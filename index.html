<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"tonymistark.github.io","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":true,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":true,"preload":true},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="å®‰é™åœ°åç€å­¦ä¹ ">
<meta property="og:type" content="website">
<meta property="og:title" content="BLOG">
<meta property="og:url" content="https://tonymistark.github.io/index.html">
<meta property="og:site_name" content="BLOG">
<meta property="og:description" content="å®‰é™åœ°åç€å­¦ä¹ ">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="Ice">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://tonymistark.github.io/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'en'
  };
</script>

  <title>BLOG</title>
  
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-W6L4L92Z6Z"></script>
    <script>
      if (CONFIG.hostname === location.hostname) {
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-W6L4L92Z6Z');
      }
    </script>


  <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?99c70b2174a7fbe4af476f28bafb19a3";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>




  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

<link rel="alternate" href="/./atom.xml" title="BLOG" type="application/atom+xml">
<link rel="alternate" href="/./rss2.xml" title="BLOG" type="application/rss+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">BLOG</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">ç”¨å¿ƒè®°å½•æ€æƒ³</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
        <li class="menu-item menu-item-sitemap">

    <a href="/sitemap.xml" rel="section"><i class="fa fa-sitemap fa-fw"></i>Sitemap</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://tonymistark.github.io/2023/11/23/design-pattern/singleton/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Ice">
      <meta itemprop="description" content="å®‰é™åœ°åç€å­¦ä¹ ">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="BLOG">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/11/23/design-pattern/singleton/" class="post-title-link" itemprop="url">Singleton</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2023-11-23 21:08:58 / Modified: 22:14:51" itemprop="dateCreated datePublished" datetime="2023-11-23T21:08:58+08:00">2023-11-23</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/design-pattern/" itemprop="url" rel="index"><span itemprop="name">design-pattern</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="Symbols count in article">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">Symbols count in article: </span>
              <span>2.9k</span>
            </span>
            <span class="post-meta-item" title="Reading time">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">Reading time &asymp;</span>
              <span>11 mins.</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="Singleton-å•ä¾‹æ¨¡å¼"><a href="#Singleton-å•ä¾‹æ¨¡å¼" class="headerlink" title="Singleton å•ä¾‹æ¨¡å¼"></a>Singleton å•ä¾‹æ¨¡å¼</h1><h2 id="Intent-æ„å›¾"><a href="#Intent-æ„å›¾" class="headerlink" title="Intent æ„å›¾"></a>Intent æ„å›¾</h2><p><strong>Singleton</strong> is a creational design pattern that lets you ensure that a class has only one instance, while providing a global access point to this instance.<br>Singleton æ˜¯ä¸€ç§åˆ›å»ºæ€§è®¾è®¡æ¨¡å¼ï¼Œå®ƒå…è®¸æ‚¨ç¡®ä¿ä¸€ä¸ªç±»åªæœ‰ä¸€ä¸ªå®ä¾‹ï¼ŒåŒæ—¶æä¾›æ­¤å®ä¾‹çš„å…¨å±€è®¿é—®ç‚¹ã€‚</p>
<div align="center"> <img src="/images/singleton-header.png"/></div>

<h2 id="Problem-é—®é¢˜"><a href="#Problem-é—®é¢˜" class="headerlink" title="Problem é—®é¢˜"></a>Problem é—®é¢˜</h2><p>The Singleton pattern solves two problems at the same time, violating the Single Responsibility Principle:<br>Singleton æ¨¡å¼åŒæ—¶è§£å†³äº†ä¸¤ä¸ªé—®é¢˜ï¼Œè¿åäº†å•ä¸€è´£ä»»åŸåˆ™ï¼š</p>
<ol>
<li><strong>Ensure that a class has just a single instance</strong>. Why would anyone want to control how many instances a class has? The most common reason for this is to control access to some shared resourceâ€”for example, a database or a file.<br>ç¡®ä¿ä¸€ä¸ªç±»åªæœ‰ä¸€ä¸ªå®ä¾‹ã€‚ä¸ºä»€ä¹ˆæœ‰äººæƒ³è¦æ§åˆ¶ä¸€ä¸ªç±»æœ‰å¤šå°‘ä¸ªå®ä¾‹ï¼Ÿæœ€å¸¸è§çš„åŸå› æ˜¯æ§åˆ¶å¯¹æŸäº›å…±äº«èµ„æºï¼ˆä¾‹å¦‚æ•°æ®åº“æˆ–æ–‡ä»¶ï¼‰çš„è®¿é—®ã€‚</li>
</ol>
<p>Hereâ€™s how it works: imagine that you created an object, but after a while decided to create a new one. Instead of receiving a fresh object, youâ€™ll get the one you already created.<br>å®ƒæ˜¯è¿™æ ·å·¥ä½œçš„ï¼šå‡è®¾ä½ åˆ›å»ºäº†ä¸€ä¸ªå¯¹è±¡ï¼Œä½†è¿‡äº†ä¸€æ®µæ—¶é—´å†³å®šåˆ›å»ºä¸€ä¸ªæ–°å¯¹è±¡ã€‚æ‚¨å°†è·å¾—å·²åˆ›å»ºçš„å¯¹è±¡ï¼Œè€Œä¸æ˜¯æ¥æ”¶æ–°å¯¹è±¡ã€‚</p>
<p>Note that this behavior is impossible to implement with a regular constructor since a constructor call must always return a new object by design.<br>è¯·æ³¨æ„ï¼Œæ­¤è¡Œä¸ºæ— æ³•ä½¿ç”¨å¸¸è§„æ„é€ å‡½æ•°å®ç°ï¼Œå› ä¸ºæ„é€ å‡½æ•°è°ƒç”¨å¿…é¡»å§‹ç»ˆè¿”å›æ–°å¯¹è±¡ã€‚</p>
<div align="center"> <img src="/images/singleton-comic-1-en.png"/>Clients may not even realize that theyâ€™re working with the same object all the time.</br>å®¢æˆ·ç”šè‡³å¯èƒ½æ²¡æœ‰æ„è¯†åˆ°ä»–ä»¬ä¸€ç›´åœ¨ä½¿ç”¨åŒä¸€ä¸ªå¯¹è±¡ã€‚</div>

<ol start="2">
<li><strong>Provide a global access point to that instance</strong>.Remember those global variables that you (all right, me) used to store some essential objects? While theyâ€™re very handy, theyâ€™re also very unsafe since any code can potentially overwrite the contents of those variables and crash the app.<br>ä¸ºè¯¥å®ä¾‹æä¾›å…¨å±€è®¿é—®ç‚¹ã€‚è¿˜è®°å¾—ä½ ï¼ˆå¥½å§ï¼Œæˆ‘ï¼‰ç”¨æ¥å­˜å‚¨ä¸€äº›åŸºæœ¬å¯¹è±¡çš„é‚£äº›å…¨å±€å˜é‡å—ï¼Ÿè™½ç„¶å®ƒä»¬éå¸¸æ–¹ä¾¿ï¼Œä½†å®ƒä»¬ä¹Ÿéå¸¸ä¸å®‰å…¨ï¼Œå› ä¸ºä»»ä½•ä»£ç éƒ½å¯èƒ½è¦†ç›–è¿™äº›å˜é‡çš„å†…å®¹å¹¶ä½¿åº”ç”¨ç¨‹åºå´©æºƒã€‚<br>Just like a global variable, the Singleton pattern lets you access some object from anywhere in the program. However, it also protects that instance from being overwritten by other code.<br>å°±åƒå…¨å±€å˜é‡ä¸€æ ·ï¼ŒSingleton æ¨¡å¼å…è®¸æ‚¨ä»ç¨‹åºä¸­çš„ä»»ä½•ä½ç½®è®¿é—®æŸäº›å¯¹è±¡ã€‚ä½†æ˜¯ï¼Œå®ƒè¿˜å¯ä»¥ä¿æŠ¤è¯¥å®ä¾‹ä¸è¢«å…¶ä»–ä»£ç è¦†ç›–ã€‚<br>Thereâ€™s another side to this problem: you donâ€™t want the code that solves problem #1 to be scattered all over your program. Itâ€™s much better to have it within one class, especially if the rest of your code already depends on it.<br>è¿™ä¸ªé—®é¢˜è¿˜æœ‰å¦ä¸€é¢ï¼šä½ ä¸å¸Œæœ›è§£å†³é—®é¢˜ #1 çš„ä»£ç åˆ†æ•£åœ¨ä½ çš„ç¨‹åºä¸­ã€‚æœ€å¥½å°†å®ƒæ”¾åœ¨ä¸€ä¸ªç±»ä¸­ï¼Œç‰¹åˆ«æ˜¯å¦‚æœæ‚¨çš„å…¶ä½™ä»£ç å·²ç»ä¾èµ–äºå®ƒã€‚</li>
</ol>
<p>Nowadays, the Singleton pattern has become so popular that people may call something a singleton even if it solves just one of the listed problems.<br>å¦‚ä»Šï¼Œå•ä¾‹æ¨¡å¼å·²ç»å˜å¾—å¦‚æ­¤æµè¡Œï¼Œä»¥è‡³äºäººä»¬å¯èƒ½ä¼šç§°æŸç‰©ä¸ºå•ä¾‹ï¼Œå³ä½¿å®ƒåªè§£å†³äº†åˆ—å‡ºçš„é—®é¢˜ä¹‹ä¸€ã€‚</p>
<h2 id="Solution-è§£å†³æ–¹æ¡ˆ"><a href="#Solution-è§£å†³æ–¹æ¡ˆ" class="headerlink" title="Solution è§£å†³æ–¹æ¡ˆ"></a>Solution è§£å†³æ–¹æ¡ˆ</h2><p>All implementations of the Singleton have these two steps in common:<br>Singleton çš„æ‰€æœ‰å®ç°éƒ½å…·æœ‰ä»¥ä¸‹ä¸¤ä¸ªå…±åŒæ­¥éª¤ï¼š</p>
<ul>
<li>Make the default constructor private, to prevent other objects from using the new operator with the Singleton class.<br>å°†é»˜è®¤æ„é€ å‡½æ•°è®¾ä¸ºç§æœ‰ï¼Œä»¥é˜²æ­¢å…¶ä»–å¯¹è±¡å°†è¿ new ç®—ç¬¦ä¸ Singleton ç±»ä¸€èµ·ä½¿ç”¨ã€‚</li>
<li>Create a static creation method that acts as a constructor. Under the hood, this method calls the private constructor to create an object and saves it in a static field. All following calls to this method return the cached object.<br>åˆ›å»ºä¸€ä¸ªå……å½“æ„é€ å‡½æ•°çš„é™æ€åˆ›å»ºæ–¹æ³•ã€‚åœ¨åå°ï¼Œæ­¤æ–¹æ³•è°ƒç”¨ç§æœ‰æ„é€ å‡½æ•°æ¥åˆ›å»ºå¯¹è±¡å¹¶å°†å…¶ä¿å­˜åœ¨é™æ€å­—æ®µä¸­ã€‚å¯¹æ­¤æ–¹æ³•çš„æ‰€æœ‰åç»­è°ƒç”¨éƒ½å°†è¿”å›ç¼“å­˜çš„å¯¹è±¡ã€‚</li>
</ul>
<p>If your code has access to the Singleton class, then itâ€™s able to call the Singletonâ€™s static method. So whenever that method is called, the same object is always returned.<br>å¦‚æœæ‚¨çš„ä»£ç æœ‰æƒè®¿é—® Singleton ç±»ï¼Œåˆ™å®ƒèƒ½å¤Ÿè°ƒç”¨ Singleton çš„é™æ€æ–¹æ³•ã€‚å› æ­¤ï¼Œæ¯å½“è°ƒç”¨è¯¥æ–¹æ³•æ—¶ï¼Œå§‹ç»ˆè¿”å›ç›¸åŒçš„å¯¹è±¡ã€‚</p>
<h2 id="Real-World-Analogy-çœŸå®ä¸–ç•Œçš„ç±»æ¯”"><a href="#Real-World-Analogy-çœŸå®ä¸–ç•Œçš„ç±»æ¯”" class="headerlink" title="Real-World Analogy çœŸå®ä¸–ç•Œçš„ç±»æ¯”"></a>Real-World Analogy çœŸå®ä¸–ç•Œçš„ç±»æ¯”</h2><p>The government is an excellent example of the Singleton pattern. A country can have only one official government. Regardless of the personal identities of the individuals who form governments, the title, â€œThe Government of Xâ€, is a global point of access that identifies the group of people in charge.<br>æ”¿åºœæ˜¯è¾›æ ¼å°”é¡¿æ¨¡å¼çš„ä¸€ä¸ªå¾ˆå¥½çš„ä¾‹å­ã€‚ä¸€ä¸ªå›½å®¶åªèƒ½æœ‰ä¸€ä¸ªå®˜æ–¹æ”¿åºœã€‚æ— è®ºç»„æˆæ”¿åºœçš„ä¸ªäººçš„ä¸ªäººèº«ä»½å¦‚ä½•ï¼Œâ€œXæ”¿åºœâ€è¿™ä¸ªå¤´è¡”éƒ½æ˜¯ä¸€ä¸ªå…¨çƒè®¿é—®ç‚¹ï¼Œç”¨äºè¯†åˆ«è´Ÿè´£äººç¾¤ä½“ã€‚</p>
<h2 id="Structure-ç»“æ„"><a href="#Structure-ç»“æ„" class="headerlink" title="Structure ç»“æ„"></a>Structure ç»“æ„</h2><div align="center"> <img src="/images/singleton-structure-en.png"/></div>
The **Singleton** class declares the static method getInstance that returns the same instance of its own class.
**Singleton** ç±»å£°æ˜è¿”å›å…¶è‡ªèº«ç±»çš„ç›¸åŒå®ä¾‹çš„é™æ€æ–¹æ³• getInstance ã€‚

<p>The Singletonâ€™s constructor should be hidden from the client code. Calling the getInstance method should be the only way of getting the Singleton object.<br>Singleton çš„æ„é€ å‡½æ•°åº”åœ¨å®¢æˆ·ç«¯ä»£ç ä¸­éšè—ã€‚è°ƒç”¨è¯¥ getInstance æ–¹æ³•åº”è¯¥æ˜¯è·å– Singleton å¯¹è±¡çš„å”¯ä¸€æ–¹æ³•ã€‚</p>
<h2 id="Pseudocode-ä¼ªä»£ç "><a href="#Pseudocode-ä¼ªä»£ç " class="headerlink" title="Pseudocode ä¼ªä»£ç "></a>Pseudocode ä¼ªä»£ç </h2><p>In this example, the database connection class acts as a <strong>Singleton</strong>. This class doesnâ€™t have a public constructor, so the only way to get its object is to call the <code>getInstance</code> method. This method caches the first created object and returns it in all subsequent calls.<br>åœ¨æ­¤ç¤ºä¾‹ä¸­ï¼Œæ•°æ®åº“è¿æ¥ç±»å……å½“ Singletonã€‚æ­¤ç±»æ²¡æœ‰å…¬å…±æ„é€ å‡½æ•°ï¼Œå› æ­¤è·å–å…¶å¯¹è±¡çš„å”¯ä¸€æ–¹æ³•æ˜¯è°ƒç”¨è¯¥ <code>getInstance</code> æ–¹æ³•ã€‚æ­¤æ–¹æ³•ç¼“å­˜ç¬¬ä¸€ä¸ªåˆ›å»ºçš„å¯¹è±¡ï¼Œå¹¶åœ¨æ‰€æœ‰åç»­è°ƒç”¨ä¸­è¿”å›è¯¥å¯¹è±¡ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// The Database class defines the `getInstance` method that lets</span></span><br><span class="line"><span class="comment">// clients access the same instance of a database connection</span></span><br><span class="line"><span class="comment">// throughout the program.</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Database</span> is</span><br><span class="line">    <span class="comment">// The field for storing the singleton instance should be</span></span><br><span class="line">    <span class="comment">// declared static.</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> field instance: Database</span><br><span class="line"></span><br><span class="line">    <span class="comment">// The singleton&#x27;s constructor should always be private to</span></span><br><span class="line">    <span class="comment">// prevent direct construction calls with the `new`</span></span><br><span class="line">    <span class="comment">// operator.</span></span><br><span class="line">    <span class="keyword">private</span> constructor <span class="title function_">Database</span><span class="params">()</span> is</span><br><span class="line">        <span class="comment">// Some initialization code, such as the actual</span></span><br><span class="line">        <span class="comment">// connection to a database server.</span></span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// The static method that controls access to the singleton</span></span><br><span class="line">    <span class="comment">// instance.</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> method <span class="title function_">getInstance</span><span class="params">()</span> is</span><br><span class="line">        <span class="title function_">if</span> <span class="params">(Database.instance == <span class="literal">null</span>)</span> then</span><br><span class="line">            <span class="title function_">acquireThreadLock</span><span class="params">()</span> and then</span><br><span class="line">                <span class="comment">// Ensure that the instance hasn&#x27;t yet been</span></span><br><span class="line">                <span class="comment">// initialized by another thread while this one</span></span><br><span class="line">                <span class="comment">// has been waiting for the lock&#x27;s release.</span></span><br><span class="line">                <span class="keyword">if</span> (Database.instance == <span class="literal">null</span>) then</span><br><span class="line">                    Database.instance = <span class="keyword">new</span> <span class="title class_">Database</span>()</span><br><span class="line">        <span class="keyword">return</span> Database.instance</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Finally, any singleton should define some business logic</span></span><br><span class="line">    <span class="comment">// which can be executed on its instance.</span></span><br><span class="line">    <span class="keyword">public</span> method <span class="title function_">query</span><span class="params">(sql)</span> is</span><br><span class="line">        <span class="comment">// For instance, all database queries of an app go</span></span><br><span class="line">        <span class="comment">// through this method. Therefore, you can place</span></span><br><span class="line">        <span class="comment">// throttling or caching logic here.</span></span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Application</span> is</span><br><span class="line">    method <span class="title function_">main</span><span class="params">()</span> is</span><br><span class="line">        <span class="type">Database</span> <span class="variable">foo</span> <span class="operator">=</span> Database.getInstance()</span><br><span class="line">        foo.query(<span class="string">&quot;SELECT ...&quot;</span>)</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">        <span class="type">Database</span> <span class="variable">bar</span> <span class="operator">=</span> Database.getInstance()</span><br><span class="line">        bar.query(<span class="string">&quot;SELECT ...&quot;</span>)</span><br><span class="line">        <span class="comment">// The variable `bar` will contain the same object as</span></span><br><span class="line">        <span class="comment">// the variable `foo`.</span></span><br></pre></td></tr></table></figure>
<h2 id="Applicability-é€‚ç”¨æ€§"><a href="#Applicability-é€‚ç”¨æ€§" class="headerlink" title="Applicability é€‚ç”¨æ€§"></a>Applicability é€‚ç”¨æ€§</h2><ul>
<li><p><strong>Use the Singleton pattern when a class in your program should have just a single instance available to all clients; for example, a single database object shared by different parts of the program.å½“ç¨‹åºä¸­çš„ç±»åº”è¯¥åªæœ‰ä¸€ä¸ªå®ä¾‹å¯ä¾›æ‰€æœ‰å®¢æˆ·ç«¯ä½¿ç”¨æ—¶ï¼Œè¯·ä½¿ç”¨å•ä¾‹æ¨¡å¼;ä¾‹å¦‚ï¼Œç”±ç¨‹åºçš„ä¸åŒéƒ¨åˆ†å…±äº«çš„å•ä¸ªæ•°æ®åº“å¯¹è±¡ã€‚</strong></p>
</li>
<li><p>The Singleton pattern disables all other means of creating objects of a class except for the special creation method. This method either creates a new object or returns an existing one if it has already been created.<br>Singleton æ¨¡å¼ç¦ç”¨é™¤ç‰¹æ®Šåˆ›å»ºæ–¹æ³•ä¹‹å¤–çš„æ‰€æœ‰å…¶ä»–åˆ›å»ºç±»å¯¹è±¡çš„æ–¹æ³•ã€‚æ­¤æ–¹æ³•è¦ä¹ˆåˆ›å»ºä¸€ä¸ªæ–°å¯¹è±¡ï¼Œè¦ä¹ˆè¿”å›ä¸€ä¸ªç°æœ‰å¯¹è±¡ï¼ˆå¦‚æœå·²åˆ›å»ºï¼‰ã€‚</p>
</li>
<li><p><strong>Use the Singleton pattern when you need stricter control over global variables.å½“æ‚¨éœ€è¦å¯¹å…¨å±€å˜é‡è¿›è¡Œæ›´ä¸¥æ ¼çš„æ§åˆ¶æ—¶ï¼Œè¯·ä½¿ç”¨å•ä¾‹æ¨¡å¼ã€‚</strong></p>
</li>
<li><p>Unlike global variables, the Singleton pattern guarantees that thereâ€™s just one instance of a class. Nothing, except for the Singleton class itself, can replace the cached instance.<br>ä¸å…¨å±€å˜é‡ä¸åŒï¼Œå•ä¾‹æ¨¡å¼ä¿è¯ä¸€ä¸ªç±»åªæœ‰ä¸€ä¸ªå®ä¾‹ã€‚é™¤äº† Singleton ç±»æœ¬èº«ä¹‹å¤–ï¼Œæ²¡æœ‰ä»»ä½•å†…å®¹å¯ä»¥æ›¿æ¢ç¼“å­˜çš„å®ä¾‹ã€‚</p>
</li>
</ul>
<p>Note that you can always adjust this limitation and allow creating any number of Singleton instances. The only piece of code that needs changing is the body of the <code>getInstance</code> method.<br>è¯·æ³¨æ„ï¼Œæ‚¨å§‹ç»ˆå¯ä»¥è°ƒæ•´æ­¤é™åˆ¶ï¼Œå¹¶å…è®¸åˆ›å»ºä»»æ„æ•°é‡çš„å•ä¾‹å®ä¾‹ã€‚å”¯ä¸€éœ€è¦æ›´æ”¹çš„ä»£ç æ®µæ˜¯ <code>getInstance</code> æ–¹æ³•çš„ä¸»ä½“ã€‚</p>
<h2 id="How-to-Implement-å¦‚ä½•å®ç°"><a href="#How-to-Implement-å¦‚ä½•å®ç°" class="headerlink" title="How to Implement å¦‚ä½•å®ç°"></a>How to Implement å¦‚ä½•å®ç°</h2><ol>
<li><p>Add a private static field to the class for storing the singleton instance.<br>åœ¨ç±»ä¸­æ·»åŠ ä¸€ä¸ªç§æœ‰é™æ€å­—æ®µï¼Œç”¨äºå­˜å‚¨å•ä¾‹å®ä¾‹ã€‚</p>
</li>
<li><p>Declare a public static creation method for getting the singleton instance.<br>å£°æ˜ç”¨äºè·å–å•ä¾‹å®ä¾‹çš„å…¬å…±é™æ€åˆ›å»ºæ–¹æ³•ã€‚</p>
</li>
<li><p>Implement â€œlazy initializationâ€ inside the static method. It should create a new object on its first call and put it into the static field. The method should always return that instance on all subsequent calls.<br>åœ¨é™æ€æ–¹æ³•ä¸­å®ç°â€œå»¶è¿Ÿåˆå§‹åŒ–â€ã€‚å®ƒåº”è¯¥åœ¨ç¬¬ä¸€æ¬¡è°ƒç”¨æ—¶åˆ›å»ºä¸€ä¸ªæ–°å¯¹è±¡ï¼Œå¹¶å°†å…¶æ”¾å…¥é™æ€å­—æ®µä¸­ã€‚è¯¥æ–¹æ³•åº”å§‹ç»ˆåœ¨æ‰€æœ‰åç»­è°ƒç”¨ä¸­è¿”å›è¯¥å®ä¾‹ã€‚</p>
</li>
<li><p>Make the constructor of the class private. The static method of the class will still be able to call the constructor, but not the other objects.<br>å°†ç±»çš„æ„é€ å‡½æ•°è®¾ä¸ºç§æœ‰ã€‚ç±»çš„é™æ€æ–¹æ³•ä»ç„¶èƒ½å¤Ÿè°ƒç”¨æ„é€ å‡½æ•°ï¼Œä½†ä¸èƒ½è°ƒç”¨å…¶ä»–å¯¹è±¡ã€‚</p>
</li>
<li><p>Go over the client code and replace all direct calls to the singletonâ€™s constructor with calls to its static creation method.<br>éå†å®¢æˆ·ç«¯ä»£ç ï¼Œå¹¶å°†å¯¹å•ä¾‹æ„é€ å‡½æ•°çš„æ‰€æœ‰ç›´æ¥è°ƒç”¨æ›¿æ¢ä¸ºå¯¹å…¶é™æ€åˆ›å»ºæ–¹æ³•çš„è°ƒç”¨ã€‚</p>
</li>
</ol>
<h2 id="Pros-and-Cons-ä¼˜ç‚¹å’Œç¼ºç‚¹"><a href="#Pros-and-Cons-ä¼˜ç‚¹å’Œç¼ºç‚¹" class="headerlink" title="Pros and Cons ä¼˜ç‚¹å’Œç¼ºç‚¹"></a>Pros and Cons ä¼˜ç‚¹å’Œç¼ºç‚¹</h2><table>
<thead>
<tr>
<th>Pros ä¼˜ç‚¹</th>
<th>Cons ç¼ºç‚¹</th>
</tr>
</thead>
<tbody><tr>
<td>You can be sure that a class has only a single instance.å¯ä»¥ç¡®å®šä¸€ä¸ªç±»åªæœ‰ä¸€ä¸ªå®ä¾‹ã€‚</td>
<td>Violates the Single Responsibility Principle. The pattern solves two problems at the time.è¿åäº†å•ä¸€è´£ä»»åŸåˆ™ã€‚è¯¥æ¨¡å¼è§£å†³äº†å½“æ—¶çš„ä¸¤ä¸ªé—®é¢˜ã€‚</td>
</tr>
<tr>
<td>You gain a global access point to that instance.æ‚¨å°†è·å¾—è¯¥å®ä¾‹çš„å…¨å±€è®¿é—®ç‚¹ã€‚</td>
<td>The Singleton pattern can mask bad design, for instance, when the components of the program know too much about each other.å•ä¾‹æ¨¡å¼å¯ä»¥æ©ç›–ç³Ÿç³•çš„è®¾è®¡ï¼Œä¾‹å¦‚ï¼Œå½“ç¨‹åºçš„ç»„ä»¶å½¼æ­¤äº†è§£å¤ªå¤šæ—¶ã€‚</td>
</tr>
<tr>
<td>The singleton object is initialized only when itâ€™s requested for the first time.ä»…å½“é¦–æ¬¡è¯·æ±‚å•ä¸€å®ä¾‹å¯¹è±¡æ—¶ï¼Œæ‰ä¼šå¯¹å…¶è¿›è¡Œåˆå§‹åŒ–ã€‚</td>
<td>The pattern requires special treatment in a multithreaded environment so that multiple threads wonâ€™t create a singleton object several times.</td>
</tr>
<tr>
<td>è¯¥æ¨¡å¼éœ€è¦åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸­è¿›è¡Œç‰¹æ®Šå¤„ç†ï¼Œä»¥ä¾¿å¤šä¸ªçº¿ç¨‹ä¸ä¼šå¤šæ¬¡åˆ›å»ºå•ä¸€å®ä¾‹å¯¹è±¡ã€‚</td>
<td></td>
</tr>
<tr>
<td></td>
<td>It may be difficult to unit test the client code of the Singleton because many test frameworks rely on inheritance when producing mock objects. Since the constructor of the singleton class is private and overriding static methods is impossible in most languages, you will need to think of a creative way to mock the singleton. Or just donâ€™t write the tests. Or donâ€™t use the Singleton pattern.å¯¹ Singleton çš„å®¢æˆ·ç«¯ä»£ç è¿›è¡Œå•å…ƒæµ‹è¯•å¯èƒ½å¾ˆå›°éš¾ï¼Œå› ä¸ºè®¸å¤šæµ‹è¯•æ¡†æ¶åœ¨ç”Ÿæˆæ¨¡æ‹Ÿå¯¹è±¡æ—¶ä¾èµ–äºç»§æ‰¿ã€‚ç”±äºå•ä¾‹ç±»çš„æ„é€ å‡½æ•°æ˜¯ç§æœ‰çš„ï¼Œå¹¶ä¸”åœ¨å¤§å¤šæ•°è¯­è¨€ä¸­ä¸å¯èƒ½é‡å†™é™æ€æ–¹æ³•ï¼Œå› æ­¤æ‚¨éœ€è¦æƒ³å‡ºä¸€ç§åˆ›é€ æ€§çš„æ–¹æ³•æ¥æ¨¡æ‹Ÿå•ä¾‹ã€‚æˆ–è€…å¹²è„†ä¸å†™æµ‹è¯•ã€‚æˆ–è€…ä¸è¦ä½¿ç”¨å•ä¸€å®ä¾‹æ¨¡å¼ã€‚</td>
</tr>
</tbody></table>
<h2 id="Relations-with-Other-Patterns-ä¸å…¶ä»–æ¨¡å¼çš„å…³ç³»"><a href="#Relations-with-Other-Patterns-ä¸å…¶ä»–æ¨¡å¼çš„å…³ç³»" class="headerlink" title="Relations with Other Patterns ä¸å…¶ä»–æ¨¡å¼çš„å…³ç³»"></a>Relations with Other Patterns ä¸å…¶ä»–æ¨¡å¼çš„å…³ç³»</h2><ul>
<li><p>A <strong>Facade</strong> class can often be transformed into a <strong>Singleton</strong> since a single facade object is sufficient in most cases.<br>Facade ç±»é€šå¸¸å¯ä»¥è½¬æ¢ä¸º Singletonï¼Œå› ä¸ºåœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œå•ä¸ª Facade å¯¹è±¡å°±è¶³å¤Ÿäº†ã€‚</p>
</li>
<li><p><strong>Flyweight</strong> would resemble <strong>Singleton</strong> if you somehow managed to reduce all shared states of the objects to just one flyweight object. But there are two fundamental differences between these patterns:<br>å¦‚æœä½ ä»¥æŸç§æ–¹å¼è®¾æ³•å°†å¯¹è±¡çš„æ‰€æœ‰å…±äº«çŠ¶æ€å‡å°‘åˆ°ä¸€ä¸ªè‡é‡çº§å¯¹è±¡ï¼Œé‚£ä¹ˆ Flyweight å°†ç±»ä¼¼äº Singletonã€‚ä½†è¿™äº›æ¨¡å¼ä¹‹é—´æœ‰ä¸¤ä¸ªæ ¹æœ¬åŒºåˆ«ï¼š</p>
<ol>
<li>There should be only one Singleton instance, whereas a Flyweight class can have multiple instances with different intrinsic states.<br>åº”è¯¥åªæœ‰ä¸€ä¸ª Singleton å®ä¾‹ï¼Œè€Œ Flyweight ç±»å¯ä»¥æœ‰å¤šä¸ªå…·æœ‰ä¸åŒå†…éƒ¨çŠ¶æ€çš„å®ä¾‹ã€‚</li>
<li>The Singleton object can be mutable. Flyweight objects are immutable.<br>Singleton å¯¹è±¡å¯ä»¥æ˜¯å¯å˜çš„ã€‚è½»é‡çº§å¯¹è±¡æ˜¯ä¸å¯å˜çš„ã€‚</li>
</ol>
</li>
<li><p>Abstract Factories, Builders and Prototypes can all be implemented as Singletons.<br>æŠ½è±¡å·¥å‚ã€æ„å»ºå™¨å’ŒåŸå‹éƒ½å¯ä»¥ä½œä¸ºå•ä¾‹å®ç°ã€‚</p>
</li>
</ul>
<Tabs>
  <TabItem value="apple" label="Apple" default>
    This is an apple ğŸ
  </TabItem>
  <TabItem value="orange" label="Orange">
    This is an orange ğŸŠ
  </TabItem>
  <TabItem value="banana" label="Banana">
    This is a banana ğŸŒ
  </TabItem>
</Tabs>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://tonymistark.github.io/2023/11/22/design-pattern/prototype/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Ice">
      <meta itemprop="description" content="å®‰é™åœ°åç€å­¦ä¹ ">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="BLOG">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/11/22/design-pattern/prototype/" class="post-title-link" itemprop="url">Prototype</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2023-11-22 21:10:02 / Modified: 23:21:21" itemprop="dateCreated datePublished" datetime="2023-11-22T21:10:02+08:00">2023-11-22</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/design-pattern/" itemprop="url" rel="index"><span itemprop="name">design-pattern</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="Symbols count in article">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">Symbols count in article: </span>
              <span>4.9k</span>
            </span>
            <span class="post-meta-item" title="Reading time">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">Reading time &asymp;</span>
              <span>18 mins.</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="Prototype-åŸå‹"><a href="#Prototype-åŸå‹" class="headerlink" title="Prototype åŸå‹"></a>Prototype åŸå‹</h1><h2 id="Intent-æ„å›¾"><a href="#Intent-æ„å›¾" class="headerlink" title="Intent æ„å›¾"></a>Intent æ„å›¾</h2><p><strong>Prototype</strong> is a creational design pattern that lets you copy existing objects without making your code dependent on their classes.<br>åŸå‹æ˜¯ä¸€ç§åˆ›å»ºæ€§è®¾è®¡æ¨¡å¼ï¼Œå®ƒå…è®¸æ‚¨å¤åˆ¶ç°æœ‰å¯¹è±¡ï¼Œè€Œä¸ä¼šä½¿ä»£ç ä¾èµ–äºå®ƒä»¬çš„ç±»ã€‚</p>
<div align="center"> <img src="/images/prototype-head.png"/></div>

<h2 id="Problem-é—®é¢˜"><a href="#Problem-é—®é¢˜" class="headerlink" title="Problem é—®é¢˜"></a>Problem é—®é¢˜</h2><p>Say you have an object, and you want to create an exact copy of it. How would you do it? First, you have to create a new object of the same class. Then you have to go through all the fields of the original object and copy their values over to the new object.<br>å‡è®¾ä½ æœ‰ä¸€ä¸ªå¯¹è±¡ï¼Œå¹¶ä¸”ä½ æƒ³åˆ›å»ºä¸€ä¸ªç²¾ç¡®çš„å‰¯æœ¬ã€‚ä½ ä¼šæ€ä¹ˆåšï¼Ÿé¦–å…ˆï¼Œæ‚¨å¿…é¡»åˆ›å»ºåŒä¸€ç±»çš„æ–°å¯¹è±¡ã€‚ç„¶åï¼Œæ‚¨å¿…é¡»éå†åŸå§‹å¯¹è±¡çš„æ‰€æœ‰å­—æ®µï¼Œå¹¶å°†å…¶å€¼å¤åˆ¶åˆ°æ–°å¯¹è±¡ã€‚</p>
<p>Nice! But thereâ€™s a catch. Not all objects can be copied that way because some of the objectâ€™s fields may be private and not visible from outside of the object itself.<br>å¥½ï¼ä½†æœ‰ä¸€ä¸ªé—®é¢˜ã€‚å¹¶éæ‰€æœ‰å¯¹è±¡éƒ½å¯ä»¥ä»¥è¿™ç§æ–¹å¼å¤åˆ¶ï¼Œå› ä¸ºå¯¹è±¡çš„æŸäº›å­—æ®µå¯èƒ½æ˜¯ç§æœ‰çš„ï¼Œå¹¶ä¸”ä»å¯¹è±¡æœ¬èº«å¤–éƒ¨ä¸å¯è§ã€‚</p>
<div align="center"> <img src="/images/prototype-comic-1-en.png"/>Copying an object â€œfrom the outsideâ€ isnâ€™t always possible.</br>â€œä»å¤–éƒ¨â€å¤åˆ¶å¯¹è±¡å¹¶ä¸æ€»æ˜¯å¯è¡Œçš„ã€‚</div>
Thereâ€™s one more problem with the direct approach. Since you have to know the objectâ€™s class to create a duplicate, your code becomes dependent on that class. If the extra dependency doesnâ€™t scare you, thereâ€™s another catch. Sometimes you only know the interface that the object follows, but not its concrete class, when, for example, a parameter in a method accepts any objects that follow some interface.
ç›´æ¥æ–¹æ³•è¿˜æœ‰ä¸€ä¸ªé—®é¢˜ã€‚ç”±äºæ‚¨å¿…é¡»çŸ¥é“å¯¹è±¡çš„ç±»æ‰èƒ½åˆ›å»ºå‰¯æœ¬ï¼Œå› æ­¤æ‚¨çš„ä»£ç å°†ä¾èµ–äºè¯¥ç±»ã€‚å¦‚æœé¢å¤–çš„ä¾èµ–å…³ç³»æ²¡æœ‰å“åˆ°ä½ ï¼Œè¿˜æœ‰å¦ä¸€ä¸ªé—®é¢˜ã€‚æœ‰æ—¶ï¼Œæ‚¨åªçŸ¥é“å¯¹è±¡æ‰€éµå¾ªçš„æ¥å£ï¼Œè€Œä¸çŸ¥é“å…¶å…·ä½“ç±»ï¼Œä¾‹å¦‚ï¼Œå½“æ–¹æ³•ä¸­çš„å‚æ•°æ¥å—æŸä¸ªæ¥å£æ‰€éµå¾ªçš„ä»»ä½•å¯¹è±¡æ—¶ã€‚

<h2 id="Solution-è§£å†³æ–¹æ¡ˆ"><a href="#Solution-è§£å†³æ–¹æ¡ˆ" class="headerlink" title="Solution è§£å†³æ–¹æ¡ˆ"></a>Solution è§£å†³æ–¹æ¡ˆ</h2><p>The Prototype pattern delegates the cloning process to the actual objects that are being cloned. The pattern declares a common interface for all objects that support cloning. This interface lets you clone an object without coupling your code to the class of that object. Usually, such an interface contains just a single <code>clone</code> method.<br>Prototype æ¨¡å¼å°†å…‹éš†è¿‡ç¨‹å§”æ‰˜ç»™æ­£åœ¨å…‹éš†çš„å®é™…å¯¹è±¡ã€‚è¯¥æ¨¡å¼ä¸ºæ”¯æŒå…‹éš†çš„æ‰€æœ‰å¯¹è±¡å£°æ˜ä¸€ä¸ªé€šç”¨æ¥å£ã€‚æ­¤æ¥å£å…è®¸æ‚¨å…‹éš†å¯¹è±¡ï¼Œè€Œæ— éœ€å°†ä»£ç è€¦åˆåˆ°è¯¥å¯¹è±¡çš„ç±»ã€‚é€šå¸¸ï¼Œè¿™æ ·çš„æ¥å£åªåŒ…å«ä¸€ä¸ª <code>clone</code> æ–¹æ³•ã€‚</p>
<p>The implementation of the clone method is very similar in all classes. The method creates an object of the current class and carries over all of the field values of the old object into the new one. You can even copy private fields because most programming languages let objects access private fields of other objects that belong to the same class.<br>è¯¥ <code>clone</code> æ–¹æ³•çš„å®ç°åœ¨æ‰€æœ‰ç±»ä¸­éƒ½éå¸¸ç›¸ä¼¼ã€‚è¯¥æ–¹æ³•åˆ›å»ºå½“å‰ç±»çš„å¯¹è±¡ï¼Œå¹¶å°†æ—§å¯¹è±¡çš„æ‰€æœ‰å­—æ®µå€¼è½¬ç§»åˆ°æ–°å¯¹è±¡ä¸­ã€‚æ‚¨ç”šè‡³å¯ä»¥å¤åˆ¶ç§æœ‰å­—æ®µï¼Œå› ä¸ºå¤§å¤šæ•°ç¼–ç¨‹è¯­è¨€å…è®¸å¯¹è±¡è®¿é—®å±äºåŒä¸€ç±»çš„å…¶ä»–å¯¹è±¡çš„ç§æœ‰å­—æ®µã€‚</p>
<p>An object that supports cloning is called a prototype. When your objects have dozens of fields and hundreds of possible configurations, cloning them might serve as an alternative to subclassing.<br>æ”¯æŒå…‹éš†çš„å¯¹è±¡ç§°ä¸ºåŸå‹ã€‚å½“æ‚¨çš„å¯¹è±¡å…·æœ‰æ•°åä¸ªå­—æ®µå’Œæ•°ç™¾ç§å¯èƒ½çš„é…ç½®æ—¶ï¼Œå…‹éš†å®ƒä»¬å¯ä»¥ä½œä¸ºå­ç±»åŒ–çš„æ›¿ä»£æ–¹æ³•ã€‚</p>
<div align="center"> <img src="/images/prototype-comic-2-en.png"/>Pre-built prototypes can be an alternative to subclassing.</br>é¢„æ„å»ºçš„åŸå‹å¯ä»¥æ›¿ä»£å­ç±»åŒ–ã€‚</div>
Hereâ€™s how it works: you create a set of objects, configured in various ways. When you need an object like the one youâ€™ve configured, you just clone a prototype instead of constructing a new object from scratch.
å®ƒæ˜¯è¿™æ ·å·¥ä½œçš„ï¼šåˆ›å»ºä¸€ç»„å¯¹è±¡ï¼Œä»¥å„ç§æ–¹å¼è¿›è¡Œé…ç½®ã€‚å½“æ‚¨éœ€è¦åƒæ‚¨é…ç½®çš„å¯¹è±¡ä¸€æ ·çš„å¯¹è±¡æ—¶ï¼Œæ‚¨åªéœ€å…‹éš†ä¸€ä¸ªåŸå‹ï¼Œè€Œä¸æ˜¯ä»å¤´å¼€å§‹æ„å»ºä¸€ä¸ªæ–°å¯¹è±¡ã€‚

<h2 id="Real-World-Analogy-çœŸå®ä¸–ç•Œçš„ç±»æ¯”"><a href="#Real-World-Analogy-çœŸå®ä¸–ç•Œçš„ç±»æ¯”" class="headerlink" title="Real-World Analogy çœŸå®ä¸–ç•Œçš„ç±»æ¯”"></a>Real-World Analogy çœŸå®ä¸–ç•Œçš„ç±»æ¯”</h2><p>In real life, prototypes are used for performing various tests before starting mass production of a product. However, in this case, prototypes donâ€™t participate in any actual production, playing a passive role instead.<br>åœ¨ç°å®ç”Ÿæ´»ä¸­ï¼ŒåŸå‹ç”¨äºåœ¨å¼€å§‹æ‰¹é‡ç”Ÿäº§äº§å“ä¹‹å‰è¿›è¡Œå„ç§æµ‹è¯•ã€‚ç„¶è€Œï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒåŸå‹ä¸å‚ä¸ä»»ä½•å®é™…ç”Ÿäº§ï¼Œè€Œæ˜¯æ‰®æ¼”è¢«åŠ¨è§’è‰²ã€‚</p>
<div align="center"> <img src="/images/prototype-comic-3-en.png"/>The division of a cell.</br>ç»†èƒçš„åˆ†è£‚ã€‚</div>
Since industrial prototypes donâ€™t really copy themselves, a much closer analogy to the pattern is the process of mitotic cell division (biology, remember?). After mitotic division, a pair of identical cells is formed. The original cell acts as a prototype and takes an active role in creating the copy.
ç”±äºå·¥ä¸šåŸå‹å¹¶ä¸èƒ½çœŸæ­£å¤åˆ¶è‡ªå·±ï¼Œå› æ­¤ä¸è¯¥æ¨¡å¼æ›´æ¥è¿‘çš„ç±»æ¯”æ˜¯æœ‰ä¸åˆ†è£‚ç»†èƒåˆ†è£‚çš„è¿‡ç¨‹ï¼ˆç”Ÿç‰©å­¦ï¼Œè¿˜è®°å¾—å—ï¼Ÿæœ‰ä¸åˆ†è£‚åï¼Œå½¢æˆä¸€å¯¹ç›¸åŒçš„ç»†èƒã€‚åŸå§‹å•å…ƒå……å½“åŸå‹ï¼Œå¹¶åœ¨åˆ›å»ºå‰¯æœ¬ä¸­å‘æŒ¥ç§¯æä½œç”¨ã€‚

<h2 id="Structure-ç»“æ„"><a href="#Structure-ç»“æ„" class="headerlink" title="Structure ç»“æ„"></a>Structure ç»“æ„</h2><h3 id="Basic-implementation-åŸºæœ¬å®ç°"><a href="#Basic-implementation-åŸºæœ¬å®ç°" class="headerlink" title="Basic implementation åŸºæœ¬å®ç°"></a>Basic implementation åŸºæœ¬å®ç°</h3><div align="center"> <img src="/images/prototyp-structure.png"/></div>

<ol>
<li><p>The <strong>Prototype</strong> interface declares the cloning methods. In most cases, itâ€™s a single clone method.<br>Prototype æ¥å£å£°æ˜å…‹éš†æ–¹æ³•ã€‚åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œå®ƒæ˜¯ä¸€ç§å•ä¸€ clone æ–¹æ³•ã€‚</p>
</li>
<li><p>The <code>Concrete Prototype</code> class implements the cloning method. In addition to copying the original objectâ€™s data to the clone, this method may also handle some edge cases of the cloning process related to cloning linked objects, untangling recursive dependencies, etc.<br>Concrete Prototype ç±»å®ç°å…‹éš†æ–¹æ³•ã€‚é™¤äº†å°†åŸå§‹å¯¹è±¡çš„æ•°æ®å¤åˆ¶åˆ°å…‹éš†ä¸­å¤–ï¼Œè¯¥æ–¹æ³•è¿˜å¯ä»¥å¤„ç†å…‹éš†è¿‡ç¨‹ä¸­ä¸å…‹éš†é“¾æ¥å¯¹è±¡ã€è§£å¼€é€’å½’ä¾èµ–å…³ç³»ç­‰ç›¸å…³çš„ä¸€äº›è¾¹ç¼˜æƒ…å†µã€‚</p>
</li>
<li><p>The <code>Client</code> can produce a copy of any object that follows the prototype interface.<br>å®¢æˆ·ç«¯å¯ä»¥ç”Ÿæˆéµå¾ªåŸå‹æ¥å£çš„ä»»ä½•å¯¹è±¡çš„å‰¯æœ¬ã€‚</p>
</li>
</ol>
<h3 id="Prototype-registry-implementation-åŸå‹æ³¨å†Œè¡¨å®ç°"><a href="#Prototype-registry-implementation-åŸå‹æ³¨å†Œè¡¨å®ç°" class="headerlink" title="Prototype registry implementation åŸå‹æ³¨å†Œè¡¨å®ç°"></a>Prototype registry implementation åŸå‹æ³¨å†Œè¡¨å®ç°</h3><div align="center"> <img src="/images/structure-prototype-cache.png"/></div>
1. The `Prototype Registry` provides an easy way to access frequently-used prototypes. It stores a set of pre-built objects that are ready to be copied. The simplest prototype registry is a name â†’ prototype hash map. However, if you need better search criteria than a simple name, you can build a much more robust version of the registry.
Prototype Registry æä¾›äº†ä¸€ç§è®¿é—®å¸¸ç”¨åŸå‹çš„ç®€å•æ–¹æ³•ã€‚å®ƒå­˜å‚¨ä¸€ç»„å‡†å¤‡å¤åˆ¶çš„é¢„æ„å»ºå¯¹è±¡ã€‚æœ€ç®€å•çš„åŸå‹æ³¨å†Œè¡¨æ˜¯ name â†’ prototype å“ˆå¸Œæ˜ å°„ã€‚ä½†æ˜¯ï¼Œå¦‚æœæ‚¨éœ€è¦æ¯”ç®€å•åç§°æ›´å¥½çš„æœç´¢æ¡ä»¶ï¼Œåˆ™å¯ä»¥æ„å»ºæ›´å¯é çš„æ³¨å†Œè¡¨ç‰ˆæœ¬ã€‚

<h2 id="Pseudocode-ä¼ªä»£ç "><a href="#Pseudocode-ä¼ªä»£ç " class="headerlink" title="Pseudocode ä¼ªä»£ç "></a>Pseudocode ä¼ªä»£ç </h2><p>In this example, the Prototype pattern lets you produce exact copies of geometric objects, without coupling the code to their classes.<br>åœ¨æ­¤ç¤ºä¾‹ä¸­ï¼ŒPrototype æ¨¡å¼å…è®¸æ‚¨ç”Ÿæˆå‡ ä½•å¯¹è±¡çš„ç²¾ç¡®å‰¯æœ¬ï¼Œè€Œæ— éœ€å°†ä»£ç è€¦åˆåˆ°å…¶ç±»ã€‚</p>
<div align="center"> <img src="/images/prototype-example1.png"/>Cloning a set of objects that belong to a class hierarchy.</br>å…‹éš†å±äºç±»å±‚æ¬¡ç»“æ„çš„ä¸€ç»„å¯¹è±¡ã€‚</div>

<p>All shape classes follow the same interface, which provides a cloning method. A subclass may call the parentâ€™s cloning method before copying its own field values to the resulting object.<br>æ‰€æœ‰å½¢çŠ¶ç±»éƒ½éµå¾ªç›¸åŒçš„æ¥å£ï¼Œè¯¥æ¥å£æä¾›å…‹éš†æ–¹æ³•ã€‚å­ç±»å¯ä»¥åœ¨å°†å…¶è‡ªå·±çš„å­—æ®µå€¼å¤åˆ¶åˆ°ç”Ÿæˆçš„å¯¹è±¡ä¹‹å‰è°ƒç”¨çˆ¶ç±»çš„å…‹éš†æ–¹æ³•ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Base prototype.</span></span><br><span class="line"><span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">Shape</span> is</span><br><span class="line">    field X: <span class="type">int</span></span><br><span class="line">    field Y: <span class="type">int</span></span><br><span class="line">    field color: string</span><br><span class="line"></span><br><span class="line">    <span class="comment">// A regular constructor.</span></span><br><span class="line">    constructor <span class="title function_">Shape</span><span class="params">()</span> is</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// The prototype constructor. A fresh object is initialized</span></span><br><span class="line">    <span class="comment">// with values from the existing object.</span></span><br><span class="line">    constructor <span class="title function_">Shape</span><span class="params">(source: Shape)</span> is</span><br><span class="line">        <span class="title function_">this</span><span class="params">()</span></span><br><span class="line">        <span class="built_in">this</span>.X = source.X</span><br><span class="line">        <span class="built_in">this</span>.Y = source.Y</span><br><span class="line">        <span class="built_in">this</span>.color = source.color</span><br><span class="line"></span><br><span class="line">    <span class="comment">// The clone operation returns one of the Shape subclasses.</span></span><br><span class="line">    <span class="keyword">abstract</span> method <span class="title function_">clone</span><span class="params">()</span>:Shape</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// Concrete prototype. The cloning method creates a new object</span></span><br><span class="line"><span class="comment">// in one go by calling the constructor of the current class and</span></span><br><span class="line"><span class="comment">// passing the current object as the constructor&#x27;s argument.</span></span><br><span class="line"><span class="comment">// Performing all the actual copying in the constructor helps to</span></span><br><span class="line"><span class="comment">// keep the result consistent: the constructor will not return a</span></span><br><span class="line"><span class="comment">// result until the new object is fully built; thus, no object</span></span><br><span class="line"><span class="comment">// can have a reference to a partially-built clone.</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Rectangle</span> <span class="keyword">extends</span> <span class="title class_">Shape</span> is</span><br><span class="line">    field width: <span class="type">int</span></span><br><span class="line">    field height: <span class="type">int</span></span><br><span class="line"></span><br><span class="line">    constructor <span class="title function_">Rectangle</span><span class="params">(source: Rectangle)</span> is</span><br><span class="line">        <span class="comment">// A parent constructor call is needed to copy private</span></span><br><span class="line">        <span class="comment">// fields defined in the parent class.</span></span><br><span class="line">        <span class="built_in">super</span>(source)</span><br><span class="line">        <span class="built_in">this</span>.width = source.width</span><br><span class="line">        <span class="built_in">this</span>.height = source.height</span><br><span class="line"></span><br><span class="line">    method <span class="title function_">clone</span><span class="params">()</span>:Shape is</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Rectangle</span>(<span class="built_in">this</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Circle</span> <span class="keyword">extends</span> <span class="title class_">Shape</span> is</span><br><span class="line">    field radius: <span class="type">int</span></span><br><span class="line"></span><br><span class="line">    constructor <span class="title function_">Circle</span><span class="params">(source: Circle)</span> is</span><br><span class="line">        <span class="title function_">super</span><span class="params">(source)</span></span><br><span class="line">        <span class="built_in">this</span>.radius = source.radius</span><br><span class="line"></span><br><span class="line">    method <span class="title function_">clone</span><span class="params">()</span>:Shape is</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Circle</span>(<span class="built_in">this</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// Somewhere in the client code.</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Application</span> is</span><br><span class="line">    field shapes: array of Shape</span><br><span class="line"></span><br><span class="line">    constructor <span class="title function_">Application</span><span class="params">()</span> is</span><br><span class="line">        <span class="type">Circle</span> <span class="variable">circle</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Circle</span>()</span><br><span class="line">        circle.X = <span class="number">10</span></span><br><span class="line">        circle.Y = <span class="number">10</span></span><br><span class="line">        circle.radius = <span class="number">20</span></span><br><span class="line">        shapes.add(circle)</span><br><span class="line"></span><br><span class="line">        <span class="type">Circle</span> <span class="variable">anotherCircle</span> <span class="operator">=</span> circle.clone()</span><br><span class="line">        shapes.add(anotherCircle)</span><br><span class="line">        <span class="comment">// The `anotherCircle` variable contains an exact copy</span></span><br><span class="line">        <span class="comment">// of the `circle` object.</span></span><br><span class="line"></span><br><span class="line">        <span class="type">Rectangle</span> <span class="variable">rectangle</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Rectangle</span>()</span><br><span class="line">        rectangle.width = <span class="number">10</span></span><br><span class="line">        rectangle.height = <span class="number">20</span></span><br><span class="line">        shapes.add(rectangle)</span><br><span class="line"></span><br><span class="line">    method <span class="title function_">businessLogic</span><span class="params">()</span> is</span><br><span class="line">        <span class="comment">// Prototype rocks because it lets you produce a copy of</span></span><br><span class="line">        <span class="comment">// an object without knowing anything about its type.</span></span><br><span class="line">        <span class="type">Array</span> <span class="variable">shapesCopy</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Array</span> of Shapes.</span><br><span class="line"></span><br><span class="line">        <span class="comment">// For instance, we don&#x27;t know the exact elements in the</span></span><br><span class="line">        <span class="comment">// shapes array. All we know is that they are all</span></span><br><span class="line">        <span class="comment">// shapes. But thanks to polymorphism, when we call the</span></span><br><span class="line">        <span class="comment">// `clone` method on a shape the program checks its real</span></span><br><span class="line">        <span class="comment">// class and runs the appropriate clone method defined</span></span><br><span class="line">        <span class="comment">// in that class. That&#x27;s why we get proper clones</span></span><br><span class="line">        <span class="comment">// instead of a set of simple Shape objects.</span></span><br><span class="line">        foreach (s in shapes) <span class="keyword">do</span></span><br><span class="line">            shapesCopy.add(s.clone())</span><br><span class="line"></span><br><span class="line">        <span class="comment">// The `shapesCopy` array contains exact copies of the</span></span><br><span class="line">        <span class="comment">// `shape` array&#x27;s children.</span></span><br></pre></td></tr></table></figure>
<h2 id="Applicability-é€‚ç”¨æ€§"><a href="#Applicability-é€‚ç”¨æ€§" class="headerlink" title="Applicability é€‚ç”¨æ€§"></a>Applicability é€‚ç”¨æ€§</h2><ul>
<li><p><strong>Use the Prototype pattern when your code shouldnâ€™t depend on the concrete classes of objects that you need to copy.å½“ä»£ç ä¸åº”ä¾èµ–äºéœ€è¦å¤åˆ¶çš„å…·ä½“å¯¹è±¡ç±»æ—¶ï¼Œè¯·ä½¿ç”¨ Prototype æ¨¡å¼ã€‚</strong></p>
</li>
<li><p>This happens a lot when your code works with objects passed to you from 3rd-party code via some interface. The concrete classes of these objects are unknown, and you couldnâ€™t depend on them even if you wanted to.<br>å½“æ‚¨çš„ä»£ç ä½¿ç”¨é€šè¿‡æŸäº›æ¥å£ä»ç¬¬ä¸‰æ–¹ä»£ç ä¼ é€’ç»™æ‚¨çš„å¯¹è±¡æ—¶ï¼Œè¿™ç§æƒ…å†µç»å¸¸å‘ç”Ÿã€‚è¿™äº›å¯¹è±¡çš„å…·ä½“ç±»åˆ«æ˜¯æœªçŸ¥çš„ï¼Œå³ä½¿ä½ æ„¿æ„ï¼Œä½ ä¹Ÿä¸èƒ½ä¾èµ–å®ƒä»¬ã€‚</p>
</li>
</ul>
<p>The Prototype pattern provides the client code with a general interface for working with all objects that support cloning. This interface makes the client code independent from the concrete classes of objects that it clones.<br>Prototype æ¨¡å¼ä¸ºå®¢æˆ·ç«¯ä»£ç æä¾›äº†ä¸€ä¸ªé€šç”¨æ¥å£ï¼Œç”¨äºå¤„ç†æ”¯æŒå…‹éš†çš„æ‰€æœ‰å¯¹è±¡ã€‚æ­¤æ¥å£ä½¿å®¢æˆ·ç«¯ä»£ç ç‹¬ç«‹äºå®ƒå…‹éš†çš„å¯¹è±¡çš„å…·ä½“ç±»ã€‚</p>
<ul>
<li><p><strong>Use the pattern when you want to reduce the number of subclasses that only differ in the way they initialize their respective objects.<br>å¦‚æœè¦å‡å°‘å­ç±»çš„æ•°é‡ï¼Œè¿™äº›å­ç±»ä»…åœ¨åˆå§‹åŒ–å„è‡ªå¯¹è±¡çš„æ–¹å¼ä¸Šæœ‰æ‰€ä¸åŒï¼Œè¯·ä½¿ç”¨è¯¥æ¨¡å¼ã€‚</strong></p>
</li>
<li><p>Suppose you have a complex class that requires a laborious configuration before it can be used. There are several common ways to configure this class, and this code is scattered through your app. To reduce the duplication, you create several subclasses and put every common configuration code into their constructors. You solved the duplication problem, but now you have lots of dummy subclasses.<br>å‡è®¾æ‚¨æœ‰ä¸€ä¸ªå¤æ‚çš„ç±»ï¼Œéœ€è¦è´¹åŠ›çš„é…ç½®æ‰èƒ½ä½¿ç”¨å®ƒã€‚æœ‰å‡ ç§å¸¸ç”¨æ–¹æ³•å¯ä»¥é…ç½®æ­¤ç±»ï¼Œå¹¶ä¸”æ­¤ä»£ç åˆ†æ•£åœ¨åº”ç”¨ä¸­ã€‚ä¸ºäº†å‡å°‘é‡å¤ï¼Œæ‚¨å¯ä»¥åˆ›å»ºå¤šä¸ªå­ç±»ï¼Œå¹¶å°†æ¯ä¸ªé€šç”¨é…ç½®ä»£ç æ”¾å…¥å…¶æ„é€ å‡½æ•°ä¸­ã€‚æ‚¨è§£å†³äº†é‡å¤é—®é¢˜ï¼Œä½†ç°åœ¨æ‚¨æœ‰å¾ˆå¤šè™šæ‹Ÿå­ç±»ã€‚</p>
</li>
</ul>
<p>The Prototype pattern lets you use a set of pre-built objects configured in various ways as prototypes. Instead of instantiating a subclass that matches some configuration, the client can simply look for an appropriate prototype and clone it.<br>Prototypeæ¨¡å¼å…è®¸æ‚¨ä½¿ç”¨ä¸€ç»„ä»¥å„ç§æ–¹å¼é…ç½®çš„é¢„æ„å»ºå¯¹è±¡ä½œä¸ºåŸå‹ã€‚å®¢æˆ·ç«¯å¯ä»¥ç®€å•åœ°å¯»æ‰¾ä¸€ä¸ªåˆé€‚çš„åŸå‹å¹¶å…‹éš†å®ƒï¼Œè€Œä¸æ˜¯å®ä¾‹åŒ–ä¸€ä¸ªåŒ¹é…æŸäº›é…ç½®çš„å­ç±»ã€‚</p>
<h2 id="How-to-Implement-å¦‚ä½•å®ç°"><a href="#How-to-Implement-å¦‚ä½•å®ç°" class="headerlink" title="How to Implement å¦‚ä½•å®ç°"></a>How to Implement å¦‚ä½•å®ç°</h2><ol>
<li><p>Create the prototype interface and declare the <code>clone</code> method in it. Or just add the method to all classes of an existing class hierarchy, if you have one.<br>åˆ›å»ºåŸå‹æ¥å£å¹¶åœ¨å…¶ä¸­å£°æ˜ <code>clone</code> æ–¹æ³•ã€‚æˆ–è€…ï¼Œåªéœ€å°†è¯¥æ–¹æ³•æ·»åŠ åˆ°ç°æœ‰ç±»å±‚æ¬¡ç»“æ„çš„æ‰€æœ‰ç±»ï¼ˆå¦‚æœæœ‰ï¼‰ã€‚</p>
</li>
<li><p>A prototype class must define the alternative constructor that accepts an object of that class as an argument. The constructor must copy the values of all fields defined in the class from the passed object into the newly created instance. If youâ€™re changing a subclass, you must call the parent constructor to let the superclass handle the cloning of its private fields.<br>åŸå‹ç±»å¿…é¡»å®šä¹‰æ¥å—è¯¥ç±»çš„å¯¹è±¡ä½œä¸ºå‚æ•°çš„æ›¿ä»£æ„é€ å‡½æ•°ã€‚æ„é€ å‡½æ•°å¿…é¡»å°†ç±»ä¸­å®šä¹‰çš„æ‰€æœ‰å­—æ®µçš„å€¼ä»ä¼ é€’çš„å¯¹è±¡å¤åˆ¶åˆ°æ–°åˆ›å»ºçš„å®ä¾‹ä¸­ã€‚å¦‚æœè¦æ›´æ”¹å­ç±»ï¼Œåˆ™å¿…é¡»è°ƒç”¨çˆ¶æ„é€ å‡½æ•°ï¼Œè®©è¶…ç±»å¤„ç†å…¶ç§æœ‰å­—æ®µçš„å…‹éš†ã€‚</p>
</li>
</ol>
<p>If your programming language doesnâ€™t support method overloading, you wonâ€™t be able to create a separate â€œprototypeâ€ constructor. Thus, copying the objectâ€™s data into the newly created clone will have to be performed within the <code>clone</code> method. Still, having this code in a regular constructor is safer because the resulting object is returned fully configured right after you call the <code>new</code> operator.<br>å¦‚æœä½ çš„ç¼–ç¨‹è¯­è¨€ä¸æ”¯æŒæ–¹æ³•é‡è½½ï¼Œä½ å°†æ— æ³•åˆ›å»ºå•ç‹¬çš„â€œåŸå‹â€æ„é€ å‡½æ•°ã€‚å› æ­¤ï¼Œå¿…é¡»åœ¨ <code>clone</code> è¯¥æ–¹æ³•ä¸­å°†å¯¹è±¡çš„æ•°æ®å¤åˆ¶åˆ°æ–°åˆ›å»ºçš„å…‹éš†ä¸­ã€‚ä¸è¿‡ï¼Œåœ¨å¸¸è§„æ„é€ å‡½æ•°ä¸­ä½¿ç”¨æ­¤ä»£ç æ›´å®‰å…¨ï¼Œå› ä¸ºåœ¨è°ƒç”¨ <code>new</code> è¿ç®—ç¬¦åç«‹å³è¿”å›å®Œå…¨é…ç½®çš„ç»“æœå¯¹è±¡ã€‚</p>
<ol start="3">
<li><p>The cloning method usually consists of just one line: running a <code>new</code> operator with the prototypical version of the constructor. Note, that every class must explicitly override the cloning method and use its own class name along with the <code>new</code> operator. Otherwise, the cloning method may produce an object of a parent class.<br>å…‹éš†æ–¹æ³•é€šå¸¸åªåŒ…å«ä¸€è¡Œï¼šä½¿ç”¨æ„é€ å‡½æ•°çš„åŸå‹ç‰ˆæœ¬è¿è¡Œè¿ <code>new</code> ç®—ç¬¦ã€‚è¯·æ³¨æ„ï¼Œæ¯ä¸ªç±»éƒ½å¿…é¡»æ˜¾å¼è¦†ç›–å…‹éš†æ–¹æ³•ï¼Œå¹¶ä½¿ç”¨è‡ªå·±çš„ç±»åå’Œ <code>new</code> è¿ç®—ç¬¦ã€‚å¦åˆ™ï¼Œå…‹éš†æ–¹æ³•å¯èƒ½ä¼šç”Ÿæˆçˆ¶ç±»çš„å¯¹è±¡ã€‚</p>
</li>
<li><p>Optionally, create a centralized prototype registry to store a catalog of frequently used prototypes.<br>ï¼ˆå¯é€‰ï¼‰åˆ›å»ºä¸€ä¸ªé›†ä¸­å¼åŸå‹æ³¨å†Œè¡¨æ¥å­˜å‚¨å¸¸ç”¨åŸå‹çš„ç›®å½•ã€‚</p>
</li>
</ol>
<p>You can implement the registry as a new factory class or put it in the base prototype class with a static method for fetching the prototype. This method should search for a prototype based on search criteria that the client code passes to the method. The criteria might either be a simple string tag or a complex set of search parameters. After the appropriate prototype is found, the registry should clone it and return the copy to the client.<br>æ‚¨å¯ä»¥å°†æ³¨å†Œè¡¨å®ç°ä¸ºæ–°çš„å·¥å‚ç±»ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ç”¨äºè·å–åŸå‹çš„é™æ€æ–¹æ³•å°†å…¶æ”¾åœ¨åŸºåŸå‹ç±»ä¸­ã€‚æ­¤æ–¹æ³•åº”æ ¹æ®å®¢æˆ·ç«¯ä»£ç ä¼ é€’ç»™è¯¥æ–¹æ³•çš„æœç´¢æ¡ä»¶æœç´¢åŸå‹ã€‚æ¡ä»¶å¯ä»¥æ˜¯ç®€å•çš„å­—ç¬¦ä¸²æ ‡è®°ï¼Œä¹Ÿå¯ä»¥æ˜¯ä¸€ç»„å¤æ‚çš„æœç´¢å‚æ•°ã€‚æ‰¾åˆ°é€‚å½“çš„åŸå‹åï¼Œæ³¨å†Œè¡¨åº”å…‹éš†å®ƒå¹¶å°†å‰¯æœ¬è¿”å›ç»™å®¢æˆ·ç«¯ã€‚</p>
<p>Finally, replace the direct calls to the subclassesâ€™ constructors with calls to the factory method of the prototype registry.<br>æœ€åï¼Œå°†å¯¹å­ç±»æ„é€ å‡½æ•°çš„ç›´æ¥è°ƒç”¨æ›¿æ¢ä¸ºå¯¹åŸå‹æ³¨å†Œè¡¨çš„å·¥å‚æ–¹æ³•çš„è°ƒç”¨ã€‚</p>
<h2 id="Pros-and-Cons-ä¼˜ç‚¹å’Œç¼ºç‚¹"><a href="#Pros-and-Cons-ä¼˜ç‚¹å’Œç¼ºç‚¹" class="headerlink" title="Pros and Cons ä¼˜ç‚¹å’Œç¼ºç‚¹"></a>Pros and Cons ä¼˜ç‚¹å’Œç¼ºç‚¹</h2><ul>
<li>You can clone objects without coupling to their concrete classes.<br>æ‚¨å¯ä»¥å…‹éš†å¯¹è±¡ï¼Œè€Œæ— éœ€è€¦åˆåˆ°å…¶å…·ä½“ç±»ã€‚</li>
</ul>
<table>
<thead>
<tr>
<th>Pros ä¼˜ç‚¹</th>
<th>Cons ç¼ºç‚¹</th>
</tr>
</thead>
<tbody><tr>
<td>You can clone objects without coupling to their concrete classes.æ‚¨å¯ä»¥å…‹éš†å¯¹è±¡ï¼Œè€Œæ— éœ€è€¦åˆåˆ°å…¶å…·ä½“ç±»ã€‚</td>
<td>Cloning complex objects that have circular references might be very tricky.å…‹éš†å…·æœ‰å¾ªç¯å¼•ç”¨çš„å¤æ‚å¯¹è±¡å¯èƒ½éå¸¸æ£˜æ‰‹ã€‚</td>
</tr>
<tr>
<td>You can get rid of repeated initialization code in favor of cloning pre-built prototypes.æ‚¨å¯ä»¥æ‘†è„±é‡å¤çš„åˆå§‹åŒ–ä»£ç ï¼Œè½¬è€Œå…‹éš†é¢„æ„å»ºçš„åŸå‹ã€‚</td>
<td></td>
</tr>
<tr>
<td>You can produce complex objects more conveniently.æ‚¨å¯ä»¥æ›´æ–¹ä¾¿åœ°ç”Ÿæˆå¤æ‚çš„å¯¹è±¡ã€‚</td>
<td></td>
</tr>
<tr>
<td>You get an alternative to inheritance when dealing with configuration presets for complex objects.åœ¨å¤„ç†å¤æ‚å¯¹è±¡çš„é…ç½®é¢„è®¾æ—¶ï¼Œæ‚¨å¯ä»¥è·å¾—ç»§æ‰¿çš„æ›¿ä»£æ–¹æ³•ã€‚</td>
<td></td>
</tr>
</tbody></table>
<h2 id="Relations-with-Other-Patterns-ä¸å…¶ä»–æ¨¡å¼çš„å…³ç³»"><a href="#Relations-with-Other-Patterns-ä¸å…¶ä»–æ¨¡å¼çš„å…³ç³»" class="headerlink" title="Relations with Other Patterns ä¸å…¶ä»–æ¨¡å¼çš„å…³ç³»"></a>Relations with Other Patterns ä¸å…¶ä»–æ¨¡å¼çš„å…³ç³»</h2><ul>
<li><p>Many designs start by using <code>Factory Method</code> (less complicated and more customizable via subclasses) and evolve toward <code>Abstract Factory</code>, Prototype, or Builder (more flexible, but more complicated).<br>è®¸å¤šè®¾è®¡ä»ä½¿ç”¨å·¥å‚æ–¹æ³•ï¼ˆä¸é‚£ä¹ˆå¤æ‚ï¼Œé€šè¿‡å­ç±»æ›´å¯å®šåˆ¶ï¼‰å¼€å§‹ï¼Œç„¶åå‘å±•åˆ°æŠ½è±¡å·¥å‚ã€åŸå‹æˆ–æ„å»ºå™¨ï¼ˆæ›´çµæ´»ï¼Œä½†æ›´å¤æ‚ï¼‰ã€‚</p>
</li>
<li><p><code>Abstract Factory</code> classes are often based on a set of <code>Factory Methods</code>, but you can also use <code>Prototype</code> to compose the methods on these classes.<br>æŠ½è±¡å·¥å‚ç±»é€šå¸¸åŸºäºä¸€ç»„å·¥å‚æ–¹æ³•ï¼Œä½†æ‚¨ä¹Ÿå¯ä»¥ä½¿ç”¨ Prototype æ¥ç»„åˆè¿™äº›ç±»çš„æ–¹æ³•ã€‚</p>
</li>
<li><p><code>Prototype</code> can help when you need to save copies of <code>Commands</code> into history.<br>å½“æ‚¨éœ€è¦å°†å‘½ä»¤çš„å‰¯æœ¬ä¿å­˜åˆ°å†å²è®°å½•ä¸­æ—¶ï¼ŒPrototype å¯ä»¥æä¾›å¸®åŠ©ã€‚</p>
</li>
<li><p>Designs that make heavy use of <code>Composite</code> and <code>Decorator</code> can often benefit from using <code>Prototype</code>. Applying the pattern lets you clone complex structures instead of re-constructing them from scratch.<br>å¤§é‡ä½¿ç”¨ Composite å’Œ Decorator çš„è®¾è®¡é€šå¸¸å¯ä»¥ä»ä½¿ç”¨ Prototype ä¸­å—ç›Šã€‚é€šè¿‡åº”ç”¨è¯¥æ¨¡å¼ï¼Œæ‚¨å¯ä»¥å…‹éš†å¤æ‚çš„ç»“æ„ï¼Œè€Œä¸æ˜¯ä»å¤´å¼€å§‹é‡æ–°æ„å»ºå®ƒä»¬ã€‚</p>
</li>
<li><p><code>Prototype</code> isnâ€™t based on inheritance, so it doesnâ€™t have its drawbacks. On the other hand, Prototype requires a complicated initialization of the cloned object. <code>Factory Method</code> is based on inheritance but doesnâ€™t require an initialization step.<br>åŸå‹ä¸æ˜¯åŸºäºç»§æ‰¿çš„ï¼Œæ‰€ä»¥å®ƒæ²¡æœ‰ç¼ºç‚¹ã€‚å¦ä¸€æ–¹é¢ï¼ŒPrototype éœ€è¦å¯¹å…‹éš†å¯¹è±¡è¿›è¡Œå¤æ‚çš„åˆå§‹åŒ–ã€‚å·¥å‚æ–¹æ³•åŸºäºç»§æ‰¿ï¼Œä½†ä¸éœ€è¦åˆå§‹åŒ–æ­¥éª¤ã€‚</p>
</li>
<li><p>Sometimes <code>Prototype</code> can be a simpler alternative to <code>Memento</code>. This works if the object, the state of which you want to store in the history, is fairly straightforward and doesnâ€™t have links to external resources, or the links are easy to re-establish.<br>æœ‰æ—¶ï¼ŒPrototype å¯ä»¥æˆä¸º Memento çš„æ›´ç®€å•æ›¿ä»£å“ã€‚å¦‚æœè¦å­˜å‚¨åœ¨å†å²è®°å½•ä¸­çš„å¯¹è±¡çš„çŠ¶æ€ç›¸å½“ç®€å•ï¼Œå¹¶ä¸”æ²¡æœ‰æŒ‡å‘å¤–éƒ¨èµ„æºçš„é“¾æ¥ï¼Œæˆ–è€…é“¾æ¥æ˜“äºé‡æ–°å»ºç«‹ï¼Œåˆ™æ­¤æ–¹æ³•æœ‰æ•ˆã€‚</p>
</li>
<li><p><code>Abstract Factories</code>, <code>Builders</code> and <code>Prototypes</code> can all be implemented as <code>Singletons</code>.<br>æŠ½è±¡å·¥å‚ã€æ„å»ºå™¨å’ŒåŸå‹éƒ½å¯ä»¥ä½œä¸ºå•ä¾‹å®ç°ã€‚</p>
</li>
</ul>
<h2 id="Code-Examples-ä»£ç ç¤ºä¾‹"><a href="#Code-Examples-ä»£ç ç¤ºä¾‹" class="headerlink" title="Code Examples ä»£ç ç¤ºä¾‹"></a>Code Examples ä»£ç ç¤ºä¾‹</h2><h3 id="Python-Conceptual-example"><a href="#Python-Conceptual-example" class="headerlink" title="Python Conceptual example"></a>Python Conceptual example</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> copy</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SelfReferencingEntity</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        self.parent = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">set_parent</span>(<span class="params">self, parent</span>):</span><br><span class="line">        self.parent = parent</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SomeComponent</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    Python provides its own interface of Prototype via `copy.copy` and</span></span><br><span class="line"><span class="string">    `copy.deepcopy` functions. And any class that wants to implement custom</span></span><br><span class="line"><span class="string">    implementations have to override `__copy__` and `__deepcopy__` member</span></span><br><span class="line"><span class="string">    functions.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, some_int, some_list_of_objects, some_circular_ref</span>):</span><br><span class="line">        self.some_int = some_int</span><br><span class="line">        self.some_list_of_objects = some_list_of_objects</span><br><span class="line">        self.some_circular_ref = some_circular_ref</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__copy__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        Create a shallow copy. This method will be called whenever someone calls</span></span><br><span class="line"><span class="string">        `copy.copy` with this object and the returned value is returned as the</span></span><br><span class="line"><span class="string">        new shallow copy.</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># First, let&#x27;s create copies of the nested objects.</span></span><br><span class="line">        some_list_of_objects = copy.copy(self.some_list_of_objects)</span><br><span class="line">        some_circular_ref = copy.copy(self.some_circular_ref)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Then, let&#x27;s clone the object itself, using the prepared clones of the</span></span><br><span class="line">        <span class="comment"># nested objects.</span></span><br><span class="line">        new = self.__class__(</span><br><span class="line">            self.some_int, some_list_of_objects, some_circular_ref</span><br><span class="line">        )</span><br><span class="line">        new.__dict__.update(self.__dict__)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> new</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__deepcopy__</span>(<span class="params">self, memo=<span class="literal">None</span></span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        Create a deep copy. This method will be called whenever someone calls</span></span><br><span class="line"><span class="string">        `copy.deepcopy` with this object and the returned value is returned as</span></span><br><span class="line"><span class="string">        the new deep copy.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        What is the use of the argument `memo`? Memo is the dictionary that is</span></span><br><span class="line"><span class="string">        used by the `deepcopy` library to prevent infinite recursive copies in</span></span><br><span class="line"><span class="string">        instances of circular references. Pass it to all the `deepcopy` calls</span></span><br><span class="line"><span class="string">        you make in the `__deepcopy__` implementation to prevent infinite</span></span><br><span class="line"><span class="string">        recursions.</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">if</span> memo <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            memo = &#123;&#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment"># First, let&#x27;s create copies of the nested objects.</span></span><br><span class="line">        some_list_of_objects = copy.deepcopy(self.some_list_of_objects, memo)</span><br><span class="line">        some_circular_ref = copy.deepcopy(self.some_circular_ref, memo)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Then, let&#x27;s clone the object itself, using the prepared clones of the</span></span><br><span class="line">        <span class="comment"># nested objects.</span></span><br><span class="line">        new = self.__class__(</span><br><span class="line">            self.some_int, some_list_of_objects, some_circular_ref</span><br><span class="line">        )</span><br><span class="line">        new.__dict__ = copy.deepcopy(self.__dict__, memo)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> new</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line"></span><br><span class="line">    list_of_objects = [<span class="number">1</span>, &#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>&#125;, [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]]</span><br><span class="line">    circular_ref = SelfReferencingEntity()</span><br><span class="line">    component = SomeComponent(<span class="number">23</span>, list_of_objects, circular_ref)</span><br><span class="line">    circular_ref.set_parent(component)</span><br><span class="line"></span><br><span class="line">    shallow_copied_component = copy.copy(component)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Let&#x27;s change the list in shallow_copied_component and see if it changes in</span></span><br><span class="line">    <span class="comment"># component.</span></span><br><span class="line">    shallow_copied_component.some_list_of_objects.append(<span class="string">&quot;another object&quot;</span>)</span><br><span class="line">    <span class="keyword">if</span> component.some_list_of_objects[-<span class="number">1</span>] == <span class="string">&quot;another object&quot;</span>:</span><br><span class="line">        <span class="built_in">print</span>(</span><br><span class="line">            <span class="string">&quot;Adding elements to `shallow_copied_component`&#x27;s &quot;</span></span><br><span class="line">            <span class="string">&quot;some_list_of_objects adds it to `component`&#x27;s &quot;</span></span><br><span class="line">            <span class="string">&quot;some_list_of_objects.&quot;</span></span><br><span class="line">        )</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(</span><br><span class="line">            <span class="string">&quot;Adding elements to `shallow_copied_component`&#x27;s &quot;</span></span><br><span class="line">            <span class="string">&quot;some_list_of_objects doesn&#x27;t add it to `component`&#x27;s &quot;</span></span><br><span class="line">            <span class="string">&quot;some_list_of_objects.&quot;</span></span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Let&#x27;s change the set in the list of objects.</span></span><br><span class="line">    component.some_list_of_objects[<span class="number">1</span>].add(<span class="number">4</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="number">4</span> <span class="keyword">in</span> shallow_copied_component.some_list_of_objects[<span class="number">1</span>]:</span><br><span class="line">        <span class="built_in">print</span>(</span><br><span class="line">            <span class="string">&quot;Changing objects in the `component`&#x27;s some_list_of_objects &quot;</span></span><br><span class="line">            <span class="string">&quot;changes that object in `shallow_copied_component`&#x27;s &quot;</span></span><br><span class="line">            <span class="string">&quot;some_list_of_objects.&quot;</span></span><br><span class="line">        )</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(</span><br><span class="line">            <span class="string">&quot;Changing objects in the `component`&#x27;s some_list_of_objects &quot;</span></span><br><span class="line">            <span class="string">&quot;doesn&#x27;t change that object in `shallow_copied_component`&#x27;s &quot;</span></span><br><span class="line">            <span class="string">&quot;some_list_of_objects.&quot;</span></span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">    deep_copied_component = copy.deepcopy(component)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Let&#x27;s change the list in deep_copied_component and see if it changes in</span></span><br><span class="line">    <span class="comment"># component.</span></span><br><span class="line">    deep_copied_component.some_list_of_objects.append(<span class="string">&quot;one more object&quot;</span>)</span><br><span class="line">    <span class="keyword">if</span> component.some_list_of_objects[-<span class="number">1</span>] == <span class="string">&quot;one more object&quot;</span>:</span><br><span class="line">        <span class="built_in">print</span>(</span><br><span class="line">            <span class="string">&quot;Adding elements to `deep_copied_component`&#x27;s &quot;</span></span><br><span class="line">            <span class="string">&quot;some_list_of_objects adds it to `component`&#x27;s &quot;</span></span><br><span class="line">            <span class="string">&quot;some_list_of_objects.&quot;</span></span><br><span class="line">        )</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(</span><br><span class="line">            <span class="string">&quot;Adding elements to `deep_copied_component`&#x27;s &quot;</span></span><br><span class="line">            <span class="string">&quot;some_list_of_objects doesn&#x27;t add it to `component`&#x27;s &quot;</span></span><br><span class="line">            <span class="string">&quot;some_list_of_objects.&quot;</span></span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Let&#x27;s change the set in the list of objects.</span></span><br><span class="line">    component.some_list_of_objects[<span class="number">1</span>].add(<span class="number">10</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="number">10</span> <span class="keyword">in</span> deep_copied_component.some_list_of_objects[<span class="number">1</span>]:</span><br><span class="line">        <span class="built_in">print</span>(</span><br><span class="line">            <span class="string">&quot;Changing objects in the `component`&#x27;s some_list_of_objects &quot;</span></span><br><span class="line">            <span class="string">&quot;changes that object in `deep_copied_component`&#x27;s &quot;</span></span><br><span class="line">            <span class="string">&quot;some_list_of_objects.&quot;</span></span><br><span class="line">        )</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(</span><br><span class="line">            <span class="string">&quot;Changing objects in the `component`&#x27;s some_list_of_objects &quot;</span></span><br><span class="line">            <span class="string">&quot;doesn&#x27;t change that object in `deep_copied_component`&#x27;s &quot;</span></span><br><span class="line">            <span class="string">&quot;some_list_of_objects.&quot;</span></span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(</span><br><span class="line">        <span class="string">f&quot;id(deep_copied_component.some_circular_ref.parent): &quot;</span></span><br><span class="line">        <span class="string">f&quot;<span class="subst">&#123;<span class="built_in">id</span>(deep_copied_component.some_circular_ref.parent)&#125;</span>&quot;</span></span><br><span class="line">    )</span><br><span class="line">    <span class="built_in">print</span>(</span><br><span class="line">        <span class="string">f&quot;id(deep_copied_component.some_circular_ref.parent.some_circular_ref.parent): &quot;</span></span><br><span class="line">        <span class="string">f&quot;<span class="subst">&#123;<span class="built_in">id</span>(deep_copied_component.some_circular_ref.parent.some_circular_ref.parent)&#125;</span>&quot;</span></span><br><span class="line">    )</span><br><span class="line">    <span class="built_in">print</span>(</span><br><span class="line">        <span class="string">&quot;^^ This shows that deepcopied objects contain same reference, they &quot;</span></span><br><span class="line">        <span class="string">&quot;are not cloned repeatedly.&quot;</span></span><br><span class="line">    )</span><br></pre></td></tr></table></figure>

<h3 id="Output-txt-Execution-result"><a href="#Output-txt-Execution-result" class="headerlink" title="Output.txt: Execution result"></a>Output.txt: Execution result</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Adding elements to `shallow_copied_component`&#x27;s some_list_of_objects adds it to `component`&#x27;s some_list_of_objects.</span><br><span class="line">Changing objects in the `component`&#x27;s some_list_of_objects changes that object in `shallow_copied_component`&#x27;s some_list_of_objects.</span><br><span class="line">Adding elements to `deep_copied_component`&#x27;s some_list_of_objects doesn&#x27;t add it to `component`&#x27;s some_list_of_objects.</span><br><span class="line">Changing objects in the `component`&#x27;s some_list_of_objects doesn&#x27;t change that object in `deep_copied_component`&#x27;s some_list_of_objects.</span><br><span class="line">id(deep_copied_component.some_circular_ref.parent): 4429472784</span><br><span class="line">id(deep_copied_component.some_circular_ref.parent.some_circular_ref.parent): 4429472784</span><br><span class="line">^^ This shows that deepcopied objects contain same reference, they are not cloned repeatedly.</span><br></pre></td></tr></table></figure>

<h3 id="Rust-Built-in-Clone-trait-å†…ç½®å…‹éš†ç‰¹å¾"><a href="#Rust-Built-in-Clone-trait-å†…ç½®å…‹éš†ç‰¹å¾" class="headerlink" title="Rust Built-in Clone trait å†…ç½®å…‹éš†ç‰¹å¾"></a>Rust Built-in Clone trait å†…ç½®å…‹éš†ç‰¹å¾</h3><p>Rust has a built-in <code>std::clone::Clone</code> trait with many implementations for various types (via <code>#[derive(Clone)]</code>). Thus, the Prototype pattern is ready to use out of the box.<br>Rust æœ‰ä¸€ä¸ªå†…ç½® <code>std::clone::Clone</code> çš„ç‰¹æ€§ï¼Œå…·æœ‰è®¸å¤šé’ˆå¯¹å„ç§ç±»å‹çš„å®ç°ï¼ˆé€šè¿‡ <code>#[derive(Clone)]</code> ï¼‰ã€‚å› æ­¤ï¼ŒåŸå‹æ¨¡å¼å¯ä»¥å¼€ç®±å³ç”¨ã€‚</p>
<h4 id="main-rs"><a href="#main-rs" class="headerlink" title="main.rs"></a>main.rs</h4><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#[derive(Clone)]</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Circle</span> &#123;</span><br><span class="line">    <span class="keyword">pub</span> x: <span class="type">u32</span>,</span><br><span class="line">    <span class="keyword">pub</span> y: <span class="type">u32</span>,</span><br><span class="line">    <span class="keyword">pub</span> radius: <span class="type">u32</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">circle1</span> = Circle &#123;</span><br><span class="line">        x: <span class="number">10</span>,</span><br><span class="line">        y: <span class="number">15</span>,</span><br><span class="line">        radius: <span class="number">10</span>,</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Prototype in action.</span></span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">circle2</span> = circle1.<span class="title function_ invoke__">clone</span>();</span><br><span class="line">    circle2.radius = <span class="number">77</span>;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;Circle 1: &#123;&#125;, &#123;&#125;, &#123;&#125;&quot;</span>, circle1.x, circle1.y, circle1.radius);</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;Circle 2: &#123;&#125;, &#123;&#125;, &#123;&#125;&quot;</span>, circle2.x, circle2.y, circle2.radius);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Output"><a href="#Output" class="headerlink" title="Output"></a>Output</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Circle 1: 10, 15, 10</span><br><span class="line">Circle 2: 10, 15, 77</span><br></pre></td></tr></table></figure>




      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://tonymistark.github.io/2023/11/21/design-pattern/builder/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Ice">
      <meta itemprop="description" content="å®‰é™åœ°åç€å­¦ä¹ ">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="BLOG">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/11/21/design-pattern/builder/" class="post-title-link" itemprop="url">Builder</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2023-11-21 20:42:48" itemprop="dateCreated datePublished" datetime="2023-11-21T20:42:48+08:00">2023-11-21</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2023-11-22 23:21:21" itemprop="dateModified" datetime="2023-11-22T23:21:21+08:00">2023-11-22</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/design-pattern/" itemprop="url" rel="index"><span itemprop="name">design-pattern</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="Symbols count in article">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">Symbols count in article: </span>
              <span>7.7k</span>
            </span>
            <span class="post-meta-item" title="Reading time">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">Reading time &asymp;</span>
              <span>28 mins.</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="Builder-å»ºé€ è€…"><a href="#Builder-å»ºé€ è€…" class="headerlink" title="Builder å»ºé€ è€…"></a>Builder å»ºé€ è€…</h1><h2 id="Intent-æ„å›¾"><a href="#Intent-æ„å›¾" class="headerlink" title="Intent æ„å›¾"></a>Intent æ„å›¾</h2><p><strong>Builder</strong> is a creational design pattern that lets you construct complex objects step by step. The pattern allows you to produce different types and representations of an object using the same construction code.<br><strong>Builder</strong> æ˜¯ä¸€ç§åˆ›å»ºæ€§è®¾è®¡æ¨¡å¼ï¼Œå¯è®©æ‚¨é€æ­¥æ„å»ºå¤æ‚çš„å¯¹è±¡ã€‚è¯¥æ¨¡å¼å…è®¸æ‚¨ä½¿ç”¨ç›¸åŒçš„æ„é€ ä»£ç ç”Ÿæˆå¯¹è±¡çš„ä¸åŒç±»å‹å’Œè¡¨ç¤ºå½¢å¼ã€‚</p>
<div align="center"> <img src="/images/builder-en.png"/></div>

<h2 id="Problem-é—®é¢˜"><a href="#Problem-é—®é¢˜" class="headerlink" title="Problem é—®é¢˜"></a>Problem é—®é¢˜</h2><p>Imagine a complex object that requires laborious, step-by-step initialization of many fields and nested objects. Such initialization code is usually buried inside a monstrous constructor with lots of parameters. Or even worse: scattered all over the client code.<br>æƒ³è±¡ä¸€ä¸ªå¤æ‚çš„å¯¹è±¡ï¼Œéœ€è¦è´¹åŠ›åœ°é€æ­¥åˆå§‹åŒ–è®¸å¤šå­—æ®µå’ŒåµŒå¥—å¯¹è±¡ã€‚è¿™ç§åˆå§‹åŒ–ä»£ç é€šå¸¸éšè—åœ¨å…·æœ‰å¤§é‡å‚æ•°çš„å¯æ€•æ„é€ å‡½æ•°ä¸­ã€‚æˆ–è€…æ›´ç³Ÿç³•çš„æ˜¯ï¼šåˆ†æ•£åœ¨å®¢æˆ·ç«¯ä»£ç ä¸­ã€‚</p>
<div align="center"> <img src="/images/builder-problem1.png"/>You might make the program too complex by creating a subclass for every possible configuration of an object.</é€šè¿‡ä¸ºå¯¹è±¡çš„æ¯ä¸ªå¯èƒ½é…ç½®åˆ›å»ºä¸€ä¸ªå­ç±»ï¼Œå¯èƒ½ä¼šä½¿ç¨‹åºè¿‡äºå¤æ‚ã€‚></div>

<p>For example, letâ€™s think about how to create a <code>House</code> object. To build a simple house, you need to construct four walls and a floor, install a door, fit a pair of windows, and build a roof. But what if you want a bigger, brighter house, with a backyard and other goodies (like a heating system, plumbing, and electrical wiring)?<br>ä¾‹å¦‚ï¼Œè®©æˆ‘ä»¬è€ƒè™‘å¦‚ä½•åˆ›å»ºä¸€ä¸ª <code>House</code> å¯¹è±¡ã€‚è¦å»ºé€ ä¸€ä¸ªç®€å•çš„æˆ¿å­ï¼Œä½ éœ€è¦å»ºé€ å››é¢å¢™å’Œä¸€ä¸ªåœ°æ¿ï¼Œå®‰è£…ä¸€æ‰‡é—¨ï¼Œå®‰è£…ä¸€å¯¹çª—æˆ·ï¼Œå¹¶å»ºé€ ä¸€ä¸ªå±‹é¡¶ã€‚ä½†æ˜¯ï¼Œå¦‚æœæ‚¨æƒ³è¦ä¸€ä¸ªæ›´å¤§ã€æ›´æ˜äº®çš„æˆ¿å­ï¼Œæœ‰åé™¢å’Œå…¶ä»–å¥½ä¸œè¥¿ï¼ˆå¦‚ä¾›æš–ç³»ç»Ÿã€ç®¡é“å’Œç”µçº¿ï¼‰æ€ä¹ˆåŠï¼Ÿ</p>
<p>The simplest solution is to extend the base <code>House</code> class and create a set of subclasses to cover all combinations of the parameters. But eventually youâ€™ll end up with a considerable number of subclasses. Any new parameter, such as the porch style, will require growing this hierarchy even more.<br>æœ€ç®€å•çš„è§£å†³æ–¹æ¡ˆæ˜¯æ‰©å±•åŸº <code>House</code> ç±»å¹¶åˆ›å»ºä¸€ç»„å­ç±»ä»¥æ¶µç›–å‚æ•°çš„æ‰€æœ‰ç»„åˆã€‚ä½†æœ€ç»ˆä½ ä¼šå¾—åˆ°ç›¸å½“å¤šçš„å­ç±»ã€‚ä»»ä½•æ–°å‚æ•°ï¼ˆä¾‹å¦‚é—¨å»Šæ ·å¼ï¼‰éƒ½éœ€è¦è¿›ä¸€æ­¥æ‰©å±•æ­¤å±‚æ¬¡ç»“æ„ã€‚</p>
<p>Thereâ€™s another approach that doesnâ€™t involve breeding subclasses. You can create a giant constructor right in the base <code>House</code> class with all possible parameters that control the house object. While this approach indeed eliminates the need for subclasses, it creates another problem.<br>è¿˜æœ‰å¦ä¸€ç§æ–¹æ³•ä¸æ¶‰åŠè‚²ç§å­ç±»ã€‚æ‚¨å¯ä»¥ç›´æ¥åœ¨åŸº <code>House</code> ç±»ä¸­åˆ›å»ºä¸€ä¸ªå·¨å¤§çš„æ„é€ å‡½æ•°ï¼Œå…¶ä¸­åŒ…å«æ§åˆ¶ house å¯¹è±¡çš„æ‰€æœ‰å¯èƒ½å‚æ•°ã€‚è™½ç„¶è¿™ç§æ–¹æ³•ç¡®å®æ¶ˆé™¤äº†å¯¹å­ç±»çš„éœ€æ±‚ï¼Œä½†å®ƒäº§ç”Ÿäº†å¦ä¸€ä¸ªé—®é¢˜ã€‚</p>
<div align="center"> <img src="/images/builder-problem2.png"/>The constructor with lots of parameters has its downside: not all the parameters are needed at all times.</br>å…·æœ‰å¤§é‡å‚æ•°çš„æ„é€ å‡½æ•°æœ‰å…¶ç¼ºç‚¹ï¼šå¹¶éæ‰€æœ‰å‚æ•°éƒ½æ˜¯å¿…éœ€çš„ã€‚</div>

<p>In most cases most of the parameters will be unused, making <strong>the constructor calls pretty ugly</strong>. For instance, only a fraction of houses have swimming pools, so the parameters related to swimming pools will be useless nine times out of ten.<br>åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œå¤§å¤šæ•°å‚æ•°å°†å¤„äºæœªä½¿ç”¨çŠ¶æ€ï¼Œè¿™ä½¿å¾—æ„é€ å‡½æ•°è°ƒç”¨éå¸¸ä¸‘é™‹ã€‚ä¾‹å¦‚ï¼Œåªæœ‰ä¸€å°éƒ¨åˆ†æˆ¿å±‹æœ‰æ¸¸æ³³æ± ï¼Œå› æ­¤ä¸æ¸¸æ³³æ± ç›¸å…³çš„å‚æ•°åæœ‰å…«ä¹å°†æ¯«æ— ç”¨å¤„ã€‚</p>
<h2 id="Solution-è§£å†³æ–¹æ¡ˆ"><a href="#Solution-è§£å†³æ–¹æ¡ˆ" class="headerlink" title="Solution è§£å†³æ–¹æ¡ˆ"></a>Solution è§£å†³æ–¹æ¡ˆ</h2><p>The Builder pattern suggests that you extract the object construction code out of its own class and move it to separate objects called builders.<br>Builder æ¨¡å¼å»ºè®®æ‚¨å°†å¯¹è±¡æ„é€ ä»£ç ä»å…¶è‡ªå·±çš„ç±»ä¸­æå–å‡ºæ¥ï¼Œå¹¶å°†å…¶ç§»åŠ¨åˆ°ç§°ä¸ºç”Ÿæˆå™¨çš„å•ç‹¬å¯¹è±¡ä¸­ã€‚</p>
<div align="center"> <img src="/images/builder-solution1.png"/>The Builder pattern lets you construct complex objects step by step. The Builder doesnâ€™t allow other objects to access the product while itâ€™s being built.</br>Builder æ¨¡å¼å…è®¸æ‚¨é€æ­¥æ„å»ºå¤æ‚çš„å¯¹è±¡ã€‚Builder ä¸å…è®¸å…¶ä»–å¯¹è±¡åœ¨æ„å»ºäº§å“æ—¶è®¿é—®äº§å“ã€‚</div>

<p>The pattern organizes object construction into a set of steps (<code>buildWalls</code>, <code>buildDoor</code>, etc.). To create an object, you execute a series of these steps on a builder object. The important part is that you donâ€™t need to call all of the steps. You can call only those steps that are necessary for producing a particular configuration of an object.<br>è¯¥æ¨¡å¼å°†å¯¹è±¡æ„é€ ç»„ç»‡ä¸ºä¸€ç»„æ­¥éª¤ï¼ˆ<code>buildWalls</code>, <code>buildDoor</code> ç­‰ï¼‰ã€‚è¦åˆ›å»ºå¯¹è±¡ï¼Œè¯·åœ¨ç”Ÿæˆå™¨å¯¹è±¡ä¸Šæ‰§è¡Œä¸€ç³»åˆ—è¿™äº›æ­¥éª¤ã€‚é‡è¦çš„æ˜¯ï¼Œæ‚¨ä¸éœ€è¦è°ƒç”¨æ‰€æœ‰æ­¥éª¤ã€‚æ‚¨åªèƒ½è°ƒç”¨ç”Ÿæˆå¯¹è±¡çš„ç‰¹å®šé…ç½®æ‰€éœ€çš„é‚£äº›æ­¥éª¤ã€‚</p>
<p>Some of the construction steps might require different implementation when you need to build various representations of the product. For example, walls of a cabin may be built of wood, but the castle walls must be built with stone.<br>å½“æ‚¨éœ€è¦æ„å»ºäº§å“çš„å„ç§è¡¨ç¤ºå½¢å¼æ—¶ï¼ŒæŸäº›æ„é€ æ­¥éª¤å¯èƒ½éœ€è¦ä¸åŒçš„å®ç°ã€‚ä¾‹å¦‚ï¼Œå°å±‹çš„å¢™å£å¯ä»¥ç”¨æœ¨å¤´å»ºé€ ï¼Œä½†åŸå ¡çš„å¢™å£å¿…é¡»ç”¨çŸ³å¤´å»ºé€ ã€‚</p>
<p>In this case, you can create several different builder classes that implement the same set of building steps, but in a different manner. Then you can use these builders in the construction process (i.e., an ordered set of calls to the building steps) to produce different kinds of objects.<br>åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ‚¨å¯ä»¥åˆ›å»ºå¤šä¸ªä¸åŒçš„ç”Ÿæˆå™¨ç±»ï¼Œè¿™äº›ç±»ä»¥ä¸åŒçš„æ–¹å¼å®ç°åŒä¸€ç»„ç”Ÿæˆæ­¥éª¤ã€‚ç„¶åï¼Œæ‚¨å¯ä»¥åœ¨æ„é€ è¿‡ç¨‹ä¸­ä½¿ç”¨è¿™äº›æ„å»ºå™¨ï¼ˆå³ï¼Œå¯¹æ„å»ºæ­¥éª¤çš„ä¸€ç»„æœ‰åºè°ƒç”¨ï¼‰æ¥ç”Ÿæˆä¸åŒç±»å‹çš„å¯¹è±¡ã€‚</p>
<div align="center"> <img src="/images/builder-comic-1-en.png"/>Different builders execute the same task in various ways.</br>ä¸åŒçš„æ„å»ºå™¨ä»¥ä¸åŒçš„æ–¹å¼æ‰§è¡Œç›¸åŒçš„ä»»åŠ¡ã€‚</div>

<p>For example, imagine a builder that builds everything from wood and glass, a second one that builds everything with stone and iron and a third one that uses gold and diamonds. By calling the same set of steps, you get a regular house from the first builder, a small castle from the second and a palace from the third. However, this would only work if the client code that calls the building steps is able to interact with builders using a common interface.<br>ä¾‹å¦‚ï¼Œæƒ³è±¡ä¸€ä¸ªå»ºç­‘å•†ç”¨æœ¨å¤´å’Œç»ç’ƒå»ºé€ æ‰€æœ‰ä¸œè¥¿ï¼Œç¬¬äºŒä¸ªå»ºç­‘å•†ç”¨çŸ³å¤´å’Œé“å»ºé€ æ‰€æœ‰ä¸œè¥¿ï¼Œç¬¬ä¸‰ä¸ªå»ºç­‘å•†ä½¿ç”¨é»„é‡‘å’Œé’»çŸ³å»ºé€ æ‰€æœ‰ä¸œè¥¿ã€‚é€šè¿‡è°ƒç”¨ç›¸åŒçš„æ­¥éª¤ï¼Œæ‚¨å¯ä»¥ä»ç¬¬ä¸€ä¸ªå»ºç­‘å•†é‚£é‡Œè·å¾—æ™®é€šæˆ¿å±‹ï¼Œä»ç¬¬äºŒä¸ªå»ºé€ è€…é‚£é‡Œè·å¾—ä¸€åº§å°åŸå ¡ï¼Œä»ç¬¬ä¸‰ä¸ªå»ºé€ è€…é‚£é‡Œè·å¾—ä¸€åº§å®«æ®¿ã€‚ä½†æ˜¯ï¼Œä»…å½“è°ƒç”¨ç”Ÿæˆæ­¥éª¤çš„å®¢æˆ·ç«¯ä»£ç èƒ½å¤Ÿä½¿ç”¨é€šç”¨æ¥å£ä¸æ„å»ºå™¨äº¤äº’æ—¶ï¼Œè¿™æ‰æœ‰æ•ˆã€‚</p>
<h2 id="Director"><a href="#Director" class="headerlink" title="Director"></a>Director</h2><p>You can go further and extract a series of calls to the builder steps you use to construct a product into a separate class called director. The director class defines the order in which to execute the building steps, while the builder provides the implementation for those steps.<br>æ‚¨å¯ä»¥æ›´è¿›ä¸€æ­¥ï¼Œå°†å¯¹ç”¨äºå°†äº§å“æ„é€ åˆ°ç§°ä¸º director çš„å•ç‹¬ç±»çš„æ„å»ºå™¨æ­¥éª¤çš„ä¸€ç³»åˆ—è°ƒç”¨ä¸­æå–å‡ºæ¥ã€‚director ç±»å®šä¹‰æ‰§è¡Œç”Ÿæˆæ­¥éª¤çš„é¡ºåºï¼Œè€Œç”Ÿæˆå™¨åˆ™æä¾›è¿™äº›æ­¥éª¤çš„å®ç°ã€‚</p>
<div align="center"> <img src="/images/builder-comic-2-en.png"/>The director knows which building steps to execute to get a working product.</br>ä¸»ç®¡çŸ¥é“è¦æ‰§è¡Œå“ªäº›æ„å»ºæ­¥éª¤æ‰èƒ½è·å¾—å·¥ä½œäº§å“ã€‚</div>

<p>Having a director class in your program isnâ€™t strictly necessary. You can always call the building steps in a specific order directly from the client code. However, the director class might be a good place to put various construction routines so you can reuse them across your program.<br>åœ¨æ‚¨çš„è¯¾ç¨‹ä¸­å¼€è®¾directorç±»å¹¶ä¸æ˜¯ç»å¯¹å¿…è¦çš„ã€‚æ‚¨å§‹ç»ˆå¯ä»¥ç›´æ¥ä»å®¢æˆ·ç«¯ä»£ç æŒ‰ç‰¹å®šé¡ºåºè°ƒç”¨ç”Ÿæˆæ­¥éª¤ã€‚ä½†æ˜¯ï¼Œdirector ç±»å¯èƒ½æ˜¯æ”¾ç½®å„ç§æ„é€ ä¾‹ç¨‹çš„å¥½åœ°æ–¹ï¼Œä»¥ä¾¿æ‚¨å¯ä»¥åœ¨ç¨‹åºä¸­é‡ç”¨å®ƒä»¬ã€‚</p>
<p>In addition, the director class completely hides the details of product construction from the client code. The client only needs to associate a builder with a director, launch the construction with the director, and get the result from the builder.<br>æ­¤å¤–ï¼Œdirector ç±»åœ¨å®¢æˆ·ç«¯ä»£ç ä¸­å®Œå…¨éšè—äº†äº§å“æ„é€ çš„ç»†èŠ‚ã€‚å®¢æˆ·ç«¯åªéœ€å°†æ„å»ºå™¨ä¸æ§åˆ¶å™¨å…³è”ï¼Œä¸æ§åˆ¶å™¨ä¸€èµ·å¯åŠ¨æ„é€ ï¼Œå¹¶ä»æ„å»ºå™¨è·å–ç»“æœã€‚</p>
<h2 id="Structure-ç»“æ„"><a href="#Structure-ç»“æ„" class="headerlink" title="Structure ç»“æ„"></a>Structure ç»“æ„</h2><div align="center"> <img src="/images/builder-structure.png"/></div>

<ol>
<li><p>The <strong>Builder</strong> interface declares product construction steps that are common to all types of builders.<br>Builder ç•Œé¢å£°æ˜äº†æ‰€æœ‰ç±»å‹çš„æ„å»ºå™¨é€šç”¨çš„äº§å“æ„å»ºæ­¥</p>
</li>
<li><p><strong>Concrete</strong> Builders provide different implementations of the construction steps. Concrete builders may produce products that donâ€™t follow the common interface.<br>æ··å‡åœŸå»ºé€ è€…æä¾›æ–½å·¥æ­¥éª¤çš„ä¸åŒå®æ–½ã€‚æ··å‡åœŸå»ºç­‘å•†å¯èƒ½ä¼šç”Ÿäº§ä¸éµå¾ªé€šç”¨æ¥å£çš„äº§å“ã€‚</p>
</li>
<li><p><strong>Products</strong> are resulting objects. Products constructed by different builders donâ€™t have to belong to the same class hierarchy or interface.<br>äº§å“æ˜¯ç»“æœå¯¹è±¡ã€‚ç”±ä¸åŒæ„å»ºå™¨æ„å»ºçš„äº§å“ä¸å¿…å±äºç›¸åŒçš„ç±»å±‚æ¬¡ç»“æ„æˆ–æ¥å£ã€‚</p>
</li>
<li><p>The <strong>Director</strong> class defines the order in which to call construction steps, so you can create and reuse specific configurations of products.<br>Director ç±»å®šä¹‰è°ƒç”¨æ„é€ æ­¥éª¤çš„é¡ºåºï¼Œä»¥ä¾¿æ‚¨å¯ä»¥åˆ›å»ºå’Œé‡ç”¨äº§å“çš„ç‰¹å®šé…ç½®ã€‚</p>
</li>
<li><p>The <strong>Client</strong> must associate one of the builder objects with the director. Usually, itâ€™s done just once, via parameters of the directorâ€™s constructor. Then the director uses that builder object for all further construction. However, thereâ€™s an alternative approach for when the client passes the builder object to the production method of the director. In this case, you can use a different builder each time you produce something with the director.<br>å®¢æˆ·ç«¯å¿…é¡»å°†å…¶ä¸­ä¸€ä¸ªæ„å»ºå™¨å¯¹è±¡ä¸æ§åˆ¶å™¨ç›¸å…³è”ã€‚é€šå¸¸ï¼Œå®ƒåªé€šè¿‡æ§åˆ¶å™¨æ„é€ å‡½æ•°çš„å‚æ•°å®Œæˆä¸€æ¬¡ã€‚ç„¶åï¼Œdirector ä½¿ç”¨è¯¥æ„å»ºå™¨å¯¹è±¡è¿›è¡Œæ‰€æœ‰è¿›ä¸€æ­¥çš„æ„é€ ã€‚ä½†æ˜¯ï¼Œå½“å®¢æˆ·ç«¯å°†ç”Ÿæˆå™¨å¯¹è±¡ä¼ é€’ç»™æ§åˆ¶å™¨çš„ç”Ÿäº§æ–¹æ³•æ—¶ï¼Œè¿˜æœ‰å¦ä¸€ç§æ–¹æ³•ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ¯æ¬¡ä¸directorä¸€èµ·åˆ¶ä½œå†…å®¹æ—¶ï¼Œéƒ½å¯ä»¥ä½¿ç”¨ä¸åŒçš„æ„å»ºå™¨ã€‚</p>
</li>
</ol>
<h2 id="Pseudocode-ä¼ªä»£ç "><a href="#Pseudocode-ä¼ªä»£ç " class="headerlink" title="Pseudocode ä¼ªä»£ç "></a>Pseudocode ä¼ªä»£ç </h2><p>This example of the <strong>Builder</strong> pattern illustrates how you can reuse the same object construction code when building different types of products, such as cars, and create the corresponding manuals for them.<br>æ­¤ Builder æ¨¡å¼ç¤ºä¾‹è¯´æ˜äº†å¦‚ä½•åœ¨æ„å»ºä¸åŒç±»å‹çš„äº§å“ï¼ˆå¦‚æ±½è½¦ï¼‰æ—¶é‡ç”¨ç›¸åŒçš„å¯¹è±¡æ„é€ ä»£ç ï¼Œå¹¶ä¸ºå®ƒä»¬åˆ›å»ºç›¸åº”çš„æ‰‹å†Œã€‚</p>
<div align="center"> <img src="/images/builder-example-en.png"/>The example of step-by-step construction of cars and the user guides that fit those car models.</br>æ±½è½¦çš„åˆ†æ­¥æ„é€ ç¤ºä¾‹ä»¥åŠé€‚åˆè¿™äº›æ±½è½¦å‹å·çš„ç”¨æˆ·æŒ‡å—ã€‚</div>

<p>A car is a complex object that can be constructed in a hundred different ways. Instead of bloating the <code>Car</code> class with a huge constructor, we extracted the car assembly code into a separate car builder class. This class has a set of methods for configuring various parts of a car.<br>æ±½è½¦æ˜¯ä¸€ä¸ªå¤æ‚çš„ç‰©ä½“ï¼Œå¯ä»¥ç”¨ä¸€ç™¾ç§ä¸åŒçš„æ–¹å¼å»ºé€ ã€‚æˆ‘ä»¬æ²¡æœ‰ä½¿ç”¨åºå¤§çš„æ„é€ å‡½æ•°æ¥è†¨èƒ€ç±» <code>Car</code> ï¼Œè€Œæ˜¯å°†æ±½è½¦è£…é…ä»£ç æå–åˆ°ä¸€ä¸ªå•ç‹¬çš„ car builder ç±»ä¸­ã€‚æ­¤ç±»å…·æœ‰ä¸€ç»„ç”¨äºé…ç½®æ±½è½¦å„ä¸ªéƒ¨åˆ†çš„æ–¹æ³•ã€‚</p>
<p>If the client code needs to assemble a special, fine-tuned model of a car, it can work with the builder directly. On the other hand, the client can delegate the assembly to the director class, which knows how to use a builder to construct several of the most popular models of cars.<br>å¦‚æœå®¢æˆ·ç«¯ä»£ç éœ€è¦ç»„è£…ä¸€ä¸ªç‰¹æ®Šçš„ã€å¾®è°ƒçš„æ±½è½¦æ¨¡å‹ï¼Œå®ƒå¯ä»¥ç›´æ¥ä¸æ„å»ºå™¨ä¸€èµ·ä½¿ç”¨ã€‚å¦ä¸€æ–¹é¢ï¼Œå®¢æˆ·ç«¯å¯ä»¥å°†ç¨‹åºé›†å§”æ‰˜ç»™ director ç±»ï¼Œè¯¥ç±»çŸ¥é“å¦‚ä½•ä½¿ç”¨æ„å»ºå™¨æ¥æ„é€ å‡ ç§æœ€æµè¡Œçš„æ±½è½¦æ¨¡å‹ã€‚</p>
<p>You might be shocked, but every car needs a manual (seriously, who reads them?). The manual describes every feature of the car, so the details in the manuals vary across the different models. Thatâ€™s why it makes sense to reuse an existing construction process for both real cars and their respective manuals. Of course, building a manual isnâ€™t the same as building a car, and thatâ€™s why we must provide another builder class that specializes in composing manuals. This class implements the same building methods as its car-building sibling, but instead of crafting car parts, it describes them. By passing these builders to the same director object, we can construct either a car or a manual.<br>æ‚¨å¯èƒ½ä¼šæ„Ÿåˆ°éœ‡æƒŠï¼Œä½†æ¯è¾†è½¦éƒ½éœ€è¦ä¸€æœ¬æ‰‹å†Œï¼ˆè¯´çœŸçš„ï¼Œè°ä¼šè¯»å®ƒä»¬ï¼Ÿæ‰‹å†Œæè¿°äº†æ±½è½¦çš„æ¯ä¸ªåŠŸèƒ½ï¼Œå› æ­¤æ‰‹å†Œä¸­çš„ç»†èŠ‚å› ä¸åŒè½¦å‹è€Œå¼‚ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆåœ¨çœŸå®æ±½è½¦åŠå…¶å„è‡ªçš„æ‰‹å†Œä¸­é‡å¤ä½¿ç”¨ç°æœ‰çš„åˆ¶é€ è¿‡ç¨‹æ˜¯æœ‰æ„ä¹‰çš„ã€‚å½“ç„¶ï¼Œæ„å»ºæ‰‹å†Œä¸æ„å»ºæ±½è½¦ä¸åŒï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»¬å¿…é¡»æä¾›å¦ä¸€ä¸ªä¸“é—¨ç¼–å†™æ‰‹å†Œçš„æ„å»ºè€…ç±»ã€‚è¯¥ç±»å®ç°äº†ä¸å…¶æ±½è½¦åˆ¶é€ åŒçº§ç›¸åŒçš„æ„å»ºæ–¹æ³•ï¼Œä½†ä¸æ˜¯åˆ¶ä½œæ±½è½¦é›¶ä»¶ï¼Œè€Œæ˜¯æè¿°å®ƒä»¬ã€‚é€šè¿‡å°†è¿™äº›æ„å»ºå™¨ä¼ é€’ç»™åŒä¸€ä¸ª director å¯¹è±¡ï¼Œæˆ‘ä»¬å¯ä»¥æ„é€ æ±½è½¦æˆ–æ‰‹å†Œã€‚</p>
<p>The final part is fetching the resulting object. A metal car and a paper manual, although related, are still very different things. We canâ€™t place a method for fetching results in the director without coupling the director to concrete product classes. Hence, we obtain the result of the construction from the builder which performed the job.<br>æœ€åä¸€éƒ¨åˆ†æ˜¯è·å–ç”Ÿæˆçš„å¯¹è±¡ã€‚é‡‘å±æ±½è½¦å’Œçº¸è´¨æ‰‹å†Œè™½ç„¶ç›¸å…³ï¼Œä½†ä»ç„¶æ˜¯éå¸¸ä¸åŒçš„ä¸œè¥¿ã€‚å¦‚æœä¸å°†æ§åˆ¶å™¨ä¸å…·ä½“çš„äº§å“ç±»è€¦åˆï¼Œæˆ‘ä»¬å°±æ— æ³•åœ¨æ§åˆ¶å™¨ä¸­æ”¾ç½®è·å–ç»“æœçš„æ–¹æ³•ã€‚å› æ­¤ï¼Œæˆ‘ä»¬ä»æ‰§è¡Œå·¥ä½œçš„å»ºç­‘å•†é‚£é‡Œè·å¾—æ–½å·¥ç»“æœã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Using the Builder pattern makes sense only when your products</span></span><br><span class="line"><span class="comment">// are quite complex and require extensive configuration. The</span></span><br><span class="line"><span class="comment">// following two products are related, although they don&#x27;t have</span></span><br><span class="line"><span class="comment">// a common interface.</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Car</span> is</span><br><span class="line">    <span class="comment">// A car can have a GPS, trip computer and some number of</span></span><br><span class="line">    <span class="comment">// seats. Different models of cars (sports car, SUV,</span></span><br><span class="line">    <span class="comment">// cabriolet) might have different features installed or</span></span><br><span class="line">    <span class="comment">// enabled.</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Manual</span> is</span><br><span class="line">    <span class="comment">// Each car should have a user manual that corresponds to</span></span><br><span class="line">    <span class="comment">// the car&#x27;s configuration and describes all its features.</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// The builder interface specifies methods for creating the</span></span><br><span class="line"><span class="comment">// different parts of the product objects.</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">Builder</span> is</span><br><span class="line">    method <span class="title function_">reset</span><span class="params">()</span></span><br><span class="line">    method <span class="title function_">setSeats</span><span class="params">(...)</span></span><br><span class="line">    method <span class="title function_">setEngine</span><span class="params">(...)</span></span><br><span class="line">    method <span class="title function_">setTripComputer</span><span class="params">(...)</span></span><br><span class="line">    method <span class="title function_">setGPS</span><span class="params">(...)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// The concrete builder classes follow the builder interface and</span></span><br><span class="line"><span class="comment">// provide specific implementations of the building steps. Your</span></span><br><span class="line"><span class="comment">// program may have several variations of builders, each</span></span><br><span class="line"><span class="comment">// implemented differently.</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CarBuilder</span> <span class="keyword">implements</span> <span class="title class_">Builder</span> is</span><br><span class="line">    <span class="keyword">private</span> field car:Car</span><br><span class="line"></span><br><span class="line">    <span class="comment">// A fresh builder instance should contain a blank product</span></span><br><span class="line">    <span class="comment">// object which it uses in further assembly.</span></span><br><span class="line">    constructor <span class="title function_">CarBuilder</span><span class="params">()</span> is</span><br><span class="line">        <span class="built_in">this</span>.reset()</span><br><span class="line"></span><br><span class="line">    <span class="comment">// The reset method clears the object being built.</span></span><br><span class="line">    method <span class="title function_">reset</span><span class="params">()</span> is</span><br><span class="line">        <span class="built_in">this</span>.car = <span class="keyword">new</span> <span class="title class_">Car</span>()</span><br><span class="line"></span><br><span class="line">    <span class="comment">// All production steps work with the same product instance.</span></span><br><span class="line">    method <span class="title function_">setSeats</span><span class="params">(...)</span> is</span><br><span class="line">        <span class="comment">// Set the number of seats in the car.</span></span><br><span class="line"></span><br><span class="line">    method <span class="title function_">setEngine</span><span class="params">(...)</span> is</span><br><span class="line">        <span class="comment">// Install a given engine.</span></span><br><span class="line"></span><br><span class="line">    method <span class="title function_">setTripComputer</span><span class="params">(...)</span> is</span><br><span class="line">        <span class="comment">// Install a trip computer.</span></span><br><span class="line"></span><br><span class="line">    method <span class="title function_">setGPS</span><span class="params">(...)</span> is</span><br><span class="line">        <span class="comment">// Install a global positioning system.</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// Concrete builders are supposed to provide their own</span></span><br><span class="line">    <span class="comment">// methods for retrieving results. That&#x27;s because various</span></span><br><span class="line">    <span class="comment">// types of builders may create entirely different products</span></span><br><span class="line">    <span class="comment">// that don&#x27;t all follow the same interface. Therefore such</span></span><br><span class="line">    <span class="comment">// methods can&#x27;t be declared in the builder interface (at</span></span><br><span class="line">    <span class="comment">// least not in a statically-typed programming language).</span></span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">    <span class="comment">// Usually, after returning the end result to the client, a</span></span><br><span class="line">    <span class="comment">// builder instance is expected to be ready to start</span></span><br><span class="line">    <span class="comment">// producing another product. That&#x27;s why it&#x27;s a usual</span></span><br><span class="line">    <span class="comment">// practice to call the reset method at the end of the</span></span><br><span class="line">    <span class="comment">// `getProduct` method body. However, this behavior isn&#x27;t</span></span><br><span class="line">    <span class="comment">// mandatory, and you can make your builder wait for an</span></span><br><span class="line">    <span class="comment">// explicit reset call from the client code before disposing</span></span><br><span class="line">    <span class="comment">// of the previous result.</span></span><br><span class="line">    method <span class="title function_">getProduct</span><span class="params">()</span>:Car <span class="type">is</span></span><br><span class="line">        <span class="variable">product</span> <span class="operator">=</span> <span class="built_in">this</span>.car</span><br><span class="line">        <span class="built_in">this</span>.reset()</span><br><span class="line">        <span class="keyword">return</span> product</span><br><span class="line"></span><br><span class="line"><span class="comment">// Unlike other creational patterns, builder lets you construct</span></span><br><span class="line"><span class="comment">// products that don&#x27;t follow the common interface.</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CarManualBuilder</span> <span class="keyword">implements</span> <span class="title class_">Builder</span> is</span><br><span class="line">    <span class="keyword">private</span> field manual:Manual</span><br><span class="line"></span><br><span class="line">    constructor <span class="title function_">CarManualBuilder</span><span class="params">()</span> is</span><br><span class="line">        <span class="built_in">this</span>.reset()</span><br><span class="line"></span><br><span class="line">    method <span class="title function_">reset</span><span class="params">()</span> is</span><br><span class="line">        <span class="built_in">this</span>.manual = <span class="keyword">new</span> <span class="title class_">Manual</span>()</span><br><span class="line"></span><br><span class="line">    method <span class="title function_">setSeats</span><span class="params">(...)</span> is</span><br><span class="line">        <span class="comment">// Document car seat features.</span></span><br><span class="line"></span><br><span class="line">    method <span class="title function_">setEngine</span><span class="params">(...)</span> is</span><br><span class="line">        <span class="comment">// Add engine instructions.</span></span><br><span class="line"></span><br><span class="line">    method <span class="title function_">setTripComputer</span><span class="params">(...)</span> is</span><br><span class="line">        <span class="comment">// Add trip computer instructions.</span></span><br><span class="line"></span><br><span class="line">    method <span class="title function_">setGPS</span><span class="params">(...)</span> is</span><br><span class="line">        <span class="comment">// Add GPS instructions.</span></span><br><span class="line"></span><br><span class="line">    method <span class="title function_">getProduct</span><span class="params">()</span>:Manual is</span><br><span class="line">        <span class="comment">// Return the manual and reset the builder.</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// The director is only responsible for executing the building</span></span><br><span class="line"><span class="comment">// steps in a particular sequence. It&#x27;s helpful when producing</span></span><br><span class="line"><span class="comment">// products according to a specific order or configuration.</span></span><br><span class="line"><span class="comment">// Strictly speaking, the director class is optional, since the</span></span><br><span class="line"><span class="comment">// client can control builders directly.</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Director</span> is</span><br><span class="line">    <span class="comment">// The director works with any builder instance that the</span></span><br><span class="line">    <span class="comment">// client code passes to it. This way, the client code may</span></span><br><span class="line">    <span class="comment">// alter the final type of the newly assembled product.</span></span><br><span class="line">    <span class="comment">// The director can construct several product variations</span></span><br><span class="line">    <span class="comment">// using the same building steps.</span></span><br><span class="line">    method <span class="title function_">constructSportsCar</span><span class="params">(builder: Builder)</span> is</span><br><span class="line">        builder.reset()</span><br><span class="line">        builder.setSeats(<span class="number">2</span>)</span><br><span class="line">        builder.setEngine(<span class="keyword">new</span> <span class="title class_">SportEngine</span>())</span><br><span class="line">        builder.setTripComputer(<span class="literal">true</span>)</span><br><span class="line">        builder.setGPS(<span class="literal">true</span>)</span><br><span class="line"></span><br><span class="line">    method <span class="title function_">constructSUV</span><span class="params">(builder: Builder)</span> is</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// The client code creates a builder object, passes it to the</span></span><br><span class="line"><span class="comment">// director and then initiates the construction process. The end</span></span><br><span class="line"><span class="comment">// result is retrieved from the builder object.</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Application</span> is</span><br><span class="line"></span><br><span class="line">    method <span class="title function_">makeCar</span><span class="params">()</span> <span class="type">is</span></span><br><span class="line">        <span class="variable">director</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Director</span>()</span><br><span class="line"></span><br><span class="line">        <span class="type">CarBuilder</span> <span class="variable">builder</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CarBuilder</span>()</span><br><span class="line">        director.constructSportsCar(builder)</span><br><span class="line">        <span class="type">Car</span> <span class="variable">car</span> <span class="operator">=</span> builder.getProduct()</span><br><span class="line"></span><br><span class="line">        <span class="type">CarManualBuilder</span> <span class="variable">builder</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CarManualBuilder</span>()</span><br><span class="line">        director.constructSportsCar(builder)</span><br><span class="line"></span><br><span class="line">        <span class="comment">// The final product is often retrieved from a builder</span></span><br><span class="line">        <span class="comment">// object since the director isn&#x27;t aware of and not</span></span><br><span class="line">        <span class="comment">// dependent on concrete builders and products.</span></span><br><span class="line">        <span class="type">Manual</span> <span class="variable">manual</span> <span class="operator">=</span> builder.getProduct()</span><br></pre></td></tr></table></figure>

<h2 id="Applicability-é€‚ç”¨æ€§"><a href="#Applicability-é€‚ç”¨æ€§" class="headerlink" title="Applicability é€‚ç”¨æ€§"></a>Applicability é€‚ç”¨æ€§</h2><ul>
<li><p><strong>Use the Builder pattern to get rid of a â€œtelescoping constructorâ€. ä½¿ç”¨ Builder æ¨¡å¼æ¥æ‘†è„±â€œä¼¸ç¼©æ„é€ å‡½æ•°â€ã€‚</strong></p>
</li>
<li><p>Say you have a constructor with ten optional parameters. Calling such a beast is very inconvenient; therefore, you overload the constructor and create several shorter versions with fewer parameters. These constructors still refer to the main one, passing some default values into any omitted parameters.<br>å‡è®¾æ‚¨æœ‰ä¸€ä¸ªåŒ…å«åä¸ªå¯é€‰å‚æ•°çš„æ„é€ å‡½æ•°ã€‚å¬å”¤è¿™æ ·çš„é‡å…½æ˜¯å¾ˆä¸æ–¹ä¾¿çš„;å› æ­¤ï¼Œé‡è½½æ„é€ å‡½æ•°ï¼Œå¹¶ä½¿ç”¨è¾ƒå°‘çš„å‚æ•°åˆ›å»ºå¤šä¸ªè¾ƒçŸ­çš„ç‰ˆæœ¬ã€‚è¿™äº›æ„é€ å‡½æ•°ä»ç„¶å¼•ç”¨ä¸»æ„é€ å‡½æ•°ï¼Œå°†ä¸€äº›é»˜è®¤å€¼ä¼ é€’åˆ°ä»»ä½•çœç•¥çš„å‚æ•°ä¸­ã€‚</p>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Pizza</span> &#123;</span><br><span class="line">    Pizza(<span class="type">int</span> size) &#123; ... &#125;</span><br><span class="line">    Pizza(<span class="type">int</span> size, <span class="type">boolean</span> cheese) &#123; ... &#125;</span><br><span class="line">    Pizza(<span class="type">int</span> size, <span class="type">boolean</span> cheese, <span class="type">boolean</span> pepperoni) &#123; ... &#125;</span><br><span class="line">    <span class="comment">// ...</span></span><br></pre></td></tr></table></figure>
<p>Creating such a monster is only possible in languages that support method overloading, such as C# or Java.åªæœ‰åœ¨æ”¯æŒæ–¹æ³•é‡è½½çš„è¯­è¨€ï¼ˆå¦‚ C# æˆ– Javaï¼‰ä¸­æ‰èƒ½åˆ›å»ºè¿™æ ·çš„æ€ªç‰©ã€‚</p>
<p>The Builder pattern lets you build objects step by step, using only those steps that you really need. After implementing the pattern, you donâ€™t have to cram dozens of parameters into your constructors anymore.<br>Builder æ¨¡å¼å…è®¸æ‚¨é€æ­¥æ„å»ºå¯¹è±¡ï¼Œä»…ä½¿ç”¨æ‚¨çœŸæ­£éœ€è¦çš„é‚£äº›æ­¥éª¤ã€‚å®ç°è¯¥æ¨¡å¼åï¼Œæ‚¨ä¸å¿…å†å°†æ•°åä¸ªå‚æ•°å¡å…¥æ„é€ å‡½æ•°ä¸­ã€‚</p>
<ul>
<li><p><strong>Use the Builder pattern when you want your code to be able to create different representations of some product (for example, stone and wooden houses).å½“æ‚¨å¸Œæœ›ä»£ç èƒ½å¤Ÿåˆ›å»ºæŸäº›äº§å“ï¼ˆä¾‹å¦‚ï¼ŒçŸ³å¤´å’Œæœ¨å±‹ï¼‰çš„ä¸åŒè¡¨ç¤ºå½¢å¼æ—¶ï¼Œè¯·ä½¿ç”¨ Builder æ¨¡å¼ã€‚</strong></p>
</li>
<li><p>The Builder pattern can be applied when construction of various representations of the product involves similar steps that differ only in the details.<br>å½“æ„å»ºäº§å“çš„å„ç§è¡¨ç¤ºå½¢å¼æ¶‰åŠä»…åœ¨ç»†èŠ‚ä¸Šæœ‰æ‰€ä¸åŒçš„ç±»ä¼¼æ­¥éª¤æ—¶ï¼Œå¯ä»¥åº”ç”¨æ„å»ºå™¨æ¨¡å¼ã€‚</p>
</li>
</ul>
<p>The base builder interface defines all possible construction steps, and concrete builders implement these steps to construct particular representations of the product. Meanwhile, the director class guides the order of construction.<br>åŸºç¡€æ„å»ºå™¨ç•Œé¢å®šä¹‰äº†æ‰€æœ‰å¯èƒ½çš„æ„å»ºæ­¥éª¤ï¼Œå…·ä½“æ„å»ºå™¨å®ç°è¿™äº›æ­¥éª¤æ¥æ„å»ºäº§å“çš„ç‰¹å®šè¡¨ç¤ºã€‚åŒæ—¶ï¼Œdirectorç±»æŒ‡å¯¼æ–½å·¥é¡ºåºã€‚</p>
<ul>
<li><p><strong>Use the Builder to construct Composite trees or other complex objects.ä½¿ç”¨æ„å»ºå™¨æ„å»ºå¤åˆæ ‘æˆ–å…¶ä»–å¤æ‚å¯¹è±¡ã€‚</strong></p>
</li>
<li><p>The Builder pattern lets you construct products step-by-step. You could defer execution of some steps without breaking the final product. You can even call steps recursively, which comes in handy when you need to build an object tree.<br>Builder æ¨¡å¼å…è®¸æ‚¨é€æ­¥æ„å»ºäº§å“ã€‚æ‚¨å¯ä»¥åœ¨ä¸ç ´åæœ€ç»ˆäº§å“çš„æƒ…å†µä¸‹å»¶è¿ŸæŸäº›æ­¥éª¤çš„æ‰§è¡Œã€‚æ‚¨ç”šè‡³å¯ä»¥é€’å½’è°ƒç”¨æ­¥éª¤ï¼Œè¿™åœ¨éœ€è¦æ„å»ºå¯¹è±¡æ ‘æ—¶ä¼šæ´¾ä¸Šç”¨åœºã€‚</p>
</li>
</ul>
<p>A builder doesnâ€™t expose the unfinished product while running construction steps. This prevents the client code from fetching an incomplete result.<br>æ„å»ºå™¨åœ¨è¿è¡Œæ„é€ æ­¥éª¤æ—¶ä¸ä¼šæš´éœ²æœªå®Œæˆçš„äº§å“ã€‚è¿™æ ·å¯ä»¥é˜²æ­¢å®¢æˆ·ç«¯ä»£ç æå–ä¸å®Œæ•´çš„ç»“æœã€‚</p>
<h2 id="How-to-Implement-å¦‚ä½•å®ç°"><a href="#How-to-Implement-å¦‚ä½•å®ç°" class="headerlink" title="How to Implement å¦‚ä½•å®ç°"></a>How to Implement å¦‚ä½•å®ç°</h2><ol>
<li><p>Make sure that you can clearly define the common construction steps for building all available product representations. Otherwise, you wonâ€™t be able to proceed with implementing the pattern.<br>ç¡®ä¿æ‚¨å¯ä»¥æ¸…æ¥šåœ°å®šä¹‰ç”¨äºæ„å»ºæ‰€æœ‰å¯ç”¨äº§å“è¡¨ç¤ºçš„å¸¸è§æ„é€ æ­¥éª¤ã€‚å¦åˆ™ï¼Œæ‚¨å°†æ— æ³•ç»§ç»­å®ç°è¯¥æ¨¡å¼ã€‚</p>
</li>
<li><p>Declare these steps in the base builder interface.<br>åœ¨åŸºç¡€æ„å»ºå™¨ç•Œé¢ä¸­å£°æ˜è¿™äº›æ­¥éª¤ã€‚</p>
</li>
<li><p>Create a concrete builder class for each of the product representations and implement their construction steps.<br>ä¸ºæ¯ä¸ªäº§å“è¡¨ç¤ºå½¢å¼åˆ›å»ºä¸€ä¸ªå…·ä½“çš„æ„å»ºå™¨ç±»ï¼Œå¹¶å®ç°å…¶æ„é€ æ­¥éª¤ã€‚</p>
</li>
</ol>
<p>Donâ€™t forget about implementing a method for fetching the result of the construction. The reason why this method canâ€™t be declared inside the builder interface is that various builders may construct products that donâ€™t have a common interface. Therefore, you donâ€™t know what would be the return type for such a method. However, if youâ€™re dealing with products from a single hierarchy, the fetching method can be safely added to the base interface.<br>ä¸è¦å¿˜è®°å®ç°ä¸€ä¸ªè·å–æ„é€ ç»“æœçš„æ–¹æ³•ã€‚æ— æ³•åœ¨ç”Ÿæˆå™¨æ¥å£ä¸­å£°æ˜æ­¤æ–¹æ³•çš„åŸå› æ˜¯ï¼Œå„ç§ç”Ÿæˆå™¨å¯èƒ½ä¼šæ„é€ æ²¡æœ‰é€šç”¨æ¥å£çš„äº§å“ã€‚å› æ­¤ï¼Œæ‚¨ä¸çŸ¥é“è¿™ç§æ–¹æ³•çš„è¿”å›ç±»å‹æ˜¯ä»€ä¹ˆã€‚ä½†æ˜¯ï¼Œå¦‚æœæ‚¨è¦å¤„ç†æ¥è‡ªå•ä¸ªå±‚æ¬¡ç»“æ„çš„äº§å“ï¼Œåˆ™å¯ä»¥å®‰å…¨åœ°å°†æå–æ–¹æ³•æ·»åŠ åˆ°åŸºæœ¬ç•Œé¢ã€‚</p>
<ol start="4">
<li><p>Think about creating a director class. It may encapsulate various ways to construct a product using the same builder object.<br>è€ƒè™‘åˆ›å»ºä¸€ä¸ªdirectorç±»ã€‚å®ƒå¯ä»¥å°è£…ä½¿ç”¨ç›¸åŒçš„æ„å»ºå™¨å¯¹è±¡æ„å»ºäº§å“çš„å„ç§æ–¹æ³•ã€‚</p>
</li>
<li><p>The client code creates both the builder and the director objects. Before construction starts, the client must pass a builder object to the director. Usually, the client does this only once, via parameters of the directorâ€™s class constructor. The director uses the builder object in all further construction. Thereâ€™s an alternative approach, where the builder is passed to a specific product construction method of the director.<br>å®¢æˆ·ç«¯ä»£ç åˆ›å»ºç”Ÿæˆå™¨å’Œæ§åˆ¶å™¨å¯¹è±¡ã€‚åœ¨æ„é€ å¼€å§‹ä¹‹å‰ï¼Œå®¢æˆ·ç«¯å¿…é¡»å°†ç”Ÿæˆå™¨å¯¹è±¡ä¼ é€’ç»™æ§åˆ¶å™¨ã€‚é€šå¸¸ï¼Œå®¢æˆ·ç«¯ä»…é€šè¿‡ director ç±»æ„é€ å‡½æ•°çš„å‚æ•°æ‰§è¡Œæ­¤æ“ä½œä¸€æ¬¡ã€‚director åœ¨æ‰€æœ‰è¿›ä¸€æ­¥çš„æ„é€ ä¸­ä½¿ç”¨ builder å¯¹è±¡ã€‚è¿˜æœ‰å¦ä¸€ç§æ–¹æ³•ï¼Œå°†æ„å»ºå™¨ä¼ é€’ç»™ä¸»ç®¡çš„ç‰¹å®šäº§å“æ„å»ºæ–¹æ³•ã€‚</p>
</li>
<li><p>The construction result can be obtained directly from the director only if all products follow the same interface. Otherwise, the client should fetch the result from the builder.<br>åªæœ‰å½“æ‰€æœ‰äº§å“éƒ½éµå¾ªç›¸åŒçš„æ¥å£æ—¶ï¼Œæ‰èƒ½ç›´æ¥ä»directoré‚£é‡Œè·å¾—æ–½å·¥ç»“æœã€‚å¦åˆ™ï¼Œå®¢æˆ·ç«¯åº”ä»æ„å»ºå™¨è·å–ç»“æœã€‚</p>
</li>
</ol>
<h2 id="Pros-and-Cons-ä¼˜ç‚¹å’Œç¼ºç‚¹"><a href="#Pros-and-Cons-ä¼˜ç‚¹å’Œç¼ºç‚¹" class="headerlink" title="Pros and Cons ä¼˜ç‚¹å’Œç¼ºç‚¹"></a>Pros and Cons ä¼˜ç‚¹å’Œç¼ºç‚¹</h2><h3 id="Pros-ä¼˜ç‚¹"><a href="#Pros-ä¼˜ç‚¹" class="headerlink" title="Pros ä¼˜ç‚¹"></a>Pros ä¼˜ç‚¹</h3><ul>
<li><p>You can construct objects step-by-step, defer construction steps or run steps recursively.<br>æ‚¨å¯ä»¥é€æ­¥æ„é€ å¯¹è±¡ã€å»¶è¿Ÿæ„é€ æ­¥éª¤æˆ–é€’å½’è¿è¡Œæ­¥éª¤ã€‚</p>
</li>
<li><p>You can reuse the same construction code when building various representations of products.<br>åœ¨æ„å»ºäº§å“çš„å„ç§è¡¨ç¤ºå½¢å¼æ—¶ï¼Œæ‚¨å¯ä»¥é‡å¤ä½¿ç”¨ç›¸åŒçš„æ„é€ ä»£ç ã€‚</p>
</li>
<li><p>Single Responsibility Principle. You can isolate complex construction code from the business logic of the product.<br>å•ä¸€è´£ä»»åŸåˆ™ã€‚æ‚¨å¯ä»¥å°†å¤æ‚çš„æ„é€ ä»£ç ä¸äº§å“çš„ä¸šåŠ¡é€»è¾‘éš”ç¦»å¼€æ¥ã€‚</p>
</li>
</ul>
<h3 id="ç¼ºç‚¹"><a href="#ç¼ºç‚¹" class="headerlink" title="ç¼ºç‚¹"></a>ç¼ºç‚¹</h3><ul>
<li>The overall complexity of the code increases since the pattern requires creating multiple new classes.<br>ä»£ç çš„æ•´ä½“å¤æ‚æ€§å¢åŠ ï¼Œå› ä¸ºè¯¥æ¨¡å¼éœ€è¦åˆ›å»ºå¤šä¸ªæ–°ç±»ã€‚</li>
</ul>
<h2 id="Relations-with-Other-Patterns-ä¸å…¶ä»–æ¨¡å¼çš„å…³ç³»"><a href="#Relations-with-Other-Patterns-ä¸å…¶ä»–æ¨¡å¼çš„å…³ç³»" class="headerlink" title="Relations with Other Patterns ä¸å…¶ä»–æ¨¡å¼çš„å…³ç³»"></a>Relations with Other Patterns ä¸å…¶ä»–æ¨¡å¼çš„å…³ç³»</h2><ul>
<li><p>Many designs start by using **Factory Method **(less complicated and more customizable via subclasses) and evolve toward <strong>Abstract Factory</strong>, <strong>Prototype</strong>, or <strong>Builder</strong> (more flexible, but more complicated).<br>è®¸å¤šè®¾è®¡ä»ä½¿ç”¨å·¥å‚æ–¹æ³•ï¼ˆä¸é‚£ä¹ˆå¤æ‚ï¼Œé€šè¿‡å­ç±»æ›´å¯å®šåˆ¶ï¼‰å¼€å§‹ï¼Œç„¶åå‘å±•åˆ°æŠ½è±¡å·¥å‚ã€åŸå‹æˆ–æ„å»ºå™¨ï¼ˆæ›´çµæ´»ï¼Œä½†æ›´å¤æ‚ï¼‰ã€‚</p>
</li>
<li><p><strong>Builder</strong> focuses on constructing complex objects step by step. <strong>Abstract Factory</strong> specializes in creating families of related objects. <strong>Abstract Factory</strong> returns the product immediately, whereas Builder lets you run some additional construction steps before fetching the product.<br>Builder ä¸“æ³¨äºé€æ­¥æ„å»ºå¤æ‚çš„å¯¹è±¡ã€‚Abstract Factoryä¸“é—¨ç”¨äºåˆ›å»ºç›¸å…³å¯¹è±¡çš„æ—ã€‚Abstract Factory ä¼šç«‹å³è¿”å›äº§å“ï¼Œè€Œ Builder å…è®¸æ‚¨åœ¨è·å–äº§å“ä¹‹å‰è¿è¡Œä¸€äº›é¢å¤–çš„æ„é€ æ­¥éª¤ã€‚</p>
</li>
<li><p>You can use <strong>Builder</strong> when creating complex <strong>Composite</strong> trees because you can program its construction steps to work recursively.<br>åœ¨åˆ›å»ºå¤æ‚çš„å¤åˆæ ‘æ—¶ï¼Œå¯ä»¥ä½¿ç”¨ Builderï¼Œå› ä¸ºæ‚¨å¯ä»¥å¯¹å…¶æ„é€ æ­¥éª¤è¿›è¡Œç¼–ç¨‹ä»¥é€’å½’æ–¹å¼å·¥ä½œã€‚</p>
</li>
<li><p>You can combine <strong>Builder</strong> with <strong>Bridge</strong>: the director class plays the role of the abstraction, while different builders act as implementations.<br>æ‚¨å¯ä»¥å°† Builder ä¸ Bridge ç»“åˆä½¿ç”¨ï¼šdirector ç±»æ‰®æ¼”æŠ½è±¡çš„è§’è‰²ï¼Œè€Œä¸åŒçš„æ„å»ºå™¨å……å½“å®ç°ã€‚</p>
</li>
<li><p><strong>Abstract Factories</strong>, <strong>Builders</strong> and <strong>Prototypes</strong> can all be implemented as <strong>Singletons</strong>.<br>æŠ½è±¡å·¥å‚ã€æ„å»ºå™¨å’ŒåŸå‹éƒ½å¯ä»¥ä½œä¸ºå•ä¾‹å®ç°ã€‚</p>
</li>
</ul>
<h2 id="Code-Examples-ä»£ç ç¤ºä¾‹"><a href="#Code-Examples-ä»£ç ç¤ºä¾‹" class="headerlink" title="Code Examples ä»£ç ç¤ºä¾‹"></a>Code Examples ä»£ç ç¤ºä¾‹</h2><h3 id="python-Conceptual-Example-æ¦‚å¿µç¤ºä¾‹"><a href="#python-Conceptual-Example-æ¦‚å¿µç¤ºä¾‹" class="headerlink" title="python Conceptual Example æ¦‚å¿µç¤ºä¾‹"></a>python Conceptual Example æ¦‚å¿µç¤ºä¾‹</h3><p>This example illustrates the structure of the Builder design pattern. It focuses on answering these questions:<br>æ­¤ç¤ºä¾‹è¯´æ˜äº† Builder è®¾è®¡æ¨¡å¼çš„ç»“æ„ã€‚å®ƒä¾§é‡äºå›ç­”ä»¥ä¸‹é—®é¢˜ï¼š</p>
<ul>
<li>What classes does it consist of?<br>å®ƒç”±å“ªäº›ç±»ç»„æˆï¼Ÿ</li>
<li>What roles do these classes play?<br>è¿™äº›è¯¾ç¨‹æ‰®æ¼”ä»€ä¹ˆè§’è‰²ï¼Ÿ</li>
<li>In what way the elements of the pattern are related?<br>æ¨¡å¼çš„å…ƒç´ ä»¥ä½•ç§æ–¹å¼ç›¸å…³ï¼Ÿ</li>
</ul>
<p>main.py: æ¦‚å¿µç¤ºä¾‹</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> __future__ <span class="keyword">import</span> annotations</span><br><span class="line"><span class="keyword">from</span> abc <span class="keyword">import</span> ABC, abstractmethod</span><br><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">Any</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Builder</span>(<span class="title class_ inherited__">ABC</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    The Builder interface specifies methods for creating the different parts of</span></span><br><span class="line"><span class="string">    the Product objects.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">    @property</span></span><br><span class="line"><span class="meta">    @abstractmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">product</span>(<span class="params">self</span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="meta">    @abstractmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">produce_part_a</span>(<span class="params">self</span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="meta">    @abstractmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">produce_part_b</span>(<span class="params">self</span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="meta">    @abstractmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">produce_part_c</span>(<span class="params">self</span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ConcreteBuilder1</span>(<span class="title class_ inherited__">Builder</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    The Concrete Builder classes follow the Builder interface and provide</span></span><br><span class="line"><span class="string">    specific implementations of the building steps. Your program may have</span></span><br><span class="line"><span class="string">    several variations of Builders, implemented differently.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        A fresh builder instance should contain a blank product object, which is</span></span><br><span class="line"><span class="string">        used in further assembly.</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        self.reset()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">reset</span>(<span class="params">self</span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">        self._product = Product1()</span><br><span class="line"></span><br><span class="line"><span class="meta">    @property</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">product</span>(<span class="params">self</span>) -&gt; Product1:</span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        Concrete Builders are supposed to provide their own methods for</span></span><br><span class="line"><span class="string">        retrieving results. That&#x27;s because various types of builders may create</span></span><br><span class="line"><span class="string">        entirely different products that don&#x27;t follow the same interface.</span></span><br><span class="line"><span class="string">        Therefore, such methods cannot be declared in the base Builder interface</span></span><br><span class="line"><span class="string">        (at least in a statically typed programming language).</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        Usually, after returning the end result to the client, a builder</span></span><br><span class="line"><span class="string">        instance is expected to be ready to start producing another product.</span></span><br><span class="line"><span class="string">        That&#x27;s why it&#x27;s a usual practice to call the reset method at the end of</span></span><br><span class="line"><span class="string">        the `getProduct` method body. However, this behavior is not mandatory,</span></span><br><span class="line"><span class="string">        and you can make your builders wait for an explicit reset call from the</span></span><br><span class="line"><span class="string">        client code before disposing of the previous result.</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        product = self._product</span><br><span class="line">        self.reset()</span><br><span class="line">        <span class="keyword">return</span> product</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">produce_part_a</span>(<span class="params">self</span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">        self._product.add(<span class="string">&quot;PartA1&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">produce_part_b</span>(<span class="params">self</span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">        self._product.add(<span class="string">&quot;PartB1&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">produce_part_c</span>(<span class="params">self</span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">        self._product.add(<span class="string">&quot;PartC1&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Product1</span>():</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    It makes sense to use the Builder pattern only when your products are quite</span></span><br><span class="line"><span class="string">    complex and require extensive configuration.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Unlike in other creational patterns, different concrete builders can produce</span></span><br><span class="line"><span class="string">    unrelated products. In other words, results of various builders may not</span></span><br><span class="line"><span class="string">    always follow the same interface.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">        self.parts = []</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">add</span>(<span class="params">self, part: <span class="type">Any</span></span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">        self.parts.append(part)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">list_parts</span>(<span class="params">self</span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;Product parts: <span class="subst">&#123;<span class="string">&#x27;, &#x27;</span>.join(self.parts)&#125;</span>&quot;</span>, end=<span class="string">&quot;&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Director</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    The Director is only responsible for executing the building steps in a</span></span><br><span class="line"><span class="string">    particular sequence. It is helpful when producing products according to a</span></span><br><span class="line"><span class="string">    specific order or configuration. Strictly speaking, the Director class is</span></span><br><span class="line"><span class="string">    optional, since the client can control builders directly.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">        self._builder = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"><span class="meta">    @property</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">builder</span>(<span class="params">self</span>) -&gt; Builder:</span><br><span class="line">        <span class="keyword">return</span> self._builder</span><br><span class="line"></span><br><span class="line"><span class="meta">    @builder.setter</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">builder</span>(<span class="params">self, builder: Builder</span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        The Director works with any builder instance that the client code passes</span></span><br><span class="line"><span class="string">        to it. This way, the client code may alter the final type of the newly</span></span><br><span class="line"><span class="string">        assembled product.</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        self._builder = builder</span><br><span class="line"></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    The Director can construct several product variations using the same</span></span><br><span class="line"><span class="string">    building steps.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">build_minimal_viable_product</span>(<span class="params">self</span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">        self.builder.produce_part_a()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">build_full_featured_product</span>(<span class="params">self</span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">        self.builder.produce_part_a()</span><br><span class="line">        self.builder.produce_part_b()</span><br><span class="line">        self.builder.produce_part_c()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    The client code creates a builder object, passes it to the director and then</span></span><br><span class="line"><span class="string">    initiates the construction process. The end result is retrieved from the</span></span><br><span class="line"><span class="string">    builder object.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    director = Director()</span><br><span class="line">    builder = ConcreteBuilder1()</span><br><span class="line">    director.builder = builder</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Standard basic product: &quot;</span>)</span><br><span class="line">    director.build_minimal_viable_product()</span><br><span class="line">    builder.product.list_parts()</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;\n&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Standard full featured product: &quot;</span>)</span><br><span class="line">    director.build_full_featured_product()</span><br><span class="line">    builder.product.list_parts()</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;\n&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Remember, the Builder pattern can be used without a Director class.</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Custom product: &quot;</span>)</span><br><span class="line">    builder.produce_part_a()</span><br><span class="line">    builder.produce_part_b()</span><br><span class="line">    builder.product.list_parts()</span><br></pre></td></tr></table></figure>

<h3 id="Output-txt-Execution-result"><a href="#Output-txt-Execution-result" class="headerlink" title="Output.txt: Execution result"></a>Output.txt: Execution result</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Standard basic product:</span><br><span class="line">Product parts: PartA1</span><br><span class="line"></span><br><span class="line">Standard full featured product:</span><br><span class="line">Product parts: PartA1, PartB1, PartC1</span><br><span class="line"></span><br><span class="line">Custom product:</span><br><span class="line">Product parts: PartA1, PartB1</span><br></pre></td></tr></table></figure>

<h3 id="Rust-ç¤ºä¾‹ï¼šCar-car-manual-builders"><a href="#Rust-ç¤ºä¾‹ï¼šCar-car-manual-builders" class="headerlink" title="Rust ç¤ºä¾‹ï¼šCar &amp; car manual builders"></a>Rust ç¤ºä¾‹ï¼šCar &amp; car manual builders</h3><p>This slightly synthetic example illustrates how you can use the <code>Builder</code> pattern to construct totally different products using the same building process. For example, the trait Builder declares steps for assembling a car. However, depending on the builder implementation, a constructed object can be something different, for example, a car manual. The resulting manual will contain instructions from each building step, making it accurate and up-to-date.<br>è¿™ä¸ªç•¥å¾®åˆæˆçš„ç¤ºä¾‹è¯´æ˜äº†å¦‚ä½•ä½¿ç”¨ Builder æ¨¡å¼ï¼Œé€šè¿‡ç›¸åŒçš„æ„å»ºè¿‡ç¨‹æ¥æ„å»ºå®Œå…¨ä¸åŒçš„äº§å“ã€‚ä¾‹å¦‚ï¼Œè¯¥ç‰¹å¾ <code>Builder</code> å£°æ˜äº†ç»„è£…æ±½è½¦çš„æ­¥éª¤ã€‚ä½†æ˜¯ï¼Œæ ¹æ®æ„å»ºå™¨å®ç°çš„ä¸åŒï¼Œæ„é€ çš„å¯¹è±¡å¯ä»¥æ˜¯ä¸åŒçš„å¯¹è±¡ï¼Œä¾‹å¦‚æ±½è½¦æ‰‹å†Œã€‚ç”±æ­¤äº§ç”Ÿçš„æ‰‹å†Œå°†åŒ…å«æ¯ä¸ªæ„å»ºæ­¥éª¤çš„è¯´æ˜ï¼Œä½¿å…¶å‡†ç¡®å’Œæœ€æ–°ã€‚</p>
<p>The <strong>Builder</strong> design pattern is not the same as the <strong>Fluent Interface</strong> idiom (that relies on method chaining), although Rust developers sometimes use those terms interchangeably.<br>Builder è®¾è®¡æ¨¡å¼ä¸ Fluent Interface ä¹ æƒ¯ç”¨è¯­ï¼ˆä¾èµ–äºæ–¹æ³•é“¾ï¼‰ä¸åŒï¼Œå°½ç®¡ Rust å¼€å‘äººå‘˜æœ‰æ—¶ä¼šäº’æ¢ä½¿ç”¨è¿™äº›æœ¯è¯­ã€‚</p>
<ol>
<li><p>Fluent Interface is a way to chain methods for constructing or modifying an object using the following approach:<br>Fluent Interface æ˜¯ä¸€ç§ä½¿ç”¨ä»¥ä¸‹æ–¹æ³•é“¾æ¥ç”¨äºæ„é€ æˆ–ä¿®æ”¹å¯¹è±¡çš„æ–¹æ³•çš„æ–¹æ³•ï¼š</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="variable">car</span> = Car::<span class="title function_ invoke__">default</span>().<span class="title function_ invoke__">places</span>(<span class="number">5</span>).<span class="title function_ invoke__">gas</span>(<span class="number">30</span>)</span><br></pre></td></tr></table></figure>
<p>Itâ€™s pretty elegant way to construct an object. Still, such a code may not be an instance of the Builder pattern.<br>è¿™æ˜¯æ„é€ å¯¹è±¡çš„éå¸¸ä¼˜é›…çš„æ–¹å¼ã€‚ä¸è¿‡ï¼Œè¿™æ ·çš„ä»£ç å¯èƒ½ä¸æ˜¯ Builder æ¨¡å¼çš„å®ä¾‹ã€‚</p>
</li>
<li><p>While the <strong>Builder</strong> pattern also suggests constructing object step by step, it also lets you build different types of products using the same construction process.<br>è™½ç„¶ <strong>Builder</strong> æ¨¡å¼è¿˜å»ºè®®é€æ­¥æ„å»ºå¯¹è±¡ï¼Œä½†å®ƒä¹Ÿå…è®¸æ‚¨ä½¿ç”¨ç›¸åŒçš„æ„å»ºè¿‡ç¨‹æ„å»ºä¸åŒç±»å‹çš„äº§å“ã€‚</p>
</li>
</ol>
<h3 id="builders-Builders-builders"><a href="#builders-Builders-builders" class="headerlink" title="builders: Builders builders"></a>builders: Builders builders</h3><h4 id="builders-mod-rs"><a href="#builders-mod-rs" class="headerlink" title="builders&#x2F;mod.rs"></a>builders&#x2F;mod.rs</h4><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">mod</span> car;</span><br><span class="line"><span class="keyword">mod</span> car_manual;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> crate::components::&#123;CarType, Engine, GpsNavigator, Transmission&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// Builder defines how to assemble a car.</span></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">trait</span> <span class="title class_">Builder</span> &#123;</span><br><span class="line">    <span class="keyword">type</span> <span class="title class_">OutputType</span>;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">set_car_type</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>, car_type: CarType);</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">set_seats</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>, seats: <span class="type">u16</span>);</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">set_engine</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>, engine: Engine);</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">set_transmission</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>, transmission: Transmission);</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">set_gsp_navigator</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>, gps_navigator: GpsNavigator);</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">build</span>(<span class="keyword">self</span>) <span class="punctuation">-&gt;</span> <span class="keyword">Self</span>::OutputType;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">use</span> car::CarBuilder;</span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">use</span> car_manual::CarManualBuilder;</span><br></pre></td></tr></table></figure>
<h4 id="builders-car-rs"><a href="#builders-car-rs" class="headerlink" title="builders&#x2F;car.rs"></a>builders&#x2F;car.rs</h4><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> crate::&#123;</span><br><span class="line">    cars::Car,</span><br><span class="line">    components::&#123;CarType, Engine, GpsNavigator, Transmission&#125;,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> super::Builder;</span><br><span class="line"></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">const</span> DEFAULT_FUEL: <span class="type">f64</span> = <span class="number">5f64</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">#[derive(Default)]</span></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">struct</span> <span class="title class_">CarBuilder</span> &#123;</span><br><span class="line">    car_type: <span class="type">Option</span>&lt;CarType&gt;,</span><br><span class="line">    engine: <span class="type">Option</span>&lt;Engine&gt;,</span><br><span class="line">    gps_navigator: <span class="type">Option</span>&lt;GpsNavigator&gt;,</span><br><span class="line">    seats: <span class="type">Option</span>&lt;<span class="type">u16</span>&gt;,</span><br><span class="line">    transmission: <span class="type">Option</span>&lt;Transmission&gt;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">Builder</span> <span class="keyword">for</span> <span class="title class_">CarBuilder</span> &#123;</span><br><span class="line">    <span class="keyword">type</span> <span class="title class_">OutputType</span> = Car;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">set_car_type</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>, car_type: CarType) &#123;</span><br><span class="line">        <span class="keyword">self</span>.car_type = <span class="title function_ invoke__">Some</span>(car_type);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">set_engine</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>, engine: Engine) &#123;</span><br><span class="line">        <span class="keyword">self</span>.engine = <span class="title function_ invoke__">Some</span>(engine);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">set_gsp_navigator</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>, gps_navigator: GpsNavigator) &#123;</span><br><span class="line">        <span class="keyword">self</span>.gps_navigator = <span class="title function_ invoke__">Some</span>(gps_navigator);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">set_seats</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>, seats: <span class="type">u16</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.seats = <span class="title function_ invoke__">Some</span>(seats);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">set_transmission</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>, transmission: Transmission) &#123;</span><br><span class="line">        <span class="keyword">self</span>.transmission = <span class="title function_ invoke__">Some</span>(transmission);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">build</span>(<span class="keyword">self</span>) <span class="punctuation">-&gt;</span> Car &#123;</span><br><span class="line">        Car::<span class="title function_ invoke__">new</span>(</span><br><span class="line">            <span class="keyword">self</span>.car_type.<span class="title function_ invoke__">expect</span>(<span class="string">&quot;Please, set a car type&quot;</span>),</span><br><span class="line">            <span class="keyword">self</span>.seats.<span class="title function_ invoke__">expect</span>(<span class="string">&quot;Please, set a number of seats&quot;</span>),</span><br><span class="line">            <span class="keyword">self</span>.engine.<span class="title function_ invoke__">expect</span>(<span class="string">&quot;Please, set an engine configuration&quot;</span>),</span><br><span class="line">            <span class="keyword">self</span>.transmission.<span class="title function_ invoke__">expect</span>(<span class="string">&quot;Please, set up transmission&quot;</span>),</span><br><span class="line">            <span class="keyword">self</span>.gps_navigator,</span><br><span class="line">            DEFAULT_FUEL,</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="builders-car-manual-rs"><a href="#builders-car-manual-rs" class="headerlink" title="builders&#x2F;car_manual.rs"></a>builders&#x2F;car_manual.rs</h4><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> crate::&#123;</span><br><span class="line">    cars::Manual,</span><br><span class="line">    components::&#123;CarType, Engine, GpsNavigator, Transmission&#125;,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> super::Builder;</span><br><span class="line"></span><br><span class="line"><span class="meta">#[derive(Default)]</span></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">struct</span> <span class="title class_">CarManualBuilder</span> &#123;</span><br><span class="line">    car_type: <span class="type">Option</span>&lt;CarType&gt;,</span><br><span class="line">    engine: <span class="type">Option</span>&lt;Engine&gt;,</span><br><span class="line">    gps_navigator: <span class="type">Option</span>&lt;GpsNavigator&gt;,</span><br><span class="line">    seats: <span class="type">Option</span>&lt;<span class="type">u16</span>&gt;,</span><br><span class="line">    transmission: <span class="type">Option</span>&lt;Transmission&gt;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// Builds a car manual instead of an actual car.</span></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">Builder</span> <span class="keyword">for</span> <span class="title class_">CarManualBuilder</span> &#123;</span><br><span class="line">    <span class="keyword">type</span> <span class="title class_">OutputType</span> = Manual;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">set_car_type</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>, car_type: CarType) &#123;</span><br><span class="line">        <span class="keyword">self</span>.car_type = <span class="title function_ invoke__">Some</span>(car_type);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">set_engine</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>, engine: Engine) &#123;</span><br><span class="line">        <span class="keyword">self</span>.engine = <span class="title function_ invoke__">Some</span>(engine);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">set_gsp_navigator</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>, gps_navigator: GpsNavigator) &#123;</span><br><span class="line">        <span class="keyword">self</span>.gps_navigator = <span class="title function_ invoke__">Some</span>(gps_navigator);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">set_seats</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>, seats: <span class="type">u16</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.seats = <span class="title function_ invoke__">Some</span>(seats);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">set_transmission</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>, transmission: Transmission) &#123;</span><br><span class="line">        <span class="keyword">self</span>.transmission = <span class="title function_ invoke__">Some</span>(transmission);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">build</span>(<span class="keyword">self</span>) <span class="punctuation">-&gt;</span> Manual &#123;</span><br><span class="line">        Manual::<span class="title function_ invoke__">new</span>(</span><br><span class="line">            <span class="keyword">self</span>.car_type.<span class="title function_ invoke__">expect</span>(<span class="string">&quot;Please, set a car type&quot;</span>),</span><br><span class="line">            <span class="keyword">self</span>.seats.<span class="title function_ invoke__">expect</span>(<span class="string">&quot;Please, set a number of seats&quot;</span>),</span><br><span class="line">            <span class="keyword">self</span>.engine.<span class="title function_ invoke__">expect</span>(<span class="string">&quot;Please, set an engine configuration&quot;</span>),</span><br><span class="line">            <span class="keyword">self</span>.transmission.<span class="title function_ invoke__">expect</span>(<span class="string">&quot;Please, set up transmission&quot;</span>),</span><br><span class="line">            <span class="keyword">self</span>.gps_navigator,</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="cars-Products"><a href="#cars-Products" class="headerlink" title="cars: Products"></a>cars: Products</h4><h5 id="cars-mod-rs"><a href="#cars-mod-rs" class="headerlink" title="cars&#x2F;mod.rs"></a>cars&#x2F;mod.rs</h5><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">mod</span> car;</span><br><span class="line"><span class="keyword">mod</span> manual;</span><br><span class="line"></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">use</span> car::Car;</span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">use</span> manual::Manual;</span><br></pre></td></tr></table></figure>

<h5 id="cars-car-rs"><a href="#cars-car-rs" class="headerlink" title="cars&#x2F;car.rs"></a>cars&#x2F;car.rs</h5><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> crate::components::&#123;CarType, Engine, GpsNavigator, Transmission&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">struct</span> <span class="title class_">Car</span> &#123;</span><br><span class="line">    car_type: CarType,</span><br><span class="line">    seats: <span class="type">u16</span>,</span><br><span class="line">    engine: Engine,</span><br><span class="line">    transmission: Transmission,</span><br><span class="line">    gps_navigator: <span class="type">Option</span>&lt;GpsNavigator&gt;,</span><br><span class="line">    fuel: <span class="type">f64</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">Car</span> &#123;</span><br><span class="line">    <span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">new</span>(</span><br><span class="line">        car_type: CarType,</span><br><span class="line">        seats: <span class="type">u16</span>,</span><br><span class="line">        engine: Engine,</span><br><span class="line">        transmission: Transmission,</span><br><span class="line">        gps_navigator: <span class="type">Option</span>&lt;GpsNavigator&gt;,</span><br><span class="line">        fuel: <span class="type">f64</span>,</span><br><span class="line">    ) <span class="punctuation">-&gt;</span> <span class="keyword">Self</span> &#123;</span><br><span class="line">        <span class="keyword">Self</span> &#123;</span><br><span class="line">            car_type,</span><br><span class="line">            seats,</span><br><span class="line">            engine,</span><br><span class="line">            transmission,</span><br><span class="line">            gps_navigator,</span><br><span class="line">            fuel,</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">car_type</span>(&amp;<span class="keyword">self</span>) <span class="punctuation">-&gt;</span> CarType &#123;</span><br><span class="line">        <span class="keyword">self</span>.car_type</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">fuel</span>(&amp;<span class="keyword">self</span>) <span class="punctuation">-&gt;</span> <span class="type">f64</span> &#123;</span><br><span class="line">        <span class="keyword">self</span>.fuel</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">set_fuel</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>, fuel: <span class="type">f64</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.fuel = fuel;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">seats</span>(&amp;<span class="keyword">self</span>) <span class="punctuation">-&gt;</span> <span class="type">u16</span> &#123;</span><br><span class="line">        <span class="keyword">self</span>.seats</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">engine</span>(&amp;<span class="keyword">self</span>) <span class="punctuation">-&gt;</span> &amp;Engine &#123;</span><br><span class="line">        &amp;<span class="keyword">self</span>.engine</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">transmission</span>(&amp;<span class="keyword">self</span>) <span class="punctuation">-&gt;</span> &amp;Transmission &#123;</span><br><span class="line">        &amp;<span class="keyword">self</span>.transmission</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">gps_navigator</span>(&amp;<span class="keyword">self</span>) <span class="punctuation">-&gt;</span> &amp;<span class="type">Option</span>&lt;GpsNavigator&gt; &#123;</span><br><span class="line">        &amp;<span class="keyword">self</span>.gps_navigator</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="cars-manual-rs"><a href="#cars-manual-rs" class="headerlink" title="cars&#x2F;manual.rs"></a>cars&#x2F;manual.rs</h5><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> crate::components::&#123;CarType, Engine, GpsNavigator, Transmission&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">struct</span> <span class="title class_">Manual</span> &#123;</span><br><span class="line">    car_type: CarType,</span><br><span class="line">    seats: <span class="type">u16</span>,</span><br><span class="line">    engine: Engine,</span><br><span class="line">    transmission: Transmission,</span><br><span class="line">    gps_navigator: <span class="type">Option</span>&lt;GpsNavigator&gt;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">Manual</span> &#123;</span><br><span class="line">    <span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">new</span>(</span><br><span class="line">        car_type: CarType,</span><br><span class="line">        seats: <span class="type">u16</span>,</span><br><span class="line">        engine: Engine,</span><br><span class="line">        transmission: Transmission,</span><br><span class="line">        gps_navigator: <span class="type">Option</span>&lt;GpsNavigator&gt;,</span><br><span class="line">    ) <span class="punctuation">-&gt;</span> <span class="keyword">Self</span> &#123;</span><br><span class="line">        <span class="keyword">Self</span> &#123;</span><br><span class="line">            car_type,</span><br><span class="line">            seats,</span><br><span class="line">            engine,</span><br><span class="line">            transmission,</span><br><span class="line">            gps_navigator,</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">std</span>::fmt::Display <span class="keyword">for</span> <span class="title class_">Manual</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">fmt</span>(&amp;<span class="keyword">self</span>, f: &amp;<span class="keyword">mut</span> std::fmt::Formatter&lt;<span class="symbol">&#x27;_</span>&gt;) <span class="punctuation">-&gt;</span> std::fmt::<span class="type">Result</span> &#123;</span><br><span class="line">        <span class="built_in">writeln!</span>(f, <span class="string">&quot;Type of car: &#123;:?&#125;&quot;</span>, <span class="keyword">self</span>.car_type)?;</span><br><span class="line">        <span class="built_in">writeln!</span>(f, <span class="string">&quot;Count of seats: &#123;&#125;&quot;</span>, <span class="keyword">self</span>.seats)?;</span><br><span class="line">        <span class="built_in">writeln!</span>(</span><br><span class="line">            f,</span><br><span class="line">            <span class="string">&quot;Engine: volume - &#123;&#125;; mileage - &#123;&#125;&quot;</span>,</span><br><span class="line">            <span class="keyword">self</span>.engine.<span class="title function_ invoke__">volume</span>(),</span><br><span class="line">            <span class="keyword">self</span>.engine.<span class="title function_ invoke__">mileage</span>()</span><br><span class="line">        )?;</span><br><span class="line">        <span class="built_in">writeln!</span>(f, <span class="string">&quot;Transmission: &#123;:?&#125;&quot;</span>, <span class="keyword">self</span>.transmission)?;</span><br><span class="line">        <span class="keyword">match</span> <span class="keyword">self</span>.gps_navigator &#123;</span><br><span class="line">            <span class="title function_ invoke__">Some</span>(_) =&gt; <span class="built_in">writeln!</span>(f, <span class="string">&quot;GPS Navigator: Functional&quot;</span>)?,</span><br><span class="line">            <span class="literal">None</span> =&gt; <span class="built_in">writeln!</span>(f, <span class="string">&quot;GPS Navigator: N/A&quot;</span>)?,</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="title function_ invoke__">Ok</span>(())</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="components-rs-Product-components"><a href="#components-rs-Product-components" class="headerlink" title="components.rs: Product components"></a>components.rs: Product components</h4><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#[derive(Copy, Clone, Debug)]</span></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">enum</span> <span class="title class_">CarType</span> &#123;</span><br><span class="line">    CityCar,</span><br><span class="line">    SportsCar,</span><br><span class="line">    Suv,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#[derive(Debug)]</span></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">enum</span> <span class="title class_">Transmission</span> &#123;</span><br><span class="line">    SingleSpeed,</span><br><span class="line">    Manual,</span><br><span class="line">    Automatic,</span><br><span class="line">    SemiAutomatic,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">struct</span> <span class="title class_">Engine</span> &#123;</span><br><span class="line">    volume: <span class="type">f64</span>,</span><br><span class="line">    mileage: <span class="type">f64</span>,</span><br><span class="line">    started: <span class="type">bool</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">Engine</span> &#123;</span><br><span class="line">    <span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">new</span>(volume: <span class="type">f64</span>, mileage: <span class="type">f64</span>) <span class="punctuation">-&gt;</span> <span class="keyword">Self</span> &#123;</span><br><span class="line">        <span class="keyword">Self</span> &#123;</span><br><span class="line">            volume,</span><br><span class="line">            mileage,</span><br><span class="line">            started: <span class="literal">false</span>,</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">on</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.started = <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">off</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.started = <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">started</span>(&amp;<span class="keyword">self</span>) <span class="punctuation">-&gt;</span> <span class="type">bool</span> &#123;</span><br><span class="line">        <span class="keyword">self</span>.started</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">volume</span>(&amp;<span class="keyword">self</span>) <span class="punctuation">-&gt;</span> <span class="type">f64</span> &#123;</span><br><span class="line">        <span class="keyword">self</span>.volume</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">mileage</span>(&amp;<span class="keyword">self</span>) <span class="punctuation">-&gt;</span> <span class="type">f64</span> &#123;</span><br><span class="line">        <span class="keyword">self</span>.mileage</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">go</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>, mileage: <span class="type">f64</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">self</span>.<span class="title function_ invoke__">started</span>() &#123;</span><br><span class="line">            <span class="keyword">self</span>.mileage += mileage;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="built_in">println!</span>(<span class="string">&quot;Cannot go(), you must start engine first!&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">struct</span> <span class="title class_">GpsNavigator</span> &#123;</span><br><span class="line">    route: <span class="type">String</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">GpsNavigator</span> &#123;</span><br><span class="line">    <span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">new</span>() <span class="punctuation">-&gt;</span> <span class="keyword">Self</span> &#123;</span><br><span class="line">        <span class="keyword">Self</span>::<span class="title function_ invoke__">from_route</span>(</span><br><span class="line">            <span class="string">&quot;221b, Baker Street, London  to Scotland Yard, 8-10 Broadway, London&quot;</span>.<span class="title function_ invoke__">into</span>(),</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">from_route</span>(route: <span class="type">String</span>) <span class="punctuation">-&gt;</span> <span class="keyword">Self</span> &#123;</span><br><span class="line">        <span class="keyword">Self</span> &#123; route &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">route</span>(&amp;<span class="keyword">self</span>) <span class="punctuation">-&gt;</span> &amp;<span class="type">String</span> &#123;</span><br><span class="line">        &amp;<span class="keyword">self</span>.route</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="director-rs-Directors"><a href="#director-rs-Directors" class="headerlink" title="director.rs: Directors"></a>director.rs: Directors</h4><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> crate::&#123;</span><br><span class="line">    builders::Builder,</span><br><span class="line">    components::&#123;CarType, Engine, GpsNavigator, Transmission&#125;,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// Director knows how to build a car.</span></span><br><span class="line"><span class="comment">///</span></span><br><span class="line"><span class="comment">/// However, a builder can build a car manual instead of an actual car,</span></span><br><span class="line"><span class="comment">/// everything depends on the concrete builder.</span></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">struct</span> <span class="title class_">Director</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">Director</span> &#123;</span><br><span class="line">    <span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">construct_sports_car</span>(builder: &amp;<span class="keyword">mut</span> <span class="keyword">impl</span> <span class="title class_">Builder</span>) &#123;</span><br><span class="line">        builder.<span class="title function_ invoke__">set_car_type</span>(CarType::SportsCar);</span><br><span class="line">        builder.<span class="title function_ invoke__">set_seats</span>(<span class="number">2</span>);</span><br><span class="line">        builder.<span class="title function_ invoke__">set_engine</span>(Engine::<span class="title function_ invoke__">new</span>(<span class="number">3.0</span>, <span class="number">0.0</span>));</span><br><span class="line">        builder.<span class="title function_ invoke__">set_transmission</span>(Transmission::SemiAutomatic);</span><br><span class="line">        builder.<span class="title function_ invoke__">set_gsp_navigator</span>(GpsNavigator::<span class="title function_ invoke__">new</span>());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">construct_city_car</span>(builder: &amp;<span class="keyword">mut</span> <span class="keyword">impl</span> <span class="title class_">Builder</span>) &#123;</span><br><span class="line">        builder.<span class="title function_ invoke__">set_car_type</span>(CarType::CityCar);</span><br><span class="line">        builder.<span class="title function_ invoke__">set_seats</span>(<span class="number">2</span>);</span><br><span class="line">        builder.<span class="title function_ invoke__">set_engine</span>(Engine::<span class="title function_ invoke__">new</span>(<span class="number">1.2</span>, <span class="number">0.0</span>));</span><br><span class="line">        builder.<span class="title function_ invoke__">set_transmission</span>(Transmission::Automatic);</span><br><span class="line">        builder.<span class="title function_ invoke__">set_gsp_navigator</span>(GpsNavigator::<span class="title function_ invoke__">new</span>());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">construct_suv</span>(builder: &amp;<span class="keyword">mut</span> <span class="keyword">impl</span> <span class="title class_">Builder</span>) &#123;</span><br><span class="line">        builder.<span class="title function_ invoke__">set_car_type</span>(CarType::Suv);</span><br><span class="line">        builder.<span class="title function_ invoke__">set_seats</span>(<span class="number">4</span>);</span><br><span class="line">        builder.<span class="title function_ invoke__">set_engine</span>(Engine::<span class="title function_ invoke__">new</span>(<span class="number">2.5</span>, <span class="number">0.0</span>));</span><br><span class="line">        builder.<span class="title function_ invoke__">set_transmission</span>(Transmission::Manual);</span><br><span class="line">        builder.<span class="title function_ invoke__">set_gsp_navigator</span>(GpsNavigator::<span class="title function_ invoke__">new</span>());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="main-rs-Client-code"><a href="#main-rs-Client-code" class="headerlink" title="main.rs: Client code"></a>main.rs: Client code</h4><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#![allow(unused)]</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">mod</span> builders;</span><br><span class="line"><span class="keyword">mod</span> cars;</span><br><span class="line"><span class="keyword">mod</span> components;</span><br><span class="line"><span class="keyword">mod</span> director;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> builders::&#123;Builder, CarBuilder, CarManualBuilder&#125;;</span><br><span class="line"><span class="keyword">use</span> cars::&#123;Car, Manual&#125;;</span><br><span class="line"><span class="keyword">use</span> director::Director;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">car_builder</span> = CarBuilder::<span class="title function_ invoke__">default</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Director gets the concrete builder object from the client</span></span><br><span class="line">    <span class="comment">// (application code). That&#x27;s because application knows better which</span></span><br><span class="line">    <span class="comment">// builder to use to get a specific product.</span></span><br><span class="line">    Director::<span class="title function_ invoke__">construct_sports_car</span>(&amp;<span class="keyword">mut</span> car_builder);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// The final product is often retrieved from a builder object, since</span></span><br><span class="line">    <span class="comment">// Director is not aware and not dependent on concrete builders and</span></span><br><span class="line">    <span class="comment">// products.</span></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">car</span>: Car = car_builder.<span class="title function_ invoke__">build</span>();</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;Car built: &#123;:?&#125;\n&quot;</span>, car.<span class="title function_ invoke__">car_type</span>());</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">manual_builder</span> = CarManualBuilder::<span class="title function_ invoke__">default</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Director may know several building recipes.</span></span><br><span class="line">    Director::<span class="title function_ invoke__">construct_city_car</span>(&amp;<span class="keyword">mut</span> manual_builder);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// The final car manual.</span></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">manual</span>: Manual = manual_builder.<span class="title function_ invoke__">build</span>();</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;Car manual built:\n&#123;&#125;&quot;</span>, manual);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Output"><a href="#Output" class="headerlink" title="Output"></a>Output</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Car built: SportsCar</span><br><span class="line"></span><br><span class="line">Car manual built:</span><br><span class="line">Type of car: CityCar</span><br><span class="line">Count of seats: 2</span><br><span class="line">Engine: volume - 1.2; mileage - 0</span><br><span class="line">Transmission: Automatic</span><br><span class="line">GPS Navigator: Functional</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://tonymistark.github.io/2023/11/20/design-pattern/abstract-factory/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Ice">
      <meta itemprop="description" content="å®‰é™åœ°åç€å­¦ä¹ ">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="BLOG">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/11/20/design-pattern/abstract-factory/" class="post-title-link" itemprop="url">Abstract Factory</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2023-11-20 20:16:29" itemprop="dateCreated datePublished" datetime="2023-11-20T20:16:29+08:00">2023-11-20</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2023-11-22 23:21:21" itemprop="dateModified" datetime="2023-11-22T23:21:21+08:00">2023-11-22</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/design-pattern/" itemprop="url" rel="index"><span itemprop="name">design-pattern</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="Symbols count in article">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">Symbols count in article: </span>
              <span>6.2k</span>
            </span>
            <span class="post-meta-item" title="Reading time">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">Reading time &asymp;</span>
              <span>22 mins.</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="Abstract-Factory-æŠ½è±¡å·¥å‚"><a href="#Abstract-Factory-æŠ½è±¡å·¥å‚" class="headerlink" title="Abstract Factory æŠ½è±¡å·¥å‚"></a>Abstract Factory æŠ½è±¡å·¥å‚</h1><h2 id="Intent-æ„å›¾"><a href="#Intent-æ„å›¾" class="headerlink" title="Intent æ„å›¾"></a>Intent æ„å›¾</h2><p>Abstract Factory is a creational design pattern that lets you produce families of related objects without specifying their concrete classes.<br>æŠ½è±¡å·¥å‚æ˜¯ä¸€ç§åˆ›å»ºæ€§è®¾è®¡æ¨¡å¼ï¼Œå®ƒå…è®¸æ‚¨ç”Ÿæˆç›¸å…³å¯¹è±¡çš„æ—ï¼Œè€Œæ— éœ€æŒ‡å®šå…¶å…·ä½“ç±»ã€‚</p>
<div align="center"> <img src="/images/abstract-factory-en.png"/></div>

<h2 id="Problem-é—®é¢˜"><a href="#Problem-é—®é¢˜" class="headerlink" title="Problem é—®é¢˜"></a>Problem é—®é¢˜</h2><p>Imagine that youâ€™re creating a furniture shop simulator. Your code consists of classes that represent:<br>æƒ³è±¡ä¸€ä¸‹ï¼Œæ‚¨æ­£åœ¨åˆ›å»ºä¸€ä¸ªå®¶å…·åº—æ¨¡æ‹Ÿå™¨ã€‚ä»£ç ç”±è¡¨ç¤ºä»¥ä¸‹å†…å®¹çš„ç±»ç»„æˆï¼š</p>
<p>A family of related products, say: <code>Chair</code> + <code>Sofa</code> + <code>CoffeeTable</code>.<br>ä¸€ç³»åˆ—ç›¸å…³äº§å“ï¼Œå¦‚ï¼š<code>Chair</code> + <code>Sofa</code> + <code>CoffeeTable</code>ã€‚</p>
<p>Several variants of this family. For example, products <code>Chair</code> + <code>Sofa</code> + <code>CoffeeTable</code> are available in these variants: <code>Modern</code>, <code>Victorian</code>, <code>ArtDeco</code>.<br>è¯¥ç³»åˆ—çš„å‡ ä¸ªå˜ä½“ã€‚ä¾‹å¦‚ï¼Œäº§å“ <code>Chair</code> + <code>Sofa</code> + <code>CoffeeTable</code> æä¾›ä»¥ä¸‹å˜ä½“ï¼š <code>Modern</code> + <code>Victorian</code> + <code>ArtDeco</code> ã€‚</p>
<div align="center"> <img src="/images/abs-fac-problem2-en.png"/>Product families and their variants.</br> äº§å“ç³»åˆ—åŠå…¶å˜ä½“ã€‚</div>

<p>You need a way to create individual furniture objects so that they match other objects of the same family. Customers get quite mad when they receive non-matching furniture.<br>æ‚¨éœ€è¦ä¸€ç§æ–¹æ³•æ¥åˆ›å»ºå•ä¸ªå®¶å…·å¯¹è±¡ï¼Œä»¥ä¾¿å®ƒä»¬ä¸åŒä¸€ç³»åˆ—çš„å…¶ä»–å¯¹è±¡ç›¸åŒ¹é…ã€‚å½“å®¢æˆ·æ”¶åˆ°ä¸åŒ¹é…çš„å®¶å…·æ—¶ï¼Œä»–ä»¬ä¼šéå¸¸ç”Ÿæ°”ã€‚</p>
<div align="center"> <img src="/images/abstract-factory-comic-1-en.png"/>A Modern-style sofa doesnâ€™t match Victorian-style chairs.</div>

<p>A Modern-style sofa doesnâ€™t match Victorian-style chairs.<br>ç°ä»£é£æ ¼çš„æ²™å‘ä¸ç»´å¤šåˆ©äºšé£æ ¼çš„æ¤…å­ä¸åŒ¹é…ã€‚</p>
<p>Also, you donâ€™t want to change existing code when adding new products or families of products to the program. Furniture vendors update their catalogs very often, and you wouldnâ€™t want to change the core code each time it happens.<br>æ­¤å¤–ï¼Œåœ¨å‘ç¨‹åºæ·»åŠ æ–°äº§å“æˆ–äº§å“ç³»åˆ—æ—¶ï¼Œæ‚¨ä¸å¸Œæœ›æ›´æ”¹ç°æœ‰ä»£ç ã€‚å®¶å…·ä¾›åº”å•†ç»å¸¸æ›´æ–°ä»–ä»¬çš„ç›®å½•ï¼Œæ‚¨ä¸å¸Œæœ›æ¯æ¬¡éƒ½æ›´æ”¹æ ¸å¿ƒä»£ç ã€‚</p>
<h2 id="Solution-è§£å†³æ–¹æ¡ˆ"><a href="#Solution-è§£å†³æ–¹æ¡ˆ" class="headerlink" title="Solution è§£å†³æ–¹æ¡ˆ"></a>Solution è§£å†³æ–¹æ¡ˆ</h2><p>The first thing the Abstract Factory pattern suggests is to explicitly declare interfaces for each distinct product of the product family (e.g., chair, sofa or coffee table). Then you can make all variants of products follow those interfaces. For example, all chair variants can implement the <code>Chair</code> interface; all coffee table variants can implement the <code>CoffeeTable</code> interface, and so on.<br>æŠ½è±¡å·¥å‚æ¨¡å¼å»ºè®®çš„ç¬¬ä¸€ä»¶äº‹æ˜¯æ˜¾å¼å£°æ˜äº§å“ç³»åˆ—ä¸­æ¯ä¸ªä¸åŒäº§å“ï¼ˆä¾‹å¦‚ï¼Œæ¤…å­ã€æ²™å‘æˆ–å’–å•¡æ¡Œï¼‰çš„æ¥å£ã€‚ç„¶åï¼Œæ‚¨å¯ä»¥ä½¿äº§å“çš„æ‰€æœ‰å˜ä½“éƒ½éµå¾ªè¿™äº›æ¥å£ã€‚ä¾‹å¦‚ï¼Œæ‰€æœ‰æ¤…å­å˜ä½“éƒ½å¯ä»¥å®ç°è¯¥ <code>Chair</code> æ¥å£;æ‰€æœ‰å’–å•¡æ¡Œå˜ä½“éƒ½å¯ä»¥å®ç°æ¥å£ <code>CoffeeTable</code> ï¼Œä¾æ­¤ç±»æ¨ã€‚</p>
<div align="center"> <img src="/images/abs-fac-solution1.png"/>All variants of the same object must be moved to a single class hierarchy.</br>å¿…é¡»å°†åŒä¸€å¯¹è±¡çš„æ‰€æœ‰å˜ä½“ç§»åŠ¨åˆ°å•ä¸ªç±»å±‚æ¬¡ç»“æ„ä¸­ã€‚</div>

<p>The next move is to declare the Abstract Factoryâ€”an interface with a list of creation methods for all products that are part of the product family (for example, <code>createChair</code>, <code>createSofa</code> and <code>createCoffeeTable</code>). These methods must return abstract product types represented by the interfaces we extracted previously: <code>Chair</code>, <code>Sofa</code>, <code>CoffeeTable</code> and so on.<br>ä¸‹ä¸€æ­¥æ˜¯å£°æ˜æŠ½è±¡å·¥å‚ - ä¸€ä¸ªæ¥å£ï¼Œå…¶ä¸­åŒ…å«å±äºäº§å“ç³»åˆ—çš„æ‰€æœ‰äº§å“çš„åˆ›å»ºæ–¹æ³•åˆ—è¡¨ï¼ˆä¾‹å¦‚ï¼Œ <code>createChair</code> ã€ <code>createSofa </code>å’Œ <code>createCoffeeTable</code> ï¼‰ã€‚è¿™äº›æ–¹æ³•å¿…é¡»è¿”å›ç”±æˆ‘ä»¬ä¹‹å‰æå–çš„æ¥å£è¡¨ç¤ºçš„æŠ½è±¡äº§å“ç±»å‹ï¼š <code>Chair</code> ã€ <code>Sofa</code> ç­‰ <code>CoffeeTable</code> ã€‚</p>
<div align="center"> <img src="/images/abs-fac-solution2.png"/>Each concrete factory corresponds to a specific product variant.</br>æ¯ä¸ªæ··å‡åœŸå·¥å‚å¯¹åº”ä¸€ä¸ªç‰¹å®šçš„äº§å“å˜å‹ã€‚</div>
The _Factories_ class hierarchy
Each concrete factory corresponds to a specific product variant.
æ¯ä¸ªæ··å‡åœŸå·¥å‚å¯¹åº”ä¸€ä¸ªç‰¹å®šçš„äº§å“å˜å‹ã€‚

<p>Now, how about the product variants? For each variant of a product family, we create a separate factory class based on the <code>AbstractFactory</code> interface. A factory is a class that returns products of a particular kind. For example, the <code>ModernFurnitureFactory</code> can only create <code>ModernChair</code>, <code>ModernSofa</code> and <code>ModernCoffeeTable</code> objects.<br>ç°åœ¨ï¼Œäº§å“å˜ä½“æ€ä¹ˆæ ·ï¼Ÿå¯¹äºäº§å“ç³»åˆ—çš„æ¯ä¸ªå˜ä½“ï¼Œæˆ‘ä»¬åŸºäº <code>AbstractFactory</code> æ¥å£åˆ›å»ºä¸€ä¸ªå•ç‹¬çš„å·¥å‚ç±»ã€‚å·¥å‚æ˜¯è¿”å›ç‰¹å®šç§ç±»äº§å“çš„ç±»ã€‚ä¾‹å¦‚ï¼Œåªèƒ½ <code>ModernFurnitureFactory</code> åˆ›å»º <code>ModernChair</code> å’Œ <code>ModernSofa</code> <code>ModernCoffeeTable</code> å¯¹è±¡ã€‚</p>
<p>The client code has to work with both factories and products via their respective abstract interfaces. This lets you change the type of a factory that you pass to the client code, as well as the product variant that the client code receives, without breaking the actual client code.<br>å®¢æˆ·ç«¯ä»£ç å¿…é¡»é€šè¿‡å·¥å‚å’Œäº§å“å„è‡ªçš„æŠ½è±¡æ¥å£è¿›è¡Œå¤„ç†ã€‚è¿™æ ·ï¼Œæ‚¨å°±å¯ä»¥æ›´æ”¹ä¼ é€’ç»™å®¢æˆ·ç«¯ä»£ç çš„å·¥å‚ç±»å‹ï¼Œä»¥åŠå®¢æˆ·ç«¯ä»£ç æ¥æ”¶çš„äº§å“å˜å‹ï¼Œè€Œä¸ä¼šç ´åå®é™…çš„å®¢æˆ·ç«¯ä»£ç ã€‚</p>
<div align="center"> <img src="/images/abs-fac-solution2.png"/>The client shouldnâ€™t care about the concrete class of the factory it works with.</br>å®¢æˆ·ä¸åº”è¯¥å…³å¿ƒä¸å®ƒåˆä½œçš„å·¥å‚çš„å…·ä½“ç±»åˆ«ã€‚</div>

<p>The client shouldnâ€™t care about the concrete class of the factory it works with.<br>å®¢æˆ·ä¸åº”è¯¥å…³å¿ƒä¸å®ƒåˆä½œçš„å·¥å‚çš„å…·ä½“ç±»åˆ«ã€‚</p>
<p>Say the client wants a factory to produce a chair. The client doesnâ€™t have to be aware of the factoryâ€™s class, nor does it matter what kind of chair it gets. Whether itâ€™s a Modern model or a Victorian-style chair, the client must treat all chairs in the same manner, using the abstract <code>Chair</code> interface. With this approach, the only thing that the client knows about the chair is that it implements the sitOn method in some way. Also, whichever variant of the chair is returned, itâ€™ll always match the type of sofa or coffee table produced by the same factory object.<br>å‡è®¾å®¢æˆ·æƒ³è¦ä¸€å®¶å·¥å‚ç”Ÿäº§ä¸€æŠŠæ¤…å­ã€‚å®¢æˆ·ä¸å¿…çŸ¥é“å·¥å‚çš„ç­‰çº§ï¼Œä¹Ÿä¸å¿…çŸ¥é“å®ƒå¾—åˆ°ä»€ä¹ˆæ ·çš„æ¤…å­ã€‚æ— è®ºæ˜¯ç°ä»£æ¨¡å‹è¿˜æ˜¯ç»´å¤šåˆ©äºšé£æ ¼çš„æ¤…å­ï¼Œå®¢æˆ·éƒ½å¿…é¡»ä½¿ç”¨æŠ½è±¡ <code>Chair</code> ç•Œé¢ä»¥ç›¸åŒçš„æ–¹å¼å¯¹å¾…æ‰€æœ‰æ¤…å­ã€‚ä½¿ç”¨è¿™ç§æ–¹æ³•ï¼Œå®¢æˆ·å¯¹æ¤…å­çš„å”¯ä¸€äº†è§£æ˜¯å®ƒä»¥æŸç§æ–¹å¼å®ç°äº† <code>sitOn</code> è¯¥æ–¹æ³•ã€‚æ­¤å¤–ï¼Œæ— è®ºè¿”å›å“ªç§æ¤…å­å˜ä½“ï¼Œå®ƒéƒ½å°†å§‹ç»ˆä¸åŒä¸€å·¥å‚å¯¹è±¡ç”Ÿäº§çš„æ²™å‘æˆ–å’–å•¡æ¡Œç±»å‹ç›¸åŒ¹é…ã€‚</p>
<p>Thereâ€™s one more thing left to clarify: if the client is only exposed to the abstract interfaces, what creates the actual factory objects? Usually, the application creates a concrete factory object at the initialization stage. Just before that, the app must select the factory type depending on the configuration or the environment settings.<br>è¿˜æœ‰ä¸€ä»¶äº‹éœ€è¦æ¾„æ¸…ï¼šå¦‚æœå®¢æˆ·ç«¯åªæš´éœ²ç»™æŠ½è±¡æ¥å£ï¼Œé‚£ä¹ˆæ˜¯ä»€ä¹ˆåˆ›å»ºäº†å®é™…çš„å·¥å‚å¯¹è±¡ï¼Ÿé€šå¸¸ï¼Œåº”ç”¨ç¨‹åºåœ¨åˆå§‹åŒ–é˜¶æ®µåˆ›å»ºä¸€ä¸ªå…·ä½“çš„å·¥å‚å¯¹è±¡ã€‚åœ¨æ­¤ä¹‹å‰ï¼Œåº”ç”¨ç¨‹åºå¿…é¡»æ ¹æ®é…ç½®æˆ–ç¯å¢ƒè®¾ç½®é€‰æ‹©å‡ºå‚ç±»å‹ã€‚</p>
<h2 id="Structure-ç»“æ„"><a href="#Structure-ç»“æ„" class="headerlink" title="Structure ç»“æ„"></a>Structure ç»“æ„</h2><div align="center"> <img src="/images/abs-fac-structure.png"/></br></div>

<ol>
<li><p><strong>Abstract Products</strong> declare interfaces for a set of distinct but related products which make up a product family.<br>æŠ½è±¡äº§å“å£°æ˜äº†ä¸€ç»„ä¸åŒä½†ç›¸å…³çš„äº§å“çš„æ¥å£ï¼Œè¿™äº›äº§å“æ„æˆäº†ä¸€ä¸ªäº§å“ç³»åˆ—ã€‚</p>
</li>
<li><p><strong>concrete Products</strong> are various implementations of abstract products, grouped by variants. Each abstract product (chair&#x2F;sofa) must be implemented in all given variants (Victorian&#x2F;Modern).<br>å…·ä½“äº§å“æ˜¯æŠ½è±¡äº§å“çš„å„ç§å®ç°ï¼ŒæŒ‰å˜ä½“åˆ†ç»„ã€‚æ¯ä¸ªæŠ½è±¡äº§å“ï¼ˆæ¤…å­&#x2F;æ²™å‘ï¼‰éƒ½å¿…é¡»åœ¨æ‰€æœ‰ç»™å®šçš„å˜ä½“ï¼ˆç»´å¤šåˆ©äºšå¼&#x2F;ç°ä»£å¼ï¼‰ä¸­å®ç°ã€‚</p>
</li>
<li><p>The <strong>Abstract Factory</strong> interface declares a set of methods for creating each of the abstract products.<br>æŠ½è±¡å·¥å‚æ¥å£å£°æ˜äº†ä¸€ç»„ç”¨äºåˆ›å»ºæ¯ä¸ªæŠ½è±¡äº§å“çš„æ–¹æ³•ã€‚</p>
</li>
<li><p><strong>Concrete Factories</strong> implement creation methods of the abstract factory. Each concrete factory corresponds to a specific variant of products and creates only those product variants.<br>å…·ä½“å·¥å‚å®ç°äº†æŠ½è±¡å·¥å‚çš„åˆ›å»ºæ–¹æ³•ã€‚æ¯ä¸ªæ··å‡åœŸå·¥å‚å¯¹åº”äºäº§å“çš„ç‰¹å®šå˜ä½“ï¼Œå¹¶ä¸”ä»…åˆ›å»ºè¿™äº›äº§å“å˜ä½“ã€‚</p>
</li>
<li><p><strong>Although concrete</strong> factories instantiate concrete products, signatures of their creation methods must return corresponding abstract products. This way the client code that uses a factory doesnâ€™t get coupled to the specific variant of the product it gets from a factory. The Client can work with any concrete factory&#x2F;product variant, as long as it communicates with their objects via abstract interfaces.<br>è™½ç„¶å…·ä½“å·¥å‚å®ä¾‹åŒ–äº†å…·ä½“äº§å“ï¼Œä½†å…¶åˆ›å»ºæ–¹æ³•çš„ç­¾åå¿…é¡»è¿”å›ç›¸åº”çš„æŠ½è±¡äº§å“ã€‚è¿™æ ·ï¼Œä½¿ç”¨å·¥å‚çš„å®¢æˆ·ç«¯ä»£ç å°±ä¸ä¼šä¸å®ƒä»å·¥å‚è·å¾—çš„äº§å“çš„ç‰¹å®šå˜ä½“è€¦åˆã€‚å®¢æˆ·ç«¯å¯ä»¥ä½¿ç”¨ä»»ä½•å…·ä½“çš„å·¥å‚&#x2F;äº§å“å˜ä½“ï¼Œåªè¦å®ƒé€šè¿‡æŠ½è±¡æ¥å£ä¸å®ƒä»¬çš„å¯¹è±¡è¿›è¡Œé€šä¿¡å³å¯ã€‚</p>
</li>
</ol>
<h2 id="Pseudocode-ä¼ªä»£ç "><a href="#Pseudocode-ä¼ªä»£ç " class="headerlink" title="Pseudocode ä¼ªä»£ç "></a>Pseudocode ä¼ªä»£ç </h2><p>This example illustrates how the <strong>Abstract Factory</strong> pattern can be used for creating cross-platform UI elements without coupling the client code to concrete UI classes, while keeping all created elements consistent with a selected operating system.<br>æ­¤ç¤ºä¾‹æ¼”ç¤ºå¦‚ä½•ä½¿ç”¨æŠ½è±¡å·¥å‚æ¨¡å¼åˆ›å»ºè·¨å¹³å° UI å…ƒç´ ï¼Œè€Œæ— éœ€å°†å®¢æˆ·ç«¯ä»£ç è€¦åˆåˆ°å…·ä½“çš„ UI ç±»ï¼ŒåŒæ—¶ä½¿æ‰€æœ‰åˆ›å»ºçš„å…ƒç´ ä¸æ‰€é€‰æ“ä½œç³»ç»Ÿä¿æŒä¸€è‡´ã€‚</p>
<div align="center"> <img src="/images/abs-fac-example.png"/>The cross-platform UI classes example.</br>è·¨å¹³å° UI ç±»ç¤ºä¾‹ã€‚</div>
The same UI elements in a cross-platform application are expected to behave similarly, but look a little bit different under different operating systems. Moreover, itâ€™s your job to make sure that the UI elements match the style of the current operating system. You wouldnâ€™t want your program to render macOS controls when itâ€™s executed in Windows.
è·¨å¹³å°åº”ç”¨ç¨‹åºä¸­çš„ç›¸åŒ UI å…ƒç´ çš„è¡Œä¸ºåº”ç›¸ä¼¼ï¼Œä½†åœ¨ä¸åŒçš„æ“ä½œç³»ç»Ÿä¸‹çœ‹èµ·æ¥ç•¥æœ‰ä¸åŒã€‚æ­¤å¤–ï¼Œæ‚¨çš„å·¥ä½œæ˜¯ç¡®ä¿ UI å…ƒç´ ä¸å½“å‰æ“ä½œç³»ç»Ÿçš„æ ·å¼ç›¸åŒ¹é…ã€‚ä½ ä¸å¸Œæœ›ç¨‹åºåœ¨ Windows ä¸­æ‰§è¡Œæ—¶å‘ˆç° macOS æ§ä»¶ã€‚

<p>The Abstract Factory interface declares a set of creation methods that the client code can use to produce different types of UI elements. Concrete factories correspond to specific operating systems and create the UI elements that match that particular OS.<br>æŠ½è±¡å·¥å‚æ¥å£å£°æ˜äº†ä¸€ç»„åˆ›å»ºæ–¹æ³•ï¼Œå®¢æˆ·ç«¯ä»£ç å¯ä»¥ä½¿ç”¨è¿™äº›æ–¹æ³•ç”Ÿæˆä¸åŒç±»å‹çš„ UI å…ƒç´ ã€‚å…·ä½“å·¥å‚å¯¹åº”äºç‰¹å®šçš„æ“ä½œç³»ç»Ÿï¼Œå¹¶åˆ›å»ºä¸è¯¥ç‰¹å®šæ“ä½œç³»ç»ŸåŒ¹é…çš„ UI å…ƒç´ ã€‚</p>
<p>It works like this: when an application launches, it checks the type of the current operating system. The app uses this information to create a factory object from a class that matches the operating system. The rest of the code uses this factory to create UI elements. This prevents the wrong elements from being created.<br>å®ƒçš„å·¥ä½œåŸç†æ˜¯è¿™æ ·çš„ï¼šå½“åº”ç”¨ç¨‹åºå¯åŠ¨æ—¶ï¼Œå®ƒä¼šæ£€æŸ¥å½“å‰æ“ä½œç³»ç»Ÿçš„ç±»å‹ã€‚åº”ç”¨ä½¿ç”¨æ­¤ä¿¡æ¯ä»ä¸æ“ä½œç³»ç»ŸåŒ¹é…çš„ç±»åˆ›å»ºå·¥å‚å¯¹è±¡ã€‚ä»£ç çš„å…¶ä½™éƒ¨åˆ†ä½¿ç”¨æ­¤å·¥å‚åˆ›å»º UI å…ƒç´ ã€‚è¿™æ ·å¯ä»¥é˜²æ­¢åˆ›å»ºé”™è¯¯çš„å…ƒç´ ã€‚</p>
<p>With this approach, the client code doesnâ€™t depend on concrete classes of factories and UI elements as long as it works with these objects via their abstract interfaces. This also lets the client code support other factories or UI elements that you might add in the future.<br>ä½¿ç”¨è¿™ç§æ–¹æ³•ï¼Œå®¢æˆ·ç«¯ä»£ç ä¸ä¾èµ–äºå·¥å‚å’Œ UI å…ƒç´ çš„å…·ä½“ç±»ï¼Œåªè¦å®ƒé€šè¿‡å…¶æŠ½è±¡æ¥å£å¤„ç†è¿™äº›å¯¹è±¡å³å¯ã€‚è¿™ä¹Ÿå…è®¸å®¢æˆ·ç«¯ä»£ç æ”¯æŒå°†æ¥å¯èƒ½æ·»åŠ çš„å…¶ä»–å·¥å‚æˆ– UI å…ƒç´ ã€‚</p>
<p>As a result, you donâ€™t need to modify the client code each time you add a new variation of UI elements to your app. You just have to create a new factory class that produces these elements and slightly modify the appâ€™s initialization code so it selects that class when appropriate.<br>å› æ­¤ï¼Œæ¯æ¬¡å‘åº”ç”¨æ·»åŠ æ–°çš„ UI å…ƒç´ å˜ä½“æ—¶ï¼Œéƒ½æ— éœ€ä¿®æ”¹å®¢æˆ·ç«¯ä»£ç ã€‚åªéœ€åˆ›å»ºä¸€ä¸ªæ–°çš„å·¥å‚ç±»æ¥ç”Ÿæˆè¿™äº›å…ƒç´ ï¼Œå¹¶ç¨å¾®ä¿®æ”¹åº”ç”¨çš„åˆå§‹åŒ–ä»£ç ï¼Œä»¥ä¾¿å®ƒåœ¨é€‚å½“çš„æ—¶å€™é€‰æ‹©è¯¥ç±»ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// The abstract factory interface declares a set of methods that</span></span><br><span class="line"><span class="comment">// return different abstract products. These products are called</span></span><br><span class="line"><span class="comment">// a family and are related by a high-level theme or concept.</span></span><br><span class="line"><span class="comment">// Products of one family are usually able to collaborate among</span></span><br><span class="line"><span class="comment">// themselves. A family of products may have several variants,</span></span><br><span class="line"><span class="comment">// but the products of one variant are incompatible with the</span></span><br><span class="line"><span class="comment">// products of another variant.</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">GUIFactory</span> is</span><br><span class="line">    method <span class="title function_">createButton</span><span class="params">()</span>:Button</span><br><span class="line">    method <span class="title function_">createCheckbox</span><span class="params">()</span>:Checkbox</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// Concrete factories produce a family of products that belong</span></span><br><span class="line"><span class="comment">// to a single variant. The factory guarantees that the</span></span><br><span class="line"><span class="comment">// resulting products are compatible. Signatures of the concrete</span></span><br><span class="line"><span class="comment">// factory&#x27;s methods return an abstract product, while inside</span></span><br><span class="line"><span class="comment">// the method a concrete product is instantiated.</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">WinFactory</span> <span class="keyword">implements</span> <span class="title class_">GUIFactory</span> is</span><br><span class="line">    method <span class="title function_">createButton</span><span class="params">()</span>:Button is</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">WinButton</span>()</span><br><span class="line">    method <span class="title function_">createCheckbox</span><span class="params">()</span>:Checkbox is</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">WinCheckbox</span>()</span><br><span class="line"></span><br><span class="line"><span class="comment">// Each concrete factory has a corresponding product variant.</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MacFactory</span> <span class="keyword">implements</span> <span class="title class_">GUIFactory</span> is</span><br><span class="line">    method <span class="title function_">createButton</span><span class="params">()</span>:Button is</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">MacButton</span>()</span><br><span class="line">    method <span class="title function_">createCheckbox</span><span class="params">()</span>:Checkbox is</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">MacCheckbox</span>()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// Each distinct product of a product family should have a base</span></span><br><span class="line"><span class="comment">// interface. All variants of the product must implement this</span></span><br><span class="line"><span class="comment">// interface.</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">Button</span> is</span><br><span class="line">    method <span class="title function_">paint</span><span class="params">()</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Concrete products are created by corresponding concrete</span></span><br><span class="line"><span class="comment">// factories.</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">WinButton</span> <span class="keyword">implements</span> <span class="title class_">Button</span> is</span><br><span class="line">    method <span class="title function_">paint</span><span class="params">()</span> is</span><br><span class="line">        <span class="comment">// Render a button in Windows style.</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MacButton</span> <span class="keyword">implements</span> <span class="title class_">Button</span> is</span><br><span class="line">    method <span class="title function_">paint</span><span class="params">()</span> is</span><br><span class="line">        <span class="comment">// Render a button in macOS style.</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Here&#x27;s the base interface of another product. All products</span></span><br><span class="line"><span class="comment">// can interact with each other, but proper interaction is</span></span><br><span class="line"><span class="comment">// possible only between products of the same concrete variant.</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">Checkbox</span> is</span><br><span class="line">    method <span class="title function_">paint</span><span class="params">()</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">WinCheckbox</span> <span class="keyword">implements</span> <span class="title class_">Checkbox</span> is</span><br><span class="line">    method <span class="title function_">paint</span><span class="params">()</span> is</span><br><span class="line">        <span class="comment">// Render a checkbox in Windows style.</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MacCheckbox</span> <span class="keyword">implements</span> <span class="title class_">Checkbox</span> is</span><br><span class="line">    method <span class="title function_">paint</span><span class="params">()</span> is</span><br><span class="line">        <span class="comment">// Render a checkbox in macOS style.</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// The client code works with factories and products only</span></span><br><span class="line"><span class="comment">// through abstract types: GUIFactory, Button and Checkbox. This</span></span><br><span class="line"><span class="comment">// lets you pass any factory or product subclass to the client</span></span><br><span class="line"><span class="comment">// code without breaking it.</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Application</span> is</span><br><span class="line">    <span class="keyword">private</span> field factory: GUIFactory</span><br><span class="line">    <span class="keyword">private</span> field button: Button</span><br><span class="line">    constructor <span class="title function_">Application</span><span class="params">(factory: GUIFactory)</span> is</span><br><span class="line">        <span class="built_in">this</span>.factory = factory</span><br><span class="line">    method <span class="title function_">createUI</span><span class="params">()</span> is</span><br><span class="line">        <span class="built_in">this</span>.button = factory.createButton()</span><br><span class="line">    method <span class="title function_">paint</span><span class="params">()</span> is</span><br><span class="line">        button.paint()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// The application picks the factory type depending on the</span></span><br><span class="line"><span class="comment">// current configuration or environment settings and creates it</span></span><br><span class="line"><span class="comment">// at runtime (usually at the initialization stage).</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ApplicationConfigurator</span> is</span><br><span class="line">    method <span class="title function_">main</span><span class="params">()</span> <span class="type">is</span></span><br><span class="line">        <span class="variable">config</span> <span class="operator">=</span> readApplicationConfigFile()</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (config.OS == <span class="string">&quot;Windows&quot;</span>) <span class="type">then</span></span><br><span class="line">            <span class="variable">factory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">WinFactory</span>()</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (config.OS == <span class="string">&quot;Mac&quot;</span>) <span class="type">then</span></span><br><span class="line">            <span class="variable">factory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MacFactory</span>()</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Exception</span>(<span class="string">&quot;Error! Unknown operating system.&quot;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="type">Application</span> <span class="variable">app</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Application</span>(factory)</span><br></pre></td></tr></table></figure>

<h2 id="Applicability-é€‚ç”¨æ€§"><a href="#Applicability-é€‚ç”¨æ€§" class="headerlink" title="Applicability é€‚ç”¨æ€§"></a>Applicability é€‚ç”¨æ€§</h2><ul>
<li><p><strong>Use the Abstract Factory when your code needs to work with various families of related products, but you donâ€™t want it to depend on the concrete classes of those productsâ€”they might be unknown beforehand or you simply want to allow for future extensibility.<br>å½“æ‚¨çš„ä»£ç éœ€è¦å¤„ç†å„ç§ç›¸å…³äº§å“ç³»åˆ—ï¼Œä½†æ‚¨ä¸å¸Œæœ›å®ƒä¾èµ–äºè¿™äº›äº§å“çš„å…·ä½“ç±»æ—¶ï¼Œè¯·ä½¿ç”¨æŠ½è±¡å·¥å‚ - å®ƒä»¬å¯èƒ½äº‹å…ˆæ˜¯æœªçŸ¥çš„ï¼Œæˆ–è€…æ‚¨åªæ˜¯æƒ³å…è®¸å°†æ¥çš„å¯æ‰©å±•æ€§ã€‚</strong></p>
</li>
<li><p>The Abstract Factory provides you with an interface for creating objects from each class of the product family. As long as your code creates objects via this interface, you donâ€™t have to worry about creating the wrong variant of a product which doesnâ€™t match the products already created by your app.<br>æŠ½è±¡å·¥å‚ä¸ºæ‚¨æä¾›äº†ä¸€ä¸ªæ¥å£ï¼Œç”¨äºä»äº§å“ç³»åˆ—çš„æ¯ä¸ªç±»åˆ›å»ºå¯¹è±¡ã€‚åªè¦æ‚¨çš„ä»£ç é€šè¿‡æ­¤æ¥å£åˆ›å»ºå¯¹è±¡ï¼Œæ‚¨å°±ä¸å¿…æ‹…å¿ƒåˆ›å»ºé”™è¯¯çš„äº§å“å˜ä½“ï¼Œè€Œè¯¥å˜ä½“ä¸æ‚¨çš„åº”ç”¨å·²åˆ›å»ºçš„äº§å“ä¸åŒ¹é…ã€‚</p>
</li>
<li><p><strong>Consider implementing the Abstract Factory when you have a class with a set of Factory Methods that blur its primary responsibility.<br>å½“æ‚¨æœ‰ä¸€ä¸ªå…·æœ‰ä¸€ç»„æ¨¡ç³Šå…¶ä¸»è¦èŒè´£çš„å·¥å‚æ–¹æ³•çš„ç±»æ—¶ï¼Œè¯·è€ƒè™‘å®ç°æŠ½è±¡å·¥å‚ã€‚</strong></p>
</li>
<li><p>In a well-designed program each class is responsible only for one thing. When a class deals with multiple product types, it may be worth extracting its factory methods into a stand-alone factory class or a full-blown Abstract Factory implementation.<br>åœ¨ä¸€ä¸ªç²¾å¿ƒè®¾è®¡çš„ç¨‹åºä¸­ï¼Œæ¯ä¸ªç±»åªè´Ÿè´£ä¸€ä»¶äº‹ã€‚å½“ä¸€ä¸ªç±»å¤„ç†å¤šç§äº§å“ç±»å‹æ—¶ï¼Œå¯èƒ½å€¼å¾—å°†å…¶å·¥å‚æ–¹æ³•æå–åˆ°ç‹¬ç«‹çš„å·¥å‚ç±»æˆ–æˆç†Ÿçš„æŠ½è±¡å·¥å‚å®ç°ä¸­ã€‚</p>
</li>
</ul>
<h2 id="How-to-Implement-å¦‚ä½•å®ç°"><a href="#How-to-Implement-å¦‚ä½•å®ç°" class="headerlink" title="How to Implement å¦‚ä½•å®ç°"></a>How to Implement å¦‚ä½•å®ç°</h2><ol>
<li><p>Map out a matrix of distinct product types versus variants of these products.<br>ç»˜åˆ¶å‡ºä¸åŒäº§å“ç±»å‹ä¸è¿™äº›äº§å“å˜ä½“çš„çŸ©é˜µã€‚</p>
</li>
<li><p>Declare abstract product interfaces for all product types. Then make all concrete product classes implement these interfaces.<br>å£°æ˜æ‰€æœ‰äº§å“ç±»å‹çš„æŠ½è±¡äº§å“æ¥å£ã€‚ç„¶åè®©æ‰€æœ‰å…·ä½“çš„äº§å“ç±»å®ç°è¿™äº›æ¥å£ã€‚</p>
</li>
<li><p>Declare the abstract factory interface with a set of creation methods for all abstract products.<br>å£°æ˜æŠ½è±¡å·¥å‚æ¥å£ï¼Œå…¶ä¸­åŒ…å«æ‰€æœ‰æŠ½è±¡äº§å“çš„ä¸€ç»„åˆ›å»ºæ–¹æ³•ã€‚</p>
</li>
<li><p>Implement a set of concrete factory classes, one for each product variant.<br>å®ç°ä¸€ç»„å…·ä½“çš„å·¥å‚ç±»ï¼Œæ¯ä¸ªäº§å“å˜å‹å¯¹åº”ä¸€ä¸ªã€‚</p>
</li>
<li><p>Create factory initialization code somewhere in the app. It should instantiate one of the concrete factory classes, depending on the application configuration or the current environment. Pass this factory object to all classes that construct products.<br>åœ¨åº”ç”¨çš„æŸä¸ªä½ç½®åˆ›å»ºå·¥å‚åˆå§‹åŒ–ä»£ç ã€‚å®ƒåº”è¯¥å®ä¾‹åŒ–ä¸€ä¸ªå…·ä½“çš„å·¥å‚ç±»ï¼Œå…·ä½“å–å†³äºåº”ç”¨ç¨‹åºé…ç½®æˆ–å½“å‰ç¯å¢ƒã€‚å°†æ­¤å·¥å‚å¯¹è±¡ä¼ é€’ç»™æ„é€ äº§å“çš„æ‰€æœ‰ç±»ã€‚</p>
</li>
<li><p>Scan through the code and find all direct calls to product constructors. Replace them with calls to the appropriate creation method on the factory object.<br>æ‰«æä»£ç å¹¶æ‰¾åˆ°å¯¹äº§å“æ„é€ å‡½æ•°çš„æ‰€æœ‰ç›´æ¥è°ƒç”¨ã€‚å°†å®ƒä»¬æ›¿æ¢ä¸ºå¯¹å·¥å‚å¯¹è±¡ä¸Šç›¸åº”åˆ›å»ºæ–¹æ³•çš„è°ƒç”¨ã€‚</p>
</li>
</ol>
<h2 id="Pros-and-Cons-ä¼˜ç‚¹å’Œç¼ºç‚¹"><a href="#Pros-and-Cons-ä¼˜ç‚¹å’Œç¼ºç‚¹" class="headerlink" title="Pros and Cons ä¼˜ç‚¹å’Œç¼ºç‚¹"></a>Pros and Cons ä¼˜ç‚¹å’Œç¼ºç‚¹</h2><h3 id="Pros-ä¼˜ç‚¹"><a href="#Pros-ä¼˜ç‚¹" class="headerlink" title="Pros ä¼˜ç‚¹"></a>Pros ä¼˜ç‚¹</h3><ul>
<li>You can be sure that the products youâ€™re getting from a factory are compatible with each other.<br>æ‚¨å¯ä»¥ç¡®å®šæ‚¨ä»å·¥å‚è·å¾—çš„äº§å“å½¼æ­¤å…¼å®¹ã€‚</li>
<li>You avoid tight coupling between concrete products and client code.<br>å¯ä»¥é¿å…å…·ä½“äº§å“å’Œå®¢æˆ·ç«¯ä»£ç ä¹‹é—´çš„ç´§å¯†è€¦åˆã€‚</li>
<li>Single Responsibility Principle. You can extract the product creation code into one place, making the code easier to support.<br>å•ä¸€è´£ä»»åŸåˆ™ã€‚æ‚¨å¯ä»¥å°†äº§å“åˆ›å»ºä»£ç æå–åˆ°ä¸€ä¸ªä½ç½®ï¼Œä½¿ä»£ç æ›´æ˜“äºæ”¯æŒã€‚</li>
<li>Open&#x2F;Closed Principle. You can introduce new variants of products without breaking existing client code.<br>å¼€&#x2F;é—­åŸç†ã€‚æ‚¨å¯ä»¥åœ¨ä¸ç ´åç°æœ‰å®¢æˆ·ç«¯ä»£ç çš„æƒ…å†µä¸‹å¼•å…¥æ–°çš„äº§å“å˜ä½“ã€‚</li>
</ul>
<h3 id="Cons-ç¼ºç‚¹"><a href="#Cons-ç¼ºç‚¹" class="headerlink" title="Cons ç¼ºç‚¹"></a>Cons ç¼ºç‚¹</h3><ul>
<li>The code may become more complicated than it should be, since a lot of new interfaces and classes are introduced along with the pattern.<br>ä»£ç å¯èƒ½ä¼šå˜å¾—æ¯”åº”æœ‰çš„æ›´å¤æ‚ï¼Œå› ä¸ºè®¸å¤šæ–°çš„æ¥å£å’Œç±»ä¸æ¨¡å¼ä¸€èµ·å¼•å…¥ã€‚</li>
</ul>
<h2 id="Relations-with-Other-Patterns-ä¸å…¶ä»–æ¨¡å¼çš„å…³ç³»"><a href="#Relations-with-Other-Patterns-ä¸å…¶ä»–æ¨¡å¼çš„å…³ç³»" class="headerlink" title="Relations with Other Patterns ä¸å…¶ä»–æ¨¡å¼çš„å…³ç³»"></a>Relations with Other Patterns ä¸å…¶ä»–æ¨¡å¼çš„å…³ç³»</h2><ul>
<li><p>Many designs start by using <strong>Factory Method</strong> (less complicated and more customizable via subclasses) and evolve toward <strong>Abstract Factory</strong>, <strong>Prototype</strong>, or <strong>Builder</strong> (more flexible, but more complicated).<br>è®¸å¤šè®¾è®¡ä»ä½¿ç”¨å·¥å‚æ–¹æ³•ï¼ˆä¸é‚£ä¹ˆå¤æ‚ï¼Œé€šè¿‡å­ç±»æ›´å¯å®šåˆ¶ï¼‰å¼€å§‹ï¼Œç„¶åå‘å±•åˆ°æŠ½è±¡å·¥å‚ã€åŸå‹æˆ–æ„å»ºå™¨ï¼ˆæ›´çµæ´»ï¼Œä½†æ›´å¤æ‚ï¼‰ã€‚</p>
</li>
<li><p><strong>Builder</strong> focuses on constructing complex objects step by step.** Abstract Factory** specializes in creating families of related objects. <strong>Abstract Factory</strong> returns the product immediately, whereas Builder lets you run some additional construction steps before fetching the product.<br>Builder ä¸“æ³¨äºé€æ­¥æ„å»ºå¤æ‚çš„å¯¹è±¡ã€‚Abstract Factoryä¸“é—¨ç”¨äºåˆ›å»ºç›¸å…³å¯¹è±¡çš„æ—ã€‚Abstract Factory ä¼šç«‹å³è¿”å›äº§å“ï¼Œè€Œ Builder å…è®¸æ‚¨åœ¨è·å–äº§å“ä¹‹å‰è¿è¡Œä¸€äº›é¢å¤–çš„æ„é€ æ­¥éª¤ã€‚</p>
</li>
<li><p><strong>Abstract Factory</strong> classes are often based on a set of <strong>Factory Methods</strong>, but you can also use <strong>Prototype</strong> to compose the methods on these classes.<br>æŠ½è±¡å·¥å‚ç±»é€šå¸¸åŸºäºä¸€ç»„å·¥å‚æ–¹æ³•ï¼Œä½†æ‚¨ä¹Ÿå¯ä»¥ä½¿ç”¨ Prototype æ¥ç»„åˆè¿™äº›ç±»çš„æ–¹æ³•ã€‚</p>
</li>
<li><p><strong>Abstract Factory</strong> can serve as an alternative to <strong>Facade</strong> when you only want to hide the way the subsystem objects are created from the client code.<br>æŠ½è±¡å·¥å‚å¯ä»¥ä½œä¸º Facade çš„æ›¿ä»£æ–¹æ³•ï¼Œå½“æ‚¨åªæƒ³ä»å®¢æˆ·ç«¯ä»£ç ä¸­éšè—å­ç³»ç»Ÿå¯¹è±¡çš„åˆ›å»ºæ–¹å¼æ—¶ã€‚</p>
</li>
<li><p>You can use <strong>Abstract Factory</strong> along with <strong>Bridge</strong>. This pairing is useful when some abstractions defined by Bridge can only work with specific implementations. In this case, Abstract Factory can encapsulate these relations and hide the complexity from the client code.<br>æ‚¨å¯ä»¥å°† Abstract Factory ä¸ Bridge ä¸€èµ·ä½¿ç”¨ã€‚å½“ Bridge å®šä¹‰çš„æŸäº›æŠ½è±¡åªèƒ½ä¸ç‰¹å®šå®ç°ä¸€èµ·ä½¿ç”¨æ—¶ï¼Œè¿™ç§é…å¯¹éå¸¸æœ‰ç”¨ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒæŠ½è±¡å·¥å‚å¯ä»¥å°è£…è¿™äº›å…³ç³»ï¼Œå¹¶ä»å®¢æˆ·ç«¯ä»£ç ä¸­éšè—å¤æ‚æ€§ã€‚</p>
</li>
<li><p><strong>Abstract Factories</strong>, <strong>Builders</strong> and <strong>Prototypes</strong> can all be implemented as <strong>Singletons</strong>.<br>æŠ½è±¡å·¥å‚ã€æ„å»ºå™¨å’ŒåŸå‹éƒ½å¯ä»¥ä½œä¸ºå•ä¾‹å®ç°ã€‚</p>
</li>
</ul>
<h2 id="Code-Examples-ç¤ºä¾‹ä»£ç "><a href="#Code-Examples-ç¤ºä¾‹ä»£ç " class="headerlink" title="Code Examples ç¤ºä¾‹ä»£ç "></a>Code Examples ç¤ºä¾‹ä»£ç </h2><h3 id="Python"><a href="#Python" class="headerlink" title="Python"></a>Python</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> __future__ <span class="keyword">import</span> annotations</span><br><span class="line"><span class="keyword">from</span> abc <span class="keyword">import</span> ABC, abstractmethod</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">AbstractFactory</span>(<span class="title class_ inherited__">ABC</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    The Abstract Factory interface declares a set of methods that return</span></span><br><span class="line"><span class="string">    different abstract products. These products are called a family and are</span></span><br><span class="line"><span class="string">    related by a high-level theme or concept. Products of one family are usually</span></span><br><span class="line"><span class="string">    able to collaborate among themselves. A family of products may have several</span></span><br><span class="line"><span class="string">    variants, but the products of one variant are incompatible with products of</span></span><br><span class="line"><span class="string">    another.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"><span class="meta">    @abstractmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">create_product_a</span>(<span class="params">self</span>) -&gt; AbstractProductA:</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="meta">    @abstractmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">create_product_b</span>(<span class="params">self</span>) -&gt; AbstractProductB:</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ConcreteFactory1</span>(<span class="title class_ inherited__">AbstractFactory</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    Concrete Factories produce a family of products that belong to a single</span></span><br><span class="line"><span class="string">    variant. The factory guarantees that resulting products are compatible. Note</span></span><br><span class="line"><span class="string">    that signatures of the Concrete Factory&#x27;s methods return an abstract</span></span><br><span class="line"><span class="string">    product, while inside the method a concrete product is instantiated.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">create_product_a</span>(<span class="params">self</span>) -&gt; AbstractProductA:</span><br><span class="line">        <span class="keyword">return</span> ConcreteProductA1()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">create_product_b</span>(<span class="params">self</span>) -&gt; AbstractProductB:</span><br><span class="line">        <span class="keyword">return</span> ConcreteProductB1()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ConcreteFactory2</span>(<span class="title class_ inherited__">AbstractFactory</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    Each Concrete Factory has a corresponding product variant.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">create_product_a</span>(<span class="params">self</span>) -&gt; AbstractProductA:</span><br><span class="line">        <span class="keyword">return</span> ConcreteProductA2()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">create_product_b</span>(<span class="params">self</span>) -&gt; AbstractProductB:</span><br><span class="line">        <span class="keyword">return</span> ConcreteProductB2()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">AbstractProductA</span>(<span class="title class_ inherited__">ABC</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    Each distinct product of a product family should have a base interface. All</span></span><br><span class="line"><span class="string">    variants of the product must implement this interface.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">    @abstractmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">useful_function_a</span>(<span class="params">self</span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">Concrete Products are created by corresponding Concrete Factories.</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ConcreteProductA1</span>(<span class="title class_ inherited__">AbstractProductA</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">useful_function_a</span>(<span class="params">self</span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;The result of the product A1.&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ConcreteProductA2</span>(<span class="title class_ inherited__">AbstractProductA</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">useful_function_a</span>(<span class="params">self</span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;The result of the product A2.&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">AbstractProductB</span>(<span class="title class_ inherited__">ABC</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    Here&#x27;s the the base interface of another product. All products can interact</span></span><br><span class="line"><span class="string">    with each other, but proper interaction is possible only between products of</span></span><br><span class="line"><span class="string">    the same concrete variant.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"><span class="meta">    @abstractmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">useful_function_b</span>(<span class="params">self</span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        Product B is able to do its own thing...</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="meta">    @abstractmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">another_useful_function_b</span>(<span class="params">self, collaborator: AbstractProductA</span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        ...but it also can collaborate with the ProductA.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        The Abstract Factory makes sure that all products it creates are of the</span></span><br><span class="line"><span class="string">        same variant and thus, compatible.</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">Concrete Products are created by corresponding Concrete Factories.</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ConcreteProductB1</span>(<span class="title class_ inherited__">AbstractProductB</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">useful_function_b</span>(<span class="params">self</span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;The result of the product B1.&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    The variant, Product B1, is only able to work correctly with the variant,</span></span><br><span class="line"><span class="string">    Product A1. Nevertheless, it accepts any instance of AbstractProductA as an</span></span><br><span class="line"><span class="string">    argument.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">another_useful_function_b</span>(<span class="params">self, collaborator: AbstractProductA</span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">        result = collaborator.useful_function_a()</span><br><span class="line">        <span class="keyword">return</span> <span class="string">f&quot;The result of the B1 collaborating with the (<span class="subst">&#123;result&#125;</span>)&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ConcreteProductB2</span>(<span class="title class_ inherited__">AbstractProductB</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">useful_function_b</span>(<span class="params">self</span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;The result of the product B2.&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">another_useful_function_b</span>(<span class="params">self, collaborator: AbstractProductA</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        The variant, Product B2, is only able to work correctly with the</span></span><br><span class="line"><span class="string">        variant, Product A2. Nevertheless, it accepts any instance of</span></span><br><span class="line"><span class="string">        AbstractProductA as an argument.</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        result = collaborator.useful_function_a()</span><br><span class="line">        <span class="keyword">return</span> <span class="string">f&quot;The result of the B2 collaborating with the (<span class="subst">&#123;result&#125;</span>)&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">client_code</span>(<span class="params">factory: AbstractFactory</span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    The client code works with factories and products only through abstract</span></span><br><span class="line"><span class="string">    types: AbstractFactory and AbstractProduct. This lets you pass any factory</span></span><br><span class="line"><span class="string">    or product subclass to the client code without breaking it.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    product_a = factory.create_product_a()</span><br><span class="line">    product_b = factory.create_product_b()</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;product_b.useful_function_b()&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;product_b.another_useful_function_b(product_a)&#125;</span>&quot;</span>, end=<span class="string">&quot;&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    The client code can work with any concrete factory class.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Client: Testing client code with the first factory type:&quot;</span>)</span><br><span class="line">    client_code(ConcreteFactory1())</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;\n&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Client: Testing the same client code with the second factory type:&quot;</span>)</span><br><span class="line">    client_code(ConcreteFactory2())</span><br></pre></td></tr></table></figure>

<h3 id="Output-txt-Exception-result"><a href="#Output-txt-Exception-result" class="headerlink" title="Output.txt: Exception result"></a>Output.txt: Exception result</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Client: Testing client code with the first factory type:</span><br><span class="line">The result of the product B1.</span><br><span class="line">The result of the B1 collaborating with the (The result of the product A1.)</span><br><span class="line"></span><br><span class="line">Client: Testing the same client code with the second factory type:</span><br><span class="line">The result of the product B2.</span><br><span class="line">The result of the B2 collaborating with the (The result of the product A2.)</span><br></pre></td></tr></table></figure>
<h3 id="Rust"><a href="#Rust" class="headerlink" title="Rust"></a>Rust</h3><h4 id="GUI-Elements-Factory-GUI-å…ƒç´ å·¥å‚"><a href="#GUI-Elements-Factory-GUI-å…ƒç´ å·¥å‚" class="headerlink" title="GUI Elements Factory GUI å…ƒç´ å·¥å‚"></a>GUI Elements Factory GUI å…ƒç´ å·¥å‚</h4><p>This example illustrates how a GUI framework can organize its classes into independent libraries:<br>æ­¤ç¤ºä¾‹è¯´æ˜äº† GUI æ¡†æ¶å¦‚ä½•å°†å…¶ç±»ç»„ç»‡åˆ°ç‹¬ç«‹çš„åº“ä¸­ï¼š</p>
<ol>
<li>The gui library defines interfaces for all the components.<br>è¯¥ gui åº“å®šä¹‰äº†æ‰€æœ‰ç»„ä»¶çš„æ¥å£ã€‚<br>It has no external dependencies.<br>å®ƒæ²¡æœ‰å¤–éƒ¨ä¾èµ–å…³ç³»ã€‚</li>
<li>The windows-gui library provides Windows implementation of the base GUI.<br>è¯¥ windows-gui åº“æä¾›åŸºæœ¬ GUI çš„ Windows å®ç°ã€‚<br>Depends on gui.<br>å–å†³äº gui ã€‚</li>
<li>The macos-gui library provides Mac OS implementation of the base GUI.<br>è¯¥ macos-gui åº“æä¾›åŸºæœ¬ GUI çš„ Mac OS å®ç°ã€‚<br>Depends on gui.<br>å–å†³äº gui ã€‚<br>The app is a client application that can use several implementations of the GUI framework, depending on the current environment or configuration. However, most of the app code doesnâ€™t depend on specific types of GUI elements. All the client code works with GUI elements through abstract interfaces (traits) defined by the gui lib.<br>æ˜¯ä¸€ä¸ª app å®¢æˆ·ç«¯åº”ç”¨ç¨‹åºï¼Œå¯ä»¥ä½¿ç”¨ GUI æ¡†æ¶çš„å¤šä¸ªå®ç°ï¼Œå…·ä½“å–å†³äºå½“å‰ç¯å¢ƒæˆ–é…ç½®ã€‚ä½†æ˜¯ï¼Œå¤§å¤šæ•° app ä»£ç å¹¶ä¸ä¾èµ–äºç‰¹å®šç±»å‹çš„ GUI å…ƒç´ ã€‚æ‰€æœ‰å®¢æˆ·ç«¯ä»£ç éƒ½é€šè¿‡ gui åº“å®šä¹‰çš„æŠ½è±¡æ¥å£ï¼ˆç‰¹å¾ï¼‰ä¸ GUI å…ƒç´ ä¸€èµ·ä½¿ç”¨ã€‚</li>
</ol>
<p>There are two approaches to implementing abstract factories in Rust:<br>åœ¨ Rust ä¸­å®ç°æŠ½è±¡å·¥å‚æœ‰ä¸¤ç§æ–¹æ³•ï¼š<br>1.using generics (static dispatch)<br>ä½¿ç”¨æ³›å‹ï¼ˆé™æ€è°ƒåº¦ï¼‰<br>2.using dynamic allocation (dynamic dispatch)<br>ä½¿ç”¨åŠ¨æ€åˆ†é…ï¼ˆåŠ¨æ€è°ƒåº¦ï¼‰</p>
<p>When youâ€™re given a choice between static and dynamic dispatch, there is rarely a clear-cut correct answer. Youâ€™ll want to use static dispatch in your libraries and dynamic dispatch in your binaries. In a library, you want to allow your users to decide what kind of dispatch is best for them since you donâ€™t know what their needs are. If you use dynamic dispatch, theyâ€™re forced to do the same, whereas if you use static dispatch, they can choose whether to use dynamic dispatch or not.<br>å½“æ‚¨åœ¨é™æ€è°ƒåº¦å’ŒåŠ¨æ€è°ƒåº¦ä¹‹é—´åšå‡ºé€‰æ‹©æ—¶ï¼Œå¾ˆå°‘æœ‰æ˜ç¡®çš„æ­£ç¡®ç­”æ¡ˆã€‚æ‚¨éœ€è¦åœ¨åº“ä¸­ä½¿ç”¨é™æ€è°ƒåº¦ï¼Œåœ¨äºŒè¿›åˆ¶æ–‡ä»¶ä¸­ä½¿ç”¨åŠ¨æ€è°ƒåº¦ã€‚åœ¨å›¾ä¹¦é¦†ä¸­ï¼Œæ‚¨å¸Œæœ›å…è®¸ç”¨æˆ·å†³å®šå“ªç§è°ƒåº¦æœ€é€‚åˆä»–ä»¬ï¼Œå› ä¸ºæ‚¨ä¸çŸ¥é“ä»–ä»¬çš„éœ€æ±‚æ˜¯ä»€ä¹ˆã€‚å¦‚æœæ‚¨ä½¿ç”¨åŠ¨æ€è°ƒåº¦ï¼Œä»–ä»¬å°†è¢«è¿«æ‰§è¡Œç›¸åŒçš„æ“ä½œï¼Œè€Œå¦‚æœæ‚¨ä½¿ç”¨é™æ€è°ƒåº¦ï¼Œåˆ™å¯ä»¥é€‰æ‹©æ˜¯å¦ä½¿ç”¨åŠ¨æ€è°ƒåº¦ã€‚</p>
<h4 id="gui-Abstract-Factory-and-Abstract-Products-guiï¼šæŠ½è±¡å·¥å‚å’ŒæŠ½è±¡äº§å“"><a href="#gui-Abstract-Factory-and-Abstract-Products-guiï¼šæŠ½è±¡å·¥å‚å’ŒæŠ½è±¡äº§å“" class="headerlink" title="gui: Abstract Factory and Abstract Products guiï¼šæŠ½è±¡å·¥å‚å’ŒæŠ½è±¡äº§å“"></a>gui: Abstract Factory and Abstract Products guiï¼šæŠ½è±¡å·¥å‚å’ŒæŠ½è±¡äº§å“</h4><ul>
<li>gui&#x2F;lib.rs<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">pub</span> <span class="keyword">trait</span> <span class="title class_">Button</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">press</span>(&amp;<span class="keyword">self</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">trait</span> <span class="title class_">Checkbox</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">switch</span>(&amp;<span class="keyword">self</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// Abstract Factory defined using generics.</span></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">trait</span> <span class="title class_">GuiFactory</span> &#123;</span><br><span class="line">    <span class="keyword">type</span> <span class="title class_">B</span>: Button;</span><br><span class="line">    <span class="keyword">type</span> <span class="title class_">C</span>: Checkbox;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">create_button</span>(&amp;<span class="keyword">self</span>) <span class="punctuation">-&gt;</span> <span class="keyword">Self</span>::B;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">create_checkbox</span>(&amp;<span class="keyword">self</span>) <span class="punctuation">-&gt;</span> <span class="keyword">Self</span>::C;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// Abstract Factory defined using Box pointer.</span></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">trait</span> <span class="title class_">GuiFactoryDynamic</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">create_button</span>(&amp;<span class="keyword">self</span>) <span class="punctuation">-&gt;</span> <span class="type">Box</span>&lt;<span class="keyword">dyn</span> Button&gt;;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">create_checkbox</span>(&amp;<span class="keyword">self</span>) <span class="punctuation">-&gt;</span> <span class="type">Box</span>&lt;<span class="keyword">dyn</span> Checkbox&gt;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>macos-gui: One family of products<br>file: macos-gui&#x2F;lib.rs<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">pub</span> <span class="keyword">mod</span> button;</span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">mod</span> checkbox;</span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">mod</span> factory;</span><br></pre></td></tr></table></figure></li>
<li>windows-gui: Another family of products<br>file: windows-gui&#x2F;lib.rs<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">pub</span> <span class="keyword">mod</span> button;</span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">mod</span> checkbox;</span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">mod</span> factory;</span><br></pre></td></tr></table></figure></li>
</ul>
<h4 id="Static-dispatch-é™æ€è°ƒåº¦"><a href="#Static-dispatch-é™æ€è°ƒåº¦" class="headerlink" title="Static dispatch é™æ€è°ƒåº¦"></a>Static dispatch é™æ€è°ƒåº¦</h4><p>Here, the abstract factory is implemented via generics which lets the compiler create a code that does NOT require dynamic dispatch in runtime.<br>åœ¨è¿™é‡Œï¼ŒæŠ½è±¡å·¥å‚æ˜¯é€šè¿‡æ³›å‹å®ç°çš„ï¼Œå®ƒå…è®¸ç¼–è¯‘å™¨åˆ›å»ºä¸éœ€è¦åœ¨è¿è¡Œæ—¶åŠ¨æ€è°ƒåº¦çš„ä»£ç ã€‚</p>
<ul>
<li>app: Client code with static dispatch<br>file: app&#x2F;main.rs<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">mod</span> render;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> render::render;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> macos_gui::factory::MacFactory;</span><br><span class="line"><span class="keyword">use</span> windows_gui::factory::WindowsFactory;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">windows</span> = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> windows &#123;</span><br><span class="line">        <span class="title function_ invoke__">render</span>(WindowsFactory);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="title function_ invoke__">render</span>(MacFactory);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
file: app&#x2F;render.rs<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//! The code demonstrates that it doesn&#x27;t depend on a concrete</span></span><br><span class="line"><span class="comment">//! factory implementation.</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> gui::GuiFactory;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Renders GUI. Factory object must be passed as a parameter to such the</span></span><br><span class="line"><span class="comment">// generic function with factory invocation to utilize static dispatch.</span></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">render</span>(factory: <span class="keyword">impl</span> <span class="title class_">GuiFactory</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">button1</span> = factory.<span class="title function_ invoke__">create_button</span>();</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">button2</span> = factory.<span class="title function_ invoke__">create_button</span>();</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">checkbox1</span> = factory.<span class="title function_ invoke__">create_checkbox</span>();</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">checkbox2</span> = factory.<span class="title function_ invoke__">create_checkbox</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">use</span> gui::&#123;Button, Checkbox&#125;;</span><br><span class="line"></span><br><span class="line">    button1.<span class="title function_ invoke__">press</span>();</span><br><span class="line">    button2.<span class="title function_ invoke__">press</span>();</span><br><span class="line">    checkbox1.<span class="title function_ invoke__">switch</span>();</span><br><span class="line">    checkbox2.<span class="title function_ invoke__">switch</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h4 id="Dynamic-dispatch-åŠ¨æ€è°ƒåº¦"><a href="#Dynamic-dispatch-åŠ¨æ€è°ƒåº¦" class="headerlink" title="Dynamic dispatch åŠ¨æ€è°ƒåº¦"></a>Dynamic dispatch åŠ¨æ€è°ƒåº¦</h4><p>If a concrete type of abstract factory is not known at the compilation time, then is should be implemented using Box pointers.<br>å¦‚æœåœ¨ç¼–è¯‘æ—¶ä¸çŸ¥é“æŠ½è±¡å·¥å‚çš„å…·ä½“ç±»å‹ï¼Œåˆ™åº”ä½¿ç”¨ Box æŒ‡é’ˆå®ç°ã€‚</p>
<ul>
<li>app-dyn: Client code with dynamic dispatch<br>file: app-dyn&#x2F;main.rs<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">mod</span> render;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> render::render;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> gui::GuiFactoryDynamic;</span><br><span class="line"><span class="keyword">use</span> macos_gui::factory::MacFactory;</span><br><span class="line"><span class="keyword">use</span> windows_gui::factory::WindowsFactory;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">windows</span> = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Allocate a factory object in runtime depending on unpredictable input.</span></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">factory</span>: &amp;<span class="keyword">dyn</span> GuiFactoryDynamic = <span class="keyword">if</span> windows &#123;</span><br><span class="line">        &amp;WindowsFactory</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        &amp;MacFactory</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Factory invocation can be inlined right here.</span></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">button</span> = factory.<span class="title function_ invoke__">create_button</span>();</span><br><span class="line">    button.<span class="title function_ invoke__">press</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Factory object can be passed to a function as a parameter.</span></span><br><span class="line">    <span class="title function_ invoke__">render</span>(factory);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
file: app-dyn&#x2F;render.rs<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//! The code demonstrates that it doesn&#x27;t depend on a concrete</span></span><br><span class="line"><span class="comment">//! factory implementation.</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> gui::GuiFactoryDynamic;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// Renders GUI.</span></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">render</span>(factory: &amp;<span class="keyword">dyn</span> GuiFactoryDynamic) &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">button1</span> = factory.<span class="title function_ invoke__">create_button</span>();</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">button2</span> = factory.<span class="title function_ invoke__">create_button</span>();</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">checkbox1</span> = factory.<span class="title function_ invoke__">create_checkbox</span>();</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">checkbox2</span> = factory.<span class="title function_ invoke__">create_checkbox</span>();</span><br><span class="line"></span><br><span class="line">    button1.<span class="title function_ invoke__">press</span>();</span><br><span class="line">    button2.<span class="title function_ invoke__">press</span>();</span><br><span class="line">    checkbox1.<span class="title function_ invoke__">switch</span>();</span><br><span class="line">    checkbox2.<span class="title function_ invoke__">switch</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h4 id="Output"><a href="#Output" class="headerlink" title="Output"></a>Output</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Windows button has pressed</span><br><span class="line">Windows button has pressed</span><br><span class="line">Windows checkbox has switched</span><br><span class="line">Windows checkbox has switched</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://tonymistark.github.io/2023/11/16/design-pattern/factory-method/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Ice">
      <meta itemprop="description" content="å®‰é™åœ°åç€å­¦ä¹ ">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="BLOG">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/11/16/design-pattern/factory-method/" class="post-title-link" itemprop="url">Factory Method</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2023-11-16 21:02:09" itemprop="dateCreated datePublished" datetime="2023-11-16T21:02:09+08:00">2023-11-16</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2023-11-22 23:21:21" itemprop="dateModified" datetime="2023-11-22T23:21:21+08:00">2023-11-22</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/design-pattern/" itemprop="url" rel="index"><span itemprop="name">design-pattern</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="Symbols count in article">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">Symbols count in article: </span>
              <span>6.1k</span>
            </span>
            <span class="post-meta-item" title="Reading time">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">Reading time &asymp;</span>
              <span>22 mins.</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="Factory-Method"><a href="#Factory-Method" class="headerlink" title="Factory Method"></a>Factory Method</h1><h1 id="å·¥å‚æ–¹æ³•"><a href="#å·¥å‚æ–¹æ³•" class="headerlink" title="å·¥å‚æ–¹æ³•"></a>å·¥å‚æ–¹æ³•</h1><p>Also known as: Virtual Constructor<br>ä¹Ÿç§°ä¸ºï¼š Virtual Constructor</p>
<h2 id="Intent-æ„å›¾"><a href="#Intent-æ„å›¾" class="headerlink" title="Intent æ„å›¾"></a>Intent æ„å›¾</h2><p>Factory Method is a creational design pattern that provides an interface for creating objects in a superclass, but allows subclasses to alter the type of objects that will be created.</p>
<p>å·¥å‚æ–¹æ³•æ˜¯ä¸€ç§åˆ›å»ºè®¾è®¡æ¨¡å¼ï¼Œå®ƒæä¾›äº†ä¸€ä¸ªæ¥å£ï¼Œç”¨äºåœ¨è¶…ç±»ä¸­åˆ›å»ºå¯¹è±¡ï¼Œä½†å…è®¸å­ç±»æ›´æ”¹å°†è¦åˆ›å»ºçš„å¯¹è±¡çš„ç±»å‹ã€‚<br><img src="/images/factory-method-en.png"></p>
<p>Factory Method pattern</p>
<h2 id="Problem-é—®é¢˜"><a href="#Problem-é—®é¢˜" class="headerlink" title="Problem é—®é¢˜"></a>Problem é—®é¢˜</h2><p>Imagine that youâ€™re creating a logistics management application. The first version of your app can only handle transportation by trucks, so the bulk of your code lives inside the Truck class.<br>å‡è®¾æ‚¨æ­£åœ¨åˆ›å»ºä¸€ä¸ªç‰©æµç®¡ç†åº”ç”¨ç¨‹åºã€‚åº”ç”¨çš„ç¬¬ä¸€ä¸ªç‰ˆæœ¬åªèƒ½å¤„ç†å¡è½¦è¿è¾“ï¼Œå› æ­¤å¤§éƒ¨åˆ†ä»£ç éƒ½ä½äº Truck ç±»ä¸­ã€‚</p>
<p>After a while, your app becomes pretty popular. Each day you receive dozens of requests from sea transportation companies to incorporate sea logistics into the app.</p>
<p>ä¸€æ®µæ—¶é—´åï¼Œæ‚¨çš„åº”ç”¨ç¨‹åºå˜å¾—éå¸¸å—æ¬¢è¿ã€‚æ¯å¤©ï¼Œæ‚¨éƒ½ä¼šæ”¶åˆ°æ•°åä¸ªæ¥è‡ªæµ·è¿å…¬å¸çš„è¯·æ±‚ï¼Œè¦æ±‚å°†æµ·è¿ç‰©æµçº³å…¥åº”ç”¨ç¨‹åºã€‚</p>
<div align="center"> <img src="/images/problem1-en.png"/> Adding a new class to the program isnâ€™t that simple if the rest of the code is already coupled to existing classes.</br>å¦‚æœä»£ç çš„å…¶ä½™éƒ¨åˆ†å·²ç»è€¦åˆåˆ°ç°æœ‰ç±»ï¼Œåˆ™å‘ç¨‹åºæ·»åŠ æ–°ç±»å¹¶ä¸é‚£ä¹ˆç®€å•ã€‚ </div>

<p>Great news, right? But how about the code? At present, most of your code is coupled to the <code>Truck</code> class. Adding <code>Ships</code> into the app would require making changes to the entire codebase. Moreover, if later you decide to add another type of transportation to the app, you will probably need to make all of these changes again.<br>å¥½æ¶ˆæ¯ï¼Œå¯¹å§ï¼Ÿä½†æ˜¯ä»£ç å‘¢ï¼Ÿç›®å‰ï¼Œæ‚¨çš„å¤§éƒ¨åˆ†ä»£ç éƒ½ä¸ç±» Truck è€¦åˆã€‚æ·»åŠ åˆ° Ships åº”ç”¨ç¨‹åºä¸­éœ€è¦å¯¹æ•´ä¸ªä»£ç åº“è¿›è¡Œæ›´æ”¹ã€‚æ­¤å¤–ï¼Œå¦‚æœæ‚¨ä»¥åå†³å®šå‘åº”ç”¨ç¨‹åºæ·»åŠ å¦ä¸€ç§ç±»å‹çš„äº¤é€šå·¥å…·ï¼Œæ‚¨å¯èƒ½éœ€è¦å†æ¬¡è¿›è¡Œæ‰€æœ‰è¿™äº›æ›´æ”¹ã€‚</p>
<p>As a result, you will end up with pretty nasty code, riddled with conditionals that switch the appâ€™s behavior depending on the class of transportation objects.<br>ç»“æœï¼Œä½ æœ€ç»ˆä¼šå¾—åˆ°éå¸¸è®¨åŒçš„ä»£ç ï¼Œå…¶ä¸­å……æ–¥ç€æ¡ä»¶ï¼Œè¿™äº›æ¡ä»¶æ ¹æ®è¿è¾“å¯¹è±¡çš„ç±»åˆ«æ¥åˆ‡æ¢åº”ç”¨ç¨‹åºçš„è¡Œä¸ºã€‚</p>
<h2 id="Solution-è§£å†³æ–¹æ¡ˆ"><a href="#Solution-è§£å†³æ–¹æ¡ˆ" class="headerlink" title="Solution è§£å†³æ–¹æ¡ˆ"></a>Solution è§£å†³æ–¹æ¡ˆ</h2><p>The Factory Method pattern suggests that you replace direct object construction calls (using the new operator) with calls to a special factory method. Donâ€™t worry: the objects are still created via the new operator, but itâ€™s being called from within the factory method. Objects returned by a factory method are often referred to as products.<br>å·¥å‚æ–¹æ³•æ¨¡å¼å»ºè®®å°†ç›´æ¥å¯¹è±¡æ„é€ è°ƒç”¨ï¼ˆä½¿ç”¨è¿ new ç®—ç¬¦ï¼‰æ›¿æ¢ä¸ºå¯¹ç‰¹æ®Šå·¥å‚æ–¹æ³•çš„è°ƒç”¨ã€‚ä¸ç”¨æ‹…å¿ƒï¼šå¯¹è±¡ä»ç„¶æ˜¯é€šè¿‡è¿ç®—ç¬¦ new åˆ›å»ºçš„ï¼Œä½†å®ƒæ˜¯ä»å·¥å‚æ–¹æ³•ä¸­è°ƒç”¨çš„ã€‚å·¥å‚æ–¹æ³•è¿”å›çš„å¯¹è±¡é€šå¸¸ç§°ä¸ºäº§å“ã€‚</p>
<div align="center"> <img src="/images/solution1.png"/> Subclasses can alter the class of objects being returned by the factory method.</br>å­ç±»å¯ä»¥æ›´æ”¹å·¥å‚æ–¹æ³•è¿”å›çš„å¯¹è±¡çš„ç±»ã€‚</div>

<p>At first glance, this change may look pointless: we just moved the constructor call from one part of the program to another. However, consider this: now you can override the factory method in a subclass and change the class of products being created by the method.</p>
<p>ä¹ä¸€çœ‹ï¼Œè¿™ç§å˜åŒ–å¯èƒ½çœ‹èµ·æ¥æ¯«æ— æ„ä¹‰ï¼šæˆ‘ä»¬åªæ˜¯å°†æ„é€ å‡½æ•°è°ƒç”¨ä»ç¨‹åºçš„ä¸€éƒ¨åˆ†ç§»åŠ¨åˆ°å¦ä¸€éƒ¨åˆ†ã€‚ä½†æ˜¯ï¼Œè¯·è€ƒè™‘ä»¥ä¸‹æƒ…å†µï¼šç°åœ¨æ‚¨å¯ä»¥åœ¨å­ç±»ä¸­é‡å†™å·¥å‚æ–¹æ³•ï¼Œå¹¶æ›´æ”¹è¯¥æ–¹æ³•åˆ›å»ºçš„äº§å“ç±»ã€‚</p>
<p>Thereâ€™s a slight limitation though: subclasses may return different types of products only if these products have a common base class or interface. Also, the factory method in the base class should have its return type declared as this interface.</p>
<p>ä½†æ˜¯æœ‰ä¸€ä¸ªè½»å¾®çš„é™åˆ¶ï¼šåªæœ‰å½“è¿™äº›äº§å“å…·æœ‰å…±åŒçš„åŸºç±»æˆ–æ¥å£æ—¶ï¼Œå­ç±»æ‰èƒ½è¿”å›ä¸åŒç±»å‹çš„äº§å“ã€‚æ­¤å¤–ï¼ŒåŸºç±»ä¸­çš„å·¥å‚æ–¹æ³•åº”å°†å…¶è¿”å›ç±»å‹å£°æ˜ä¸ºæ­¤æ¥å£ã€‚</p>
<p>The structure of the products hierarchy<br>All products must follow the same interface.<br>æ‰€æœ‰äº§å“å¿…é¡»éµå¾ªç›¸åŒçš„ç•Œé¢ã€‚</p>
<div align="center"> <img src="/images/solution1.png"/>All products must follow the same interface.</br>æ‰€æœ‰äº§å“å¿…é¡»éµå¾ªç›¸åŒçš„ç•Œé¢ã€‚</div>

<p>For example, both <code>Truck</code> and <code>Ship</code> classes should implement the <code>Transport</code> interface, which declares a method called <code>deliver</code>. Each class implements this method differently: trucks deliver cargo by land, ships deliver cargo by sea. The factory method in the <code>RoadLogistics</code> class returns truck objects, whereas the factory method in the <code>SeaLogistics</code> class returns ships.<br>ä¾‹å¦‚ï¼Œå’Œç±»éƒ½åº”è¯¥ <code>Truck</code> å®ç°æ¥å£ <code>Transport</code> ï¼Œè¯¥æ¥å£å£°æ˜äº†ä¸€ä¸ªåä¸º <code>deliver</code> . <code>Ship</code> æ¯ä¸ªç±»åˆ«éƒ½ä»¥ä¸åŒçš„æ–¹å¼å®ç°è¿™ç§æ–¹æ³•ï¼šå¡è½¦é€šè¿‡é™†è·¯è¿é€è´§ç‰©ï¼Œèˆ¹èˆ¶é€šè¿‡æµ·ä¸Šè¿é€è´§ç‰©ã€‚ <code>RoadLogistics</code> ç±»ä¸­çš„ <code>factory</code> æ–¹æ³•è¿”å› <code>truck</code> å¯¹è±¡ï¼Œè€Œ <code>SeaLogistics</code> ç±»ä¸­çš„ <code>factory</code> æ–¹æ³•è¿”å› <code>ships</code>ã€‚</p>
<div align="center"> <img src="/images/solution2.png"/>As long as all product classes implement a common interface, you can pass their objects to the client code without breaking it.</br>åªè¦æ‰€æœ‰äº§å“ç±»éƒ½å®ç°ä¸€ä¸ªé€šç”¨æ¥å£ï¼Œå°±å¯ä»¥å°†å…¶å¯¹è±¡ä¼ é€’ç»™å®¢æˆ·ç«¯ä»£ç ï¼Œè€Œä¸ä¼šä¸­æ–­å®ƒã€‚</div>

<p>The code that uses the factory method (often called the client code) doesnâ€™t see a difference between the actual products returned by various subclasses. The client treats all the products as abstract <code>Transport</code>. The client knows that all transport objects are supposed to have the <code>deliver</code> method, but exactly how it works isnâ€™t important to the client.<br>ä½¿ç”¨å·¥å‚æ–¹æ³•çš„ä»£ç ï¼ˆé€šå¸¸ç§°ä¸ºå®¢æˆ·ç«¯ä»£ç ï¼‰çœ‹ä¸åˆ°å„ä¸ªå­ç±»è¿”å›çš„å®é™…äº§å“ä¹‹é—´çš„å·®å¼‚ã€‚å®¢æˆ·å°†æ‰€æœ‰äº§å“è§†ä¸ºæŠ½è±¡ <code>Transport</code> äº§å“ã€‚å®¢æˆ·ç«¯çŸ¥é“æ‰€æœ‰ä¼ è¾“å¯¹è±¡éƒ½åº”è¯¥å…·æœ‰è¯¥ <code>deliver</code> æ–¹æ³•ï¼Œä½†å…¶å·¥ä½œæ–¹å¼å¯¹å®¢æˆ·ç«¯æ¥è¯´å¹¶ä¸é‡è¦ã€‚</p>
<h2 id="Structure-ç»“æ„"><a href="#Structure-ç»“æ„" class="headerlink" title="Structure ç»“æ„"></a>Structure ç»“æ„</h2><div align="center"> <img src="/images/structure.png"/></div>

<h4 id="1-Prodcut"><a href="#1-Prodcut" class="headerlink" title="1.Prodcut"></a>1.Prodcut</h4><p>The Product declares the interface, which is common to all objects that can be produced by the creator and its subclasses.</p>
<p>Product å£°æ˜æ¥å£ï¼Œè¯¥æ¥å£å¯¹äºåˆ›å»ºè€…åŠå…¶å­ç±»å¯ä»¥ç”Ÿæˆçš„æ‰€æœ‰å¯¹è±¡éƒ½æ˜¯é€šç”¨çš„ã€‚</p>
<h4 id="2-Concrete-Products"><a href="#2-Concrete-Products" class="headerlink" title="2.Concrete Products"></a>2.Concrete Products</h4><p>Concrete Products are different implementations of the product interface.<br>å…·ä½“äº§å“æ˜¯äº§å“æ¥å£çš„ä¸åŒå®ç°ã€‚</p>
<h4 id="3-Creator"><a href="#3-Creator" class="headerlink" title="3.Creator"></a>3.Creator</h4><p>The Creator class declares the factory method that returns new product objects. Itâ€™s important that the return type of this method matches the product interface.</p>
<p>Creator ç±»å£°æ˜è¿”å›æ–°äº§å“å¯¹è±¡çš„å·¥å‚æ–¹æ³•ã€‚æ­¤æ–¹æ³•çš„è¿”å›ç±»å‹å¿…é¡»ä¸äº§å“æ¥å£åŒ¹é…ï¼Œè¿™ä¸€ç‚¹å¾ˆé‡è¦ã€‚</p>
<p>You can declare the factory method as abstract to force all subclasses to implement their own versions of the method. As an alternative, the base factory method can return some default product type.</p>
<p>æ‚¨å¯ä»¥å£°æ˜å·¥å‚æ–¹æ³•ï¼Œä»¥ abstract å¼ºåˆ¶æ‰€æœ‰å­ç±»å®ç°å…¶è‡ªå·±çš„æ–¹æ³•ç‰ˆæœ¬ã€‚æˆ–è€…ï¼ŒåŸºå·¥å‚æ–¹æ³•å¯ä»¥è¿”å›ä¸€äº›é»˜è®¤äº§å“ç±»å‹ã€‚</p>
<p>Note, despite its name, product creation is not the primary responsibility of the creator. Usually, the creator class already has some core business logic related to products. The factory method helps to decouple this logic from the concrete product classes. Here is an analogy: a large software development company can have a training department for programmers. However, the primary function of the company as a whole is still writing code, not producing programmers.</p>
<p>è¯·æ³¨æ„ï¼Œå°½ç®¡å®ƒçš„åå­—ï¼Œäº§å“åˆ›å»ºå¹¶ä¸æ˜¯åˆ›å»ºè€…çš„ä¸»è¦è´£ä»»ã€‚é€šå¸¸ï¼Œcreator ç±»å·²ç»æœ‰ä¸€äº›ä¸äº§å“ç›¸å…³çš„æ ¸å¿ƒä¸šåŠ¡é€»è¾‘ã€‚å·¥å‚æ–¹æ³•æœ‰åŠ©äºå°†æ­¤é€»è¾‘ä¸å…·ä½“çš„äº§å“ç±»åˆ†ç¦»ã€‚æ‰“ä¸ªæ¯”æ–¹ï¼šä¸€å®¶å¤§å‹è½¯ä»¶å¼€å‘å…¬å¸å¯ä»¥æœ‰ä¸€ä¸ªç¨‹åºå‘˜åŸ¹è®­éƒ¨é—¨ã€‚ç„¶è€Œï¼Œæ•´ä¸ªå…¬å¸çš„ä¸»è¦èŒèƒ½ä»ç„¶æ˜¯ç¼–å†™ä»£ç ï¼Œè€Œä¸æ˜¯åŸ¹å…»ç¨‹åºå‘˜ã€‚</p>
<h4 id="4-Concrete-Creators"><a href="#4-Concrete-Creators" class="headerlink" title="4.Concrete Creators"></a>4.Concrete Creators</h4><p>Concrete Creators override the base factory method so it returns a different type of product.<br>Concrete Creators ä¼šé‡å†™åŸºæœ¬å·¥å‚æ–¹æ³•ï¼Œå› æ­¤å®ƒä¼šè¿”å›ä¸åŒç±»å‹çš„äº§å“ã€‚</p>
<p>Note that the factory method doesnâ€™t have to create new instances all the time. It can also return existing objects from a cache, an object pool, or another source.<br>è¯·æ³¨æ„ï¼Œå·¥å‚æ–¹æ³•ä¸å¿…ä¸€ç›´åˆ›å»ºæ–°å®ä¾‹ã€‚å®ƒè¿˜å¯ä»¥ä»ç¼“å­˜ã€å¯¹è±¡æ± æˆ–å…¶ä»–æºè¿”å›ç°æœ‰å¯¹è±¡ã€‚</p>
<h2 id="Pseudocode-ä¼ªä»£ç "><a href="#Pseudocode-ä¼ªä»£ç " class="headerlink" title="Pseudocode ä¼ªä»£ç "></a>Pseudocode ä¼ªä»£ç </h2><p>This example illustrates how the Factory Method can be used for creating cross-platform UI elements without coupling the client code to concrete UI classes.</p>
<p>æ­¤ç¤ºä¾‹æ¼”ç¤ºå¦‚ä½•ä½¿ç”¨ Factory æ–¹æ³•åˆ›å»ºè·¨å¹³å° UI å…ƒç´ ï¼Œè€Œæ— éœ€å°†å®¢æˆ·ç«¯ä»£ç è€¦åˆåˆ°å…·ä½“çš„ UI ç±»ã€‚</p>
<div align="center"> <img src="/images/example.png"/>The cross-platform dialog example.</br>è·¨å¹³å°å¯¹è¯æ¡†ç¤ºä¾‹ã€‚</div>

<p>The base <code>Dialog</code> class uses different UI elements to render its window. Under various operating systems, these elements may look a little bit different, but they should still behave consistently. A button in Windows is still a button in Linux.<br>åŸº <code>Dialog</code> ç±»ä½¿ç”¨ä¸åŒçš„ UI å…ƒç´ æ¥å‘ˆç°å…¶çª—å£ã€‚åœ¨å„ç§æ“ä½œç³»ç»Ÿä¸‹ï¼Œè¿™äº›å…ƒç´ å¯èƒ½çœ‹èµ·æ¥ç•¥æœ‰ä¸åŒï¼Œä½†å®ƒä»¬çš„è¡Œä¸ºä»åº”ä¸€è‡´ã€‚Windows ä¸­çš„æŒ‰é’®ä»ç„¶æ˜¯ Linux ä¸­çš„æŒ‰é’®ã€‚</p>
<p>When the factory method comes into play, you donâ€™t need to rewrite the logic of the <code>Dialog</code> class for each operating system. If we declare a factory method that produces buttons inside the base <code>Dialog</code> class, we can later create a subclass that returns Windows-styled buttons from the factory method. The subclass then inherits most of the code from the base class, but, thanks to the factory method, can render Windows-looking buttons on the screen.<br>å½“å·¥å‚æ–¹æ³•å‘æŒ¥ä½œç”¨æ—¶ï¼Œæ— éœ€ä¸ºæ¯ä¸ªæ“ä½œç³»ç»Ÿé‡å†™ <code>Dialog</code> ç±»çš„é€»è¾‘ã€‚å¦‚æœæˆ‘ä»¬å£°æ˜ä¸€ä¸ªåœ¨åŸº <code>Dialog</code> ç±»ä¸­ç”ŸæˆæŒ‰é’®çš„å·¥å‚æ–¹æ³•ï¼Œæˆ‘ä»¬ç¨åå¯ä»¥åˆ›å»ºä¸€ä¸ªå­ç±»ï¼Œè¯¥å­ç±»ä»å·¥å‚æ–¹æ³•è¿”å› Windows æ ·å¼çš„æŒ‰é’®ã€‚ç„¶åï¼Œè¯¥å­ç±»ä»åŸºç±»ç»§æ‰¿å¤§éƒ¨åˆ†ä»£ç ï¼Œä½†æ˜¯ï¼Œç”±äºå·¥å‚æ–¹æ³•ï¼Œå¯ä»¥åœ¨å±å¹•ä¸Šå‘ˆç°å…·æœ‰ Windows å¤–è§‚çš„æŒ‰é’®ã€‚</p>
<p>For this pattern to work, the base <code>Dialog</code> class must work with abstract buttons: a base class or an interface that all concrete buttons follow. This way the code within <code>Dialog</code> remains functional, whichever type of buttons it works with.<br>è¦ä½¿æ­¤æ¨¡å¼èµ·ä½œç”¨ï¼ŒåŸºç±»å¿…é¡»ä½¿ç”¨æŠ½è±¡æŒ‰é’®ï¼šæ‰€æœ‰å…·ä½“æŒ‰é’®éƒ½éµå¾ªçš„åŸº <code>Dialog</code> ç±»æˆ–æ¥å£ã€‚è¿™æ ·ï¼Œæ— è®ºä½¿ç”¨å“ªç§ç±»å‹çš„æŒ‰é’®ï¼Œå…¶ä¸­ <code>Dialog</code> çš„ä»£ç éƒ½å¯ä»¥æ­£å¸¸å·¥ä½œã€‚</p>
<p>Of course, you can apply this approach to other UI elements as well. However, with each new factory method you add to the <code>Dialog</code>, you get closer to the Abstract Factory pattern. Fear not, weâ€™ll talk about this pattern later.<br>å½“ç„¶ï¼Œæ‚¨ä¹Ÿå¯ä»¥å°†æ­¤æ–¹æ³•åº”ç”¨äºå…¶ä»– UI å…ƒç´ ã€‚ä½†æ˜¯ï¼Œéšç€æ‚¨æ·»åŠ åˆ° <code>Dialog</code> çš„æ¯ä¸ªæ–°å·¥å‚æ–¹æ³•ï¼Œæ‚¨éƒ½æ›´æ¥è¿‘æŠ½è±¡å·¥å‚æ¨¡å¼ã€‚ä¸è¦å®³æ€•ï¼Œæˆ‘ä»¬ç¨åä¼šè®¨è®ºè¿™ç§æ¨¡å¼ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// The creator class declares the factory method that must</span></span><br><span class="line"><span class="comment">// return an object of a product class. The creator&#x27;s subclasses</span></span><br><span class="line"><span class="comment">// usually provide the implementation of this method.</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Dialog</span> is</span><br><span class="line">    <span class="comment">// The creator may also provide some default implementation</span></span><br><span class="line">    <span class="comment">// of the factory method.</span></span><br><span class="line">    <span class="keyword">abstract</span> method <span class="title function_">createButton</span><span class="params">()</span>:Button</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Note that, despite its name, the creator&#x27;s primary</span></span><br><span class="line">    <span class="comment">// responsibility isn&#x27;t creating products. It usually</span></span><br><span class="line">    <span class="comment">// contains some core business logic that relies on product</span></span><br><span class="line">    <span class="comment">// objects returned by the factory method. Subclasses can</span></span><br><span class="line">    <span class="comment">// indirectly change that business logic by overriding the</span></span><br><span class="line">    <span class="comment">// factory method and returning a different type of product</span></span><br><span class="line">    <span class="comment">// from it.</span></span><br><span class="line">    method <span class="title function_">render</span><span class="params">()</span> is</span><br><span class="line">        <span class="comment">// Call the factory method to create a product object.</span></span><br><span class="line">        <span class="type">Button</span> <span class="variable">okButton</span> <span class="operator">=</span> createButton()</span><br><span class="line">        <span class="comment">// Now use the product.</span></span><br><span class="line">        okButton.onClick(closeDialog)</span><br><span class="line">        okButton.render()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// Concrete creators override the factory method to change the</span></span><br><span class="line"><span class="comment">// resulting product&#x27;s type.</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">WindowsDialog</span> <span class="keyword">extends</span> <span class="title class_">Dialog</span> is</span><br><span class="line">    method <span class="title function_">createButton</span><span class="params">()</span>:Button is</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">WindowsButton</span>()</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">WebDialog</span> <span class="keyword">extends</span> <span class="title class_">Dialog</span> is</span><br><span class="line">    method <span class="title function_">createButton</span><span class="params">()</span>:Button is</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">HTMLButton</span>()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// The product interface declares the operations that all</span></span><br><span class="line"><span class="comment">// concrete products must implement.</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">Button</span> is</span><br><span class="line">    method <span class="title function_">render</span><span class="params">()</span></span><br><span class="line">    method <span class="title function_">onClick</span><span class="params">(f)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Concrete products provide various implementations of the</span></span><br><span class="line"><span class="comment">// product interface.</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">WindowsButton</span> <span class="keyword">implements</span> <span class="title class_">Button</span> is</span><br><span class="line">    method <span class="title function_">render</span><span class="params">(a, b)</span> is</span><br><span class="line">        <span class="comment">// Render a button in Windows style.</span></span><br><span class="line">    method <span class="title function_">onClick</span><span class="params">(f)</span> is</span><br><span class="line">        <span class="comment">// Bind a native OS click event.</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">HTMLButton</span> <span class="keyword">implements</span> <span class="title class_">Button</span> is</span><br><span class="line">    method <span class="title function_">render</span><span class="params">(a, b)</span> is</span><br><span class="line">        <span class="comment">// Return an HTML representation of a button.</span></span><br><span class="line">    method <span class="title function_">onClick</span><span class="params">(f)</span> is</span><br><span class="line">        <span class="comment">// Bind a web browser click event.</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Application</span> is</span><br><span class="line">    field dialog: Dialog</span><br><span class="line"></span><br><span class="line">    <span class="comment">// The application picks a creator&#x27;s type depending on the</span></span><br><span class="line">    <span class="comment">// current configuration or environment settings.</span></span><br><span class="line">    method <span class="title function_">initialize</span><span class="params">()</span> <span class="type">is</span></span><br><span class="line">        <span class="variable">config</span> <span class="operator">=</span> readApplicationConfigFile()</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (config.OS == <span class="string">&quot;Windows&quot;</span>) <span class="type">then</span></span><br><span class="line">            <span class="variable">dialog</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">WindowsDialog</span>()</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (config.OS == <span class="string">&quot;Web&quot;</span>) <span class="type">then</span></span><br><span class="line">            <span class="variable">dialog</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">WebDialog</span>()</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Exception</span>(<span class="string">&quot;Error! Unknown operating system.&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// The client code works with an instance of a concrete</span></span><br><span class="line">    <span class="comment">// creator, albeit through its base interface. As long as</span></span><br><span class="line">    <span class="comment">// the client keeps working with the creator via the base</span></span><br><span class="line">    <span class="comment">// interface, you can pass it any creator&#x27;s subclass.</span></span><br><span class="line">    method <span class="title function_">main</span><span class="params">()</span> is</span><br><span class="line">        <span class="built_in">this</span>.initialize()</span><br><span class="line">        dialog.render()</span><br></pre></td></tr></table></figure>

<h2 id="Applicability-é€‚ç”¨æ€§"><a href="#Applicability-é€‚ç”¨æ€§" class="headerlink" title="Applicability é€‚ç”¨æ€§"></a>Applicability é€‚ç”¨æ€§</h2><p><strong>Use the Factory Method when you donâ€™t know beforehand the exact types and dependencies of the objects your code should work with.</strong><br><strong>å½“æ‚¨äº‹å…ˆä¸çŸ¥é“ä»£ç åº”ä½¿ç”¨çš„å¯¹è±¡çš„ç¡®åˆ‡ç±»å‹å’Œä¾èµ–é¡¹æ—¶ï¼Œè¯·ä½¿ç”¨å·¥å‚æ–¹æ³•ã€‚</strong></p>
<p>The Factory Method separates product construction code from the code that actually uses the product. Therefore itâ€™s easier to extend the product construction code independently from the rest of the code.</p>
<p>Factory æ–¹æ³•å°†äº§å“æ„é€ ä»£ç ä¸å®é™…ä½¿ç”¨äº§å“çš„ä»£ç åˆ†å¼€ã€‚å› æ­¤ï¼Œç‹¬ç«‹äºä»£ç çš„å…¶ä½™éƒ¨åˆ†æ‰©å±•äº§å“æ„é€ ä»£ç æ›´å®¹æ˜“ã€‚</p>
<p>For example, to add a new product type to the app, youâ€™ll only need to create a new creator subclass and override the factory method in it.</p>
<p>ä¾‹å¦‚ï¼Œè¦å‘åº”ç”¨æ·»åŠ æ–°çš„äº§å“ç±»å‹ï¼Œåªéœ€åˆ›å»ºä¸€ä¸ªæ–°çš„åˆ›å»ºè€…å­ç±»å¹¶é‡å†™å…¶ä¸­çš„å·¥å‚æ–¹æ³•ã€‚</p>
<p><strong>Use the Factory Method when you want to provide users of your library or framework with a way to extend its internal components.</strong><br><strong>å¦‚æœè¦ä¸ºåº“æˆ–æ¡†æ¶çš„ç”¨æˆ·æä¾›æ‰©å±•å…¶å†…éƒ¨ç»„ä»¶çš„æ–¹æ³•ï¼Œè¯·ä½¿ç”¨å·¥å‚æ–¹æ³•ã€‚</strong></p>
<p>Inheritance is probably the easiest way to extend the default behavior of a library or framework. But how would the framework recognize that your subclass should be used instead of a standard component?<br>ç»§æ‰¿å¯èƒ½æ˜¯æ‰©å±•åº“æˆ–æ¡†æ¶é»˜è®¤è¡Œä¸ºçš„æœ€ç®€å•æ–¹æ³•ã€‚ä½†æ˜¯ï¼Œæ¡†æ¶å¦‚ä½•è¯†åˆ«åº”è¯¥ä½¿ç”¨æ‚¨çš„å­ç±»è€Œä¸æ˜¯æ ‡å‡†ç»„ä»¶å‘¢ï¼Ÿ</p>
<p>The solution is to reduce the code that constructs components across the framework into a single factory method and let anyone override this method in addition to extending the component itself.<br>è§£å†³æ–¹æ¡ˆæ˜¯å°†è·¨æ¡†æ¶æ„é€ ç»„ä»¶çš„ä»£ç ç®€åŒ–ä¸ºå•ä¸ªå·¥å‚æ–¹æ³•ï¼Œå¹¶å…è®¸ä»»ä½•äººåœ¨æ‰©å±•ç»„ä»¶æœ¬èº«ä¹‹å¤–é‡å†™æ­¤æ–¹æ³•ã€‚</p>
<p>Letâ€™s see how that would work. Imagine that you write an app using an open source UI framework. Your app should have round buttons, but the framework only provides square ones. You extend the standard <code>Button</code> class with a glorious <code>RoundButton</code> subclass. But now you need to tell the main <code>UIFramework</code> class to use the new button subclass instead of a default one.<br>è®©æˆ‘ä»¬çœ‹çœ‹è¿™å°†å¦‚ä½•å·¥ä½œã€‚æƒ³è±¡ä¸€ä¸‹ï¼Œä½ ä½¿ç”¨å¼€æº UI æ¡†æ¶ç¼–å†™ä¸€ä¸ªåº”ç”¨ã€‚ä½ çš„åº”ç”¨åº”è¯¥æœ‰åœ†å½¢æŒ‰é’®ï¼Œä½†æ¡†æ¶åªæä¾›æ–¹å½¢æŒ‰é’®ã€‚ä½ ç”¨ä¸€ä¸ªå…‰è£çš„ <code>RoundButton</code> å­ç±»æ‰©å±•äº†æ ‡å‡† Button ç±»ã€‚ä½†æ˜¯ç°åœ¨ä½ éœ€è¦å‘Šè¯‰ä¸» <code>UIFramework</code> ç±»ä½¿ç”¨æ–°çš„æŒ‰é’®å­ç±»ï¼Œè€Œä¸æ˜¯é»˜è®¤çš„å­ç±»ã€‚</p>
<p>To achieve this, you create a subclass <code>UIWithRoundButtons</code> from a base framework class and override its createButton method. While this method returns <code>Button</code> objects in the base class, you make your subclass return <code>RoundButton</code> objects. Now use the <code>UIWithRoundButtons</code> class instead of <code>UIFramework</code>. And thatâ€™s about it!<br>ä¸ºæ­¤ï¼Œå¯ä»¥ä»åŸºæ¡†æ¶ç±»åˆ›å»ºä¸€ä¸ªå­ç±» <code>UIWithRoundButtons</code> å¹¶é‡å†™å…¶ createButton æ–¹æ³•ã€‚å½“æ­¤æ–¹æ³•è¿”å›åŸºç±»ä¸­çš„å¯¹è±¡æ—¶ï¼Œæ‚¨å¯ä»¥ä½¿å­ç±»è¿”å› Button <code>RoundButton</code> å¯¹è±¡ã€‚ç°åœ¨ä½¿ç”¨ç±» <code>UIWithRoundButtons</code> è€Œä¸æ˜¯ <code>UIFramework</code> .ä»…æ­¤è€Œå·²ï¼</p>
<p><strong>Use the Factory Method when you want to save system resources by reusing existing objects instead of rebuilding them each time.</strong><br><strong>å¦‚æœè¦é€šè¿‡é‡ç”¨ç°æœ‰å¯¹è±¡è€Œä¸æ˜¯æ¯æ¬¡éƒ½é‡æ–°ç”Ÿæˆå®ƒä»¬æ¥èŠ‚çœç³»ç»Ÿèµ„æºï¼Œè¯·ä½¿ç”¨å·¥å‚æ–¹æ³•ã€‚</strong></p>
<p>You often experience this need when dealing with large, resource-intensive objects such as database connections, file systems, and network resources.<br>åœ¨å¤„ç†å¤§å‹èµ„æºå¯†é›†å‹å¯¹è±¡ï¼ˆå¦‚æ•°æ®åº“è¿æ¥ã€æ–‡ä»¶ç³»ç»Ÿå’Œç½‘ç»œèµ„æºï¼‰æ—¶ï¼Œæ‚¨ç»å¸¸ä¼šé‡åˆ°è¿™ç§éœ€æ±‚ã€‚</p>
<p>Letâ€™s think about what has to be done to reuse an existing object:<br>è®©æˆ‘ä»¬è€ƒè™‘ä¸€ä¸‹é‡ç”¨ç°æœ‰å¯¹è±¡å¿…é¡»åšäº›ä»€ä¹ˆï¼š</p>
<ul>
<li>First, you need to create some storage to keep track of all of the created objects.<br>é¦–å…ˆï¼Œæ‚¨éœ€è¦åˆ›å»ºä¸€äº›å­˜å‚¨æ¥è·Ÿè¸ªæ‰€æœ‰åˆ›å»ºçš„å¯¹è±¡ã€‚</li>
<li>When someone requests an object, the program should look for a free object inside that pool.<br>å½“æœ‰äººè¯·æ±‚æŸä¸ªå¯¹è±¡æ—¶ï¼Œç¨‹åºåº”è¯¥åœ¨è¯¥æ± ä¸­æŸ¥æ‰¾ä¸€ä¸ªç©ºé—²å¯¹è±¡ã€‚</li>
<li>â€¦ and then return it to the client code.<br>â€¦ï¼Œç„¶åå°†å…¶è¿”å›ç»™å®¢æˆ·ç«¯ä»£ç ã€‚</li>
<li>If there are no free objects, the program should create a new one (and add it to the pool).<br>å¦‚æœæ²¡æœ‰ç©ºé—²å¯¹è±¡ï¼Œç¨‹åºåº”åˆ›å»ºä¸€ä¸ªæ–°å¯¹è±¡ï¼ˆå¹¶å°†å…¶æ·»åŠ åˆ°æ± ä¸­ï¼‰ã€‚</li>
</ul>
<p>Thatâ€™s a lot of code! And it must all be put into a single place so that you donâ€™t pollute the program with duplicate code.<br>è¿™æ˜¯ä¸€å¤§å †ä»£ç ï¼è€Œä¸”å¿…é¡»å°†å®ƒä»¬å…¨éƒ¨æ”¾åœ¨ä¸€ä¸ªåœ°æ–¹ï¼Œè¿™æ ·æ‚¨å°±ä¸ä¼šç”¨é‡å¤çš„ä»£ç æ±¡æŸ“ç¨‹åºã€‚</p>
<p>Probably the most obvious and convenient place where this code could be placed is the constructor of the class whose objects weâ€™re trying to reuse. However, a constructor must always return <strong>new objects</strong> by definition. It canâ€™t return existing instances.<br>æ”¾ç½®æ­¤ä»£ç çš„æœ€æ˜æ˜¾å’Œæœ€æ–¹ä¾¿çš„ä½ç½®å¯èƒ½æ˜¯æˆ‘ä»¬å°è¯•é‡ç”¨å…¶å¯¹è±¡çš„ç±»çš„æ„é€ å‡½æ•°ã€‚ä½†æ˜¯ï¼Œæ ¹æ®å®šä¹‰ï¼Œæ„é€ å‡½æ•°å¿…é¡»å§‹ç»ˆè¿”å›<strong>new objects</strong>ã€‚å®ƒæ— æ³•è¿”å›ç°æœ‰å®ä¾‹ã€‚</p>
<p>Therefore, you need to have a regular method capable of creating new objects as well as reusing existing ones. That sounds very much like a factory method.<br>å› æ­¤ï¼Œæ‚¨éœ€è¦æœ‰ä¸€ä¸ªèƒ½å¤Ÿåˆ›å»ºæ–°å¯¹è±¡ä»¥åŠé‡ç”¨ç°æœ‰å¯¹è±¡çš„å¸¸è§„æ–¹æ³•ã€‚è¿™å¬èµ·æ¥å¾ˆåƒå·¥å‚æ–¹æ³•ã€‚</p>
<h2 id="How-to-Implement-å¦‚ä½•å®ç°"><a href="#How-to-Implement-å¦‚ä½•å®ç°" class="headerlink" title="How to Implement å¦‚ä½•å®ç°"></a>How to Implement å¦‚ä½•å®ç°</h2><ul>
<li><p>Make all products follow the same interface. This interface should declare methods that make sense in every product.<br>ä½¿æ‰€æœ‰äº§å“éƒ½éµå¾ªç›¸åŒçš„ç•Œé¢ã€‚æ­¤æ¥å£åº”å£°æ˜åœ¨æ¯ä¸ªäº§å“ä¸­éƒ½æœ‰æ„ä¹‰çš„æ–¹æ³•ã€‚</p>
</li>
<li><p>Add an empty factory method inside the creator class. The return type of the method should match the common product interface.<br>åœ¨ creator ç±»ä¸­æ·»åŠ ä¸€ä¸ªç©ºçš„å·¥å‚æ–¹æ³•ã€‚æ–¹æ³•çš„è¿”å›ç±»å‹åº”ä¸é€šç”¨äº§å“æ¥å£åŒ¹é…ã€‚</p>
</li>
<li><p>In the creatorâ€™s code find all references to product constructors. One by one, replace them with calls to the factory method, while extracting the product creation code into the factory method.<br>åœ¨åˆ›å»ºè€…çš„ä»£ç ä¸­ï¼Œæ‰¾åˆ°å¯¹äº§å“æ„é€ å‡½æ•°çš„æ‰€æœ‰å¼•ç”¨ã€‚å°†å®ƒä»¬é€ä¸ªæ›¿æ¢ä¸ºå¯¹å·¥å‚æ–¹æ³•çš„è°ƒç”¨ï¼ŒåŒæ—¶å°†äº§å“åˆ›å»ºä»£ç æå–åˆ°å·¥å‚æ–¹æ³•ä¸­ã€‚</p>
</li>
</ul>
<p>You might need to add a temporary parameter to the factory method to control the type of returned product.<br>æ‚¨å¯èƒ½éœ€è¦å‘å·¥å‚æ–¹æ³•æ·»åŠ ä¸´æ—¶å‚æ•°ï¼Œä»¥æ§åˆ¶è¿”å›äº§å“çš„ç±»å‹ã€‚</p>
<p>At this point, the code of the factory method may look pretty ugly. It may have a large <code>switch</code> statement that picks which product class to instantiate. But donâ€™t worry, weâ€™ll fix it soon enough.<br>åœ¨è¿™ä¸€ç‚¹ä¸Šï¼Œå·¥å‚æ–¹æ³•çš„ä»£ç å¯èƒ½çœ‹èµ·æ¥å¾ˆä¸‘é™‹ã€‚å®ƒå¯èƒ½æœ‰ä¸€ä¸ªå¤§ <code>switch</code> è¯­å¥ï¼Œç”¨äºé€‰æ‹©è¦å®ä¾‹åŒ–çš„äº§å“ç±»ã€‚ä½†åˆ«æ‹…å¿ƒï¼Œæˆ‘ä»¬ä¼šå°½å¿«ä¿®å¤å®ƒã€‚</p>
<ul>
<li><p>Now, create a set of creator subclasses for each type of product listed in the factory method. Override the factory method in the subclasses and extract the appropriate bits of construction code from the base method.<br>ç°åœ¨ï¼Œä¸º factory æ–¹æ³•ä¸­åˆ—å‡ºçš„æ¯ç§ç±»å‹çš„äº§å“åˆ›å»ºä¸€ç»„åˆ›å»ºè€…å­ç±»ã€‚é‡å†™å­ç±»ä¸­çš„å·¥å‚æ–¹æ³•ï¼Œå¹¶ä»åŸºæ–¹æ³•ä¸­æå–é€‚å½“çš„æ„é€ ä»£ç ä½ã€‚</p>
</li>
<li><p>If there are too many product types and it doesnâ€™t make sense to create subclasses for all of them, you can reuse the control parameter from the base class in subclasses.<br>å¦‚æœäº§å“ç±»å‹å¤ªå¤šï¼Œå¹¶ä¸”ä¸ºæ‰€æœ‰äº§å“ç±»å‹åˆ›å»ºå­ç±»æ²¡æœ‰æ„ä¹‰ï¼Œåˆ™å¯ä»¥åœ¨å­ç±»ä¸­é‡ç”¨åŸºç±»ä¸­çš„æ§åˆ¶å‚æ•°ã€‚</p>
</li>
</ul>
<p>For instance, imagine that you have the following hierarchy of classes: the base <code>Mail</code> class with a couple of subclasses: <code>AirMail</code> and <code>GroundMail</code>; the <code>Transport</code> classes are <code>Plane</code>, <code>Truck</code> and <code>Train</code>. While the <code>AirMail</code> class only uses <code>Plane</code> objects, <code>GroundMail</code> may work with both <code>Truck</code> and <code>Train</code> objects. You can create a new subclass (say <code>TrainMail</code>) to handle both cases, but thereâ€™s another option. The client code can pass an argument to the factory method of the <code>GroundMail</code> class to control which product it wants to receive.<br>ä¾‹å¦‚ï¼Œå‡è®¾æ‚¨æœ‰ä»¥ä¸‹ç±»å±‚æ¬¡ç»“æ„ï¼šå…·æœ‰å‡ ä¸ªå­ç±»çš„åŸº <code>Mail</code> ç±»ï¼š <code>AirMail</code> å’Œ <code>GroundMail</code> ; <code>Transport</code> è¿™äº›ç±»æ˜¯ <code>Plane</code>,  <code>Truck</code>å’Œ <code>Train</code> ã€‚è™½ç„¶è¯¥ <code>AirMail</code> ç±»ä»…ä½¿ç”¨ <code>Plane</code> å¯¹è±¡ï¼Œ <code>GroundMail</code> ä½†å¯ä»¥åŒæ—¶ <code>Truck</code> ä½¿ç”¨å’Œ <code>Train</code> å¯¹è±¡ã€‚æ‚¨å¯ä»¥åˆ›å»ºä¸€ä¸ªæ–°çš„å­ç±»ï¼ˆä¾‹å¦‚ <code>TrainMail</code> ï¼‰æ¥å¤„ç†è¿™ä¸¤ç§æƒ…å†µï¼Œä½†è¿˜æœ‰å¦ä¸€ç§é€‰æ‹©ã€‚å®¢æˆ·ç«¯ä»£ç å¯ä»¥å°†å‚æ•°ä¼ é€’ç»™ <code>GroundMail</code> ç±»çš„å·¥å‚æ–¹æ³•ï¼Œä»¥æ§åˆ¶å®ƒè¦æ¥æ”¶çš„äº§å“ã€‚</p>
<ul>
<li>If, after all of the extractions, the base factory method has become empty, you can make it abstract. If thereâ€™s something left, you can make it a default behavior of the method.<br>å¦‚æœåœ¨æ‰€æœ‰æå–ä¹‹åï¼ŒåŸºæœ¬å·¥å‚æ–¹æ³•å·²å˜ä¸ºç©ºï¼Œåˆ™å¯ä»¥å°†å…¶æŠ½è±¡åŒ–ã€‚å¦‚æœè¿˜å‰©ä¸‹ä¸€äº›ä¸œè¥¿ï¼Œå¯ä»¥å°†å…¶è®¾ç½®ä¸ºæ–¹æ³•çš„é»˜è®¤è¡Œä¸ºã€‚</li>
</ul>
<h2 id="Pros-and-Cons-ä¼˜ç‚¹å’Œç¼ºç‚¹"><a href="#Pros-and-Cons-ä¼˜ç‚¹å’Œç¼ºç‚¹" class="headerlink" title="Pros and Cons ä¼˜ç‚¹å’Œç¼ºç‚¹"></a>Pros and Cons ä¼˜ç‚¹å’Œç¼ºç‚¹</h2><h4 id="Pros-ä¼˜ç‚¹"><a href="#Pros-ä¼˜ç‚¹" class="headerlink" title="Pros ä¼˜ç‚¹"></a>Pros ä¼˜ç‚¹</h4><ul>
<li>You avoid tight coupling between the creator and the concrete products.<br>æ‚¨å¯ä»¥é¿å…åˆ›å»ºè€…å’Œå…·ä½“äº§å“ä¹‹é—´çš„ç´§å¯†è€¦åˆã€‚</li>
<li>Single Responsibility Principle. You can move the product creation code into one place in the program, making the code easier to support.<br>å•ä¸€è´£ä»»åŸåˆ™ã€‚æ‚¨å¯ä»¥å°†äº§å“åˆ›å»ºä»£ç ç§»åŠ¨åˆ°ç¨‹åºä¸­çš„ä¸€ä¸ªä½ç½®ï¼Œä½¿ä»£ç æ›´æ˜“äºæ”¯æŒã€‚</li>
<li>Open&#x2F;Closed Principle. You can introduce new types of products into the program without breaking existing client code.<br>å¼€&#x2F;é—­åŸç†ã€‚æ‚¨å¯ä»¥åœ¨ä¸ç ´åç°æœ‰å®¢æˆ·ç«¯ä»£ç çš„æƒ…å†µä¸‹å°†æ–°ç±»å‹çš„äº§å“å¼•å…¥ç¨‹åºã€‚</li>
</ul>
<h4 id="Cons-ç¼ºç‚¹"><a href="#Cons-ç¼ºç‚¹" class="headerlink" title="Cons ç¼ºç‚¹"></a>Cons ç¼ºç‚¹</h4><p>The code may become more complicated since you need to introduce a lot of new subclasses to implement the pattern. The best case scenario is when youâ€™re introducing the pattern into an existing hierarchy of creator classes.<br>ä»£ç å¯èƒ½ä¼šå˜å¾—æ›´åŠ å¤æ‚ï¼Œå› ä¸ºæ‚¨éœ€è¦å¼•å…¥è®¸å¤šæ–°çš„å­ç±»æ¥å®ç°è¯¥æ¨¡å¼ã€‚æœ€å¥½çš„æƒ…å†µæ˜¯å°†æ¨¡å¼å¼•å…¥åˆ°åˆ›å»ºè€…ç±»çš„ç°æœ‰å±‚æ¬¡ç»“æ„ä¸­ã€‚</p>
<h2 id="Relations-with-Other-Patterns-ä¸å…¶ä»–æ¨¡å¼çš„å…³ç³»"><a href="#Relations-with-Other-Patterns-ä¸å…¶ä»–æ¨¡å¼çš„å…³ç³»" class="headerlink" title="Relations with Other Patterns ä¸å…¶ä»–æ¨¡å¼çš„å…³ç³»"></a>Relations with Other Patterns ä¸å…¶ä»–æ¨¡å¼çš„å…³ç³»</h2><ul>
<li><p>Many designs start by using Factory Method (less complicated and more customizable via subclasses) and evolve toward Abstract Factory, Prototype, or Builder (more flexible, but more complicated).<br>è®¸å¤šè®¾è®¡ä»ä½¿ç”¨å·¥å‚æ–¹æ³•ï¼ˆä¸é‚£ä¹ˆå¤æ‚ï¼Œé€šè¿‡å­ç±»æ›´å¯å®šåˆ¶ï¼‰å¼€å§‹ï¼Œç„¶åå‘å±•åˆ°æŠ½è±¡å·¥å‚ã€åŸå‹æˆ–æ„å»ºå™¨ï¼ˆæ›´çµæ´»ï¼Œä½†æ›´å¤æ‚ï¼‰ã€‚</p>
</li>
<li><p>Abstract Factory classes are often based on a set of Factory Methods, but you can also use Prototype to compose the methods on these classes.<br>æŠ½è±¡å·¥å‚ç±»é€šå¸¸åŸºäºä¸€ç»„å·¥å‚æ–¹æ³•ï¼Œä½†æ‚¨ä¹Ÿå¯ä»¥ä½¿ç”¨ Prototype æ¥ç»„åˆè¿™äº›ç±»çš„æ–¹æ³•ã€‚</p>
</li>
<li><p>You can use Factory Method along with Iterator to let collection subclasses return different types of iterators that are compatible with the collections.<br>å¯ä»¥å°†å·¥å‚æ–¹æ³•ä¸è¿­ä»£å™¨ä¸€èµ·ä½¿ç”¨ï¼Œè®©é›†åˆå­ç±»è¿”å›ä¸é›†åˆå…¼å®¹çš„ä¸åŒç±»å‹çš„è¿­ä»£å™¨ã€‚</p>
</li>
<li><p>Prototype isnâ€™t based on inheritance, so it doesnâ€™t have its drawbacks. On the other hand, Prototype requires a complicated initialization of the cloned object. Factory Method is based on inheritance but doesnâ€™t require an initialization step.<br>åŸå‹ä¸æ˜¯åŸºäºç»§æ‰¿çš„ï¼Œæ‰€ä»¥å®ƒæ²¡æœ‰ç¼ºç‚¹ã€‚å¦ä¸€æ–¹é¢ï¼ŒPrototype éœ€è¦å¯¹å…‹éš†å¯¹è±¡è¿›è¡Œå¤æ‚çš„åˆå§‹åŒ–ã€‚å·¥å‚æ–¹æ³•åŸºäºç»§æ‰¿ï¼Œä½†ä¸éœ€è¦åˆå§‹åŒ–æ­¥éª¤ã€‚</p>
</li>
<li><p>Factory Method is a specialization of Template Method. At the same time, a Factory Method may serve as a step in a large Template Method.<br>å·¥å‚æ–¹æ³•æ˜¯æ¨¡æ¿æ–¹æ³•çš„ä¸“ä¸šåŒ–ã€‚åŒæ—¶ï¼Œå·¥å‚æ–¹æ³•å¯ä»¥ä½œä¸ºå¤§å‹æ¨¡æ¿æ–¹æ³•ä¸­çš„ä¸€ä¸ªæ­¥éª¤ã€‚</p>
</li>
</ul>
<h2 id="Code-Examples-ä»£ç ç¤ºä¾‹"><a href="#Code-Examples-ä»£ç ç¤ºä¾‹" class="headerlink" title="Code Examples ä»£ç ç¤ºä¾‹"></a>Code Examples ä»£ç ç¤ºä¾‹</h2><ul>
<li><p>python</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> __future__ <span class="keyword">import</span> annotations</span><br><span class="line"><span class="keyword">from</span> abc <span class="keyword">import</span> ABC, abstractmethod</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Creator</span>(<span class="title class_ inherited__">ABC</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    The Creator class declares the factory method that is supposed to return an</span></span><br><span class="line"><span class="string">    object of a Product class. The Creator&#x27;s subclasses usually provide the</span></span><br><span class="line"><span class="string">    implementation of this method.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">    @abstractmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">factory_method</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        Note that the Creator may also provide some default implementation of</span></span><br><span class="line"><span class="string">        the factory method.</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">some_operation</span>(<span class="params">self</span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        Also note that, despite its name, the Creator&#x27;s primary responsibility</span></span><br><span class="line"><span class="string">        is not creating products. Usually, it contains some core business logic</span></span><br><span class="line"><span class="string">        that relies on Product objects, returned by the factory method.</span></span><br><span class="line"><span class="string">        Subclasses can indirectly change that business logic by overriding the</span></span><br><span class="line"><span class="string">        factory method and returning a different type of product from it.</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># Call the factory method to create a Product object.</span></span><br><span class="line">        product = self.factory_method()</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Now, use the product.</span></span><br><span class="line">        result = <span class="string">f&quot;Creator: The same creator&#x27;s code has just worked with <span class="subst">&#123;product.operation()&#125;</span>&quot;</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">Concrete Creators override the factory method in order to change the resulting</span></span><br><span class="line"><span class="string">product&#x27;s type.</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ConcreteCreator1</span>(<span class="title class_ inherited__">Creator</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    Note that the signature of the method still uses the abstract product type,</span></span><br><span class="line"><span class="string">    even though the concrete product is actually returned from the method. This</span></span><br><span class="line"><span class="string">    way the Creator can stay independent of concrete product classes.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">factory_method</span>(<span class="params">self</span>) -&gt; Product:</span><br><span class="line">        <span class="keyword">return</span> ConcreteProduct1()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ConcreteCreator2</span>(<span class="title class_ inherited__">Creator</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">factory_method</span>(<span class="params">self</span>) -&gt; Product:</span><br><span class="line">        <span class="keyword">return</span> ConcreteProduct2()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Product</span>(<span class="title class_ inherited__">ABC</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    The Product interface declares the operations that all concrete products</span></span><br><span class="line"><span class="string">    must implement.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">    @abstractmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">operation</span>(<span class="params">self</span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">Concrete Products provide various implementations of the Product interface.</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ConcreteProduct1</span>(<span class="title class_ inherited__">Product</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">operation</span>(<span class="params">self</span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;&#123;Result of the ConcreteProduct1&#125;&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ConcreteProduct2</span>(<span class="title class_ inherited__">Product</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">operation</span>(<span class="params">self</span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;&#123;Result of the ConcreteProduct2&#125;&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">client_code</span>(<span class="params">creator: Creator</span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    The client code works with an instance of a concrete creator, albeit through</span></span><br><span class="line"><span class="string">    its base interface. As long as the client keeps working with the creator via</span></span><br><span class="line"><span class="string">    the base interface, you can pass it any creator&#x27;s subclass.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;Client: I&#x27;m not aware of the creator&#x27;s class, but it still works.\n&quot;</span></span><br><span class="line">          <span class="string">f&quot;<span class="subst">&#123;creator.some_operation()&#125;</span>&quot;</span>, end=<span class="string">&quot;&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;App: Launched with the ConcreteCreator1.&quot;</span>)</span><br><span class="line">    client_code(ConcreteCreator1())</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;\n&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;App: Launched with the ConcreteCreator2.&quot;</span>)</span><br><span class="line">    client_code(ConcreteCreator2())</span><br></pre></td></tr></table></figure>
<p><strong>Output.txt: Execution result</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">App: Launched <span class="keyword">with</span> the ConcreteCreator1.</span><br><span class="line">Client: I<span class="string">&#x27;m not aware of the creator&#x27;</span>s <span class="keyword">class</span>, but it still works.</span><br><span class="line">Creator: The same creato<span class="string">r&#x27;s code has just worked with &#123;Result of the ConcreteProduct1&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">App: Launched with the ConcreteCreator2.</span></span><br><span class="line"><span class="string">Client: I&#x27;</span>m <span class="keyword">not</span> aware of the creato<span class="string">r&#x27;s class, but it still works.</span></span><br><span class="line"><span class="string">Creator: The same creator&#x27;</span>s code has just worked <span class="keyword">with</span> &#123;Result of the ConcreteProduct2&#125;</span><br></pre></td></tr></table></figure>

</li>
<li><p>Rust<br><strong>gui.rs:Prodcut &amp; Creator</strong></p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">pub</span> <span class="keyword">trait</span> <span class="title class_">Button</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">render</span>(&amp;<span class="keyword">self</span>);</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">on_click</span>(&amp;<span class="keyword">self</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// Dialog has a factory method `create_button`.</span></span><br><span class="line"><span class="comment">///</span></span><br><span class="line"><span class="comment">/// It creates different buttons depending on a factory implementation.</span></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">trait</span> <span class="title class_">Dialog</span> &#123;</span><br><span class="line">    <span class="comment">/// The factory method. It must be overridden with a concrete implementation.</span></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">create_button</span>(&amp;<span class="keyword">self</span>) <span class="punctuation">-&gt;</span> <span class="type">Box</span>&lt;<span class="keyword">dyn</span> Button&gt;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">render</span>(&amp;<span class="keyword">self</span>) &#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="variable">button</span> = <span class="keyword">self</span>.<span class="title function_ invoke__">create_button</span>();</span><br><span class="line">        button.<span class="title function_ invoke__">render</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">refresh</span>(&amp;<span class="keyword">self</span>) &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;Dialog - Refresh&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>html_gui.rs: Concrete creator</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> crate::gui::&#123;Button, Dialog&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">struct</span> <span class="title class_">HtmlButton</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">Button</span> <span class="keyword">for</span> <span class="title class_">HtmlButton</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">render</span>(&amp;<span class="keyword">self</span>) &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;&lt;button&gt;Test Button&lt;/button&gt;&quot;</span>);</span><br><span class="line">        <span class="keyword">self</span>.<span class="title function_ invoke__">on_click</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">on_click</span>(&amp;<span class="keyword">self</span>) &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;Click! Button says - &#x27;Hello World!&#x27;&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">struct</span> <span class="title class_">HtmlDialog</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">Dialog</span> <span class="keyword">for</span> <span class="title class_">HtmlDialog</span> &#123;</span><br><span class="line">    <span class="comment">/// Creates an HTML button.</span></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">create_button</span>(&amp;<span class="keyword">self</span>) <span class="punctuation">-&gt;</span> <span class="type">Box</span>&lt;<span class="keyword">dyn</span> Button&gt; &#123;</span><br><span class="line">        <span class="type">Box</span>::<span class="title function_ invoke__">new</span>(HtmlButton)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>windows_gui.rs: Another concrete creator</strong></p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> crate::gui::&#123;Button, Dialog&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">struct</span> <span class="title class_">WindowsButton</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">Button</span> <span class="keyword">for</span> <span class="title class_">WindowsButton</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">render</span>(&amp;<span class="keyword">self</span>) &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;Drawing a Windows button&quot;</span>);</span><br><span class="line">        <span class="keyword">self</span>.<span class="title function_ invoke__">on_click</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">on_click</span>(&amp;<span class="keyword">self</span>) &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;Click! Hello, Windows!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">struct</span> <span class="title class_">WindowsDialog</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">Dialog</span> <span class="keyword">for</span> <span class="title class_">WindowsDialog</span> &#123;</span><br><span class="line">    <span class="comment">/// Creates a Windows button.</span></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">create_button</span>(&amp;<span class="keyword">self</span>) <span class="punctuation">-&gt;</span> <span class="type">Box</span>&lt;<span class="keyword">dyn</span> Button&gt; &#123;</span><br><span class="line">        <span class="type">Box</span>::<span class="title function_ invoke__">new</span>(WindowsButton)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<p><strong>init.rs: Initialization code</strong></p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> crate::gui::Dialog;</span><br><span class="line"><span class="keyword">use</span> crate::html_gui::HtmlDialog;</span><br><span class="line"><span class="keyword">use</span> crate::windows_gui::WindowsDialog;</span><br><span class="line"></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">initialize</span>() <span class="punctuation">-&gt;</span> &amp;<span class="symbol">&#x27;static</span> <span class="keyword">dyn</span> Dialog &#123;</span><br><span class="line">    <span class="comment">// The dialog type is selected depending on the environment settings or configuration.</span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">cfg!</span>(windows) &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;-- Windows detected, creating Windows GUI --&quot;</span>);</span><br><span class="line">        &amp;WindowsDialog</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;-- No OS detected, creating the HTML GUI --&quot;</span>);</span><br><span class="line">        &amp;HtmlDialog</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>main.rs: Client code main.rs</strong></p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">mod</span> gui;</span><br><span class="line"><span class="keyword">mod</span> html_gui;</span><br><span class="line"><span class="keyword">mod</span> init;</span><br><span class="line"><span class="keyword">mod</span> windows_gui;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> init::initialize;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="comment">// The rest of the code doesn&#x27;t depend on specific dialog types, because</span></span><br><span class="line">    <span class="comment">// it works with all dialog objects via the abstract `Dialog` trait</span></span><br><span class="line">    <span class="comment">// which is defined in the `gui` module.</span></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">dialog</span> = <span class="title function_ invoke__">initialize</span>();</span><br><span class="line">    dialog.<span class="title function_ invoke__">render</span>();</span><br><span class="line">    dialog.<span class="title function_ invoke__">refresh</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>Output</strong></p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;button&gt;Test Button&lt;/button&gt;</span><br><span class="line">Click! Button says - <span class="symbol">&#x27;Hello</span> World!&#x27;</span><br><span class="line">Dialog - Refresh</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://tonymistark.github.io/2023/11/15/design-pattern/classification-of-patterns/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Ice">
      <meta itemprop="description" content="å®‰é™åœ°åç€å­¦ä¹ ">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="BLOG">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/11/15/design-pattern/classification-of-patterns/" class="post-title-link" itemprop="url">classification of patterns</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2023-11-15 23:02:50" itemprop="dateCreated datePublished" datetime="2023-11-15T23:02:50+08:00">2023-11-15</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2023-11-22 23:21:21" itemprop="dateModified" datetime="2023-11-22T23:21:21+08:00">2023-11-22</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/design-pattern/" itemprop="url" rel="index"><span itemprop="name">design-pattern</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="Symbols count in article">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">Symbols count in article: </span>
              <span>465</span>
            </span>
            <span class="post-meta-item" title="Reading time">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">Reading time &asymp;</span>
              <span>2 mins.</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="Classification-of-patterns"><a href="#Classification-of-patterns" class="headerlink" title="Classification of patterns"></a>Classification of patterns</h1><h1 id="æ¨¡å¼åˆ†ç±»"><a href="#æ¨¡å¼åˆ†ç±»" class="headerlink" title="æ¨¡å¼åˆ†ç±»"></a>æ¨¡å¼åˆ†ç±»</h1><p>Design patterns differ by their complexity, level of detail and scale of applicability to the entire system being designed. I like the analogy to road construction: you can make an intersection safer by either installing some traffic lights or building an entire multi-level interchange with underground passages for pedestrians.</p>
<p>è®¾è®¡æ¨¡å¼çš„å¤æ‚æ€§ã€è¯¦ç»†ç¨‹åº¦å’Œå¯¹æ•´ä¸ªè®¾è®¡çš„ç³»ç»Ÿçš„é€‚ç”¨èŒƒå›´å„ä¸ç›¸åŒã€‚æˆ‘å–œæ¬¢ä¸é“è·¯å»ºè®¾çš„ç±»æ¯”ï¼šä½ å¯ä»¥é€šè¿‡å®‰è£…ä¸€äº›äº¤é€šä¿¡å·ç¯æˆ–å»ºé€ ä¸€ä¸ªå®Œæ•´çš„å¤šå±‚ç«‹äº¤æ¡¥å’Œåœ°ä¸‹é€šé“æ¥ä½¿åå­—è·¯å£æ›´å®‰å…¨ã€‚</p>
<p>The most basic and low-level patterns are often called idioms. They usually apply only to a single programming language.</p>
<p>æœ€åŸºæœ¬å’Œæœ€åº•å±‚çš„æ¨¡å¼é€šå¸¸è¢«ç§°ä¸ºæˆè¯­ã€‚å®ƒä»¬é€šå¸¸ä»…é€‚ç”¨äºä¸€ç§ç¼–ç¨‹è¯­è¨€ã€‚</p>
<p>The most universal and high-level patterns are architectural patterns. Developers can implement these patterns in virtually any language. Unlike other patterns, they can be used to design the architecture of an entire application.</p>
<p>æœ€é€šç”¨å’Œé«˜çº§çš„æ¨¡å¼æ˜¯ä½“ç³»ç»“æ„æ¨¡å¼ã€‚å¼€å‘äººå‘˜å‡ ä¹å¯ä»¥ç”¨ä»»ä½•è¯­è¨€å®ç°è¿™äº›æ¨¡å¼ã€‚ä¸å…¶ä»–æ¨¡å¼ä¸åŒï¼Œå®ƒä»¬å¯ç”¨äºè®¾è®¡æ•´ä¸ªåº”ç”¨ç¨‹åºçš„ä½“ç³»ç»“æ„ã€‚</p>
<p>In addition, all patterns can be categorized by their intent, or purpose. This book covers three main groups of patterns:</p>
<p>æ­¤å¤–ï¼Œæ‰€æœ‰æ¨¡å¼éƒ½å¯ä»¥æŒ‰å…¶æ„å›¾æˆ–ç›®çš„è¿›è¡Œåˆ†ç±»ã€‚æœ¬ä¹¦æ¶µç›–ä¸‰å¤§ç±»æ¨¡å¼ï¼š</p>
<ul>
<li><p>Creational patterns provide object creation mechanisms that increase flexibility and reuse of existing code.<br>åˆ›å»ºæ¨¡å¼æä¾›äº†å¯¹è±¡åˆ›å»ºæœºåˆ¶ï¼Œå¯æé«˜ç°æœ‰ä»£ç çš„çµæ´»æ€§å’Œé‡ç”¨æ€§ã€‚</p>
</li>
<li><p>Structural patterns explain how to assemble objects and classes into larger structures, while keeping these structures flexible and efficient.<br>ç»“æ„æ¨¡å¼è§£é‡Šäº†å¦‚ä½•å°†å¯¹è±¡å’Œç±»ç»„åˆæˆæ›´å¤§çš„ç»“æ„ï¼ŒåŒæ—¶ä¿æŒè¿™äº›ç»“æ„çš„çµæ´»æ€§å’Œæ•ˆç‡ã€‚</p>
</li>
<li><p>Behavioral patterns take care of effective communication and the assignment of responsibilities between objects.<br>è¡Œä¸ºæ¨¡å¼è´Ÿè´£å¯¹è±¡ä¹‹é—´çš„æœ‰æ•ˆæ²Ÿé€šå’Œè´£ä»»åˆ†é…ã€‚</p>
</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://tonymistark.github.io/2023/11/15/design-pattern/why-should-i-learn-patterns/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Ice">
      <meta itemprop="description" content="å®‰é™åœ°åç€å­¦ä¹ ">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="BLOG">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/11/15/design-pattern/why-should-i-learn-patterns/" class="post-title-link" itemprop="url">Why should I learn patterns?</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2023-11-15 19:54:40" itemprop="dateCreated datePublished" datetime="2023-11-15T19:54:40+08:00">2023-11-15</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2023-11-22 23:21:21" itemprop="dateModified" datetime="2023-11-22T23:21:21+08:00">2023-11-22</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/design-pattern/" itemprop="url" rel="index"><span itemprop="name">design-pattern</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="Symbols count in article">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">Symbols count in article: </span>
              <span>407</span>
            </span>
            <span class="post-meta-item" title="Reading time">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">Reading time &asymp;</span>
              <span>1 mins.</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="Why-should-I-learn-patterns"><a href="#Why-should-I-learn-patterns" class="headerlink" title="Why should I learn patterns?"></a>Why should I learn patterns?</h1><h1 id="æˆ‘ä¸ºä»€ä¹ˆè¦å­¦ä¹ æ¨¡å¼ï¼Ÿ"><a href="#æˆ‘ä¸ºä»€ä¹ˆè¦å­¦ä¹ æ¨¡å¼ï¼Ÿ" class="headerlink" title="æˆ‘ä¸ºä»€ä¹ˆè¦å­¦ä¹ æ¨¡å¼ï¼Ÿ"></a>æˆ‘ä¸ºä»€ä¹ˆè¦å­¦ä¹ æ¨¡å¼ï¼Ÿ</h1><p>The truth is that you might manage to work as a programmer for many years without knowing about a single pattern. A lot of people do just that. Even in that case, though, you might be implementing some patterns without even knowing it. So why would you spend time learning them?</p>
<p>äº‹å®æ˜¯ï¼Œä½ å¯èƒ½åœ¨ä¸äº†è§£å•ä¸€æ¨¡å¼çš„æƒ…å†µä¸‹è®¾æ³•ä½œä¸ºç¨‹åºå‘˜å·¥ä½œå¤šå¹´ã€‚å¾ˆå¤šäººå°±æ˜¯è¿™æ ·åšçš„ã€‚ä½†æ˜¯ï¼Œå³ä½¿åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ‚¨ä¹Ÿå¯èƒ½åœ¨ä¸çŸ¥ä¸è§‰ä¸­å®ç°æŸäº›æ¨¡å¼ã€‚é‚£ä¹ˆï¼Œä½ ä¸ºä»€ä¹ˆè¦èŠ±æ—¶é—´å­¦ä¹ å®ƒä»¬å‘¢ï¼Ÿ</p>
<ul>
<li><p>Design patterns are a toolkit of tried and tested solutions to common problems in software design. Even if you never encounter these problems, knowing patterns is still useful because it teaches you how to solve all sorts of problems using principles of object-oriented design.<br>è®¾è®¡æ¨¡å¼æ˜¯è½¯ä»¶è®¾è®¡ä¸­å¸¸è§é—®é¢˜çš„ä¹…ç»è€ƒéªŒçš„è§£å†³æ–¹æ¡ˆå·¥å…·åŒ…ã€‚å³ä½¿ä½ ä»æœªé‡åˆ°è¿‡è¿™äº›é—®é¢˜ï¼Œäº†è§£æ¨¡å¼ä»ç„¶å¾ˆæœ‰ç”¨ï¼Œå› ä¸ºå®ƒæ•™ä¼šäº†ä½ å¦‚ä½•ä½¿ç”¨é¢å‘å¯¹è±¡è®¾è®¡çš„åŸåˆ™æ¥è§£å†³å„ç§é—®é¢˜ã€‚</p>
</li>
<li><p>Design patterns define a common language that you and your teammates can use to communicate more efficiently. You can say, â€œOh, just use a Singleton for that,â€ and everyone will understand the idea behind your suggestion. No need to explain what a singleton is if you know the pattern and its name.<br>è®¾è®¡æ¨¡å¼å®šä¹‰äº†ä¸€ç§é€šç”¨è¯­è¨€ï¼Œæ‚¨å’Œæ‚¨çš„å›¢é˜Ÿæˆå‘˜å¯ä»¥ä½¿ç”¨è¯¥è¯­è¨€æ¥æ›´æœ‰æ•ˆåœ°è¿›è¡Œé€šä¿¡ã€‚ä½ å¯ä»¥è¯´ï¼Œâ€œå“¦ï¼Œå°±ç”¨ä¸€ä¸ªå•ä¾‹æ¥åšè¿™ä»¶äº‹å§â€ï¼Œæ¯ä¸ªäººéƒ½ä¼šç†è§£ä½ çš„å»ºè®®èƒŒåçš„æƒ³æ³•ã€‚å¦‚æœæ‚¨çŸ¥é“æ¨¡å¼åŠå…¶åç§°ï¼Œåˆ™æ— éœ€è§£é‡Šä»€ä¹ˆæ˜¯å•ä¾‹ã€‚</p>
</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://tonymistark.github.io/2023/11/14/design-pattern/history-of-patterns/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Ice">
      <meta itemprop="description" content="å®‰é™åœ°åç€å­¦ä¹ ">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="BLOG">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/11/14/design-pattern/history-of-patterns/" class="post-title-link" itemprop="url">History of patterns</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2023-11-14 20:53:45" itemprop="dateCreated datePublished" datetime="2023-11-14T20:53:45+08:00">2023-11-14</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2023-11-22 23:21:21" itemprop="dateModified" datetime="2023-11-22T23:21:21+08:00">2023-11-22</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/design-pattern/" itemprop="url" rel="index"><span itemprop="name">design-pattern</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="Symbols count in article">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">Symbols count in article: </span>
              <span>642</span>
            </span>
            <span class="post-meta-item" title="Reading time">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">Reading time &asymp;</span>
              <span>2 mins.</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="History-of-patterns"><a href="#History-of-patterns" class="headerlink" title="History of patterns"></a>History of patterns</h1><h1 id="æ¨¡å¼çš„å†å²"><a href="#æ¨¡å¼çš„å†å²" class="headerlink" title="æ¨¡å¼çš„å†å²"></a>æ¨¡å¼çš„å†å²</h1><p>Who invented patterns? Thatâ€™s a good, but not a very accurate, question. Design patterns arenâ€™t obscure, sophisticated conceptsâ€”quite the opposite. Patterns are typical solutions to common problems in object-oriented design. When a solution gets repeated over and over in various projects, someone eventually puts a name to it and describes the solution in detail. Thatâ€™s basically how a pattern gets discovered.<br>è°å‘æ˜äº†æ¨¡å¼ï¼Ÿè¿™æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„é—®é¢˜ï¼Œä½†ä¸æ˜¯å¾ˆå‡†ç¡®ã€‚è®¾è®¡æ¨¡å¼ä¸æ˜¯æ™¦æ¶©éš¾æ‡‚çš„å¤æ‚æ¦‚å¿µï¼Œæ°æ°ç›¸åã€‚æ¨¡å¼æ˜¯é¢å‘å¯¹è±¡è®¾è®¡ä¸­å¸¸è§é—®é¢˜çš„å…¸å‹è§£å†³æ–¹æ¡ˆã€‚å½“ä¸€ä¸ªè§£å†³æ–¹æ¡ˆåœ¨å„ç§é¡¹ç›®ä¸­ä¸€éåˆä¸€éåœ°é‡å¤æ—¶ï¼Œæœ€ç»ˆä¼šæœ‰äººç»™å®ƒèµ·ä¸€ä¸ªåå­—å¹¶è¯¦ç»†æè¿°è¯¥è§£å†³æ–¹æ¡ˆã€‚è¿™åŸºæœ¬ä¸Šå°±æ˜¯å‘ç°æ¨¡å¼çš„æ–¹å¼ã€‚</p>
<p>The concept of patterns was first described by Christopher Alexander in A Pattern Language: Towns, Buildings, Construction. The book describes a â€œlanguageâ€ for designing the urban environment. The units of this language are patterns. They may describe how high windows should be, how many levels a building should have, how large green areas in a neighborhood are supposed to be, and so on.<br>æ¨¡å¼çš„æ¦‚å¿µæœ€æ—©ç”±å…‹é‡Œæ–¯æ‰˜å¼—Â·äºšå†å±±å¤§ï¼ˆChristopher Alexanderï¼‰åœ¨ã€Šæ¨¡å¼è¯­è¨€ï¼šåŸé•‡ã€å»ºç­‘ã€å»ºç­‘ã€‹ä¸­æè¿°ã€‚è¯¥ä¹¦æè¿°äº†ä¸€ç§è®¾è®¡åŸå¸‚ç¯å¢ƒçš„â€œè¯­è¨€â€ã€‚è¿™ç§è¯­è¨€çš„å•ä½æ˜¯æ¨¡å¼ã€‚å®ƒä»¬å¯èƒ½ä¼šæè¿°çª—æˆ·åº”è¯¥æœ‰å¤šé«˜ï¼Œå»ºç­‘ç‰©åº”è¯¥æœ‰å¤šå°‘å±‚ï¼Œç¤¾åŒºä¸­çš„ç»¿åœ°åº”è¯¥æœ‰å¤šå¤§ï¼Œç­‰ç­‰ã€‚</p>
<p>The idea was picked up by four authors: Erich Gamma, John Vlissides, Ralph Johnson, and Richard Helm. In 1994, they published Design Patterns: Elements of Reusable Object-Oriented Software, in which they applied the concept of design patterns to programming. The book featured 23 patterns solving various problems of object-oriented design and became a best-seller very quickly. Due to its lengthy name, people started to call it â€œthe book by the gang of fourâ€ which was soon shortened to simply â€œthe GoF bookâ€.<br>è¿™ä¸ªæƒ³æ³•è¢«å››ä½ä½œè€…é‡‡çº³ï¼šErich Gammaã€John Vlissidesã€Ralph Johnson å’Œ Richard Helmã€‚1994 å¹´ï¼Œä»–ä»¬å‡ºç‰ˆäº†ã€Šè®¾è®¡æ¨¡å¼ï¼šå¯é‡ç”¨é¢å‘å¯¹è±¡è½¯ä»¶çš„å…ƒç´ ã€‹ï¼Œå…¶ä¸­ä»–ä»¬å°†è®¾è®¡æ¨¡å¼çš„æ¦‚å¿µåº”ç”¨äºç¼–ç¨‹ã€‚è¯¥ä¹¦æ”¶å½•äº† 23 ç§æ¨¡å¼ï¼Œè§£å†³äº†é¢å‘å¯¹è±¡è®¾è®¡çš„å„ç§é—®é¢˜ï¼Œå¹¶å¾ˆå¿«æˆä¸ºç•…é”€ä¹¦ã€‚ç”±äºåå­—å¾ˆé•¿ï¼Œäººä»¬å¼€å§‹ç§°å®ƒä¸ºâ€œå››äººå›¢çš„ä¹¦â€ï¼Œå¾ˆå¿«å°±ç®€ç§°ä¸ºã€ŠThe GoF bookã€‹ã€‚</p>
<p>Since then, dozens of other object-oriented patterns have been discovered. The â€œpattern approachâ€ became very popular in other programming fields, so lots of other patterns now exist outside of object-oriented design as well.<br>ä»é‚£æ—¶èµ·ï¼Œå·²ç»å‘ç°äº†è®¸å¤šå…¶ä»–é¢å‘å¯¹è±¡çš„æ¨¡å¼ã€‚â€œæ¨¡å¼æ–¹æ³•â€åœ¨å…¶ä»–ç¼–ç¨‹é¢†åŸŸå˜å¾—éå¸¸æµè¡Œï¼Œå› æ­¤åœ¨é¢å‘å¯¹è±¡è®¾è®¡ä¹‹å¤–ä¹Ÿå­˜åœ¨è®¸å¤šå…¶ä»–æ¨¡å¼ã€‚</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://tonymistark.github.io/2023/11/09/design-pattern/what-is-a-design-pattern/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Ice">
      <meta itemprop="description" content="å®‰é™åœ°åç€å­¦ä¹ ">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="BLOG">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/11/09/design-pattern/what-is-a-design-pattern/" class="post-title-link" itemprop="url">What's a design pattern?</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2023-11-09 22:18:59" itemprop="dateCreated datePublished" datetime="2023-11-09T22:18:59+08:00">2023-11-09</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2023-11-22 23:21:21" itemprop="dateModified" datetime="2023-11-22T23:21:21+08:00">2023-11-22</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/design-pattern/" itemprop="url" rel="index"><span itemprop="name">design-pattern</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="Symbols count in article">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">Symbols count in article: </span>
              <span>796</span>
            </span>
            <span class="post-meta-item" title="Reading time">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">Reading time &asymp;</span>
              <span>3 mins.</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="Whatâ€™s-a-design-pattern"><a href="#Whatâ€™s-a-design-pattern" class="headerlink" title="Whatâ€™s a design pattern?"></a>Whatâ€™s a design pattern?</h1><h1 id="ä»€ä¹ˆæ˜¯è®¾è®¡æ¨¡å¼ï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯è®¾è®¡æ¨¡å¼ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯è®¾è®¡æ¨¡å¼ï¼Ÿ"></a>ä»€ä¹ˆæ˜¯è®¾è®¡æ¨¡å¼ï¼Ÿ</h1><p>Design patterns are typical solutions to commonly occurring problems in software design. They are like pre-made blueprints that you can customize to solve a recurring design problem in your code.</p>
<p>è®¾è®¡æ¨¡å¼æ˜¯è½¯ä»¶è®¾è®¡ä¸­å¸¸è§é—®é¢˜çš„å…¸å‹è§£å†³æ–¹æ¡ˆã€‚å®ƒä»¬å°±åƒé¢„åˆ¶çš„è“å›¾ï¼Œæ‚¨å¯ä»¥è‡ªå®šä¹‰è¿™äº›è“å›¾æ¥è§£å†³ä»£ç ä¸­åå¤å‡ºç°çš„è®¾è®¡é—®é¢˜ã€‚</p>
<p>You canâ€™t just find a pattern and copy it into your program, the way you can with off-the-shelf functions or libraries. The pattern is not a specific piece of code, but a general concept for solving a particular problem. You can follow the pattern details and implement a solution that suits the realities of your own program.</p>
<p>ä½ ä¸èƒ½åªæ˜¯æ‰¾åˆ°ä¸€ä¸ªæ¨¡å¼å¹¶å°†å…¶å¤åˆ¶åˆ°ä½ çš„ç¨‹åºä¸­ï¼Œå°±åƒä½ ä½¿ç”¨ç°æˆçš„å‡½æ•°æˆ–åº“ä¸€æ ·ã€‚æ¨¡å¼ä¸æ˜¯ä¸€æ®µç‰¹å®šçš„ä»£ç ï¼Œè€Œæ˜¯è§£å†³ç‰¹å®šé—®é¢˜çš„ä¸€èˆ¬æ¦‚å¿µã€‚æ‚¨å¯ä»¥éµå¾ªæ¨¡å¼è¯¦ç»†ä¿¡æ¯ï¼Œå¹¶å®ç°é€‚åˆæ‚¨è‡ªå·±ç¨‹åºå®é™…æƒ…å†µçš„è§£å†³æ–¹æ¡ˆã€‚</p>
<p>Patterns are often confused with algorithms, because both concepts describe typical solutions to some known problems. While an algorithm always defines a clear set of actions that can achieve some goal, a pattern is a more high-level description of a solution. The code of the same pattern applied to two different programs may be different.</p>
<p>æ¨¡å¼ç»å¸¸ä¸ç®—æ³•æ··æ·†ï¼Œå› ä¸ºè¿™ä¸¤ä¸ªæ¦‚å¿µéƒ½æè¿°äº†ä¸€äº›å·²çŸ¥é—®é¢˜çš„å…¸å‹è§£å†³æ–¹æ¡ˆã€‚è™½ç„¶ç®—æ³•å§‹ç»ˆå®šä¹‰ä¸€ç»„å¯ä»¥å®ç°æŸäº›ç›®æ ‡çš„æ˜ç¡®æ“ä½œï¼Œä½†æ¨¡å¼æ˜¯å¯¹è§£å†³æ–¹æ¡ˆçš„æ›´é«˜çº§æè¿°ã€‚åº”ç”¨äºä¸¤ä¸ªä¸åŒç¨‹åºçš„ç›¸åŒæ¨¡å¼çš„ä»£ç å¯èƒ½ä¸åŒã€‚</p>
<p>An analogy to an algorithm is a cooking recipe: both have clear steps to achieve a goal. On the other hand, a pattern is more like a blueprint: you can see what the result and its features are, but the exact order of implementation is up to you.</p>
<p>ç®—æ³•çš„ç±»æ¯”æ˜¯çƒ¹é¥ªé£Ÿè°±ï¼šä¸¤è€…éƒ½æœ‰æ˜ç¡®çš„æ­¥éª¤æ¥å®ç°ç›®æ ‡ã€‚å¦ä¸€æ–¹é¢ï¼Œæ¨¡å¼æ›´åƒæ˜¯ä¸€ä¸ªè“å›¾ï¼šä½ å¯ä»¥çœ‹åˆ°ç»“æœåŠå…¶åŠŸèƒ½æ˜¯ä»€ä¹ˆï¼Œä½†å®ç°çš„ç¡®åˆ‡é¡ºåºå–å†³äºä½ ã€‚</p>
<h1 id="What-does-the-pattern-consist-of"><a href="#What-does-the-pattern-consist-of" class="headerlink" title="What does the pattern consist of?"></a>What does the pattern consist of?</h1><h1 id="æ¨¡å¼ç”±ä»€ä¹ˆç»„æˆï¼Ÿ"><a href="#æ¨¡å¼ç”±ä»€ä¹ˆç»„æˆï¼Ÿ" class="headerlink" title="æ¨¡å¼ç”±ä»€ä¹ˆç»„æˆï¼Ÿ"></a>æ¨¡å¼ç”±ä»€ä¹ˆç»„æˆï¼Ÿ</h1><p>Most patterns are described very formally so people can reproduce them in many contexts. Here are the sections that are usually present in a pattern description:</p>
<p>å¤§å¤šæ•°æ¨¡å¼éƒ½æè¿°å¾—éå¸¸æ­£å¼ï¼Œå› æ­¤äººä»¬å¯ä»¥åœ¨è®¸å¤šæƒ…å†µä¸‹é‡ç°å®ƒä»¬ã€‚ä»¥ä¸‹æ˜¯æ¨¡å¼æè¿°ä¸­é€šå¸¸å­˜åœ¨çš„éƒ¨åˆ†ï¼š</p>
<ul>
<li>Intent of the pattern briefly describes both the problem and the solution.<br>æ¨¡å¼çš„æ„å›¾ç®€è¦æè¿°äº†é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆã€‚</li>
<li>Motivation further explains the problem and the solution the pattern makes possible.<br>åŠ¨æœºè¿›ä¸€æ­¥è§£é‡Šäº†é—®é¢˜å’Œæ¨¡å¼ä½¿è§£å†³æ–¹æ¡ˆæˆä¸ºå¯èƒ½ã€‚</li>
<li>Structure of classes shows each part of the pattern and how they are related.<br>ç±»çš„ç»“æ„æ˜¾ç¤ºäº†æ¨¡å¼çš„æ¯ä¸ªéƒ¨åˆ†ä»¥åŠå®ƒä»¬ä¹‹é—´çš„å…³ç³»ã€‚</li>
<li>Code example in one of the popular programming languages makes it easier to grasp the idea behind the pattern.<br>ä½¿ç”¨ä¸€ç§æµè¡Œçš„ç¼–ç¨‹è¯­è¨€çš„ä»£ç ç¤ºä¾‹å¯ä»¥æ›´å®¹æ˜“åœ°æŒæ¡æ¨¡å¼èƒŒåçš„æ€æƒ³ã€‚</li>
</ul>
<p>Some pattern catalogs list other useful details, such as applicability of the pattern, implementation steps and relations with other patterns.</p>
<p>ä¸€äº›æ¨¡å¼ç›®å½•åˆ—å‡ºäº†å…¶ä»–æœ‰ç”¨çš„ç»†èŠ‚ï¼Œä¾‹å¦‚æ¨¡å¼çš„é€‚ç”¨æ€§ã€å®ç°æ­¥éª¤ä»¥åŠä¸å…¶ä»–æ¨¡å¼çš„å…³ç³»ã€‚</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://tonymistark.github.io/2023/11/02/Ollama-%E5%9C%A8%E6%9C%AC%E5%9C%B0%E5%90%AF%E5%8A%A8%E5%B9%B6%E8%BF%90%E8%A1%8C%E5%A4%A7%E8%AF%AD%E8%A8%80%E6%A8%A1%E5%9E%8B/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Ice">
      <meta itemprop="description" content="å®‰é™åœ°åç€å­¦ä¹ ">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="BLOG">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/11/02/Ollama-%E5%9C%A8%E6%9C%AC%E5%9C%B0%E5%90%AF%E5%8A%A8%E5%B9%B6%E8%BF%90%E8%A1%8C%E5%A4%A7%E8%AF%AD%E8%A8%80%E6%A8%A1%E5%9E%8B/" class="post-title-link" itemprop="url">ä¸€é”®éƒ¨ç½² Ollamaåœ¨æœ¬åœ°å¯åŠ¨å¹¶è¿è¡Œå¤§è¯­è¨€æ¨¡å‹</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2023-11-02 15:13:38" itemprop="dateCreated datePublished" datetime="2023-11-02T15:13:38+08:00">2023-11-02</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2023-11-22 23:21:21" itemprop="dateModified" datetime="2023-11-22T23:21:21+08:00">2023-11-22</time>
              </span>

          <br>
            <span class="post-meta-item" title="Symbols count in article">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">Symbols count in article: </span>
              <span>781</span>
            </span>
            <span class="post-meta-item" title="Reading time">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">Reading time &asymp;</span>
              <span>3 mins.</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt; docker run -d -v ollama:/root/.ollama -p 11434:11434 --name ollama ollama/ollama</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">Unable to find image &#x27;ollama/ollama:latest&#x27; locally</span><br><span class="line">latest: Pulling from ollama/ollama</span><br><span class="line">aece8493d397: Pull complete</span><br><span class="line">4eca1ad9be6c: Pull complete</span><br><span class="line">fcd9fc6db2c0: Pull complete</span><br><span class="line">Digest: sha256:871505ffb1050381f75875a645e7b24c37e1436fc51b915fd91a8ed202583e3b</span><br><span class="line">Status: Downloaded newer image for ollama/ollama:latest</span><br><span class="line">e8291c35ef1f8414f9b8ab008bc3c3523cb7881ad96ccf60745fffb5916e2d9e</span><br><span class="line">&gt; docker exec -it ollama ollama run llama2</span><br><span class="line">pulling manifest</span><br><span class="line">pulling 22f7f8ef5f4c... 100% |â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| (3.8/3.8 GB, 29 MB/s)</span><br><span class="line">pulling 8c17c2ebb0ea... 100% |â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| (7.0/7.0 kB, 3.2 kB/s)</span><br><span class="line">pulling 7c23fb36d801... 100% |â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| (4.8/4.8 kB, 2.0 kB/s)</span><br><span class="line">pulling 2e0493f67d0c... 100% |â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| (59/59 B, 27 B/s)</span><br><span class="line">pulling 2759286baa87... 100% |â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| (105/105 B, 45 B/s)</span><br><span class="line">pulling 5407e3188df9... 100% |â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| (529/529 B, 163 B/s)</span><br><span class="line">verifying sha256 digest</span><br><span class="line">writing manifest</span><br><span class="line">removing any unused layers</span><br><span class="line">success</span><br></pre></td></tr></table></figure>

<blockquote>
<p>whatâ€™s your name?</p>
</blockquote>
<p>Iâ€™m just an AI, I donâ€™t have a personal name. My purpose is to assist and provide information to users like you through text-based conversations. How may I help you today?</p>
<blockquote>
<p>ä½ å«ä»€ä¹ˆï¼Ÿ</p>
</blockquote>
<p>Iâ€™m just an AI, I donâ€™t have a personal name. My purpose is to assist and provide information to users like you through text-based conversations. How may I help you today?</p>
<blockquote>
<p>è¯·å¸®æˆ‘å†™ä¸€æ®µè‡ªæˆ‘ä»‹ç»ï¼Œæˆ‘æ˜¯ä¸€ä¸ªpython     åç«¯ç¨‹åºå‘˜</p>
</blockquote>
<p>Sure, hereâ€™s a simple self-introduction for a Python developer:</p>
<p>â€œHi there! My name is [Your Name], and Iâ€™m a Python developer with [Number of Years] years of experience. I specialize in developing web applications, data analysis, and machine learning models using Python. Iâ€™m passionate about solving complex problems and creating innovative solutions using my technical skills. In my free time, I enjoy learning new technologies and sharing knowledge with the developer community. Letâ€™s connect and work together on exciting projects!â€</p>
<blockquote>
<p> &#x2F;?</p>
</blockquote>
<p>Available Commands:<br>  &#x2F;set         Set session variables<br>  &#x2F;show        Show model information<br>  &#x2F;bye         Exit<br>  &#x2F;?, &#x2F;help    Help for a command</p>
<p>Use <code>&quot;&quot;&quot;</code> to begin a multi-line message.</p>
<blockquote>
<p>&#x2F;show</p>
</blockquote>
<p>Available Commands:<br>  &#x2F;show license      Show model license<br>  &#x2F;show modelfile    Show Modelfile for this model<br>  &#x2F;show parameters   Show parameters for this model<br>  &#x2F;show system       Show system prompt<br>  &#x2F;show template     Show prompt template</p>
<blockquote>
<p> æˆ‘ç°åœ¨æ˜¯åœ¨å‘½ä»¤ è¡Œè¿›è¡Œè¾“å…¥ï¼Œæ€ä¹ˆæ‰èƒ½ è¾“å…¥å¤šè¡Œå‘¢ï¼Ÿ</p>
</blockquote>
<p>Great, you want to input multiple lines of text! In the command line, you can input multiple lines by pressing the <code>Enter</code> key after each line. For example:</p>
<ol>
<li><code>My name is John.</code></li>
<li><code>I&#39;m a Python developer with 5 years of experience.</code></li>
<li><code>I specialize in developing web applications and data analysis using Python.</code></li>
<li><code>In my free time, I enjoy learning new technologies and sharing knowledge with the developer community.</code></li>
</ol>
<p>After each line, press the <code>Enter</code> key to move on to the next line. When youâ€™re finished, you can press <code>Ctrl+D</code> to exit the command prompt.</p>
<blockquote>
<p>å¯ä»¥å¸®æˆ‘å†™ä¸€ä¸ªpythonçš„å†’æ³¡æ’åºå—ï¼Ÿ&#96;</p>
</blockquote>
<p>Of course! Here is an example of a simple bubble sort algorithm written in Python:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">bubble_sort</span>(<span class="params">arr</span>):</span><br><span class="line">    n = <span class="built_in">len</span>(arr)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n-<span class="number">1</span>):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, n-i-<span class="number">1</span>):</span><br><span class="line">            <span class="keyword">if</span> arr[j] &gt; arr[j+<span class="number">1</span>]:</span><br><span class="line">                arr[j], arr[j+<span class="number">1</span>] = arr[j+<span class="number">1</span>], arr[j]</span><br><span class="line">    <span class="keyword">return</span> arr</span><br></pre></td></tr></table></figure>
<p>This algorithm takes an array as input and sorts it using the bubble sort algorithm. It works by repeatedly iterating over the array, comparing adjacent elements, and swapping them if they are in the wrong order. The <code>range()</code> function is used to generate the loop indices for the iteration.</p>
<p>Hereâ€™s an example of how you could use this function:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">arr = [<span class="number">5</span>, <span class="number">2</span>, <span class="number">7</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">4</span>]</span><br><span class="line"><span class="built_in">print</span>(bubble_sort(arr))</span><br></pre></td></tr></table></figure>
<p>This would output the sorted array <code>[1, 2, 3, 4, 5, 7]</code>.</p>
<p>Keep in mind that this is a very basic implementation of bubble sort, and it has a time complexity of O(n^2), which means it can take a long time to sort large arrays. There are more efficient algorithms for sorting large arrays, such as quicksort or mergesort.</p>
<blockquote>
<p>ä½ å¯ä»¥ç”¨ä¸­æ–‡å›ç­”æˆ‘å—ï¼Ÿ</p>
</blockquote>
<p>Of course! I can answer in Chinese if youâ€™d like. Here is the same information in Chinese:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">æ³¡æ²«æ’åº</span>(<span class="params">arr</span>):</span><br><span class="line">    n = <span class="built_in">len</span>(arr)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n-<span class="number">1</span>):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, n-i-<span class="number">1</span>):</span><br><span class="line">            <span class="keyword">if</span> arr[j] &gt; arr[j+<span class="number">1</span>]:</span><br><span class="line">                arr[j], arr[j+<span class="number">1</span>] = arr[j+<span class="number">1</span>], arr[j]</span><br><span class="line">    <span class="keyword">return</span> arr</span><br></pre></td></tr></table></figure>
<p>è¯·ä½¿ç”¨ä»¥ä¸Šå‡½æ•°æ¥æ’åºä¸€ä¸ªæ•°ç»„ã€‚ä¾‹å¦‚ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">arr = [<span class="number">5</span>, <span class="number">2</span>, <span class="number">7</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">4</span>]</span><br><span class="line"><span class="built_in">print</span>(æ³¡æ²«æ’åº(arr))</span><br></pre></td></tr></table></figure>
<p>è¿™å°†è¾“å‡ºæ’åºåçš„æ•°ç»„ <code>[1, 2, 3, 4, 5, 7]</code>.</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/6/">6</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Ice</p>
  <div class="site-description" itemprop="description">å®‰é™åœ°åç€å­¦ä¹ </div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">59</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">6</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">7</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/TonyMistark" title="GitHub â†’ https:&#x2F;&#x2F;github.com&#x2F;TonyMistark" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://gitee.com/Micestark" title="Gitee â†’ https:&#x2F;&#x2F;gitee.com&#x2F;Micestark" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>Gitee</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:tony_mistark@163.com" title="E-Mail â†’ mailto:tony_mistark@163.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://twitter.com/Tony_Mistark" title="Twitter â†’ https:&#x2F;&#x2F;twitter.com&#x2F;Tony_Mistark" rel="noopener" target="_blank"><i class="fab fa-twitter fa-fw"></i>Twitter</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Ice</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-area"></i>
    </span>
    <span title="Symbols count total">66k</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="Reading time total">4:01</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a>
  </div>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="Total Visitors">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="Total Views">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/medium-zoom@1/dist/medium-zoom.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  


</body>
</html>
