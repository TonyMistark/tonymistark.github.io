<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"tonymistark.github.io","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":true,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":true,"preload":true},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="安静地坐着学习">
<meta property="og:type" content="website">
<meta property="og:title" content="BLOG">
<meta property="og:url" content="https://tonymistark.github.io/index.html">
<meta property="og:site_name" content="BLOG">
<meta property="og:description" content="安静地坐着学习">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="Ice">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://tonymistark.github.io/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'en'
  };
</script>

  <title>BLOG</title>
  
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-W6L4L92Z6Z"></script>
    <script>
      if (CONFIG.hostname === location.hostname) {
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-W6L4L92Z6Z');
      }
    </script>


  <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?99c70b2174a7fbe4af476f28bafb19a3";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>




  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

<link rel="alternate" href="/./atom.xml" title="BLOG" type="application/atom+xml">
<link rel="alternate" href="/./rss2.xml" title="BLOG" type="application/rss+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">BLOG</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">用心记录思想</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
        <li class="menu-item menu-item-sitemap">

    <a href="/sitemap.xml" rel="section"><i class="fa fa-sitemap fa-fw"></i>Sitemap</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://tonymistark.github.io/2024/02/03/design-pattern/chain-of-responsibility/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Ice">
      <meta itemprop="description" content="安静地坐着学习">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="BLOG">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2024/02/03/design-pattern/chain-of-responsibility/" class="post-title-link" itemprop="url">Chain of Responsibility 责任链</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2024-02-03 13:49:38 / Modified: 21:14:43" itemprop="dateCreated datePublished" datetime="2024-02-03T13:49:38+08:00">2024-02-03</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/design-pattern/" itemprop="url" rel="index"><span itemprop="name">design-pattern</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="Symbols count in article">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">Symbols count in article: </span>
              <span>5.1k</span>
            </span>
            <span class="post-meta-item" title="Reading time">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">Reading time &asymp;</span>
              <span>19 mins.</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="意图"><a href="#意图" class="headerlink" title="意图"></a>意图</h2><p>Chain of Responsibility是一种行为设计模式，它允许您沿着处理程序链沿着传递请求。在接收到请求时，每个处理程序决定是处理请求还是将其传递给链中的下一个处理程序。</p>
<div align="center"> <img src="/images/chain-of-responsibility-header.png"/></div>


<h2 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h2><p>假设你正在开发一个在线订购系统。您希望限制对系统的访问，以便只有经过身份验证的用户才能创建订单。此外，具有管理权限的用户必须对所有订单具有完全访问权限。</p>
<p>经过一段时间的规划后，您意识到这些检查必须按顺序执行。每当应用程序收到包含用户凭据的请求时，它都可以尝试向系统验证用户的身份。但是，如果这些凭据不正确并且身份验证失败，则没有理由继续进行任何其他检查。</p>
<div align="center"> <img src="/images/responsibilty-problem1.png"/>请求必须通过一系列检查，然后订购系统才能处理它。</div>


<p>在接下来的几个月里，您又实现了几个这样的顺序检查。</p>
<ul>
<li>您的一位同事建议将原始数据直接传递到订购系统是不安全的。因此，您添加了一个额外的验证步骤来清理请求中的数据。</li>
<li>后来，有人注意到，该系统是脆弱的暴力破解密码。为了消除这种情况，您立即添加了一个检查，该检查过滤来自同一IP地址的重复失败请求。</li>
<li>还有人建议，可以通过返回包含相同数据的重复请求的缓存结果来加快系统速度。因此，您添加了另一个检查，仅当没有合适的缓存响应时，才允许请求通过系统。</li>
</ul>
<div align="center"> <img src="/images/responsibility-problem2.png"/>代码越庞杂，就越混乱。</div>


<p>检查的代码本来看起来就很混乱，随着您添加每个新特性，它变得越来越臃肿。更改一张支票有时会影响其他支票。最糟糕的是，当您试图重用检查来保护系统的其他组件时，您不得不复制一些代码，因为这些组件需要一些检查，但不是所有检查。</p>
<p>这个系统变得很难理解，维护起来也很昂贵。你在代码上挣扎了一段时间，直到有一天你决定重构整个代码。</p>
<h2 id="溶液"><a href="#溶液" class="headerlink" title="溶液"></a>溶液</h2><p>与许多其他行为设计模式一样，责任链依赖于将特定行为转换为称为处理程序的独立对象。在我们的例子中，每个检查都应该被提取到它自己的类中，并使用一个执行检查的方法。请求沿着数据作为参数传递给此方法。</p>
<p>该模式建议您将这些处理程序链接成一个链。每个链接的处理程序都有一个字段，用于存储对链中下一个处理程序的引用。除了处理请求之外，处理程序还将请求进一步沿着链传递。请求沿着链传递，直到所有处理程序都有机会处理它。</p>
<p>这里是最好的部分：处理程序可以决定不将请求进一步向下传递，并有效地停止任何进一步的处理。</p>
<p>在我们的订单系统示例中，处理程序执行处理，然后决定是否将请求进一步向下传递。假设请求包含正确的数据，所有处理程序都可以执行其主要行为，无论是身份验证检查还是缓存。</p>
<div align="center"> <img src="/images/responsibility-solution1-en.png"/>把手一个接一个地排列，形成一条链条。</div>


<p>然而，还有一种稍微不同的方法（它更规范一点），在这种方法中，在接收到请求时，处理程序决定它是否可以处理它。如果可以，它就不再传递请求。因此，要么只有一个处理程序处理请求，要么根本没有处理程序。这种方法在处理图形用户界面中的元素堆栈中的事件时非常常见。</p>
<p>例如，当用户单击按钮时，事件将通过GUI元素链传播，该元素链从按钮开始，沿着其容器（如窗体或面板）传播，最后到达主应用程序窗口。事件由链中能够处理它的第一个元素处理。这个例子也值得注意，因为它表明链总是可以从对象树中提取。</p>
<div align="center"> <img src="/images/responsibility-solution2.png"/>链可以由对象树的分支形成。</div>


<p>所有的处理程序类实现相同的接口是至关重要的。每个具体的处理程序应该只关心下面的一个具有 所有的处理程序类实现相同的接口是至关重要的。每个具体的处理程序应该只关心下面的一个具有 <code>execute</code> 方法的处理程序。通过这种方式，您可以在运行时使用各种处理程序组合链，而无需将代码耦合到它们的具体类。 方法的处理程序。通过这种方式，您可以在运行时使用各种处理程序组合链，而无需将代码耦合到它们的具体类。</p>
<h2 id="结构"><a href="#结构" class="headerlink" title="结构"></a>结构</h2><div align="center"> <img src="/images/responsibility-structure.png"/></div>


<ol>
<li><p>该函数声明了接口，对所有具体处理程序都是通用的。它通常只包含一个处理请求的方法，但有时它也可能有另一个方法来设置链上的下一个处理程序。</p>
</li>
<li><p>BaseHandler是一个可选类，您可以在其中放置所有处理程序类通用的样板代码。</p>
<p>通常，这个类定义一个字段来存储对下一个处理程序的引用。客户端可以通过将处理程序传递给前一个处理程序的构造函数或setter来构建链。类也可以实现默认的处理行为：它可以在检查其存在之后将执行传递给下一个处理程序。</p>
</li>
<li><p>具体处理程序包含处理请求的实际代码。在接收到一个请求后，每个处理程序必须决定是否处理它，另外，是否沿着链沿着它。</p>
<p>处理程序通常是自包含的和不可变的，通过构造函数只接受一次所有必要的数据。</p>
</li>
<li><p>客户端可以只组合一次链，也可以动态组合它们，这取决于应用程序的逻辑。请注意，请求可以发送到链中的任何处理程序-它不必是第一个。</p>
</li>
</ol>
<h2 id="伪代码"><a href="#伪代码" class="headerlink" title="伪代码"></a>伪代码</h2><p>在本例中，责任链模式负责显示活动GUI元素的上下文帮助信息。</p>
<div align="center"> <img src="/images/responsibility-example1.png"/>GUI类是用Composite模式构建的。每个元素都链接到它的容器元素。在任何时候，您都可以构建一个元素链，该元素链从元素本身开始，遍历它的所有容器元素。</div>


<p>应用程序的GUI通常被构造为对象树。例如，呈现应用程序主窗口的 <code>Dialog</code> 类将是对象树的根。对话框包含 <code>Panels</code> ，它可能包含其他面板或简单的低级元素，如 <code>Buttons</code> 和 <code>TextFields</code> 。</p>
<p>一个简单的组件可以显示简短的上下文工具提示，只要该组件有一些帮助文本分配。但更复杂的组件定义了自己显示上下文帮助的方式，例如显示手册摘录或在浏览器中打开页面。responsibility-example2</p>
<div align="center"> <img src="/images/responsibility-solution2.png"/>这就是帮助请求遍历GUI对象的方式。</div>


<p>当用户将鼠标光标指向某个元素并按下 当用户将鼠标光标指向某个元素并按下 <code>F1</code> 键时，应用程序将检测指针下的组件并向其发送帮助请求。该请求将在元素的所有容器中冒泡，直到到达能够显示帮助信息的元素。 键时，应用程序将检测指针下的组件并向其发送帮助请求。该请求将在元素的所有容器中冒泡，直到到达能够显示帮助信息的元素。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// The handler interface declares a method for executing a</span></span><br><span class="line"><span class="comment">// request.</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">ComponentWithContextualHelp</span> is</span><br><span class="line">    method <span class="title function_">showHelp</span><span class="params">()</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// The base class for simple components.</span></span><br><span class="line"><span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">Component</span> <span class="keyword">implements</span> <span class="title class_">ComponentWithContextualHelp</span> is</span><br><span class="line">    field tooltipText: string</span><br><span class="line"></span><br><span class="line">    <span class="comment">// The component&#x27;s container acts as the next link in the</span></span><br><span class="line">    <span class="comment">// chain of handlers.</span></span><br><span class="line">    <span class="keyword">protected</span> field container: Container</span><br><span class="line"></span><br><span class="line">    <span class="comment">// The component shows a tooltip if there&#x27;s help text</span></span><br><span class="line">    <span class="comment">// assigned to it. Otherwise it forwards the call to the</span></span><br><span class="line">    <span class="comment">// container, if it exists.</span></span><br><span class="line">    method <span class="title function_">showHelp</span><span class="params">()</span> is</span><br><span class="line">        <span class="title function_">if</span> <span class="params">(tooltipText != <span class="literal">null</span>)</span></span><br><span class="line">            <span class="comment">// Show tooltip.</span></span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            container.showHelp()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// Containers can contain both simple components and other</span></span><br><span class="line"><span class="comment">// containers as children. The chain relationships are</span></span><br><span class="line"><span class="comment">// established here. The class inherits showHelp behavior from</span></span><br><span class="line"><span class="comment">// its parent.</span></span><br><span class="line"><span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">Container</span> <span class="keyword">extends</span> <span class="title class_">Component</span> is</span><br><span class="line">    <span class="keyword">protected</span> field children: array of Component</span><br><span class="line"></span><br><span class="line">    method <span class="title function_">add</span><span class="params">(child)</span> is</span><br><span class="line">        children.add(child)</span><br><span class="line">        child.container = <span class="built_in">this</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// Primitive components may be fine with default help</span></span><br><span class="line"><span class="comment">// implementation...</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Button</span> <span class="keyword">extends</span> <span class="title class_">Component</span> is</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// But complex components may override the default</span></span><br><span class="line"><span class="comment">// implementation. If the help text can&#x27;t be provided in a new</span></span><br><span class="line"><span class="comment">// way, the component can always call the base implementation</span></span><br><span class="line"><span class="comment">// (see Component class).</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Panel</span> <span class="keyword">extends</span> <span class="title class_">Container</span> is</span><br><span class="line">    field modalHelpText: string</span><br><span class="line"></span><br><span class="line">    method <span class="title function_">showHelp</span><span class="params">()</span> is</span><br><span class="line">        <span class="title function_">if</span> <span class="params">(modalHelpText != <span class="literal">null</span>)</span></span><br><span class="line">            <span class="comment">// Show a modal window with the help text.</span></span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            <span class="built_in">super</span>.showHelp()</span><br><span class="line"></span><br><span class="line"><span class="comment">// ...same as above...</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Dialog</span> <span class="keyword">extends</span> <span class="title class_">Container</span> is</span><br><span class="line">    field wikiPageURL: string</span><br><span class="line"></span><br><span class="line">    method <span class="title function_">showHelp</span><span class="params">()</span> is</span><br><span class="line">        <span class="title function_">if</span> <span class="params">(wikiPageURL != <span class="literal">null</span>)</span></span><br><span class="line">            <span class="comment">// Open the wiki help page.</span></span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            <span class="built_in">super</span>.showHelp()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// Client code.</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Application</span> is</span><br><span class="line">    <span class="comment">// Every application configures the chain differently.</span></span><br><span class="line">    method <span class="title function_">createUI</span><span class="params">()</span> <span class="type">is</span></span><br><span class="line">        <span class="variable">dialog</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Dialog</span>(<span class="string">&quot;Budget Reports&quot;</span>)</span><br><span class="line">        dialog.wikiPageURL = <span class="string">&quot;http://...&quot;</span></span><br><span class="line">        panel = <span class="keyword">new</span> <span class="title class_">Panel</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">400</span>, <span class="number">800</span>)</span><br><span class="line">        panel.modalHelpText = <span class="string">&quot;This panel does...&quot;</span></span><br><span class="line">        ok = <span class="keyword">new</span> <span class="title class_">Button</span>(<span class="number">250</span>, <span class="number">760</span>, <span class="number">50</span>, <span class="number">20</span>, <span class="string">&quot;OK&quot;</span>)</span><br><span class="line">        ok.tooltipText = <span class="string">&quot;This is an OK button that...&quot;</span></span><br><span class="line">        cancel = <span class="keyword">new</span> <span class="title class_">Button</span>(<span class="number">320</span>, <span class="number">760</span>, <span class="number">50</span>, <span class="number">20</span>, <span class="string">&quot;Cancel&quot;</span>)</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">        panel.add(ok)</span><br><span class="line">        panel.add(cancel)</span><br><span class="line">        dialog.add(panel)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Imagine what happens here.</span></span><br><span class="line">    method <span class="title function_">onF1KeyPress</span><span class="params">()</span> <span class="type">is</span></span><br><span class="line">        <span class="variable">component</span> <span class="operator">=</span> <span class="built_in">this</span>.getComponentAtMouseCoords()</span><br><span class="line">        component.showHelp()</span><br></pre></td></tr></table></figure>

<h2 id="适用性"><a href="#适用性" class="headerlink" title="适用性"></a>适用性</h2><ul>
<li><strong>当你的程序需要以不同的方式处理不同类型的请求，但请求的确切类型和它们的顺序事先是未知的时，请使用责任链模式。</strong></li>
<li>该模式允许您将多个处理程序链接到一个链中，并在收到请求时“询问”每个处理程序是否可以处理该请求。</li>
<li><strong>当必须以特定顺序执行多个处理程序时，请使用该模式。</strong></li>
<li>由于您可以以任何顺序链接链中的处理程序，因此所有请求都将完全按照您的计划通过链。</li>
<li>当处理程序集及其顺序应该在运行时更改时，请使用CoR模式。</li>
<li>如果在处理程序类中为引用字段提供setter，则可以动态地插入、删除或重新排序处理程序。</li>
</ul>
<h2 id="如何实现"><a href="#如何实现" class="headerlink" title="如何实现"></a>如何实现</h2><ol>
<li><p>描述处理程序接口并描述处理请求的方法的签名。</p>
<p>决定客户端如何将请求数据传递到方法中。最灵活的方法是将请求转换为对象，并将其作为参数传递给处理方法。</p>
</li>
<li><p>为了消除具体处理程序中重复的样板代码，可能需要创建一个从处理程序接口派生的抽象基处理程序类。</p>
<p>这个类应该有一个字段来存储对链中下一个处理程序的引用。考虑使类不可变。但是，如果您计划在运行时修改链，则需要定义一个setter来更改引用字段的值。</p>
<p>您还可以为处理方法实现方便的默认行为，即将请求转发到下一个对象，除非没有对象了。具体处理程序将能够通过调用父方法来使用此行为。</p>
</li>
<li><p>逐个创建具体的处理程序子类并实现它们的处理方法。每个处理程序在接收请求时应该做出两个决定：</p>
<ul>
<li>它是否会处理请求。</li>
<li>它是否会沿着链沿着传递请求。</li>
</ul>
</li>
<li><p>客户端可以自行组装链，也可以从其他对象接收预构建的链。在后一种情况下，您必须实现一些工厂类来根据配置或环境设置构建链</p>
</li>
<li><p>客户端可以触发链中的任何处理程序，而不仅仅是第一个。请求将沿着链传递，直到某个处理程序拒绝进一步传递它，或者直到它到达链的末端。</p>
</li>
<li><p>由于链的动态特性，客户端应该准备好处理以下场景：</p>
<ul>
<li>链条可以由单个链环组成。</li>
<li>有些请求可能无法到达链的末端。</li>
<li>其他人可能会到达链条的末端。</li>
</ul>
</li>
</ol>
<h2 id="利弊"><a href="#利弊" class="headerlink" title="利弊"></a>利弊</h2><table>
<thead>
<tr>
<th>√ 利</th>
<th>× 弊</th>
</tr>
</thead>
<tbody><tr>
<td>您可以控制请求处理的顺序。</td>
<td>有些请求可能最终无法处理。</td>
</tr>
<tr>
<td>单一责任原则。可以将调用操作的类与执行操作的类解耦。</td>
<td></td>
</tr>
<tr>
<td>开放&#x2F;封闭原则。您可以在应用程序中引入新的处理程序，而不会破坏现有的客户端代码。</td>
<td></td>
</tr>
</tbody></table>
<h2 id="与其他模式的关系"><a href="#与其他模式的关系" class="headerlink" title="与其他模式的关系"></a>与其他模式的关系</h2><ul>
<li><p>责任链、命令、调解器和观察者解决了连接请求的接收者和接收者的各种方式：</p>
<ul>
<li>责任链（Chain of Responsibility）将请求顺序地沿着一个动态的潜在接收者链传递，直到其中一个接收者处理它。</li>
<li>命令在中继器和接收器之间建立单向连接。</li>
<li>Mediator消除了发送者和接收者之间的直接连接，迫使它们通过Mediator对象间接通信。</li>
<li>观察者允许接收者动态订阅和取消订阅接收请求。</li>
</ul>
</li>
<li><p>责任链通常与复合一起使用。在这种情况下，当一个叶组件收到一个请求时，它可以通过所有父组件的链将其传递到对象树的根。</p>
</li>
<li><p>责任链中的处理程序可以作为命令实现。在这种情况下，您可以对同一个上下文对象（由请求表示）执行许多不同的操作。</p>
<p>然而，还有另一种方法，其中请求本身是一个Command对象。在这种情况下，您可以在链接成链的一系列不同上下文中执行相同的操作。</p>
</li>
<li><p>Chain of Responsibility和Decorator具有非常相似的类结构。这两种模式都依赖于递归组合来通过一系列对象传递执行。然而，有几个关键的区别。</p>
<p>CoR处理程序可以彼此独立地执行任意操作。他们也可以在任何时候停止进一步传递请求。另一方面，各种装饰器可以扩展对象的行为，同时保持它与基接口的一致性。此外，装饰器不允许中断请求流。</p>
</li>
</ul>
<h1 id="Python中的责任链"><a href="#Python中的责任链" class="headerlink" title="Python中的责任链"></a>Python中的责任链</h1><p>责任链是一种行为设计模式，它允许沿着潜在处理程序链传递请求，直到其中一个处理请求。</p>
<p>该模式允许多个对象处理请求，而无需将发送方类耦合到接收方的具体类。链可以在运行时动态地与遵循标准处理程序接口的任何处理程序组合。</p>
<h2 id="概念示例"><a href="#概念示例" class="headerlink" title="概念示例"></a>概念示例</h2><p>这个例子说明了责任链设计模式的结构。它侧重于回答这些问题：</p>
<ul>
<li>它由哪些类组成？</li>
<li>这些班级扮演什么角色？</li>
<li>模式中的元素是以什么方式联系在一起的？</li>
</ul>
<h4 id="main-py：概念性示例"><a href="#main-py：概念性示例" class="headerlink" title="main.py：概念性示例"></a>main.py：概念性示例</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> __future__ <span class="keyword">import</span> annotations</span><br><span class="line"><span class="keyword">from</span> abc <span class="keyword">import</span> ABC, abstractmethod</span><br><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">Any</span>, <span class="type">Optional</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Handler</span>(<span class="title class_ inherited__">ABC</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    The Handler interface declares a method for building the chain of handlers.</span></span><br><span class="line"><span class="string">    It also declares a method for executing a request.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">    @abstractmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">set_next</span>(<span class="params">self, handler: Handler</span>) -&gt; Handler:</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="meta">    @abstractmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">handle</span>(<span class="params">self, request</span>) -&gt; <span class="type">Optional</span>[<span class="built_in">str</span>]:</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">AbstractHandler</span>(<span class="title class_ inherited__">Handler</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    The default chaining behavior can be implemented inside a base handler</span></span><br><span class="line"><span class="string">    class.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    _next_handler: Handler = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">set_next</span>(<span class="params">self, handler: Handler</span>) -&gt; Handler:</span><br><span class="line">        self._next_handler = handler</span><br><span class="line">        <span class="comment"># Returning a handler from here will let us link handlers in a</span></span><br><span class="line">        <span class="comment"># convenient way like this:</span></span><br><span class="line">        <span class="comment"># monkey.set_next(squirrel).set_next(dog)</span></span><br><span class="line">        <span class="keyword">return</span> handler</span><br><span class="line"></span><br><span class="line"><span class="meta">    @abstractmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">handle</span>(<span class="params">self, request: <span class="type">Any</span></span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">        <span class="keyword">if</span> self._next_handler:</span><br><span class="line">            <span class="keyword">return</span> self._next_handler.handle(request)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">All Concrete Handlers either handle a request or pass it to the next handler in</span></span><br><span class="line"><span class="string">the chain.</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MonkeyHandler</span>(<span class="title class_ inherited__">AbstractHandler</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">handle</span>(<span class="params">self, request: <span class="type">Any</span></span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">        <span class="keyword">if</span> request == <span class="string">&quot;Banana&quot;</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">f&quot;Monkey: I&#x27;ll eat the <span class="subst">&#123;request&#125;</span>&quot;</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">super</span>().handle(request)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SquirrelHandler</span>(<span class="title class_ inherited__">AbstractHandler</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">handle</span>(<span class="params">self, request: <span class="type">Any</span></span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">        <span class="keyword">if</span> request == <span class="string">&quot;Nut&quot;</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">f&quot;Squirrel: I&#x27;ll eat the <span class="subst">&#123;request&#125;</span>&quot;</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">super</span>().handle(request)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">DogHandler</span>(<span class="title class_ inherited__">AbstractHandler</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">handle</span>(<span class="params">self, request: <span class="type">Any</span></span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">        <span class="keyword">if</span> request == <span class="string">&quot;MeatBall&quot;</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">f&quot;Dog: I&#x27;ll eat the <span class="subst">&#123;request&#125;</span>&quot;</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">super</span>().handle(request)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">client_code</span>(<span class="params">handler: Handler</span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    The client code is usually suited to work with a single handler. In most</span></span><br><span class="line"><span class="string">    cases, it is not even aware that the handler is part of a chain.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> food <span class="keyword">in</span> [<span class="string">&quot;Nut&quot;</span>, <span class="string">&quot;Banana&quot;</span>, <span class="string">&quot;Cup of coffee&quot;</span>]:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;\nClient: Who wants a <span class="subst">&#123;food&#125;</span>?&quot;</span>)</span><br><span class="line">        result = handler.handle(food)</span><br><span class="line">        <span class="keyword">if</span> result:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;  <span class="subst">&#123;result&#125;</span>&quot;</span>, end=<span class="string">&quot;&quot;</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;  <span class="subst">&#123;food&#125;</span> was left untouched.&quot;</span>, end=<span class="string">&quot;&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    monkey = MonkeyHandler()</span><br><span class="line">    squirrel = SquirrelHandler()</span><br><span class="line">    dog = DogHandler()</span><br><span class="line"></span><br><span class="line">    monkey.set_next(squirrel).set_next(dog)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># The client should be able to send a request to any handler, not just the</span></span><br><span class="line">    <span class="comment"># first one in the chain.</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Chain: Monkey &gt; Squirrel &gt; Dog&quot;</span>)</span><br><span class="line">    client_code(monkey)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;\n&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Subchain: Squirrel &gt; Dog&quot;</span>)</span><br><span class="line">    client_code(squirrel)</span><br></pre></td></tr></table></figure>

<h4 id="Output-txt：执行结果"><a href="#Output-txt：执行结果" class="headerlink" title="Output.txt：执行结果"></a>Output.txt：执行结果</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">Chain: Monkey &gt; Squirrel &gt; Dog</span><br><span class="line"></span><br><span class="line">Client: Who wants a Nut?</span><br><span class="line">  Squirrel: I&#x27;ll eat the Nut</span><br><span class="line">Client: Who wants a Banana?</span><br><span class="line">  Monkey: I&#x27;ll eat the Banana</span><br><span class="line">Client: Who wants a Cup of coffee?</span><br><span class="line">  Cup of coffee was left untouched.</span><br><span class="line"></span><br><span class="line">Subchain: Squirrel &gt; Dog</span><br><span class="line"></span><br><span class="line">Client: Who wants a Nut?</span><br><span class="line">  Squirrel: I&#x27;ll eat the Nut</span><br><span class="line">Client: Who wants a Banana?</span><br><span class="line">  Banana was left untouched.</span><br><span class="line">Client: Who wants a Cup of coffee?</span><br><span class="line">  Cup of coffee was left untouched.</span><br></pre></td></tr></table></figure>

<h1 id="Rust中的责任链"><a href="#Rust中的责任链" class="headerlink" title="Rust中的责任链"></a>Rust中的责任链</h1><p>责任链是一种行为设计模式，它允许沿着潜在处理程序链传递请求，直到其中一个处理请求。</p>
<p>该模式允许多个对象处理请求，而无需将发送方类耦合到接收方的具体类。链可以在运行时动态地与遵循标准处理程序接口的任何处理程序组合。</p>
<h2 id="概念示例-1"><a href="#概念示例-1" class="headerlink" title="概念示例"></a>概念示例</h2><p>该示例演示了如何通过一系列部门处理患者。责任链的构成如下：</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Patient <span class="punctuation">-&gt;</span> Reception <span class="punctuation">-&gt;</span> Doctor <span class="punctuation">-&gt;</span> Medical <span class="punctuation">-&gt;</span> Cashier</span><br></pre></td></tr></table></figure>

<p>链是使用 链是使用 <code>Box</code> 指针构建的，这意味着在运行时动态分派。为什么？为什么？使用泛型将实现缩小到严格的编译时类型似乎相当困难：为了构造一个完整链的类型，Rust需要完全了解链中的“下一个”链接。因此，它看起来像这样： 指针构建的，这意味着在运行时动态分派。为什么？为什么？使用泛型将实现缩小到严格的编译时类型似乎相当困难：为了构造一个完整链的类型，Rust需要完全了解链中的“下一个”链接。因此，它看起来像这样：</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">reception</span> = Reception::&lt;Doctor::&lt;Medical::&lt;Cashier&gt;&gt;&gt;::<span class="title function_ invoke__">new</span>(doctor); <span class="comment">// 😱</span></span><br></pre></td></tr></table></figure>

<p>相反， 相反， <code>Box</code> 允许以任何组合进行链接： 允许以任何组合进行链接：</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">reception</span> = Reception::<span class="title function_ invoke__">new</span>(doctor); <span class="comment">// 👍</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">reception</span> = Reception::<span class="title function_ invoke__">new</span>(cashier); <span class="comment">// 🕵️‍♀️</span></span><br></pre></td></tr></table></figure>

<h4 id="patient-rs-Request"><a href="#patient-rs-Request" class="headerlink" title="patient.rs: Request"></a><strong>patient.rs:</strong> Request</h4><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#[derive(Default)]</span></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">struct</span> <span class="title class_">Patient</span> &#123;</span><br><span class="line">    <span class="keyword">pub</span> name: <span class="type">String</span>,</span><br><span class="line">    <span class="keyword">pub</span> registration_done: <span class="type">bool</span>,</span><br><span class="line">    <span class="keyword">pub</span> doctor_check_up_done: <span class="type">bool</span>,</span><br><span class="line">    <span class="keyword">pub</span> medicine_done: <span class="type">bool</span>,</span><br><span class="line">    <span class="keyword">pub</span> payment_done: <span class="type">bool</span>,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="department-rs-Handlers"><a href="#department-rs-Handlers" class="headerlink" title="department.rs: Handlers"></a><strong>department.rs:</strong> Handlers</h4><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">mod</span> cashier;</span><br><span class="line"><span class="keyword">mod</span> doctor;</span><br><span class="line"><span class="keyword">mod</span> medical;</span><br><span class="line"><span class="keyword">mod</span> reception;</span><br><span class="line"></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">use</span> cashier::Cashier;</span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">use</span> doctor::Doctor;</span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">use</span> medical::Medical;</span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">use</span> reception::Reception;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> crate::patient::Patient;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// A single role of objects that make up a chain.</span></span><br><span class="line"><span class="comment">/// A typical trait implementation must have `handle` and `next` methods,</span></span><br><span class="line"><span class="comment">/// while `execute` is implemented by default and contains a proper chaining</span></span><br><span class="line"><span class="comment">/// logic.</span></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">trait</span> <span class="title class_">Department</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">execute</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>, patient: &amp;<span class="keyword">mut</span> Patient) &#123;</span><br><span class="line">        <span class="keyword">self</span>.<span class="title function_ invoke__">handle</span>(patient);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">let</span> <span class="variable">Some</span>(next) = &amp;<span class="keyword">mut</span> <span class="keyword">self</span>.<span class="title function_ invoke__">next</span>() &#123;</span><br><span class="line">            next.<span class="title function_ invoke__">execute</span>(patient);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">handle</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>, patient: &amp;<span class="keyword">mut</span> Patient);</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">next</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>) <span class="punctuation">-&gt;</span> &amp;<span class="keyword">mut</span> <span class="type">Option</span>&lt;<span class="type">Box</span>&lt;<span class="keyword">dyn</span> Department&gt;&gt;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// Helps to wrap an object into a boxed type.</span></span><br><span class="line"><span class="title function_ invoke__">pub</span>(<span class="keyword">self</span>) <span class="keyword">fn</span> <span class="title function_">into_next</span>(</span><br><span class="line">    department: <span class="keyword">impl</span> <span class="title class_">Department</span> + <span class="built_in">Sized</span> + <span class="symbol">&#x27;static</span>,</span><br><span class="line">) <span class="punctuation">-&gt;</span> <span class="type">Option</span>&lt;<span class="type">Box</span>&lt;<span class="keyword">dyn</span> Department&gt;&gt; &#123;</span><br><span class="line">    <span class="title function_ invoke__">Some</span>(<span class="type">Box</span>::<span class="title function_ invoke__">new</span>(department))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="department-cashier-rs"><a href="#department-cashier-rs" class="headerlink" title="department&#x2F;cashier.rs"></a><strong>department&#x2F;cashier.rs</strong></h4><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> super::&#123;Department, Patient&#125;;</span><br><span class="line"></span><br><span class="line"><span class="meta">#[derive(Default)]</span></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">struct</span> <span class="title class_">Cashier</span> &#123;</span><br><span class="line">    next: <span class="type">Option</span>&lt;<span class="type">Box</span>&lt;<span class="keyword">dyn</span> Department&gt;&gt;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">Department</span> <span class="keyword">for</span> <span class="title class_">Cashier</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">handle</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>, patient: &amp;<span class="keyword">mut</span> Patient) &#123;</span><br><span class="line">        <span class="keyword">if</span> patient.payment_done &#123;</span><br><span class="line">            <span class="built_in">println!</span>(<span class="string">&quot;Payment done&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="built_in">println!</span>(<span class="string">&quot;Cashier getting money from a patient &#123;&#125;&quot;</span>, patient.name);</span><br><span class="line">            patient.payment_done = <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">next</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>) <span class="punctuation">-&gt;</span> &amp;<span class="keyword">mut</span> <span class="type">Option</span>&lt;<span class="type">Box</span>&lt;<span class="keyword">dyn</span> Department&gt;&gt; &#123;</span><br><span class="line">        &amp;<span class="keyword">mut</span> <span class="keyword">self</span>.next</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="department-doctor-rs"><a href="#department-doctor-rs" class="headerlink" title="department&#x2F;doctor.rs"></a><strong>department&#x2F;doctor.rs</strong></h4><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> super::&#123;into_next, Department, Patient&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">struct</span> <span class="title class_">Doctor</span> &#123;</span><br><span class="line">    next: <span class="type">Option</span>&lt;<span class="type">Box</span>&lt;<span class="keyword">dyn</span> Department&gt;&gt;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">Doctor</span> &#123;</span><br><span class="line">    <span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">new</span>(next: <span class="keyword">impl</span> <span class="title class_">Department</span> + <span class="symbol">&#x27;static</span>) <span class="punctuation">-&gt;</span> <span class="keyword">Self</span> &#123;</span><br><span class="line">        <span class="keyword">Self</span> &#123;</span><br><span class="line">            next: <span class="title function_ invoke__">into_next</span>(next),</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">Department</span> <span class="keyword">for</span> <span class="title class_">Doctor</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">handle</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>, patient: &amp;<span class="keyword">mut</span> Patient) &#123;</span><br><span class="line">        <span class="keyword">if</span> patient.doctor_check_up_done &#123;</span><br><span class="line">            <span class="built_in">println!</span>(<span class="string">&quot;A doctor checkup is already done&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="built_in">println!</span>(<span class="string">&quot;Doctor checking a patient &#123;&#125;&quot;</span>, patient.name);</span><br><span class="line">            patient.doctor_check_up_done = <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">next</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>) <span class="punctuation">-&gt;</span> &amp;<span class="keyword">mut</span> <span class="type">Option</span>&lt;<span class="type">Box</span>&lt;<span class="keyword">dyn</span> Department&gt;&gt; &#123;</span><br><span class="line">        &amp;<span class="keyword">mut</span> <span class="keyword">self</span>.next</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="department-medical-rs"><a href="#department-medical-rs" class="headerlink" title="department&#x2F;medical.rs"></a><strong>department&#x2F;medical.rs</strong></h4><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> super::&#123;into_next, Department, Patient&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">struct</span> <span class="title class_">Medical</span> &#123;</span><br><span class="line">    next: <span class="type">Option</span>&lt;<span class="type">Box</span>&lt;<span class="keyword">dyn</span> Department&gt;&gt;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">Medical</span> &#123;</span><br><span class="line">    <span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">new</span>(next: <span class="keyword">impl</span> <span class="title class_">Department</span> + <span class="symbol">&#x27;static</span>) <span class="punctuation">-&gt;</span> <span class="keyword">Self</span> &#123;</span><br><span class="line">        <span class="keyword">Self</span> &#123;</span><br><span class="line">            next: <span class="title function_ invoke__">into_next</span>(next),</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">Department</span> <span class="keyword">for</span> <span class="title class_">Medical</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">handle</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>, patient: &amp;<span class="keyword">mut</span> Patient) &#123;</span><br><span class="line">        <span class="keyword">if</span> patient.medicine_done &#123;</span><br><span class="line">            <span class="built_in">println!</span>(<span class="string">&quot;Medicine is already given to a patient&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="built_in">println!</span>(<span class="string">&quot;Medical giving medicine to a patient &#123;&#125;&quot;</span>, patient.name);</span><br><span class="line">            patient.medicine_done = <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">next</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>) <span class="punctuation">-&gt;</span> &amp;<span class="keyword">mut</span> <span class="type">Option</span>&lt;<span class="type">Box</span>&lt;<span class="keyword">dyn</span> Department&gt;&gt; &#123;</span><br><span class="line">        &amp;<span class="keyword">mut</span> <span class="keyword">self</span>.next</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="department-reception-rs"><a href="#department-reception-rs" class="headerlink" title="department&#x2F;reception.rs"></a><strong>department&#x2F;reception.rs</strong></h4><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> super::&#123;into_next, Department, Patient&#125;;</span><br><span class="line"></span><br><span class="line"><span class="meta">#[derive(Default)]</span></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">struct</span> <span class="title class_">Reception</span> &#123;</span><br><span class="line">    next: <span class="type">Option</span>&lt;<span class="type">Box</span>&lt;<span class="keyword">dyn</span> Department&gt;&gt;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">Reception</span> &#123;</span><br><span class="line">    <span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">new</span>(next: <span class="keyword">impl</span> <span class="title class_">Department</span> + <span class="symbol">&#x27;static</span>) <span class="punctuation">-&gt;</span> <span class="keyword">Self</span> &#123;</span><br><span class="line">        <span class="keyword">Self</span> &#123;</span><br><span class="line">            next: <span class="title function_ invoke__">into_next</span>(next),</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">Department</span> <span class="keyword">for</span> <span class="title class_">Reception</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">handle</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>, patient: &amp;<span class="keyword">mut</span> Patient) &#123;</span><br><span class="line">        <span class="keyword">if</span> patient.registration_done &#123;</span><br><span class="line">            <span class="built_in">println!</span>(<span class="string">&quot;Patient registration is already done&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="built_in">println!</span>(<span class="string">&quot;Reception registering a patient &#123;&#125;&quot;</span>, patient.name);</span><br><span class="line">            patient.registration_done = <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">next</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>) <span class="punctuation">-&gt;</span> &amp;<span class="keyword">mut</span> <span class="type">Option</span>&lt;<span class="type">Box</span>&lt;<span class="keyword">dyn</span> Department&gt;&gt; &#123;</span><br><span class="line">        &amp;<span class="keyword">mut</span> <span class="keyword">self</span>.next</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="main-rs-Client"><a href="#main-rs-Client" class="headerlink" title="main.rs: Client"></a><strong>main.rs:</strong> Client</h4><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">mod</span> department;</span><br><span class="line"><span class="keyword">mod</span> patient;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> department::&#123;Cashier, Department, Doctor, Medical, Reception&#125;;</span><br><span class="line"><span class="keyword">use</span> patient::Patient;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">cashier</span> = Cashier::<span class="title function_ invoke__">default</span>();</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">medical</span> = Medical::<span class="title function_ invoke__">new</span>(cashier);</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">doctor</span> = Doctor::<span class="title function_ invoke__">new</span>(medical);</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">reception</span> = Reception::<span class="title function_ invoke__">new</span>(doctor);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">patient</span> = Patient &#123;</span><br><span class="line">        name: <span class="string">&quot;John&quot;</span>.<span class="title function_ invoke__">into</span>(),</span><br><span class="line">        ..Patient::<span class="title function_ invoke__">default</span>()</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Reception handles a patient passing him to the next link in the chain.</span></span><br><span class="line">    <span class="comment">// Reception -&gt; Doctor -&gt; Medical -&gt; Cashier.</span></span><br><span class="line">    reception.<span class="title function_ invoke__">execute</span>(&amp;<span class="keyword">mut</span> patient);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;\nThe patient has been already handled:\n&quot;</span>);</span><br><span class="line"></span><br><span class="line">    reception.<span class="title function_ invoke__">execute</span>(&amp;<span class="keyword">mut</span> patient);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="输出"><a href="#输出" class="headerlink" title="输出"></a>输出</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Reception registering a patient John</span><br><span class="line">Doctor checking a patient John</span><br><span class="line">Medical giving medicine to a patient John</span><br><span class="line">Cashier getting money from a patient John</span><br><span class="line"></span><br><span class="line">The patient has been already handled:</span><br><span class="line"></span><br><span class="line">Patient registration is already done</span><br><span class="line">A doctor checkup is already done</span><br><span class="line">Medicine is already given to a patient</span><br><span class="line">Payment done</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://tonymistark.github.io/2024/02/01/design-pattern/structural-patterns/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Ice">
      <meta itemprop="description" content="安静地坐着学习">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="BLOG">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2024/02/01/design-pattern/structural-patterns/" class="post-title-link" itemprop="url">Structural Design Patterns 结构设计模式</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2024-02-01 22:27:04 / Modified: 22:56:33" itemprop="dateCreated datePublished" datetime="2024-02-01T22:27:04+08:00">2024-02-01</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/design-pattern/" itemprop="url" rel="index"><span itemprop="name">design-pattern</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="Symbols count in article">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">Symbols count in article: </span>
              <span>225</span>
            </span>
            <span class="post-meta-item" title="Reading time">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">Reading time &asymp;</span>
              <span>1 mins.</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>结构设计模式解释了如何将对象和类组装成更大的结构，同时保持这些结构的灵活性和效率。</p>
<h1 id="Adapter-适配器"><a href="#Adapter-适配器" class="headerlink" title="Adapter 适配器"></a>Adapter 适配器</h1><div align="center"> 
    <a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/lxvFOqjS8m0DDNrs7qG9_A">
    <img src="/images/adapter-header.png"/>
    Adapter 适配器
    <a/>
</div>

<h1 id="Bridge-桥接"><a href="#Bridge-桥接" class="headerlink" title="Bridge 桥接"></a>Bridge 桥接</h1><div align="center"> 
    <a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/dSixwlU9Ds3tzR3KmmkbTg">
    <img src="/images/bridge-header.png"/>
    Bridge 桥接
    <a/>
</div>

<h1 id="Composite-部分-整体或复合模式"><a href="#Composite-部分-整体或复合模式" class="headerlink" title="Composite 部分-整体或复合模式"></a>Composite 部分-整体或复合模式</h1><div align="center"> 
    <a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/qtmrz-mTx_BXj_DhLHTbDw">
    <img src="/images/composite-header.png"/>
    Composite 部分-整体或复合模式
    <a/>
</div>

<h1 id="Decorator-装饰器"><a href="#Decorator-装饰器" class="headerlink" title="Decorator 装饰器"></a>Decorator 装饰器</h1><div align="center"> 
    <a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/ztmaiAPiNUkysA4HQWevzQ">
    <img src="/images/decorator.png"/>
    Decorator 装饰器
    <a/>
</div>

<h1 id="Facade-门面（外观）模式"><a href="#Facade-门面（外观）模式" class="headerlink" title="Facade 门面（外观）模式"></a>Facade 门面（外观）模式</h1><div align="center"> 
    <a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/-rVPbWR1AgHIwN5pG0_zsQ">
    <img src="/images/facade.png"/>
    Facade 门面（外观）模式
    <a/>
</div>

<h1 id="Flyweight-享元模式"><a href="#Flyweight-享元模式" class="headerlink" title="Flyweight 享元模式"></a>Flyweight 享元模式</h1><div align="center"> 
    <a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/FkCGFQSyK-CxpRSXCEnyWw">
    <img src="/images/flyweight.png"/>
    Flyweight 享元模式
    <a/>
</div>

<h1 id="Proxy-代理模式"><a href="#Proxy-代理模式" class="headerlink" title="Proxy 代理模式"></a>Proxy 代理模式</h1><div align="center"> 
    <a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/EF2x7td1p0UP_YUFCBjmxQ">
    <img src="/images/proxy.png"/>
    Proxy 代理模式
    <a/>
</div>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://tonymistark.github.io/2024/02/01/design-pattern/proxy/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Ice">
      <meta itemprop="description" content="安静地坐着学习">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="BLOG">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2024/02/01/design-pattern/proxy/" class="post-title-link" itemprop="url">Proxy 代理模式</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2024-02-01 21:50:38 / Modified: 22:14:51" itemprop="dateCreated datePublished" datetime="2024-02-01T21:50:38+08:00">2024-02-01</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/design-pattern/" itemprop="url" rel="index"><span itemprop="name">design-pattern</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="Symbols count in article">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">Symbols count in article: </span>
              <span>3.5k</span>
            </span>
            <span class="post-meta-item" title="Reading time">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">Reading time &asymp;</span>
              <span>13 mins.</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="意图"><a href="#意图" class="headerlink" title="意图"></a>意图</h2><p><strong>代理</strong>是一种结构化设计模式，它允许您为另一个对象提供替代或占位符。代理控制对原始对象的访问，允许您在请求到达原始对象之前或之后执行某些操作。</p>
<div align="center"> <img src="/images/proxy.png"/></div>


<h2 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h2><p>为什么要控制对对象的访问？这里有一个例子：你有一个巨大的对象，它消耗了大量的系统资源。你有时需要它，但不总是。</p>
<div align="center"> <img src="/images/proxy-problem-en.png"/>数据库查询可能真的很慢。</div>


<p>你可以实现惰性初始化：只在实际需要的时候创建这个对象。对象的所有客户端都需要执行一些延迟初始化代码。不幸的是，这可能会导致大量的代码重复。</p>
<p>在理想情况下，我们希望将这些代码直接放入对象的类中，但这并不总是可行的。例如，类可以是封闭的第三方库的一部分。</p>
<h2 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h2><p>代理模式建议您创建一个具有与原始服务对象相同接口的新代理类。然后更新您的应用，使其将代理对象传递给原始对象的所有客户端。在接收到来自客户机的请求时，代理创建一个真实的服务对象，并将所有工作委托给它。</p>
<div align="center"> <img src="/images/proxy-solution-en.png"/>代理将自己伪装成一个数据库对象。它可以在客户端或真实的数据库对象不知道的情况下处理延迟初始化和结果缓存。</div>


<p>但有什么好处呢？如果您需要在类的主要逻辑之前或之后执行某些操作，代理允许您在不更改该类的情况下执行这些操作。由于代理实现了与原始类相同的接口，因此可以将其传递给任何需要真实的服务对象的客户端。</p>
<h2 id="现实世界的类比"><a href="#现实世界的类比" class="headerlink" title="现实世界的类比"></a>现实世界的类比</h2><div align="center"> <img src="/images/proxy-live-example.png"/>信用卡和现金一样可以用来付款。</div>


<p>信用卡是银行账户的代理，银行账户是一捆现金的代理。两者都实现了相同的接口：它们可以用于进行支付。消费者感觉很好，因为没有必要随身携带大量现金。店主也很高兴，因为交易收入通过电子方式添加到商店的银行账户中，而没有丢失存款或在去银行的路上被抢劫的风险。</p>
<div align="center"> <img src="/images/proxy-structure.png"/></div>


<ol>
<li>服务接口声明服务的接口。代理必须遵循此接口，以便能够将自己伪装成服务对象。</li>
<li>Service是一个提供一些有用的业务逻辑的类。</li>
<li>Proxy类有一个指向服务对象的引用字段。在代理完成其处理之后（例如，惰性初始化、日志记录、访问控制、缓存等），它将请求传递给服务对象。通常，代理管理其服务对象的整个生命周期。</li>
<li>客户端应该通过相同的接口与服务和代理一起工作。通过这种方式，您可以将代理传递到任何需要服务对象的代码中。</li>
</ol>
<h2 id="伪代码"><a href="#伪代码" class="headerlink" title="伪代码"></a>伪代码</h2><p>此示例说明了代理模式如何帮助将延迟初始化和缓存引入第三方YouTube集成库。</p>
<div align="center"> <img src="/images/proxy-example.png"/>使用代理缓存服务的结果。</div>


<p>图书馆为我们提供了视频下载课。然而，这是非常低效的。如果客户端应用程序多次请求相同的视频，库只是一遍又一遍地下载它，而不是缓存和重用第一个下载的文件。</p>
<p>代理类实现与原始下载器相同的接口，并将所有工作委托给它。但是，它会跟踪下载的文件，并在应用多次请求同一视频时返回缓存结果。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// The interface of a remote service.</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">ThirdPartyYouTubeLib</span> is</span><br><span class="line">    method <span class="title function_">listVideos</span><span class="params">()</span></span><br><span class="line">    method <span class="title function_">getVideoInfo</span><span class="params">(id)</span></span><br><span class="line">    method <span class="title function_">downloadVideo</span><span class="params">(id)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// The concrete implementation of a service connector. Methods</span></span><br><span class="line"><span class="comment">// of this class can request information from YouTube. The speed</span></span><br><span class="line"><span class="comment">// of the request depends on a user&#x27;s internet connection as</span></span><br><span class="line"><span class="comment">// well as YouTube&#x27;s. The application will slow down if a lot of</span></span><br><span class="line"><span class="comment">// requests are fired at the same time, even if they all request</span></span><br><span class="line"><span class="comment">// the same information.</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ThirdPartyYouTubeClass</span> <span class="keyword">implements</span> <span class="title class_">ThirdPartyYouTubeLib</span> is</span><br><span class="line">    method <span class="title function_">listVideos</span><span class="params">()</span> is</span><br><span class="line">        <span class="comment">// Send an API request to YouTube.</span></span><br><span class="line"></span><br><span class="line">    method <span class="title function_">getVideoInfo</span><span class="params">(id)</span> is</span><br><span class="line">        <span class="comment">// Get metadata about some video.</span></span><br><span class="line"></span><br><span class="line">    method <span class="title function_">downloadVideo</span><span class="params">(id)</span> is</span><br><span class="line">        <span class="comment">// Download a video file from YouTube.</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// To save some bandwidth, we can cache request results and keep</span></span><br><span class="line"><span class="comment">// them for some time. But it may be impossible to put such code</span></span><br><span class="line"><span class="comment">// directly into the service class. For example, it could have</span></span><br><span class="line"><span class="comment">// been provided as part of a third party library and/or defined</span></span><br><span class="line"><span class="comment">// as `final`. That&#x27;s why we put the caching code into a new</span></span><br><span class="line"><span class="comment">// proxy class which implements the same interface as the</span></span><br><span class="line"><span class="comment">// service class. It delegates to the service object only when</span></span><br><span class="line"><span class="comment">// the real requests have to be sent.</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CachedYouTubeClass</span> <span class="keyword">implements</span> <span class="title class_">ThirdPartyYouTubeLib</span> is</span><br><span class="line">    <span class="keyword">private</span> field service: ThirdPartyYouTubeLib</span><br><span class="line">    <span class="keyword">private</span> field listCache, videoCache</span><br><span class="line">    field needReset</span><br><span class="line"></span><br><span class="line">    constructor <span class="title function_">CachedYouTubeClass</span><span class="params">(service: ThirdPartyYouTubeLib)</span> is</span><br><span class="line">        <span class="built_in">this</span>.service = service</span><br><span class="line"></span><br><span class="line">    method <span class="title function_">listVideos</span><span class="params">()</span> is</span><br><span class="line">        <span class="title function_">if</span> <span class="params">(listCache == <span class="literal">null</span> || needReset)</span></span><br><span class="line">            listCache = service.listVideos()</span><br><span class="line">        <span class="keyword">return</span> listCache</span><br><span class="line"></span><br><span class="line">    method <span class="title function_">getVideoInfo</span><span class="params">(id)</span> is</span><br><span class="line">        <span class="title function_">if</span> <span class="params">(videoCache == <span class="literal">null</span> || needReset)</span></span><br><span class="line">            videoCache = service.getVideoInfo(id)</span><br><span class="line">        <span class="keyword">return</span> videoCache</span><br><span class="line"></span><br><span class="line">    method <span class="title function_">downloadVideo</span><span class="params">(id)</span> is</span><br><span class="line">        <span class="title function_">if</span> <span class="params">(!downloadExists(id)</span> || needReset)</span><br><span class="line">            service.downloadVideo(id)</span><br><span class="line"></span><br><span class="line"><span class="comment">// The GUI class, which used to work directly with a service</span></span><br><span class="line"><span class="comment">// object, stays unchanged as long as it works with the service</span></span><br><span class="line"><span class="comment">// object through an interface. We can safely pass a proxy</span></span><br><span class="line"><span class="comment">// object instead of a real service object since they both</span></span><br><span class="line"><span class="comment">// implement the same interface.</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">YouTubeManager</span> is</span><br><span class="line">    <span class="keyword">protected</span> field service: ThirdPartyYouTubeLib</span><br><span class="line"></span><br><span class="line">    constructor <span class="title function_">YouTubeManager</span><span class="params">(service: ThirdPartyYouTubeLib)</span> is</span><br><span class="line">        <span class="built_in">this</span>.service = service</span><br><span class="line"></span><br><span class="line">    method <span class="title function_">renderVideoPage</span><span class="params">(id)</span> <span class="type">is</span></span><br><span class="line">        <span class="variable">info</span> <span class="operator">=</span> service.getVideoInfo(id)</span><br><span class="line">        <span class="comment">// Render the video page.</span></span><br><span class="line"></span><br><span class="line">    method <span class="title function_">renderListPanel</span><span class="params">()</span> <span class="type">is</span></span><br><span class="line">        <span class="variable">list</span> <span class="operator">=</span> service.listVideos()</span><br><span class="line">        <span class="comment">// Render the list of video thumbnails.</span></span><br><span class="line"></span><br><span class="line">    method <span class="title function_">reactOnUserInput</span><span class="params">()</span> is</span><br><span class="line">        <span class="title function_">renderVideoPage</span><span class="params">()</span></span><br><span class="line">        renderListPanel()</span><br><span class="line"></span><br><span class="line"><span class="comment">// The application can configure proxies on the fly.</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Application</span> is</span><br><span class="line">    method <span class="title function_">init</span><span class="params">()</span> <span class="type">is</span></span><br><span class="line">        <span class="variable">aYouTubeService</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ThirdPartyYouTubeClass</span>()</span><br><span class="line">        aYouTubeProxy = <span class="keyword">new</span> <span class="title class_">CachedYouTubeClass</span>(aYouTubeService)</span><br><span class="line">        manager = <span class="keyword">new</span> <span class="title class_">YouTubeManager</span>(aYouTubeProxy)</span><br><span class="line">        manager.reactOnUserInput()</span><br></pre></td></tr></table></figure>

<h2 id="适用性"><a href="#适用性" class="headerlink" title="适用性"></a>适用性</h2><p>使用代理模式的方法有很多种。让我们来看看最流行的用法。</p>
<ul>
<li><strong>惰性初始化（虚拟代理）。这是当您有一个重量级的服务对象时，它总是处于运行状态，浪费系统资源，即使您只是偶尔需要它。</strong></li>
<li>您可以将对象的初始化延迟到真正需要的时候，而不是在应用启动时创建对象。</li>
<li><strong>访问控制（保护代理）。这是当您希望只有特定的客户端能够使用服务对象时;例如，当您的对象是操作系统的关键部分，而客户端是各种启动的应用程序（包括恶意应用程序）时。</strong></li>
<li>只有当客户端的凭据符合某些条件时，代理才能将请求传递给服务对象。</li>
<li><strong>远程服务的本地执行（远程代理）。这是当服务对象位于远程服务器上时。</strong></li>
<li>在这种情况下，代理通过网络传递客户端请求，处理与网络一起工作的所有讨厌的细节。</li>
<li><strong>日志请求（日志代理）。这是您想要保留对服务对象的请求历史记录的时候。</strong></li>
<li>代理可以在将请求传递给服务之前记录每个请求。</li>
<li><strong>缓存请求结果（缓存代理）。这是当您需要缓存客户端请求的结果并管理此缓存的生命周期时，特别是当结果非常大时。</strong></li>
<li>代理可以为总是产生相同结果的重复请求实现缓存。代理可以使用请求的参数作为该高速缓存键。</li>
<li><strong>聪明的参考。这是您需要在没有客户端使用重量级对象时能够解除该对象的时候。</strong></li>
<li>代理可以跟踪获得对服务对象或其结果的引用的客户端。有时，代理可能会检查客户端并检查它们是否仍然处于活动状态。如果客户端列表为空，则代理可能会解除服务对象并释放底层系统资源。代理还可以跟踪客户机是否修改了服务对象。然后，未更改的对象可以被其他客户端重用。</li>
</ul>
<h2 id="如何实现"><a href="#如何实现" class="headerlink" title="如何实现"></a>如何实现</h2><ol>
<li>如果没有预先存在的服务接口，则创建一个以使代理和服务对象可互换。从服务类中提取接口并不总是可行的，因为您需要更改服务的所有客户端以使用该接口。计划B是使代理成为服务类的子类，这样它将继承服务的接口。</li>
<li>创建代理类。它应该有一个用于存储服务引用的字段。通常，代理创建和管理其服务的整个生命周期。在极少数情况下，服务由客户端通过构造函数传递给代理。</li>
<li>根据代理方法的用途实现它们。在大多数情况下，在完成一些工作之后，代理应该将工作委托给服务对象。</li>
<li>考虑引入一种创建方法，该方法决定客户机获取的是代理服务还是真实的服务。这可以是代理类中的简单静态方法，也可以是成熟的工厂方法。</li>
<li>考虑为服务对象实现惰性初始化。</li>
</ol>
<h2 id="利弊"><a href="#利弊" class="headerlink" title="利弊"></a>利弊</h2><table>
<thead>
<tr>
<th>√ 利</th>
<th>× 弊</th>
</tr>
</thead>
<tbody><tr>
<td>您可以在客户端不知道的情况下控制服务对象。</td>
<td>代码可能会变得更复杂，因为你需要引入很多新的类。</td>
</tr>
<tr>
<td>当客户机不关心服务对象时，您可以管理它的生命周期。</td>
<td>服务的响应可能会延迟。</td>
</tr>
<tr>
<td>即使服务对象未准备好或不可用，代理也可以工作。</td>
<td></td>
</tr>
<tr>
<td>开放&#x2F;封闭原则。您可以引入新的代理，而无需更改服务或客户端。</td>
<td></td>
</tr>
</tbody></table>
<h2 id="与其他模式的关系"><a href="#与其他模式的关系" class="headerlink" title="与其他模式的关系"></a>与其他模式的关系</h2><ul>
<li>使用Adapter，您可以通过不同的接口访问现有对象。使用Proxy，接口保持不变。使用Decorator，您可以通过增强的接口访问对象。</li>
<li>Facade与Proxy类似，都缓冲一个复杂的实体并自己初始化它。与Facade不同，Proxy与其服务对象具有相同的接口，这使得它们可以互换。</li>
<li>Decorator和Proxy具有类似的结构，但意图非常不同。这两种模式都建立在组合原则上，其中一个对象应该将一些工作委托给另一个对象。不同之处在于，Proxy通常自己管理其服务对象的生命周期，而Decorators的组成始终由客户端控制。</li>
</ul>
<h2 id="代码示例"><a href="#代码示例" class="headerlink" title="代码示例"></a>代码示例</h2><h1 id="Python中的代理"><a href="#Python中的代理" class="headerlink" title="Python中的代理"></a>Python中的代理</h1><p>代理是一种结构化设计模式，它提供一个对象，作为客户端使用的真实的服务对象的替代品。代理接收客户端请求，做一些工作（访问控制，缓存等）。然后将请求传递给服务对象。</p>
<p>代理对象具有与服务相同的接口，这使得它在传递给客户端时可以与真实的对象互换。</p>
<h2 id="概念示例"><a href="#概念示例" class="headerlink" title="概念示例"></a>概念示例</h2><p>这个例子说明了代理设计模式的结构。它侧重于回答这些问题：</p>
<ul>
<li>它由哪些类组成？</li>
<li>这些班级扮演什么角色？</li>
<li>模式中的元素是以什么方式联系在一起的？</li>
</ul>
<h4 id="main-py：概念性示例"><a href="#main-py：概念性示例" class="headerlink" title="main.py：概念性示例"></a>main.py：概念性示例</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> abc <span class="keyword">import</span> ABC, abstractmethod</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Subject</span>(<span class="title class_ inherited__">ABC</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    The Subject interface declares common operations for both RealSubject and</span></span><br><span class="line"><span class="string">    the Proxy. As long as the client works with RealSubject using this</span></span><br><span class="line"><span class="string">    interface, you&#x27;ll be able to pass it a proxy instead of a real subject.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">    @abstractmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">request</span>(<span class="params">self</span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">RealSubject</span>(<span class="title class_ inherited__">Subject</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    The RealSubject contains some core business logic. Usually, RealSubjects are</span></span><br><span class="line"><span class="string">    capable of doing some useful work which may also be very slow or sensitive -</span></span><br><span class="line"><span class="string">    e.g. correcting input data. A Proxy can solve these issues without any</span></span><br><span class="line"><span class="string">    changes to the RealSubject&#x27;s code.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">request</span>(<span class="params">self</span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;RealSubject: Handling request.&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Proxy</span>(<span class="title class_ inherited__">Subject</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    The Proxy has an interface identical to the RealSubject.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, real_subject: RealSubject</span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">        self._real_subject = real_subject</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">request</span>(<span class="params">self</span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        The most common applications of the Proxy pattern are lazy loading,</span></span><br><span class="line"><span class="string">        caching, controlling the access, logging, etc. A Proxy can perform one</span></span><br><span class="line"><span class="string">        of these things and then, depending on the result, pass the execution to</span></span><br><span class="line"><span class="string">        the same method in a linked RealSubject object.</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> self.check_access():</span><br><span class="line">            self._real_subject.request()</span><br><span class="line">            self.log_access()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">check_access</span>(<span class="params">self</span>) -&gt; <span class="built_in">bool</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Proxy: Checking access prior to firing a real request.&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">log_access</span>(<span class="params">self</span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Proxy: Logging the time of request.&quot;</span>, end=<span class="string">&quot;&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">client_code</span>(<span class="params">subject: Subject</span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    The client code is supposed to work with all objects (both subjects and</span></span><br><span class="line"><span class="string">    proxies) via the Subject interface in order to support both real subjects</span></span><br><span class="line"><span class="string">    and proxies. In real life, however, clients mostly work with their real</span></span><br><span class="line"><span class="string">    subjects directly. In this case, to implement the pattern more easily, you</span></span><br><span class="line"><span class="string">    can extend your proxy from the real subject&#x27;s class.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># ...</span></span><br><span class="line"></span><br><span class="line">    subject.request()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># ...</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Client: Executing the client code with a real subject:&quot;</span>)</span><br><span class="line">    real_subject = RealSubject()</span><br><span class="line">    client_code(real_subject)</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Client: Executing the same client code with a proxy:&quot;</span>)</span><br><span class="line">    proxy = Proxy(real_subject)</span><br><span class="line">    client_code(proxy)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id=""><a href="#" class="headerlink" title=""></a></h4><p>Output.txt：执行结果</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Client: Executing the client code with a real subject:</span><br><span class="line">RealSubject: Handling request.</span><br><span class="line"></span><br><span class="line">Client: Executing the same client code with a proxy:</span><br><span class="line">Proxy: Checking access prior to firing a real request.</span><br><span class="line">RealSubject: Handling request.</span><br><span class="line">Proxy: Logging the time of request.</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h1 id="Rust中的代理"><a href="#Rust中的代理" class="headerlink" title="Rust中的代理"></a>Rust中的代理</h1><p>代理是一种结构化设计模式，它提供一个对象，作为客户端使用的真实的服务对象的替代品。代理接收客户端请求，做一些工作（访问控制，缓存等）。然后将请求传递给服务对象。</p>
<h2 id="概念示例：Nginx代理"><a href="#概念示例：Nginx代理" class="headerlink" title="概念示例：Nginx代理"></a>概念示例：Nginx代理</h2><p>Web服务器（如Nginx）可以充当应用服务器的代理：</p>
<ul>
<li>它提供对应用服务器的受控访问。</li>
<li>它可以进行速率限制。</li>
<li>它可以做请求缓存。</li>
</ul>
<h4 id="server-rs"><a href="#server-rs" class="headerlink" title="server.rs"></a><strong>server.rs</strong></h4><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">mod</span> application;</span><br><span class="line"><span class="keyword">mod</span> nginx;</span><br><span class="line"></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">use</span> nginx::NginxServer;</span><br><span class="line"></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">trait</span> <span class="title class_">Server</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">handle_request</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>, url: &amp;<span class="type">str</span>, method: &amp;<span class="type">str</span>) <span class="punctuation">-&gt;</span> (<span class="type">u16</span>, <span class="type">String</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="server-application-rs"><a href="#server-application-rs" class="headerlink" title="server&#x2F;application.rs"></a>server&#x2F;application.rs</h4><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> super::Server;</span><br><span class="line"></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">struct</span> <span class="title class_">Application</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">Server</span> <span class="keyword">for</span> <span class="title class_">Application</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">handle_request</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>, url: &amp;<span class="type">str</span>, method: &amp;<span class="type">str</span>) <span class="punctuation">-&gt;</span> (<span class="type">u16</span>, <span class="type">String</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> url == <span class="string">&quot;/app/status&quot;</span> &amp;&amp; method == <span class="string">&quot;GET&quot;</span> &#123;</span><br><span class="line">            <span class="title function_ invoke__">return</span> (<span class="number">200</span>, <span class="string">&quot;Ok&quot;</span>.<span class="title function_ invoke__">into</span>());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> url == <span class="string">&quot;/create/user&quot;</span> &amp;&amp; method == <span class="string">&quot;POST&quot;</span> &#123;</span><br><span class="line">            <span class="title function_ invoke__">return</span> (<span class="number">201</span>, <span class="string">&quot;User Created&quot;</span>.<span class="title function_ invoke__">into</span>());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        (<span class="number">404</span>, <span class="string">&quot;Not Ok&quot;</span>.<span class="title function_ invoke__">into</span>())</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="server-nginx-rs"><a href="#server-nginx-rs" class="headerlink" title="server&#x2F;nginx.rs"></a><strong>server&#x2F;nginx.rs</strong></h4><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> std::collections::HashMap;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> super::&#123;application::Application, Server&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// NGINX server is a proxy to an application server.</span></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">struct</span> <span class="title class_">NginxServer</span> &#123;</span><br><span class="line">    application: Application,</span><br><span class="line">    max_allowed_requests: <span class="type">u32</span>,</span><br><span class="line">    rate_limiter: HashMap&lt;<span class="type">String</span>, <span class="type">u32</span>&gt;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">NginxServer</span> &#123;</span><br><span class="line">    <span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">new</span>() <span class="punctuation">-&gt;</span> <span class="keyword">Self</span> &#123;</span><br><span class="line">        <span class="keyword">Self</span> &#123;</span><br><span class="line">            application: Application,</span><br><span class="line">            max_allowed_requests: <span class="number">2</span>,</span><br><span class="line">            rate_limiter: HashMap::<span class="title function_ invoke__">default</span>(),</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">check_rate_limiting</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>, url: &amp;<span class="type">str</span>) <span class="punctuation">-&gt;</span> <span class="type">bool</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="variable">rate</span> = <span class="keyword">self</span>.rate_limiter.<span class="title function_ invoke__">entry</span>(url.<span class="title function_ invoke__">to_string</span>()).<span class="title function_ invoke__">or_insert</span>(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> *rate &gt; <span class="keyword">self</span>.max_allowed_requests &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        *rate += <span class="number">1</span>;</span><br><span class="line">        <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">Server</span> <span class="keyword">for</span> <span class="title class_">NginxServer</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">handle_request</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>, url: &amp;<span class="type">str</span>, method: &amp;<span class="type">str</span>) <span class="punctuation">-&gt;</span> (<span class="type">u16</span>, <span class="type">String</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> !<span class="keyword">self</span>.<span class="title function_ invoke__">check_rate_limiting</span>(url) &#123;</span><br><span class="line">            <span class="title function_ invoke__">return</span> (<span class="number">403</span>, <span class="string">&quot;Not Allowed&quot;</span>.<span class="title function_ invoke__">into</span>());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">self</span>.application.<span class="title function_ invoke__">handle_request</span>(url, method)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="main-rs"><a href="#main-rs" class="headerlink" title="main.rs"></a><strong>main.rs</strong></h4><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">mod</span> server;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> crate::server::&#123;NginxServer, Server&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">app_status</span> = &amp;<span class="string">&quot;/app/status&quot;</span>.<span class="title function_ invoke__">to_string</span>();</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">create_user</span> = &amp;<span class="string">&quot;/create/user&quot;</span>.<span class="title function_ invoke__">to_string</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">nginx</span> = NginxServer::<span class="title function_ invoke__">new</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> (code, body) = nginx.<span class="title function_ invoke__">handle_request</span>(app_status, <span class="string">&quot;GET&quot;</span>);</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;Url: &#123;&#125;\nHttpCode: &#123;&#125;\nBody: &#123;&#125;\n&quot;</span>, app_status, code, body);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> (code, body) = nginx.<span class="title function_ invoke__">handle_request</span>(app_status, <span class="string">&quot;GET&quot;</span>);</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;Url: &#123;&#125;\nHttpCode: &#123;&#125;\nBody: &#123;&#125;\n&quot;</span>, app_status, code, body);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> (code, body) = nginx.<span class="title function_ invoke__">handle_request</span>(app_status, <span class="string">&quot;GET&quot;</span>);</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;Url: &#123;&#125;\nHttpCode: &#123;&#125;\nBody: &#123;&#125;\n&quot;</span>, app_status, code, body);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> (code, body) = nginx.<span class="title function_ invoke__">handle_request</span>(create_user, <span class="string">&quot;POST&quot;</span>);</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;Url: &#123;&#125;\nHttpCode: &#123;&#125;\nBody: &#123;&#125;\n&quot;</span>, create_user, code, body);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> (code, body) = nginx.<span class="title function_ invoke__">handle_request</span>(create_user, <span class="string">&quot;GET&quot;</span>);</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;Url: &#123;&#125;\nHttpCode: &#123;&#125;\nBody: &#123;&#125;\n&quot;</span>, create_user, code, body);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="输出"><a href="#输出" class="headerlink" title="输出"></a>输出</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">Url: /app/status</span><br><span class="line">HttpCode: 200</span><br><span class="line">Body: Ok</span><br><span class="line"></span><br><span class="line">Url: /app/status</span><br><span class="line">HttpCode: 200</span><br><span class="line">Body: Ok</span><br><span class="line"></span><br><span class="line">Url: /app/status</span><br><span class="line">HttpCode: 403</span><br><span class="line">Body: Not Allowed</span><br><span class="line"></span><br><span class="line">Url: /create/user</span><br><span class="line">HttpCode: 201</span><br><span class="line">Body: User Created</span><br><span class="line"></span><br><span class="line">Url: /create/user</span><br><span class="line">HttpCode: 404</span><br><span class="line">Body: Not Ok</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://tonymistark.github.io/2024/01/30/design-pattern/flyweight/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Ice">
      <meta itemprop="description" content="安静地坐着学习">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="BLOG">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2024/01/30/design-pattern/flyweight/" class="post-title-link" itemprop="url">Flyweight 享元模式</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2024-01-30 21:55:21" itemprop="dateCreated datePublished" datetime="2024-01-30T21:55:21+08:00">2024-01-30</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2024-01-31 22:19:37" itemprop="dateModified" datetime="2024-01-31T22:19:37+08:00">2024-01-31</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/design-pattern/" itemprop="url" rel="index"><span itemprop="name">design-pattern</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="Symbols count in article">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">Symbols count in article: </span>
              <span>4.5k</span>
            </span>
            <span class="post-meta-item" title="Reading time">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">Reading time &asymp;</span>
              <span>16 mins.</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="意图"><a href="#意图" class="headerlink" title="意图"></a>意图</h2><p>Flyweight是一种结构化的设计模式，通过在多个对象之间共享状态的公共部分，而不是保留每个对象中的所有数据，可以将更多的对象放入可用的RAM中。</p>
<div align="center"> <img src="/images/flyweight.png"/></div>


<h2 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h2><p>为了在长时间的工作后找点乐子，你决定创建一个简单的视频游戏：玩家在地图上移动并互相射击。您选择实现一个逼真的粒子系统，并使其成为游戏的独特功能。大量的子弹、导弹和爆炸产生的弹片应该在地图上到处飞，给玩家带来惊心动魄的体验。</p>
<p>完成后，你推送了最后一次提交，构建了游戏并将其发送给你的朋友进行测试。虽然游戏在你的机器上运行得很顺利，但你的朋友不能玩很长时间。在他的电脑上，游戏在玩了几分钟后就不断崩溃。在花了几个小时挖掘调试日志后，您发现游戏崩溃是因为RAM不足。原来你朋友的钻机比你自己的电脑功能差得多，这就是为什么问题在他的机器上出现得这么快。</p>
<p>实际的问题与你的粒子系统有关。每一个粒子，比如一颗子弹、一枚导弹或一块弹片，都由一个包含大量数据的单独对象来表示。在某些时候，当玩家屏幕上的大屠杀达到高潮时，新创建的粒子不再适合剩余的RAM，因此程序崩溃。</p>
<div align="center"> <img src="/images/flyweight-problem-en.png"/></div>


<h2 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h2><p>仔细查看 仔细查看 <code>Particle</code> 类，您可能会注意到color和sprite字段比其他字段占用更多的内存。更糟糕的是，这两个字段存储的所有粒子的数据几乎相同。例如，所有项目符号都具有相同的颜色和子画面。 类，您可能会注意到color和sprite字段比其他字段占用更多的内存。更糟糕的是，这两个字段存储的所有粒子的数据几乎相同。例如，所有项目符号都具有相同的颜色和子画面。</p>
<div align="center"> <img src="/images/flyweight-solution1-en.png"/></div>


<p>粒子状态的其他部分，如坐标、运动矢量和速度，对于每个粒子都是唯一的。毕竟，这些字段的值会随着时间的推移而变化。该数据表示粒子存在的始终变化的上下文，而每个粒子的颜色和子画面保持不变。</p>
<p>对象的这种恒定数据通常称为固有状态。它存在于物体内部;其他对象只能读取它，而不能改变它。对象的其余状态，通常被其他对象“从外部”改变，称为外部状态。</p>
<p>Flyweight模式建议您停止在对象内部存储外部状态。相反，你应该把这个状态传递给依赖它的特定方法。只有内在状态留在对象中，让你在不同的上下文中重用它。因此，您需要更少的这些对象，因为它们只在内在状态上有所不同，而内在状态的变化要比外在状态少得多。</p>
<div align="center"> <img src="/images/flyweight-solution3.png"/></div>


<p>让我们回到我们的游戏。假设我们已经从粒子类中提取了外部状态，那么只有三个不同的对象就足以代表游戏中的所有粒子：一颗子弹、一枚导弹和一块弹片。正如你现在可能已经猜到的，一个只存储固有状态的对象被称为flyweight。</p>
<h4 id="外部状态存储器"><a href="#外部状态存储器" class="headerlink" title="外部状态存储器"></a>外部状态存储器</h4><p>外在的状态向何处去？一些类应该仍然存储它，对吗？在大多数情况下，它会被移动到容器对象中，容器对象在我们应用模式之前聚合对象。</p>
<p>在我们的例子中，这是主要的 在我们的例子中，这是主要的 <code>Game</code> 对象，它将所有粒子存储在  对象，它将所有粒子存储在  对象，它将所有粒子存储在 <code>particles</code> 场中。要将外部状态移动到这个类中，需要创建几个数组字段来存储每个粒子的坐标、向量和速度。但这还不是全部。您需要另一个数组来存储对表示粒子的特定flyweight的引用。这些数组必须同步，以便您可以使用相同的索引访问粒子的所有数据。 场中。要将外部状态移动到这个类中，需要创建几个数组字段来存储每个粒子的坐标、向量和速度。但这还不是全部。您需要另一个数组来存储对表示粒子的特定flyweight的引用。这些数组必须同步，以便您可以使用相同的索引访问粒子的所有数据。</p>
<div align="center"> <img src="/images/flyweight-solution4.png"/></div>


<p>一个更优雅的解决方案是创建一个单独的上下文类，它将存储外部状态沿着对flyweight对象的引用。这种方法只需要容器类中有一个数组。</p>
<p>等一下！难道我们不需要像一开始那样，有很多这样的上下文对象吗？严格来说是的但问题是，这些物体比以前小得多。最消耗内存的字段已经被移到几个flyweight对象中。现在，1000个小的上下文对象可以重用一个重flyweight对象，而不是存储其数据的1000个副本。</p>
<h4 id="Flyweight和不变性"><a href="#Flyweight和不变性" class="headerlink" title="Flyweight和不变性"></a>Flyweight和不变性</h4><p>由于同一个flyweight对象可以在不同的上下文中使用，因此必须确保其状态不能被修改。一个flyweight应该只初始化它的状态一次，通过构造函数参数。它不应该向其他对象公开任何setter或公共字段。</p>
<h4 id="Flyweight工厂"><a href="#Flyweight工厂" class="headerlink" title="Flyweight工厂"></a>Flyweight工厂</h4><p>为了更方便地访问各种flyweight，您可以创建一个工厂方法来管理现有flyweight对象的池。该方法从客户端接受所需flyweight的内部状态，查找与此状态匹配的现有flyweight对象，如果找到则返回它。如果没有，则创建一个新的flyweight并将其添加到池中。</p>
<p>有几种选择可以放置这种方法。最明显的地方是flyweight容器。或者，您可以创建一个新的工厂类。或者你可以让工厂方法静态化，并把它放在一个实际的flyweight类中。</p>
<h2 id="结构"><a href="#结构" class="headerlink" title="结构"></a>结构</h2><div align="center"> <img src="/images/flyweight-structure.png"/></div>


<ol>
<li>Flyweight模式仅仅是一种优化。在应用它之前，请确保您的程序确实存在与内存中同时存在大量类似对象相关的RAM消耗问题。确保这个问题不能以任何其他有意义的方式解决。</li>
<li>Flyweight类包含原始对象的状态中可以在多个对象之间共享的部分。同一个flyweight对象可以在许多不同的上下文中使用。存储在flyweight中的状态称为intrinsic。传递给flyweight方法的状态称为extrinsic。</li>
<li>Context类包含外部状态，在所有原始对象中是唯一的。当上下文与其中一个flyweight对象配对时，它表示原始对象的完整状态。</li>
<li>通常，原始对象的行为保留在flyweight类中。在这种情况下，无论谁调用flyweight的方法，都必须将外部状态的适当位传递到方法的参数中。另一方面，行为可以被移动到上下文类，它将链接的flyweight仅仅作为一个数据对象。</li>
<li>客户端计算或存储flyweights的外部状态。从客户端的角度来看，flyweight是一个模板对象，可以在运行时通过将一些上下文数据传递到其方法的参数中进行配置。</li>
<li>Flyweight Factory管理现有的Flyweight。使用工厂，客户不直接创建flyweights。相反，它们调用工厂，向其传递所需flyweight的内部状态位。工厂检查以前创建的flyweights，并返回一个与搜索条件匹配的现有flyweights，或者如果没有找到任何内容，则创建一个新的flyweights。</li>
</ol>
<h2 id="伪代码"><a href="#伪代码" class="headerlink" title="伪代码"></a>伪代码</h2><p>在本例中，Flyweight模式有助于在画布上渲染数百万个树对象时减少内存使用。</p>
<div align="center"> <img src="/images/flyweight-example.png"/></div>


<p>该模式从主类 该模式从主类 <code>Tree</code> 中提取重复的固有状态，并将其移动到flyweight类  中提取重复的固有状态，并将其移动到flyweight类  中提取重复的固有状态，并将其移动到flyweight类 <code>TreeType</code> 中。</p>
<p>现在，不再将相同的数据存储在多个对象中，而是将其保存在几个flyweight对象中，并链接到适当的 现在，不再将相同的数据存储在多个对象中，而是将其保存在几个flyweight对象中，并链接到适当的 <code>Tree</code> 对象，这些对象充当上下文。客户端代码使用flyweight工厂创建新的树对象，该工厂封装了搜索正确对象并在需要时重用它的复杂性。 对象，这些对象充当上下文。客户端代码使用flyweight工厂创建新的树对象，该工厂封装了搜索正确对象并在需要时重用它的复杂性。</p>
<p>现在，不再将相同的数据存储在多个对象中，而是将其保存在几个flyweight对象中，并链接到适当的 现在，不再将相同的数据存储在多个对象中，而是将其保存在几个flyweight对象中，并链接到适当的 <code>Tree</code> 对象，这些对象充当上下文。客户端代码使用flyweight工厂创建新的树对象，该工厂封装了搜索正确对象并在需要时重用它的复杂性。 对象，这些对象充当上下文。客户端代码使用flyweight工厂创建新的树对象，该工厂封装了搜索正确对象并在需要时重用它的复杂性。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// The flyweight class contains a portion of the state of a</span></span><br><span class="line"><span class="comment">// tree. These fields store values that are unique for each</span></span><br><span class="line"><span class="comment">// particular tree. For instance, you won&#x27;t find here the tree</span></span><br><span class="line"><span class="comment">// coordinates. But the texture and colors shared between many</span></span><br><span class="line"><span class="comment">// trees are here. Since this data is usually BIG, you&#x27;d waste a</span></span><br><span class="line"><span class="comment">// lot of memory by keeping it in each tree object. Instead, we</span></span><br><span class="line"><span class="comment">// can extract texture, color and other repeating data into a</span></span><br><span class="line"><span class="comment">// separate object which lots of individual tree objects can</span></span><br><span class="line"><span class="comment">// reference.</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">TreeType</span> is</span><br><span class="line">    field name</span><br><span class="line">    field color</span><br><span class="line">    field texture</span><br><span class="line">    constructor <span class="title function_">TreeType</span><span class="params">(name, color, texture)</span> &#123; ... &#125;</span><br><span class="line">    method <span class="title function_">draw</span><span class="params">(canvas, x, y)</span> is</span><br><span class="line">        <span class="comment">// 1. Create a bitmap of a given type, color &amp; texture.</span></span><br><span class="line">        <span class="comment">// 2. Draw the bitmap on the canvas at X and Y coords.</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Flyweight factory decides whether to re-use existing</span></span><br><span class="line"><span class="comment">// flyweight or to create a new object.</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">TreeFactory</span> is</span><br><span class="line">    <span class="keyword">static</span> field treeTypes: collection of tree types</span><br><span class="line">    <span class="keyword">static</span> method <span class="title function_">getTreeType</span><span class="params">(name, color, texture)</span> <span class="type">is</span></span><br><span class="line">        <span class="variable">type</span> <span class="operator">=</span> treeTypes.find(name, color, texture)</span><br><span class="line">        <span class="keyword">if</span> (type == <span class="literal">null</span>)</span><br><span class="line">            type = <span class="keyword">new</span> <span class="title class_">TreeType</span>(name, color, texture)</span><br><span class="line">            treeTypes.add(type)</span><br><span class="line">        <span class="keyword">return</span> type</span><br><span class="line"></span><br><span class="line"><span class="comment">// The contextual object contains the extrinsic part of the tree</span></span><br><span class="line"><span class="comment">// state. An application can create billions of these since they</span></span><br><span class="line"><span class="comment">// are pretty small: just two integer coordinates and one</span></span><br><span class="line"><span class="comment">// reference field.</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Tree</span> is</span><br><span class="line">    field x,y</span><br><span class="line">    field type: TreeType</span><br><span class="line">    constructor <span class="title function_">Tree</span><span class="params">(x, y, type)</span> &#123; ... &#125;</span><br><span class="line">    method <span class="title function_">draw</span><span class="params">(canvas)</span> is</span><br><span class="line">        type.draw(canvas, <span class="built_in">this</span>.x, <span class="built_in">this</span>.y)</span><br><span class="line"></span><br><span class="line"><span class="comment">// The Tree and the Forest classes are the flyweight&#x27;s clients.</span></span><br><span class="line"><span class="comment">// You can merge them if you don&#x27;t plan to develop the Tree</span></span><br><span class="line"><span class="comment">// class any further.</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Forest</span> is</span><br><span class="line">    field trees: collection of Trees</span><br><span class="line"></span><br><span class="line">    method <span class="title function_">plantTree</span><span class="params">(x, y, name, color, texture)</span> <span class="type">is</span></span><br><span class="line">        <span class="variable">type</span> <span class="operator">=</span> TreeFactory.getTreeType(name, color, texture)</span><br><span class="line">        tree = <span class="keyword">new</span> <span class="title class_">Tree</span>(x, y, type)</span><br><span class="line">        trees.add(tree)</span><br><span class="line"></span><br><span class="line">    method <span class="title function_">draw</span><span class="params">(canvas)</span> is</span><br><span class="line">        <span class="title function_">foreach</span> <span class="params">(tree in trees)</span> <span class="keyword">do</span></span><br><span class="line">            tree.draw(canvas)</span><br></pre></td></tr></table></figure>

<h2 id="适用性"><a href="#适用性" class="headerlink" title="适用性"></a>适用性</h2><ul>
<li><p><strong>只有当你的程序必须支持大量的对象，而这些对象几乎不能容纳在可用的RAM中时，才使用Flyweight模式。</strong></p>
</li>
<li><p>应用该模式的好处在很大程度上取决于如何以及在何处使用它。它在以下情况下最有用：</p>
<ul>
<li>应用程序需要产生大量的类似对象</li>
<li>这会耗尽目标设备上的所有可用RAM</li>
<li>对象包含可以在多个对象之间提取和共享的重复状态</li>
</ul>
</li>
</ul>
<h2 id="如何实现"><a href="#如何实现" class="headerlink" title="如何实现"></a>如何实现</h2><ol>
<li><p>将一个类的字段分成两部分，这两部分将成为一个flyweight：</p>
<ul>
<li>内部状态：包含跨多个对象复制的不变数据的字段</li>
<li>外部状态：包含每个对象唯一的上下文数据的字段</li>
</ul>
</li>
<li><p>将表示内部状态的字段保留在类中，但要确保它们是不可变的。它们应该只在构造函数内部取初始值。</p>
</li>
<li><p>检查使用外部状态字段的方法。对于方法中使用的每个字段，引入一个新参数并使用它来代替字段。</p>
</li>
<li><p>或者，创建一个工厂类来管理flyweights池。它应该在创建新的flyweight之前检查现有的flyweight。一旦工厂到位，客户端必须通过它请求flyweight。他们应该通过将其内在状态传递给工厂来描述所需的flyweight。</p>
</li>
<li><p>客户端必须存储或计算外部状态（上下文）的值，以便能够调用flyweight对象的方法。为了方便起见，可以将外部状态沿着飞权引用字段一起移动到单独的上下文类。</p>
</li>
</ol>
<h2 id="利弊"><a href="#利弊" class="headerlink" title="利弊"></a>利弊</h2><table>
<thead>
<tr>
<th>利√</th>
<th>弊×</th>
</tr>
</thead>
<tbody><tr>
<td>你可以保存大量的RAM，假设你的程序有很多类似的对象。</td>
<td>当每次有人调用flyweight方法时都需要重新计算一些上下文数据时，您可能会在CPU周期上牺牲RAM。</td>
</tr>
<tr>
<td></td>
<td>代码变得更加复杂。新的团队成员总是想知道为什么实体的状态以这种方式分离。</td>
</tr>
</tbody></table>
<h2 id="与其他模式的关系"><a href="#与其他模式的关系" class="headerlink" title="与其他模式的关系"></a>与其他模式的关系</h2><ul>
<li><p>您可以将复合树的共享叶节点实现为Flyweights，以保存一些RAM。</p>
</li>
<li><p>Flyweight展示了如何制作许多小对象，而Facade展示了如何制作代表整个子系统的单个对象。</p>
</li>
<li><p>如果你设法将对象的所有共享状态减少到一个flyweight对象，那么Flyweight就类似于Singleton。但这些模式之间有两个根本区别：</p>
<ul>
<li>应该只有一个Singleton实例，而Flyweight类可以有多个具有不同内部状态的实例。</li>
<li>Singleton对象可以是可变的。Flyweight对象是不可变的。</li>
</ul>
</li>
</ul>
<h2 id="代码示例"><a href="#代码示例" class="headerlink" title="代码示例"></a>代码示例</h2><h1 id="Python中的Flyweight模式"><a href="#Python中的Flyweight模式" class="headerlink" title="Python中的Flyweight模式"></a>Python中的Flyweight模式</h1><p>Flyweight是一种结构化设计模式，它允许程序通过保持低内存消耗来支持大量对象。</p>
<p>该模式通过在多个对象之间共享对象状态的一部分来实现。换句话说，Flyweight通过缓存不同对象使用的相同数据来节省RAM。</p>
<h2 id="概念示例"><a href="#概念示例" class="headerlink" title="概念示例"></a>概念示例</h2><p>这个例子说明了Flyweight设计模式的结构。它侧重于回答这些问题：</p>
<ul>
<li>它由哪些类组成？</li>
<li>这些班级扮演什么角色？</li>
<li>模式中的元素是以什么方式联系在一起的？</li>
</ul>
<h4 id="main-py：概念性示例"><a href="#main-py：概念性示例" class="headerlink" title="main.py：概念性示例"></a>main.py：概念性示例</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">Dict</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Flyweight</span>():</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    The Flyweight stores a common portion of the state (also called intrinsic</span></span><br><span class="line"><span class="string">    state) that belongs to multiple real business entities. The Flyweight</span></span><br><span class="line"><span class="string">    accepts the rest of the state (extrinsic state, unique for each entity) via</span></span><br><span class="line"><span class="string">    its method parameters.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, shared_state: <span class="built_in">str</span></span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">        self._shared_state = shared_state</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">operation</span>(<span class="params">self, unique_state: <span class="built_in">str</span></span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">        s = json.dumps(self._shared_state)</span><br><span class="line">        u = json.dumps(unique_state)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;Flyweight: Displaying shared (<span class="subst">&#123;s&#125;</span>) and unique (<span class="subst">&#123;u&#125;</span>) state.&quot;</span>, end=<span class="string">&quot;&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">FlyweightFactory</span>():</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    The Flyweight Factory creates and manages the Flyweight objects. It ensures</span></span><br><span class="line"><span class="string">    that flyweights are shared correctly. When the client requests a flyweight,</span></span><br><span class="line"><span class="string">    the factory either returns an existing instance or creates a new one, if it</span></span><br><span class="line"><span class="string">    doesn&#x27;t exist yet.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    _flyweights: <span class="type">Dict</span>[<span class="built_in">str</span>, Flyweight] = &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, initial_flyweights: <span class="type">Dict</span></span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">        <span class="keyword">for</span> state <span class="keyword">in</span> initial_flyweights:</span><br><span class="line">            self._flyweights[self.get_key(state)] = Flyweight(state)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_key</span>(<span class="params">self, state: <span class="type">Dict</span></span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        Returns a Flyweight&#x27;s string hash for a given state.</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;_&quot;</span>.join(<span class="built_in">sorted</span>(state))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_flyweight</span>(<span class="params">self, shared_state: <span class="type">Dict</span></span>) -&gt; Flyweight:</span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        Returns an existing Flyweight with a given state or creates a new one.</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">        key = self.get_key(shared_state)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> self._flyweights.get(key):</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;FlyweightFactory: Can&#x27;t find a flyweight, creating new one.&quot;</span>)</span><br><span class="line">            self._flyweights[key] = Flyweight(shared_state)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;FlyweightFactory: Reusing existing flyweight.&quot;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> self._flyweights[key]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">list_flyweights</span>(<span class="params">self</span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">        count = <span class="built_in">len</span>(self._flyweights)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;FlyweightFactory: I have <span class="subst">&#123;count&#125;</span> flyweights:&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;\n&quot;</span>.join(<span class="built_in">map</span>(<span class="built_in">str</span>, self._flyweights.keys())), end=<span class="string">&quot;&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">add_car_to_police_database</span>(<span class="params"></span></span><br><span class="line"><span class="params">    factory: FlyweightFactory, plates: <span class="built_in">str</span>, owner: <span class="built_in">str</span>,</span></span><br><span class="line"><span class="params">    brand: <span class="built_in">str</span>, model: <span class="built_in">str</span>, color: <span class="built_in">str</span></span></span><br><span class="line"><span class="params"></span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;\n\nClient: Adding a car to database.&quot;</span>)</span><br><span class="line">    flyweight = factory.get_flyweight([brand, model, color])</span><br><span class="line">    <span class="comment"># The client code either stores or calculates extrinsic state and passes it</span></span><br><span class="line">    <span class="comment"># to the flyweight&#x27;s methods.</span></span><br><span class="line">    flyweight.operation([plates, owner])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    The client code usually creates a bunch of pre-populated flyweights in the</span></span><br><span class="line"><span class="string">    initialization stage of the application.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    factory = FlyweightFactory([</span><br><span class="line">        [<span class="string">&quot;Chevrolet&quot;</span>, <span class="string">&quot;Camaro2018&quot;</span>, <span class="string">&quot;pink&quot;</span>],</span><br><span class="line">        [<span class="string">&quot;Mercedes Benz&quot;</span>, <span class="string">&quot;C300&quot;</span>, <span class="string">&quot;black&quot;</span>],</span><br><span class="line">        [<span class="string">&quot;Mercedes Benz&quot;</span>, <span class="string">&quot;C500&quot;</span>, <span class="string">&quot;red&quot;</span>],</span><br><span class="line">        [<span class="string">&quot;BMW&quot;</span>, <span class="string">&quot;M5&quot;</span>, <span class="string">&quot;red&quot;</span>],</span><br><span class="line">        [<span class="string">&quot;BMW&quot;</span>, <span class="string">&quot;X6&quot;</span>, <span class="string">&quot;white&quot;</span>],</span><br><span class="line">    ])</span><br><span class="line"></span><br><span class="line">    factory.list_flyweights()</span><br><span class="line"></span><br><span class="line">    add_car_to_police_database(</span><br><span class="line">        factory, <span class="string">&quot;CL234IR&quot;</span>, <span class="string">&quot;James Doe&quot;</span>, <span class="string">&quot;BMW&quot;</span>, <span class="string">&quot;M5&quot;</span>, <span class="string">&quot;red&quot;</span>)</span><br><span class="line"></span><br><span class="line">    add_car_to_police_database(</span><br><span class="line">        factory, <span class="string">&quot;CL234IR&quot;</span>, <span class="string">&quot;James Doe&quot;</span>, <span class="string">&quot;BMW&quot;</span>, <span class="string">&quot;X1&quot;</span>, <span class="string">&quot;red&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;\n&quot;</span>)</span><br><span class="line"></span><br><span class="line">    factory.list_flyweights()</span><br></pre></td></tr></table></figure>

<h4 id="执行结果"><a href="#执行结果" class="headerlink" title="执行结果"></a>执行结果</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">FlyweightFactory: I have 5 flyweights:</span><br><span class="line">Camaro2018_Chevrolet_pink</span><br><span class="line">C300_Mercedes Benz_black</span><br><span class="line">C500_Mercedes Benz_red</span><br><span class="line">BMW_M5_red</span><br><span class="line">BMW_X6_white</span><br><span class="line"></span><br><span class="line">Client: Adding a car to database.</span><br><span class="line">FlyweightFactory: Reusing existing flyweight.</span><br><span class="line">Flyweight: Displaying shared ([&quot;BMW&quot;, &quot;M5&quot;, &quot;red&quot;]) and unique ([&quot;CL234IR&quot;, &quot;James Doe&quot;]) state.</span><br><span class="line"></span><br><span class="line">Client: Adding a car to database.</span><br><span class="line">FlyweightFactory: Can&#x27;t find a flyweight, creating new one.</span><br><span class="line">Flyweight: Displaying shared ([&quot;BMW&quot;, &quot;X1&quot;, &quot;red&quot;]) and unique ([&quot;CL234IR&quot;, &quot;James Doe&quot;]) state.</span><br><span class="line"></span><br><span class="line">FlyweightFactory: I have 6 flyweights:</span><br><span class="line">Camaro2018_Chevrolet_pink</span><br><span class="line">C300_Mercedes Benz_black</span><br><span class="line">C500_Mercedes Benz_red</span><br><span class="line">BMW_M5_red</span><br><span class="line">BMW_X6_white</span><br><span class="line">BMW_X1_red</span><br></pre></td></tr></table></figure>

<h1 id="Rust中的Flyweight模式"><a href="#Rust中的Flyweight模式" class="headerlink" title="Rust中的Flyweight模式"></a>Rust中的Flyweight模式</h1><p>Flyweight是一种结构化设计模式，它允许程序通过保持低内存消耗来支持大量对象。</p>
<p>该模式通过在多个对象之间共享对象状态的一部分来实现。换句话说，Flyweight通过缓存不同对象使用的相同数据来节省RAM。</p>
<h2 id="字符的Flyweight"><a href="#字符的Flyweight" class="headerlink" title="字符的Flyweight"></a>字符的Flyweight</h2><p>在这个例子中，我们将为字符创建一个Flyweight模式，在这个模式中我们共享共同的字符对象以保存内存。</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Flyweight Character trait</span></span><br><span class="line"><span class="keyword">trait</span> <span class="title class_">Character</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">display</span>(&amp;<span class="keyword">self</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Concrete Character implementation</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">ConcreteCharacter</span> &#123;</span><br><span class="line">    symbol: <span class="type">char</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">Character</span> <span class="keyword">for</span> <span class="title class_">ConcreteCharacter</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">display</span>(&amp;<span class="keyword">self</span>) &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;Character: &#123;&#125;&quot;</span>, <span class="keyword">self</span>.symbol);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Flyweight factory for characters</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">CharacterFactory</span> &#123;</span><br><span class="line">    characters: std::collections::HashMap&lt;<span class="type">char</span>, <span class="type">Box</span>&lt;<span class="keyword">dyn</span> Character&gt;&gt;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">CharacterFactory</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">new</span>() <span class="punctuation">-&gt;</span> <span class="keyword">Self</span> &#123;</span><br><span class="line">        CharacterFactory &#123;</span><br><span class="line">            characters: std::collections::HashMap::<span class="title function_ invoke__">new</span>(),</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">get_character</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>, symbol: <span class="type">char</span>) <span class="punctuation">-&gt;</span> &amp;<span class="type">Box</span>&lt;<span class="keyword">dyn</span> Character&gt; &#123;</span><br><span class="line">        <span class="keyword">self</span>.characters</span><br><span class="line">            .<span class="title function_ invoke__">entry</span>(symbol)</span><br><span class="line">            .<span class="title function_ invoke__">or_insert</span>(<span class="type">Box</span>::<span class="title function_ invoke__">new</span>(ConcreteCharacter &#123; symbol &#125;))</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Usage</span></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">character_factory</span> = CharacterFactory::<span class="title function_ invoke__">new</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">char_a</span> = character_factory.<span class="title function_ invoke__">get_character</span>(<span class="string">&#x27;A&#x27;</span>);</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">char_b</span> = character_factory.<span class="title function_ invoke__">get_character</span>(<span class="string">&#x27;B&#x27;</span>);</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">char_a2</span> = character_factory.<span class="title function_ invoke__">get_character</span>(<span class="string">&#x27;A&#x27;</span>); <span class="comment">// Reusing &#x27;A&#x27;</span></span><br><span class="line"></span><br><span class="line">    char_a.<span class="title function_ invoke__">display</span>();</span><br><span class="line">    char_b.<span class="title function_ invoke__">display</span>();</span><br><span class="line">    char_a2.<span class="title function_ invoke__">display</span>(); <span class="comment">// The same instance as &#x27;A&#x27;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在这个例子中：</p>
<p>我们定义了一个包含 我们定义了一个包含 <code>display</code> 方法的  方法的  方法的 <code>Character</code> trait。</p>
<p><code>ConcreteCharacter</code> 结构体实现了  结构体实现了  结构体实现了 <code>Character</code> trait，并表示一个具体的字符对象。 trait，并表示一个具体的字符对象。</p>
<p><code>CharacterFactory</code> 结构体充当一个flyweight工厂，用于创建和管理角色对象。它使用HashMap来存储共享的角色对象。 结构体充当一个flyweight工厂，用于创建和管理角色对象。它使用HashMap来存储共享的角色对象。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://tonymistark.github.io/2024/01/29/design-pattern/facade/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Ice">
      <meta itemprop="description" content="安静地坐着学习">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="BLOG">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2024/01/29/design-pattern/facade/" class="post-title-link" itemprop="url">Facade 门面（外观）模式</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2024-01-29 22:15:32 / Modified: 22:47:19" itemprop="dateCreated datePublished" datetime="2024-01-29T22:15:32+08:00">2024-01-29</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/design-pattern/" itemprop="url" rel="index"><span itemprop="name">design-pattern</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="Symbols count in article">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">Symbols count in article: </span>
              <span>3k</span>
            </span>
            <span class="post-meta-item" title="Reading time">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">Reading time &asymp;</span>
              <span>11 mins.</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="意图"><a href="#意图" class="headerlink" title="意图"></a>意图</h2><p>Facade是一种结构化设计模式，它为库、框架或任何其他复杂的类集提供了一个简化的接口。</p>
<div align="center"> <img src="/images/facade.png"/></div>


<h2 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h2><p>设想一下，您必须让代码处理属于复杂库或框架的大量对象。通常，您需要初始化所有这些对象，跟踪依赖关系，以正确的顺序执行方法，等等。</p>
<p>因此，类的业务逻辑将与第三方类的实现细节紧密耦合，从而难以理解和维护。</p>
<h2 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h2><p>Facade是一个类，它为包含许多移动部件的复杂子系统提供简单的接口。与直接使用子系统相比，外观可能提供有限的功能。但是，它只包含客户真正关心的那些功能。</p>
<p>Having a facade is handy when you need to integrate your app with a sophisticated library that has dozens of features, but you just need a tiny bit of its functionality.<br>当你需要将你的应用与一个复杂的库集成时，拥有一个外观是很方便的，这个库有几十个功能，但你只需要它的一小部分功能。</p>
<p>例如，一个将猫的搞笑短视频上传到社交媒体的应用程序可能会使用专业的视频转换库。然而，它真正需要的只是一个带有单一方法 <code>encode(filename, format)</code> 的类。在创建这样一个类并将其与视频转换库连接之后，您将拥有第一个外观。</p>
<h2 id="现实世界的类比"><a href="#现实世界的类比" class="headerlink" title="现实世界的类比"></a>现实世界的类比</h2><div align="center"> <img src="/images/facade-live-example.png"/>通过电话订购。</div>


<p>当你打电话给一家商店下电话订单时，接线员是你对商店所有服务和部门的门面。运营商为您提供一个简单的语音界面，用于订购系统、支付网关和各种交付服务。</p>
<h2 id="结构"><a href="#结构" class="headerlink" title="结构"></a>结构</h2><div align="center"> <img src="/images/facade-structure.png"/></div>


<ol>
<li><strong>Facade</strong>提供了对子系统功能的特定部分的方便访问。它知道在哪里引导客户的请求，以及如何操作所有的活动部件。</li>
<li>可以创建一个<strong>Additional Facade</strong>类，以防止使用不相关的功能污染单个facade，这些功能可能会使其成为另一个复杂的结构。客户端和其他立面都可以使用其他立面。</li>
<li><strong>复杂子系统</strong>由几十个不同的对象组成。为了让它们都做一些有意义的事情，你必须深入研究子系统的实现细节，比如以正确的顺序初始化对象，并以正确的格式为它们提供数据。子系统类不知道facade的存在。他们在系统内运作，并直接相互合作。</li>
<li>客户端使用facade而不是直接调用子系统对象。</li>
</ol>
<h2 id="伪代码"><a href="#伪代码" class="headerlink" title="伪代码"></a>伪代码</h2><p>在本例中，Facade模式简化了与复杂视频转换框架的交互。</p>
<div align="center"> <img src="/images/facade-example1.png"/>在一个facade类中隔离多个依赖项的示例。</div>


<p>与其让你的代码直接与几十个框架类一起工作，不如创建一个facade类来封装这些功能，并将其隐藏在代码的其余部分中。这种结构还可以帮助您最大限度地减少升级到框架的未来版本或用另一个版本替换它的工作。你在应用中唯一需要改变的是facade方法的实现。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// These are some of the classes of a complex 3rd-party video</span></span><br><span class="line"><span class="comment">// conversion framework. We don&#x27;t control that code, therefore</span></span><br><span class="line"><span class="comment">// can&#x27;t simplify it.</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">VideoFile</span></span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">OggCompressionCodec</span></span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MPEG4CompressionCodec</span></span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CodecFactory</span></span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">BitrateReader</span></span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">AudioMixer</span></span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// We create a facade class to hide the framework&#x27;s complexity</span></span><br><span class="line"><span class="comment">// behind a simple interface. It&#x27;s a trade-off between</span></span><br><span class="line"><span class="comment">// functionality and simplicity.</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">VideoConverter</span> is</span><br><span class="line">    method <span class="title function_">convert</span><span class="params">(filename, format)</span>:File <span class="type">is</span></span><br><span class="line">        <span class="variable">file</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">VideoFile</span>(filename)</span><br><span class="line">        sourceCodec = (<span class="keyword">new</span> <span class="title class_">CodecFactory</span>).extract(file)</span><br><span class="line">        <span class="keyword">if</span> (format == <span class="string">&quot;mp4&quot;</span>)</span><br><span class="line">            destinationCodec = <span class="keyword">new</span> <span class="title class_">MPEG4CompressionCodec</span>()</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            destinationCodec = <span class="keyword">new</span> <span class="title class_">OggCompressionCodec</span>()</span><br><span class="line">        buffer = BitrateReader.read(filename, sourceCodec)</span><br><span class="line">        result = BitrateReader.convert(buffer, destinationCodec)</span><br><span class="line">        result = (<span class="keyword">new</span> <span class="title class_">AudioMixer</span>()).fix(result)</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">File</span>(result)</span><br><span class="line"></span><br><span class="line"><span class="comment">// Application classes don&#x27;t depend on a billion classes</span></span><br><span class="line"><span class="comment">// provided by the complex framework. Also, if you decide to</span></span><br><span class="line"><span class="comment">// switch frameworks, you only need to rewrite the facade class.</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Application</span> is</span><br><span class="line">    method <span class="title function_">main</span><span class="params">()</span> <span class="type">is</span></span><br><span class="line">        <span class="variable">convertor</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">VideoConverter</span>()</span><br><span class="line">        mp4 = convertor.convert(<span class="string">&quot;funny-cats-video.ogg&quot;</span>, <span class="string">&quot;mp4&quot;</span>)</span><br><span class="line">        mp4.save()</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="适用性"><a href="#适用性" class="headerlink" title="适用性"></a>适用性</h2><ul>
<li><strong>当您需要一个有限但直接的接口到一个复杂的子系统时，请使用Facade模式。</strong></li>
<li>通常，子系统会随着时间的推移变得更加复杂。即使应用设计模式通常也会导致创建更多的类。子系统可能变得更加灵活，更容易在各种上下文中重用，但它需要从客户端获得的配置和样板代码的数量越来越大。Facade试图通过提供子系统最常用功能的快捷方式来解决这个问题，以满足大多数客户的需求。</li>
<li>当你想把一个子系统组织成层时，使用Facade。</li>
<li>创建外观以定义子系统每个级别的入口点。您可以通过要求多个子系统仅通过外观进行通信来减少它们之间的耦合。例如，让我们回到我们的视频转换框架。它可以分为两个层次：视频和音频相关。对于每一层，您可以创建一个外观，然后使每一层的类通过这些外观相互通信。这种方法看起来与Mediator模式非常相似。</li>
</ul>
<h2 id="如何实施"><a href="#如何实施" class="headerlink" title="如何实施"></a>如何实施</h2><ol>
<li>检查是否有可能提供比现有子系统已经提供的接口更简单的接口。如果这个接口使客户机代码独立于许多子系统的类，那么您就走对了路。</li>
<li>在一个新的facade类中decompose并实现这个接口。facade应该将客户端代码的调用重定向到子系统的适当对象。facade应该负责初始化子系统并管理其进一步的生命周期，除非客户端代码已经这样做了。</li>
<li>要从模式中获得全部好处，请使所有客户机代码仅通过外观与子系统通信。现在，客户端代码受到保护，不受子系统代码中任何更改的影响。例如，当子系统升级到新版本时，您只需要修改外观中的代码。</li>
<li>如果外观变得太大，考虑将其行为的一部分提取到一个新的、改进的外观类中。</li>
</ol>
<h2 id="利弊"><a href="#利弊" class="headerlink" title="利弊"></a>利弊</h2><ul>
<li>利：您可以将代码与子系统的复杂性隔离开来。</li>
<li> 弊：facade可以成为耦合到应用程序的所有类的god对象。</li>
</ul>
<h2 id="与其他模式的关系"><a href="#与其他模式的关系" class="headerlink" title="与其他模式的关系"></a>与其他模式的关系</h2><ul>
<li><p>Facade为现有对象定义了一个新的接口，而Adapter试图使现有接口可用。Adapter通常只包装一个对象，而Facade则处理整个对象子系统。</p>
</li>
<li><p>当您只想隐藏从客户端代码创建子系统对象的方式时，抽象工厂可以作为Facade的替代方案。</p>
</li>
<li><p>Flyweight展示了如何制作许多小对象，而Facade展示了如何制作代表整个子系统的单个对象。</p>
</li>
<li><p>Facade和Mediator有着类似的工作：它们试图组织许多紧密耦合的类之间的协作。</p>
<ul>
<li>Facade为对象子系统定义了一个简化的接口，但它没有引入任何新功能。子系统本身不知道facade。子系统内的对象可以直接通信。</li>
<li>Mediator集中系统组件之间的通信。组件只知道中介对象，不直接通信。</li>
</ul>
</li>
<li><p>Facade类通常可以转换为Singleton，因为在大多数情况下，单个facade对象就足够了。</p>
</li>
<li><p>Facade与Proxy类似，都缓冲一个复杂的实体并自己初始化它。与Facade不同，Proxy与其服务对象具有相同的接口，这使得它们可以互换。</p>
</li>
</ul>
<h2 id="代码示例"><a href="#代码示例" class="headerlink" title="代码示例"></a>代码示例</h2><h1 id="Python中的Facade"><a href="#Python中的Facade" class="headerlink" title="Python中的Facade"></a>Python中的Facade</h1><p>Facade是一种结构化设计模式，它为复杂的类、库或框架系统提供了一个简化的（但有限的）接口。</p>
<p>虽然Facade降低了应用程序的整体复杂性，但它也有助于将不需要的依赖项移到一个地方。</p>
<h2 id="概念示例"><a href="#概念示例" class="headerlink" title="概念示例"></a>概念示例</h2><p>这个例子说明了Facade设计模式的结构。它侧重于回答这些问题：</p>
<ul>
<li>它由哪些类组成？</li>
<li>这些班级扮演什么角色？</li>
<li>模式中的元素是以什么方式联系在一起的？</li>
</ul>
<h4 id="main-py：概念性示例"><a href="#main-py：概念性示例" class="headerlink" title="main.py：概念性示例"></a>main.py：概念性示例</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> __future__ <span class="keyword">import</span> annotations</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Facade</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    The Facade class provides a simple interface to the complex logic of one or</span></span><br><span class="line"><span class="string">    several subsystems. The Facade delegates the client requests to the</span></span><br><span class="line"><span class="string">    appropriate objects within the subsystem. The Facade is also responsible for</span></span><br><span class="line"><span class="string">    managing their lifecycle. All of this shields the client from the undesired</span></span><br><span class="line"><span class="string">    complexity of the subsystem.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, subsystem1: Subsystem1, subsystem2: Subsystem2</span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        Depending on your application&#x27;s needs, you can provide the Facade with</span></span><br><span class="line"><span class="string">        existing subsystem objects or force the Facade to create them on its</span></span><br><span class="line"><span class="string">        own.</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">        self._subsystem1 = subsystem1 <span class="keyword">or</span> Subsystem1()</span><br><span class="line">        self._subsystem2 = subsystem2 <span class="keyword">or</span> Subsystem2()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">operation</span>(<span class="params">self</span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        The Facade&#x27;s methods are convenient shortcuts to the sophisticated</span></span><br><span class="line"><span class="string">        functionality of the subsystems. However, clients get only to a fraction</span></span><br><span class="line"><span class="string">        of a subsystem&#x27;s capabilities.</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">        results = []</span><br><span class="line">        results.append(<span class="string">&quot;Facade initializes subsystems:&quot;</span>)</span><br><span class="line">        results.append(self._subsystem1.operation1())</span><br><span class="line">        results.append(self._subsystem2.operation1())</span><br><span class="line">        results.append(<span class="string">&quot;Facade orders subsystems to perform the action:&quot;</span>)</span><br><span class="line">        results.append(self._subsystem1.operation_n())</span><br><span class="line">        results.append(self._subsystem2.operation_z())</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;\n&quot;</span>.join(results)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Subsystem1</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    The Subsystem can accept requests either from the facade or client directly.</span></span><br><span class="line"><span class="string">    In any case, to the Subsystem, the Facade is yet another client, and it&#x27;s</span></span><br><span class="line"><span class="string">    not a part of the Subsystem.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">operation1</span>(<span class="params">self</span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Subsystem1: Ready!&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># ...</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">operation_n</span>(<span class="params">self</span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Subsystem1: Go!&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Subsystem2</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    Some facades can work with multiple subsystems at the same time.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">operation1</span>(<span class="params">self</span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Subsystem2: Get ready!&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># ...</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">operation_z</span>(<span class="params">self</span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Subsystem2: Fire!&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">client_code</span>(<span class="params">facade: Facade</span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    The client code works with complex subsystems through a simple interface</span></span><br><span class="line"><span class="string">    provided by the Facade. When a facade manages the lifecycle of the</span></span><br><span class="line"><span class="string">    subsystem, the client might not even know about the existence of the</span></span><br><span class="line"><span class="string">    subsystem. This approach lets you keep the complexity under control.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(facade.operation(), end=<span class="string">&quot;&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    <span class="comment"># The client code may have some of the subsystem&#x27;s objects already created.</span></span><br><span class="line">    <span class="comment"># In this case, it might be worthwhile to initialize the Facade with these</span></span><br><span class="line">    <span class="comment"># objects instead of letting the Facade create new instances.</span></span><br><span class="line">    subsystem1 = Subsystem1()</span><br><span class="line">    subsystem2 = Subsystem2()</span><br><span class="line">    facade = Facade(subsystem1, subsystem2)</span><br><span class="line">    client_code(facade)</span><br></pre></td></tr></table></figure>

<h4 id="Output-txt：执行结果"><a href="#Output-txt：执行结果" class="headerlink" title="Output.txt：执行结果"></a>Output.txt：执行结果</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Facade initializes subsystems:</span><br><span class="line">Subsystem1: Ready!</span><br><span class="line">Subsystem2: Get ready!</span><br><span class="line">Facade orders subsystems to perform the action:</span><br><span class="line">Subsystem1: Go!</span><br><span class="line">Subsystem2: Fire!</span><br></pre></td></tr></table></figure>

<h1 id="Facade-in-Rust"><a href="#Facade-in-Rust" class="headerlink" title="Facade in Rust"></a><strong>Facade</strong> in Rust</h1><p>Facade是一种结构化设计模式，它为复杂的类、库或框架系统提供了一个简化的（但有限的）接口。</p>
<p>虽然Facade降低了应用程序的整体复杂性，但它也有助于将不需要的依赖项移到一个地方。</p>
<h2 id="概念示例-1"><a href="#概念示例-1" class="headerlink" title="概念示例"></a>概念示例</h2><p><code>pub struct WalletFacade</code> 在其API背后隐藏了复杂的逻辑。一个方法 <code>add_money_to_wallet</code> 在后台与账户、代码、钱包、通知和账本进行交互。</p>
<h4 id="wallet-facade-rs"><a href="#wallet-facade-rs" class="headerlink" title="wallet_facade.rs"></a><strong>wallet_facade.rs</strong></h4><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> crate::&#123;</span><br><span class="line">    account::Account, ledger::Ledger, notification::Notification, security_code::SecurityCode,</span><br><span class="line">    wallet::Wallet,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// Facade hides a complex logic behind the API.</span></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">struct</span> <span class="title class_">WalletFacade</span> &#123;</span><br><span class="line">    account: Account,</span><br><span class="line">    wallet: Wallet,</span><br><span class="line">    code: SecurityCode,</span><br><span class="line">    notification: Notification,</span><br><span class="line">    ledger: Ledger,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">WalletFacade</span> &#123;</span><br><span class="line">    <span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">new</span>(account_id: <span class="type">String</span>, code: <span class="type">u32</span>) <span class="punctuation">-&gt;</span> <span class="keyword">Self</span> &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;Starting create account&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> <span class="variable">this</span> = <span class="keyword">Self</span> &#123;</span><br><span class="line">            account: Account::<span class="title function_ invoke__">new</span>(account_id),</span><br><span class="line">            wallet: Wallet::<span class="title function_ invoke__">new</span>(),</span><br><span class="line">            code: SecurityCode::<span class="title function_ invoke__">new</span>(code),</span><br><span class="line">            notification: Notification,</span><br><span class="line">            ledger: Ledger,</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;Account created&quot;</span>);</span><br><span class="line">        this</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">add_money_to_wallet</span>(</span><br><span class="line">        &amp;<span class="keyword">mut</span> <span class="keyword">self</span>,</span><br><span class="line">        account_id: &amp;<span class="type">String</span>,</span><br><span class="line">        security_code: <span class="type">u32</span>,</span><br><span class="line">        amount: <span class="type">u32</span>,</span><br><span class="line">    ) <span class="punctuation">-&gt;</span> <span class="type">Result</span>&lt;(), <span class="type">String</span>&gt; &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;Starting add money to wallet&quot;</span>);</span><br><span class="line">        <span class="keyword">self</span>.account.<span class="title function_ invoke__">check</span>(account_id)?;</span><br><span class="line">        <span class="keyword">self</span>.code.<span class="title function_ invoke__">check</span>(security_code)?;</span><br><span class="line">        <span class="keyword">self</span>.wallet.<span class="title function_ invoke__">credit_balance</span>(amount);</span><br><span class="line">        <span class="keyword">self</span>.notification.<span class="title function_ invoke__">send_wallet_credit_notification</span>();</span><br><span class="line">        <span class="keyword">self</span>.ledger.<span class="title function_ invoke__">make_entry</span>(account_id, <span class="string">&quot;credit&quot;</span>.<span class="title function_ invoke__">into</span>(), amount);</span><br><span class="line">        <span class="title function_ invoke__">Ok</span>(())</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">deduct_money_from_wallet</span>(</span><br><span class="line">        &amp;<span class="keyword">mut</span> <span class="keyword">self</span>,</span><br><span class="line">        account_id: &amp;<span class="type">String</span>,</span><br><span class="line">        security_code: <span class="type">u32</span>,</span><br><span class="line">        amount: <span class="type">u32</span>,</span><br><span class="line">    ) <span class="punctuation">-&gt;</span> <span class="type">Result</span>&lt;(), <span class="type">String</span>&gt; &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;Starting debit money from wallet&quot;</span>);</span><br><span class="line">        <span class="keyword">self</span>.account.<span class="title function_ invoke__">check</span>(account_id)?;</span><br><span class="line">        <span class="keyword">self</span>.code.<span class="title function_ invoke__">check</span>(security_code)?;</span><br><span class="line">        <span class="keyword">self</span>.wallet.<span class="title function_ invoke__">debit_balance</span>(amount);</span><br><span class="line">        <span class="keyword">self</span>.notification.<span class="title function_ invoke__">send_wallet_debit_notification</span>();</span><br><span class="line">        <span class="keyword">self</span>.ledger.<span class="title function_ invoke__">make_entry</span>(account_id, <span class="string">&quot;debit&quot;</span>.<span class="title function_ invoke__">into</span>(), amount);</span><br><span class="line">        <span class="title function_ invoke__">Ok</span>(())</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="wallet-rs"><a href="#wallet-rs" class="headerlink" title="wallet.rs"></a><strong>wallet.rs</strong></h4><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">pub</span> <span class="keyword">struct</span> <span class="title class_">Wallet</span> &#123;</span><br><span class="line">    balance: <span class="type">u32</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">Wallet</span> &#123;</span><br><span class="line">    <span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">new</span>() <span class="punctuation">-&gt;</span> <span class="keyword">Self</span> &#123;</span><br><span class="line">        <span class="keyword">Self</span> &#123; balance: <span class="number">0</span> &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">credit_balance</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>, amount: <span class="type">u32</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.balance += amount;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">debit_balance</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>, amount: <span class="type">u32</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.balance</span><br><span class="line">            .<span class="title function_ invoke__">checked_sub</span>(amount)</span><br><span class="line">            .<span class="title function_ invoke__">expect</span>(<span class="string">&quot;Balance is not sufficient&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="account-rs"><a href="#account-rs" class="headerlink" title="account.rs"></a><strong>account.rs</strong></h4><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">pub</span> <span class="keyword">struct</span> <span class="title class_">Account</span> &#123;</span><br><span class="line">    name: <span class="type">String</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">Account</span> &#123;</span><br><span class="line">    <span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">new</span>(name: <span class="type">String</span>) <span class="punctuation">-&gt;</span> <span class="keyword">Self</span> &#123;</span><br><span class="line">        <span class="keyword">Self</span> &#123; name &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">check</span>(&amp;<span class="keyword">self</span>, name: &amp;<span class="type">String</span>) <span class="punctuation">-&gt;</span> <span class="type">Result</span>&lt;(), <span class="type">String</span>&gt; &#123;</span><br><span class="line">        <span class="keyword">if</span> &amp;<span class="keyword">self</span>.name != name &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="title function_ invoke__">Err</span>(<span class="string">&quot;Account name is incorrect&quot;</span>.<span class="title function_ invoke__">into</span>());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;Account verified&quot;</span>);</span><br><span class="line">        <span class="title function_ invoke__">Ok</span>(())</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="ledger-rs"><a href="#ledger-rs" class="headerlink" title="ledger.rs"></a><strong>ledger.rs</strong></h4><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">pub</span> <span class="keyword">struct</span> <span class="title class_">Ledger</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">Ledger</span> &#123;</span><br><span class="line">    <span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">make_entry</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>, account_id: &amp;<span class="type">String</span>, txn_type: <span class="type">String</span>, amount: <span class="type">u32</span>) &#123;</span><br><span class="line">        <span class="built_in">println!</span>(</span><br><span class="line">            <span class="string">&quot;Make ledger entry for accountId &#123;&#125; with transaction type &#123;&#125; for amount &#123;&#125;&quot;</span>,</span><br><span class="line">            account_id, txn_type, amount</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="notification-rs"><a href="#notification-rs" class="headerlink" title="notification.rs"></a><strong>notification.rs</strong></h4><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">pub</span> <span class="keyword">struct</span> <span class="title class_">Notification</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">Notification</span> &#123;</span><br><span class="line">    <span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">send_wallet_credit_notification</span>(&amp;<span class="keyword">self</span>) &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;Sending wallet credit notification&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">send_wallet_debit_notification</span>(&amp;<span class="keyword">self</span>) &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;Sending wallet debit notification&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="security-code-rs"><a href="#security-code-rs" class="headerlink" title="security_code.rs"></a><strong>security_code.rs</strong></h4><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">pub</span> <span class="keyword">struct</span> <span class="title class_">SecurityCode</span> &#123;</span><br><span class="line">    code: <span class="type">u32</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">SecurityCode</span> &#123;</span><br><span class="line">    <span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">new</span>(code: <span class="type">u32</span>) <span class="punctuation">-&gt;</span> <span class="keyword">Self</span> &#123;</span><br><span class="line">        <span class="keyword">Self</span> &#123; code &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">check</span>(&amp;<span class="keyword">self</span>, code: <span class="type">u32</span>) <span class="punctuation">-&gt;</span> <span class="type">Result</span>&lt;(), <span class="type">String</span>&gt; &#123;</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">self</span>.code != code &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="title function_ invoke__">Err</span>(<span class="string">&quot;Security code is incorrect&quot;</span>.<span class="title function_ invoke__">into</span>());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;Security code verified&quot;</span>);</span><br><span class="line">        <span class="title function_ invoke__">Ok</span>(())</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="main-rs"><a href="#main-rs" class="headerlink" title="main.rs"></a><strong>main.rs</strong></h4><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">mod</span> account;</span><br><span class="line"><span class="keyword">mod</span> ledger;</span><br><span class="line"><span class="keyword">mod</span> notification;</span><br><span class="line"><span class="keyword">mod</span> security_code;</span><br><span class="line"><span class="keyword">mod</span> wallet;</span><br><span class="line"><span class="keyword">mod</span> wallet_facade;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> wallet_facade::WalletFacade;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() <span class="punctuation">-&gt;</span> <span class="type">Result</span>&lt;(), <span class="type">String</span>&gt; &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">wallet</span> = WalletFacade::<span class="title function_ invoke__">new</span>(<span class="string">&quot;abc&quot;</span>.<span class="title function_ invoke__">into</span>(), <span class="number">1234</span>);</span><br><span class="line">    <span class="built_in">println!</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Wallet Facade interacts with the account, code, wallet, notification and</span></span><br><span class="line">    <span class="comment">// ledger behind the scenes.</span></span><br><span class="line">    wallet.<span class="title function_ invoke__">add_money_to_wallet</span>(&amp;<span class="string">&quot;abc&quot;</span>.<span class="title function_ invoke__">into</span>(), <span class="number">1234</span>, <span class="number">10</span>)?;</span><br><span class="line">    <span class="built_in">println!</span>();</span><br><span class="line"></span><br><span class="line">    wallet.<span class="title function_ invoke__">deduct_money_from_wallet</span>(&amp;<span class="string">&quot;abc&quot;</span>.<span class="title function_ invoke__">into</span>(), <span class="number">1234</span>, <span class="number">5</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="输出"><a href="#输出" class="headerlink" title="输出"></a>输出</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">Starting create account</span><br><span class="line">Account created</span><br><span class="line"></span><br><span class="line">Starting add money to wallet</span><br><span class="line">Account verified</span><br><span class="line">Security code verified</span><br><span class="line">Sending wallet credit notification</span><br><span class="line">Make ledger entry for accountId abc with transaction type credit for amount 10</span><br><span class="line"></span><br><span class="line">Starting debit money from wallet</span><br><span class="line">Account verified</span><br><span class="line">Security code verified</span><br><span class="line">Sending wallet debit notification</span><br><span class="line">Make ledger entry for accountId abc with transaction type debit for amount 5</span><br><span class="line"></span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://tonymistark.github.io/2024/01/28/design-pattern/decorator/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Ice">
      <meta itemprop="description" content="安静地坐着学习">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="BLOG">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2024/01/28/design-pattern/decorator/" class="post-title-link" itemprop="url">Decorator 装饰器模式</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2024-01-28 13:26:52 / Modified: 13:56:30" itemprop="dateCreated datePublished" datetime="2024-01-28T13:26:52+08:00">2024-01-28</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/design-pattern/" itemprop="url" rel="index"><span itemprop="name">design-pattern</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="Symbols count in article">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">Symbols count in article: </span>
              <span>6.5k</span>
            </span>
            <span class="post-meta-item" title="Reading time">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">Reading time &asymp;</span>
              <span>24 mins.</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="Decorator-装饰器模式"><a href="#Decorator-装饰器模式" class="headerlink" title="Decorator 装饰器模式"></a>Decorator 装饰器模式</h1><h2 id="Intent-意图"><a href="#Intent-意图" class="headerlink" title="Intent 意图"></a>Intent 意图</h2><p><strong>Decorator</strong>  is a structural design pattern that lets you attach new behaviors to objects by placing these objects inside special wrapper objects that contain the behaviors.<br><strong>装饰器</strong>是一种结构化设计模式，它允许您将新行为附加到对象，方法是将这些对象放置在包含行为的特殊包装器对象中。</p>
<div align="center"> <img src="/images/decorator.png"/></div>


<h2 id="Problem-问题"><a href="#Problem-问题" class="headerlink" title="Problem  问题"></a>Problem  问题</h2><p>Imagine that you’re working on a notification library which lets other programs notify their users about important events.<br>假设您正在处理一个通知库，该库允许其他程序通知其用户有关重要事件。</p>
<p>The initial version of the library was based on the <code>Notifier</code> class that had only a few fields, a constructor and a single <code>send</code> method. The method could accept a message argument from a client and send the message to a list of emails that were passed to the notifier via its constructor. A third-party app which acted as a client was supposed to create and configure the notifier object once, and then use it each time something important happened.<br>该库的初始版本基于只有几个字段、一个构造函数和一个 <code>send</code> 方法的 <code>Notifier</code> 类。该方法可以接受来自客户端的消息参数，并将消息发送到通过其构造函数传递给通知程序的电子邮件列表。作为客户端的第三方应用程序应该创建和配置一次通知程序对象，然后在每次发生重要事件时使用它。</p>
<div align="center"> <img src="/images/decorator-problem1.png"/>A program could use the notifier class to send notifications about important events to a predefined set of emails.</br>程序可以使用notifier类将有关重要事件的通知发送到一组预定义的电子邮件。</div>


<p>At some point, you realize that users of the library expect more than just email notifications. Many of them would like to receive an SMS about critical issues. Others would like to be notified on Facebook and, of course, the corporate users would love to get Slack notifications.在某种程度上，您意识到图书馆的用户期望的不仅仅是电子邮件通知。他们中的许多人希望收到关于关键问题的短信。其他人希望在Facebook上获得通知，当然，企业用户也希望获得Slack通知。</p>
<div align="center"> <img src="/images/decorator-problem2.png"/>Each notification type is implemented as a notifier’s subclass.</br>每个通知类型都作为通知程序的子类实现。</div>


<p>How hard can that be? You extended the <code>Notifier</code> class and put the additional notification methods into new subclasses. Now the client was supposed to instantiate the desired notification class and use it for all further notifications.<br>这能有多难您扩展了 <code>Notifier</code> 类，并将额外的通知方法放入新的子类中。现在，客户端应该实例化所需的通知类，并将其用于所有进一步的通知。</p>
<p>But then someone reasonably asked you, “Why can’t you use several notification types at once? If your house is on fire, you’d probably want to be informed through every channel.”<br>但是后来有人合理地问你，“为什么你不能同时使用几种通知类型？如果你的房子着火了，你可能希望通过各种渠道得到通知。“</p>
<p>You tried to address that problem by creating special subclasses which combined several notification methods within one class. However, it quickly became apparent that this approach would bloat the code immensely, not only the library code but the client code as well.<br>您试图通过创建特殊的子类来解决这个问题，这些子类在一个类中组合了几个通知方法。然而，很快就发现这种方法会极大地膨胀代码，不仅是库代码，而且还有客户机代码。</p>
<div align="center"> <img src="/images/decorator-problem2.png"/>Combinatorial explosion of subclasses.</br>子类的组合爆炸。</div>


<p>You have to find some other way to structure notifications classes so that their number won’t accidentally break some Guinness record.您必须找到其他方法来构造通知类，以便它们的数量不会意外地打破吉尼斯记录。</p>
<h2 id="Solution-解决方案"><a href="#Solution-解决方案" class="headerlink" title="Solution  解决方案"></a>Solution  解决方案</h2><p>Extending a class is the first thing that comes to mind when you need to alter an object’s behavior. However, inheritance has several serious caveats that you need to be aware of.<br>当您需要改变对象的行为时，首先想到的是扩展类。然而，继承有几个严重的警告，你需要知道。</p>
<ul>
<li>Inheritance is static. You can’t alter the behavior of an existing object at runtime. You can only replace the whole object with another one that’s created from a different subclass.<br>继承是静态的。不能在运行时改变现有对象的行为。你只能用另一个从不同子类创建的对象替换整个对象。</li>
<li>Subclasses can have just one parent class. In most languages, inheritance doesn’t let a class inherit behaviors of multiple classes at the same time.<br>子类只能有一个父类。在大多数语言中，继承不会让一个类同时继承多个类的行为。</li>
</ul>
<p>One of the ways to overcome these caveats is by using <em>Aggregation</em> or <em>Composition</em>  instead of <em>Inheritance</em>. Both of the alternatives work almost the same way: one object <em>has a</em> reference to another and delegates it some work, whereas with inheritance, the object itself <em>is</em> able to do that work, inheriting the behavior from its superclass.<br>克服这些警告的方法之一是使用聚合或组合而不是继承。这两种替代方法的工作方式几乎相同：一个对象引用另一个对象并委托它一些工作，而继承，对象本身能够完成这项工作，从其超类继承行为。</p>
<p>With this new approach you can easily substitute the linked “helper” object with another, changing the behavior of the container at runtime. An object can use the behavior of various classes, having references to multiple objects and delegating them all kinds of work. Aggregation&#x2F;composition is the key principle behind many design patterns, including Decorator. On that note, let’s return to the pattern discussion.<br>使用这种新方法，您可以轻松地将链接的“helper”对象替换为另一个对象，从而在运行时更改容器的行为。一个对象可以使用各种类的行为，引用多个对象并将各种工作委托给它们。聚合&#x2F;组合是许多设计模式背后的关键原则，包括Decorator。在这一点上，让我们回到模式讨论。</p>
<div align="center"> <img src="/images/decorator-solution1.png"/>Inheritance vs. Aggregation</br>继承与聚合</div>


<p>“Wrapper” is the alternative nickname for the Decorator pattern that clearly expresses the main idea of the pattern. A <em>wrapper</em> is an object that can be linked with some <em>target</em> object. The wrapper contains the same set of methods as the target and delegates to it all requests it receives. However, the wrapper may alter the result by doing something either before or after it passes the request to the target.<br>“Wrapper”是Decorator模式的另一个昵称，它清楚地表达了该模式的主要思想。包装器是可以与某个目标对象链接的对象。包装器包含与目标相同的方法集，并将其接收的所有请求委托给它。但是，包装器可以在将请求传递给目标之前或之后执行某些操作，从而改变结果。</p>
<p>When does a simple wrapper become the real decorator? As I mentioned, the wrapper implements the same interface as the wrapped object. That’s why from the client’s perspective these objects are identical. Make the wrapper’s reference field accept any object that follows that interface. This will let you cover an object in multiple wrappers, adding the combined behavior of all the wrappers to it.<br>什么时候简单的包装器变成了真实的装饰器？正如我提到的，包装器实现了与被包装对象相同的接口。这就是为什么从客户的角度来看，这些对象是相同的。使包装器的引用字段接受该接口后面的任何对象。这将允许您在多个包装器中覆盖一个对象，并将所有包装器的组合行为添加到该对象中。</p>
<p>In our notifications example, let’s leave the simple email notification behavior inside the base <code>Notifier</code> class, but turn all other notification methods into decorators.<br>在我们的通知示例中，让我们将简单的电子邮件通知行为留在基类 <code>Notifier</code> 中，但将所有其他通知方法转换为装饰器。</p>
<div align="center"> <img src="/images/decorator-solution2.png"/>Various notification methods become decorators.</br>各种通知方法成为装饰器。</div>


<p>The client code would need to wrap a basic notifier object into a set of decorators that match the client’s preferences. The resulting objects will be structured as a stack.客户机代码需要将一个基本的通知程序对象包装到一组符合客户机偏好的装饰器中。生成的对象将被构造为堆栈。</p>
<div align="center"> <img src="/images/decorator-solution2.png"/>Apps might configure complex stacks of notification decorators.</br>应用程序可能会配置复杂的通知装饰器堆栈。</div>


<p>The last decorator in the stack would be the object that the client actually works with. Since all decorators implement the same interface as the base notifier, the rest of the client code won’t care whether it works with the “pure” notifier object or the decorated one.<br>堆栈中的最后一个装饰器将是客户端实际使用的对象。由于所有装饰器都实现了与基本通知器相同的接口，因此客户端代码的其余部分不会关心它是与“纯”通知器对象一起工作还是与装饰的通知器对象一起工作。</p>
<p>We could apply the same approach to other behaviors such as formatting messages or composing the recipient list. The client can decorate the object with any custom decorators, as long as they follow the same interface as the others.<br>我们可以将相同的方法应用于其他行为，例如格式化消息或编写收件人列表。客户端可以使用任何自定义装饰器来装饰对象，只要它们遵循与其他装饰器相同的接口即可。</p>
<h2 id="Real-World-Analogy-现实世界的类比"><a href="#Real-World-Analogy-现实世界的类比" class="headerlink" title="Real-World Analogy  现实世界的类比"></a>Real-World Analogy  现实世界的类比</h2><div align="center"> <img src="/images/decorator-comic-1.png"/>You get a combined effect from wearing multiple pieces of clothing.</br>你会从穿多件衣服中得到一个综合效果。</div>


<p>Wearing clothes is an example of using decorators. When you’re cold, you wrap yourself in a sweater. If you’re still cold with a sweater, you can wear a jacket on top. If it’s raining, you can put on a raincoat. All of these garments “extend” your basic behavior but aren’t part of you, and you can easily take off any piece of clothing whenever you don’t need it.<br>穿衣服是使用装饰器的一个例子。当你冷的时候，你会把自己裹在毛衣里。如果你穿毛衣还是觉得冷，你可以在上面穿一件夹克。如果下雨，你可以穿上雨衣。所有这些衣服都“延伸”了你的基本行为，但不是你的一部分，你可以在不需要的时候轻松地脱掉任何一件衣服。</p>
<h2 id="Structure-结构"><a href="#Structure-结构" class="headerlink" title="Structure  结构"></a>Structure  结构</h2><div align="center"> <img src="/images/decorator-structure1.png"/></div>


<ol>
<li>The <strong>Component</strong> declares the common interface for both wrappers and wrapped objects.<br>组件声明了包装器和包装对象的公共接口。</li>
<li><strong>Concrete Component</strong> is a class of objects being wrapped. It defines the basic behavior, which can be altered by decorators.<br>具体组件是一个被包装的对象类。它定义了基本的行为，可以由装饰器修改。</li>
<li>The <strong>Base Decorator</strong> class has a field for referencing a wrapped object. The field’s type should be declared as the component interface so it can contain both concrete components and decorators. The base decorator delegates all operations to the wrapped object.<br>BaseDecorator类有一个用于引用包装对象的字段。字段的类型应该被声明为组件接口，这样它就可以包含具体的组件和装饰器。基本装饰器将所有操作委托给包装对象。</li>
<li><strong>Concrete Decorators</strong> define extra behaviors that can be added to components dynamically. Concrete decorators override methods of the base decorator and execute their behavior either before or after calling the parent method.<br>具体装饰器定义了可以动态添加到组件的额外行为。具体装饰器覆盖基本装饰器的方法，并在调用父方法之前或之后执行它们的行为。</li>
<li>The <strong>Client</strong> can wrap components in multiple layers of decorators, as long as it works with all objects via the component interface.<br>客户端可以将组件包装在多层装饰器中，只要它通过组件接口与所有对象一起工作。</li>
</ol>
<h2 id="Pseudocode-伪代码"><a href="#Pseudocode-伪代码" class="headerlink" title="Pseudocode  伪代码"></a>Pseudocode  伪代码</h2><p>In this example, the In this example, the <strong>Decorator</strong> pattern lets you compress and encrypt sensitive data independently from the code that actually uses this data. pattern lets you compress and encrypt sensitive data independently from the code that actually uses this data.在本例中，Decorator模式允许您独立于实际使用敏感数据的代码来压缩和加密这些数据。</p>
<div align="center"> <img src="/images/decorator-example1.png"/>The encryption and compression decorators example.</br>加密和压缩装饰器示例。</div>


<p>The application wraps the data source object with a pair of decorators. Both wrappers change the way the data is written to and read from the disk:<br>应用程序用一对装饰器包装数据源对象。这两种包装器都改变了数据写入磁盘和从磁盘读取的方式：</p>
<ul>
<li>Just before the data is <strong>written to disk</strong>, the decorators encrypt and compress it. The original class writes the encrypted and protected data to the file without knowing about the change.<br>就在数据写入磁盘之前，装饰器加密并压缩数据。原始类将加密和保护的数据写入文件，而不知道更改。</li>
<li>Right after the data is <strong>read from disk</strong>, it goes through the same decorators, which decompress and decode it.<br>在从磁盘读取数据之后，它会经过相同的装饰器，这些装饰器会对数据进行加密和解码。</li>
</ul>
<p>The decorators and the data source class implement the same interface, which makes them all interchangeable in the client code.<br>装饰器和数据源类实现了相同的接口，这使得它们在客户端代码中可以互换。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// The component interface defines operations that can be</span></span><br><span class="line"><span class="comment">// altered by decorators.</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">DataSource</span> is</span><br><span class="line">    method <span class="title function_">writeData</span><span class="params">(data)</span></span><br><span class="line">    method <span class="title function_">readData</span><span class="params">()</span>:data</span><br><span class="line"></span><br><span class="line"><span class="comment">// Concrete components provide default implementations for the</span></span><br><span class="line"><span class="comment">// operations. There might be several variations of these</span></span><br><span class="line"><span class="comment">// classes in a program.</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">FileDataSource</span> <span class="keyword">implements</span> <span class="title class_">DataSource</span> is</span><br><span class="line">    constructor <span class="title function_">FileDataSource</span><span class="params">(filename)</span> &#123; ... &#125;</span><br><span class="line"></span><br><span class="line">    method <span class="title function_">writeData</span><span class="params">(data)</span> is</span><br><span class="line">        <span class="comment">// Write data to file.</span></span><br><span class="line"></span><br><span class="line">    method <span class="title function_">readData</span><span class="params">()</span>:data is</span><br><span class="line">        <span class="comment">// Read data from file.</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// The base decorator class follows the same interface as the</span></span><br><span class="line"><span class="comment">// other components. The primary purpose of this class is to</span></span><br><span class="line"><span class="comment">// define the wrapping interface for all concrete decorators.</span></span><br><span class="line"><span class="comment">// The default implementation of the wrapping code might include</span></span><br><span class="line"><span class="comment">// a field for storing a wrapped component and the means to</span></span><br><span class="line"><span class="comment">// initialize it.</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">DataSourceDecorator</span> <span class="keyword">implements</span> <span class="title class_">DataSource</span> is</span><br><span class="line">    <span class="keyword">protected</span> field wrappee: DataSource</span><br><span class="line"></span><br><span class="line">    constructor <span class="title function_">DataSourceDecorator</span><span class="params">(source: DataSource)</span> <span class="type">is</span></span><br><span class="line">        <span class="variable">wrappee</span> <span class="operator">=</span> source</span><br><span class="line"></span><br><span class="line">    <span class="comment">// The base decorator simply delegates all work to the</span></span><br><span class="line">    <span class="comment">// wrapped component. Extra behaviors can be added in</span></span><br><span class="line">    <span class="comment">// concrete decorators.</span></span><br><span class="line">    method <span class="title function_">writeData</span><span class="params">(data)</span> is</span><br><span class="line">        wrappee.writeData(data)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Concrete decorators may call the parent implementation of</span></span><br><span class="line">    <span class="comment">// the operation instead of calling the wrapped object</span></span><br><span class="line">    <span class="comment">// directly. This approach simplifies extension of decorator</span></span><br><span class="line">    <span class="comment">// classes.</span></span><br><span class="line">    method <span class="title function_">readData</span><span class="params">()</span>:data is</span><br><span class="line">        <span class="keyword">return</span> wrappee.readData()</span><br><span class="line"></span><br><span class="line"><span class="comment">// Concrete decorators must call methods on the wrapped object,</span></span><br><span class="line"><span class="comment">// but may add something of their own to the result. Decorators</span></span><br><span class="line"><span class="comment">// can execute the added behavior either before or after the</span></span><br><span class="line"><span class="comment">// call to a wrapped object.</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">EncryptionDecorator</span> <span class="keyword">extends</span> <span class="title class_">DataSourceDecorator</span> is</span><br><span class="line">    method <span class="title function_">writeData</span><span class="params">(data)</span> is</span><br><span class="line">        <span class="comment">// 1. Encrypt passed data.</span></span><br><span class="line">        <span class="comment">// 2. Pass encrypted data to the wrappee&#x27;s writeData</span></span><br><span class="line">        <span class="comment">// method.</span></span><br><span class="line"></span><br><span class="line">    method <span class="title function_">readData</span><span class="params">()</span>:data is</span><br><span class="line">        <span class="comment">// 1. Get data from the wrappee&#x27;s readData method.</span></span><br><span class="line">        <span class="comment">// 2. Try to decrypt it if it&#x27;s encrypted.</span></span><br><span class="line">        <span class="comment">// 3. Return the result.</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// You can wrap objects in several layers of decorators.</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CompressionDecorator</span> <span class="keyword">extends</span> <span class="title class_">DataSourceDecorator</span> is</span><br><span class="line">    method <span class="title function_">writeData</span><span class="params">(data)</span> is</span><br><span class="line">        <span class="comment">// 1. Compress passed data.</span></span><br><span class="line">        <span class="comment">// 2. Pass compressed data to the wrappee&#x27;s writeData</span></span><br><span class="line">        <span class="comment">// method.</span></span><br><span class="line"></span><br><span class="line">    method <span class="title function_">readData</span><span class="params">()</span>:data is</span><br><span class="line">        <span class="comment">// 1. Get data from the wrappee&#x27;s readData method.</span></span><br><span class="line">        <span class="comment">// 2. Try to decompress it if it&#x27;s compressed.</span></span><br><span class="line">        <span class="comment">// 3. Return the result.</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// Option 1. A simple example of a decorator assembly.</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Application</span> is</span><br><span class="line">    method <span class="title function_">dumbUsageExample</span><span class="params">()</span> <span class="type">is</span></span><br><span class="line">        <span class="variable">source</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileDataSource</span>(<span class="string">&quot;somefile.dat&quot;</span>)</span><br><span class="line">        source.writeData(salaryRecords)</span><br><span class="line">        <span class="comment">// The target file has been written with plain data.</span></span><br><span class="line"></span><br><span class="line">        source = <span class="keyword">new</span> <span class="title class_">CompressionDecorator</span>(source)</span><br><span class="line">        source.writeData(salaryRecords)</span><br><span class="line">        <span class="comment">// The target file has been written with compressed</span></span><br><span class="line">        <span class="comment">// data.</span></span><br><span class="line"></span><br><span class="line">        source = <span class="keyword">new</span> <span class="title class_">EncryptionDecorator</span>(source)</span><br><span class="line">        <span class="comment">// The source variable now contains this:</span></span><br><span class="line">        <span class="comment">// Encryption &gt; Compression &gt; FileDataSource</span></span><br><span class="line">        source.writeData(salaryRecords)</span><br><span class="line">        <span class="comment">// The file has been written with compressed and</span></span><br><span class="line">        <span class="comment">// encrypted data.</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// Option 2. Client code that uses an external data source.</span></span><br><span class="line"><span class="comment">// SalaryManager objects neither know nor care about data</span></span><br><span class="line"><span class="comment">// storage specifics. They work with a pre-configured data</span></span><br><span class="line"><span class="comment">// source received from the app configurator.</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SalaryManager</span> is</span><br><span class="line">    field source: DataSource</span><br><span class="line"></span><br><span class="line">    constructor <span class="title function_">SalaryManager</span><span class="params">(source: DataSource)</span> &#123; ... &#125;</span><br><span class="line"></span><br><span class="line">    method <span class="title function_">load</span><span class="params">()</span> is</span><br><span class="line">        <span class="keyword">return</span> source.readData()</span><br><span class="line"></span><br><span class="line">    method <span class="title function_">save</span><span class="params">()</span> is</span><br><span class="line">        source.writeData(salaryRecords)</span><br><span class="line">    <span class="comment">// ...Other useful methods...</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// The app can assemble different stacks of decorators at</span></span><br><span class="line"><span class="comment">// runtime, depending on the configuration or environment.</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ApplicationConfigurator</span> is</span><br><span class="line">    method <span class="title function_">configurationExample</span><span class="params">()</span> <span class="type">is</span></span><br><span class="line">        <span class="variable">source</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileDataSource</span>(<span class="string">&quot;salary.dat&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> (enabledEncryption)</span><br><span class="line">            source = <span class="keyword">new</span> <span class="title class_">EncryptionDecorator</span>(source)</span><br><span class="line">        <span class="keyword">if</span> (enabledCompression)</span><br><span class="line">            source = <span class="keyword">new</span> <span class="title class_">CompressionDecorator</span>(source)</span><br><span class="line"></span><br><span class="line">        logger = <span class="keyword">new</span> <span class="title class_">SalaryManager</span>(source)</span><br><span class="line">        salary = logger.load()</span><br><span class="line">    <span class="comment">// ...</span></span><br></pre></td></tr></table></figure>

<h2 id="Applicability-适用性"><a href="#Applicability-适用性" class="headerlink" title="Applicability  适用性"></a>Applicability  适用性</h2><ul>
<li><p>Use the Decorator pattern when you need to be able to assign extra behaviors to objects at runtime without breaking the code that uses these objects.<br>当您需要能够在运行时为对象分配额外的行为而不破坏使用这些对象的代码时，请使用装饰器模式。</p>
</li>
<li><p>The Decorator lets you structure your business logic into layers, create a decorator for each layer and compose objects with various combinations of this logic at runtime. The client code can treat all these objects in the same way, since they all follow a common interface.<br>Decorator允许您将业务逻辑结构化到层中，为每一层创建一个装饰器，并在运行时使用此逻辑的各种组合来组合对象。客户端代码可以以相同的方式处理所有这些对象，因为它们都遵循一个公共接口。</p>
</li>
<li><p>Use the pattern when it’s awkward or not possible to extend an object’s behavior using inheritance.<br>当难以或不可能使用继承扩展对象的行为时，请使用该模式。</p>
</li>
<li><p>Many programming languages have the <code>final</code> keyword that can be used to prevent further extension of a class. For a final class, the only way to reuse the existing behavior would be to wrap the class with your own wrapper, using the Decorator pattern.<br>许多编程语言都有 <code>final</code> 关键字，可以用来防止类的进一步扩展。对于最后一个类，重用现有行为的唯一方法是使用自己的包装器（使用Decorator模式）包装该类。</p>
</li>
</ul>
<h2 id="How-to-Implement-如何实施"><a href="#How-to-Implement-如何实施" class="headerlink" title="How to Implement 如何实施"></a>How to Implement 如何实施</h2><ol>
<li>Make sure your business domain can be represented as a primary component with multiple optional layers over it.<br>确保您的业务域可以表示为一个主要组件，在其上有多个可选层。</li>
<li>Figure out what methods are common to both the primary component and the optional layers. Create a component interface and declare those methods there.<br>找出主要组件和可选层共有的方法。创建一个组件接口并在那里声明这些方法。</li>
<li>Create a concrete component class and define the base behavior in it.<br>创建一个具体的组件类，并在其中定义基本行为。</li>
<li>Create a base decorator class. It should have a field for storing a reference to a wrapped object. The field should be declared with the component interface type to allow linking to concrete components as well as decorators. The base decorator must delegate all work to the wrapped object.<br>创建一个基本装饰器类。它应该有一个用于存储对包装对象的引用的字段。该字段应该用组件接口类型声明，以允许链接到具体的组件以及装饰器。基本装饰器必须将所有工作委托给包装对象。</li>
<li>Make sure all classes implement the component interface.<br>确保所有类都实现组件接口。</li>
<li>Create concrete decorators by extending them from the base decorator. A concrete decorator must execute its behavior before or after the call to the parent method (which always delegates to the wrapped object).<br>通过从基本装饰器扩展它们来创建具体的装饰器。一个具体的装饰器必须在调用父方法之前或之后执行它的行为（父方法总是委托给被包装的对象）。</li>
<li>The client code must be responsible for creating decorators and composing them in the way the client needs.<br>客户端代码必须负责创建装饰器并以客户端需要的方式组合它们。</li>
</ol>
<h2 id="Pros-and-Cons"><a href="#Pros-and-Cons" class="headerlink" title="Pros and Cons"></a>Pros and Cons</h2><p>利弊</p>
<ul>
<li><p> You can extend an object’s behavior without making a new subclass.<br>你可以扩展一个对象的行为而不需要创建一个新的子类。</p>
</li>
<li><p> You can add or remove responsibilities from an object at runtime.<br>您可以在运行时添加或删除对象的责任。</p>
</li>
<li><p> You can combine several behaviors by wrapping an object into multiple decorators.<br>通过将一个对象包装到多个装饰器中，可以联合收割机组合多种行为。</p>
</li>
<li><p> <em>Single Responsibility Principle</em>. You can divide a monolithic class that implements many possible variants of behavior into several smaller classes.<br>单一责任原则。您可以将实现许多可能的行为变体的单体类划分为几个较小的类。</p>
</li>
<li><p> It’s hard to remove a specific wrapper from the wrappers stack.<br>很难从wrapper堆栈中删除特定的wrapper。</p>
</li>
<li><p> It’s hard to implement a decorator in such a way that its behavior doesn’t depend on the order in the decorators stack.<br>很难实现一个装饰器，使其行为不依赖于装饰器堆栈中的顺序。</p>
</li>
<li><p> The initial configuration code of layers might look pretty ugly.<br>层的初始配置代码可能看起来很难看。</p>
</li>
</ul>
<h2 id="Relations-with-Other-Patterns"><a href="#Relations-with-Other-Patterns" class="headerlink" title="Relations with Other Patterns"></a>Relations with Other Patterns</h2><p>与其他模式的关系</p>
<ul>
<li><p><a target="_blank" rel="noopener" href="https://refactoring.guru/design-patterns/adapter">Adapter</a> provides a completely different interface for accessing an existing object. On the other hand, with the <a target="_blank" rel="noopener" href="https://refactoring.guru/design-patterns/decorator">Decorator</a> pattern the interface either stays the same or gets extended. In addition, <em>Decorator</em> supports recursive composition, which isn’t possible when you use <em>Adapter</em>.<br>Adapter为访问现有对象提供了一个完全不同的接口。另一方面，对于Decorator模式，接口要么保持不变，要么得到扩展。此外，Decorator支持递归组合，这在使用Adapter时是不可能的。</p>
</li>
<li><p>With <a target="_blank" rel="noopener" href="https://refactoring.guru/design-patterns/adapter">Adapter</a> you access an existing object via different interface. With <a target="_blank" rel="noopener" href="https://refactoring.guru/design-patterns/proxy">Proxy</a>, the interface stays the same. With <a target="_blank" rel="noopener" href="https://refactoring.guru/design-patterns/decorator">Decorator</a> you access the object via an enhanced interface.<br>使用Adapter，您可以通过不同的接口访问现有对象。使用Proxy，接口保持不变。使用Decorator，您可以通过增强的接口访问对象。</p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://refactoring.guru/design-patterns/chain-of-responsibility">Chain of Responsibility</a> and <a target="_blank" rel="noopener" href="https://refactoring.guru/design-patterns/decorator">Decorator</a> have very similar class structures. Both patterns rely on recursive composition to pass the execution through a series of objects. However, there are several crucial differences.<br>Chain of Responsibility和Decorator具有非常相似的类结构。这两种模式都依赖于递归组合来通过一系列对象传递执行。然而，有几个关键的区别。</p>
<p>The <em>CoR</em> handlers can execute arbitrary operations independently of each other. They can also stop passing the request further at any point. On the other hand, various <em>Decorators</em> can extend the object’s behavior while keeping it consistent with the base interface. In addition, decorators aren’t allowed to break the flow of the request.</p>
</li>
</ul>
<p>CoR处理程序可以彼此独立地执行任意操作。他们也可以在任何时候停止进一步传递请求。另一方面，各种装饰器可以扩展对象的行为，同时保持它与基接口的一致性。此外，装饰器不允许中断请求流。</p>
<ul>
<li><p><a target="_blank" rel="noopener" href="https://refactoring.guru/design-patterns/composite">Composite</a> and <a target="_blank" rel="noopener" href="https://refactoring.guru/design-patterns/decorator">Decorator</a> have similar structure diagrams since both rely on recursive composition to organize an open-ended number of objects.<br>Composite和Decorator具有类似的结构图，因为它们都依赖于递归组合来组织开放数量的对象。</p>
<p>A <em>Decorator</em> is like a <em>Composite</em> but only has one child component. There’s another significant difference: <em>Decorator</em> adds additional responsibilities to the wrapped object, while <em>Composite</em> just “sums up” its children’s results.</p>
</li>
</ul>
<p>Decorator类似于Composite，但只有一个子组件。还有另一个显著的区别：Decorator为包装的对象添加了额外的责任，而Composite只是“总结”其子对象的结果。</p>
<p>  However, the patterns can also cooperate: you can use <em>Decorator</em> to extend the behavior of a specific object in the <em>Composite</em> tree.<br>然而，模式也可以合作：您可以使用Decorator来扩展Composite树中特定对象的行为。</p>
<ul>
<li>Designs that make heavy use of <a target="_blank" rel="noopener" href="https://refactoring.guru/design-patterns/composite">Composite</a> and <a target="_blank" rel="noopener" href="https://refactoring.guru/design-patterns/decorator">Decorator</a> can often benefit from using <a target="_blank" rel="noopener" href="https://refactoring.guru/design-patterns/prototype">Prototype</a>. Applying the pattern lets you clone complex structures instead of re-constructing them from scratch.<br>大量使用Composite和Decorator的设计通常可以从使用Prototype中受益。应用该模式可以克隆复杂的结构，而不是从头开始重新构造它们。</li>
<li><a target="_blank" rel="noopener" href="https://refactoring.guru/design-patterns/decorator">Decorator</a> lets you change the skin of an object, while <a target="_blank" rel="noopener" href="https://refactoring.guru/design-patterns/strategy">Strategy</a> lets you change the guts.<br>Decorator允许您更改对象的皮肤，而Strategy允许您更改内部。</li>
<li><a target="_blank" rel="noopener" href="https://refactoring.guru/design-patterns/decorator">Decorator</a> and <a target="_blank" rel="noopener" href="https://refactoring.guru/design-patterns/proxy">Proxy</a> have similar structures, but very different intents. Both patterns are built on the composition principle, where one object is supposed to delegate some of the work to another. The difference is that a <em>Proxy</em> usually manages the life cycle of its service object on its own, whereas the composition of <em>Decorators</em> is always controlled by the client.<br>Decorator和Proxy具有类似的结构，但意图非常不同。这两种模式都建立在组合原则上，其中一个对象应该将一些工作委托给另一个对象。不同之处在于，Proxy通常自己管理其服务对象的生命周期，而Decorators的组成始终由客户端控制。</li>
</ul>
<h1 id="Decorator-in-Python-Python中的Decorator"><a href="#Decorator-in-Python-Python中的Decorator" class="headerlink" title="Decorator in Python Python中的Decorator"></a><strong>Decorator</strong> in Python Python中的Decorator</h1><p><strong>Decorator</strong> is a structural pattern that allows adding new behaviors to objects dynamically by placing them inside special wrapper objects, called <em>decorators</em>.<br>装饰器是一种结构化模式，它允许通过将对象放置在特殊的包装器对象（称为装饰器）中来动态地向对象添加新行为。</p>
<p>Using decorators you can wrap objects countless number of times since both target objects and decorators follow the same interface. The resulting object will get a stacking behavior of all wrappers.<br>使用装饰器，你可以无数次地包装对象，因为目标对象和装饰器都遵循相同的接口。结果对象将获得所有包装器的堆叠行为。</p>
<h2 id="Conceptual-Example-概念示例"><a href="#Conceptual-Example-概念示例" class="headerlink" title="Conceptual Example 概念示例"></a>Conceptual Example 概念示例</h2><p>This example illustrates the structure of the <strong>Decorator</strong> design pattern. It focuses on answering these questions:<br>这个例子说明了装饰器设计模式的结构。它侧重于回答这些问题：</p>
<ul>
<li>What classes does it consist of?<br>它由哪些类组成？</li>
<li>What roles do these classes play?<br>这些班级扮演什么角色？</li>
<li>In what way the elements of the pattern are related?<br>模式中的元素是以什么方式联系在一起的？</li>
</ul>
<h4 id="main-py：概念性示例"><a href="#main-py：概念性示例" class="headerlink" title="main.py：概念性示例"></a>main.py：概念性示例</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Component</span>():</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    The base Component interface defines operations that can be altered by</span></span><br><span class="line"><span class="string">    decorators.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">operation</span>(<span class="params">self</span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ConcreteComponent</span>(<span class="title class_ inherited__">Component</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    Concrete Components provide default implementations of the operations. There</span></span><br><span class="line"><span class="string">    might be several variations of these classes.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">operation</span>(<span class="params">self</span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;ConcreteComponent&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Decorator</span>(<span class="title class_ inherited__">Component</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    The base Decorator class follows the same interface as the other components.</span></span><br><span class="line"><span class="string">    The primary purpose of this class is to define the wrapping interface for</span></span><br><span class="line"><span class="string">    all concrete decorators. The default implementation of the wrapping code</span></span><br><span class="line"><span class="string">    might include a field for storing a wrapped component and the means to</span></span><br><span class="line"><span class="string">    initialize it.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    _component: Component = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, component: Component</span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">        self._component = component</span><br><span class="line"></span><br><span class="line"><span class="meta">    @property</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">component</span>(<span class="params">self</span>) -&gt; Component:</span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        The Decorator delegates all work to the wrapped component.</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> self._component</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">operation</span>(<span class="params">self</span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">        <span class="keyword">return</span> self._component.operation()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ConcreteDecoratorA</span>(<span class="title class_ inherited__">Decorator</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    Concrete Decorators call the wrapped object and alter its result in some</span></span><br><span class="line"><span class="string">    way.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">operation</span>(<span class="params">self</span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        Decorators may call parent implementation of the operation, instead of</span></span><br><span class="line"><span class="string">        calling the wrapped object directly. This approach simplifies extension</span></span><br><span class="line"><span class="string">        of decorator classes.</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">f&quot;ConcreteDecoratorA(<span class="subst">&#123;self.component.operation()&#125;</span>)&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ConcreteDecoratorB</span>(<span class="title class_ inherited__">Decorator</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    Decorators can execute their behavior either before or after the call to a</span></span><br><span class="line"><span class="string">    wrapped object.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">operation</span>(<span class="params">self</span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">f&quot;ConcreteDecoratorB(<span class="subst">&#123;self.component.operation()&#125;</span>)&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">client_code</span>(<span class="params">component: Component</span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    The client code works with all objects using the Component interface. This</span></span><br><span class="line"><span class="string">    way it can stay independent of the concrete classes of components it works</span></span><br><span class="line"><span class="string">    with.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># ...</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;RESULT: <span class="subst">&#123;component.operation()&#125;</span>&quot;</span>, end=<span class="string">&quot;&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># ...</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    <span class="comment"># This way the client code can support both simple components...</span></span><br><span class="line">    simple = ConcreteComponent()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Client: I&#x27;ve got a simple component:&quot;</span>)</span><br><span class="line">    client_code(simple)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;\n&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># ...as well as decorated ones.</span></span><br><span class="line">    <span class="comment">#</span></span><br><span class="line">    <span class="comment"># Note how decorators can wrap not only simple components but the other</span></span><br><span class="line">    <span class="comment"># decorators as well.</span></span><br><span class="line">    decorator1 = ConcreteDecoratorA(simple)</span><br><span class="line">    decorator2 = ConcreteDecoratorB(decorator1)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Client: Now I&#x27;ve got a decorated component:&quot;</span>)</span><br><span class="line">    client_code(decorator2)</span><br></pre></td></tr></table></figure>

<h4 id="Output-txt：执行结果"><a href="#Output-txt：执行结果" class="headerlink" title="Output.txt：执行结果"></a>Output.txt：执行结果</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Client: I&#x27;ve got a simple component:</span><br><span class="line">RESULT: ConcreteComponent</span><br><span class="line"></span><br><span class="line">Client: Now I&#x27;ve got a decorated component:</span><br><span class="line">RESULT: ConcreteDecoratorB(ConcreteDecoratorA(ConcreteComponent))</span><br></pre></td></tr></table></figure>

<h1 id="Decorator-in-Rust-饰Rust"><a href="#Decorator-in-Rust-饰Rust" class="headerlink" title="Decorator in Rust 饰Rust"></a><strong>Decorator</strong> in Rust 饰Rust</h1><p><strong>Decorator</strong> is a structural pattern that allows adding new behaviors to objects dynamically by placing them inside special wrapper objects, called <em>decorators</em>.<br>装饰器是一种结构化模式，它允许通过将对象放置在特殊的包装器对象（称为装饰器）中来动态地向对象添加新行为。</p>
<p>Using decorators you can wrap objects countless number of times since both target objects and decorators follow the same interface. The resulting object will get a stacking behavior of all wrappers.<br>使用装饰器，你可以无数次地包装对象，因为目标对象和装饰器都遵循相同的接口。结果对象将获得所有包装器的堆叠行为。</p>
<h2 id="Input-streams-decoration"><a href="#Input-streams-decoration" class="headerlink" title="Input streams decoration"></a>Input streams decoration</h2><p>输入流装饰</p>
<p>There is a <em><strong>practical example</strong></em>  in Rust’s standard library for input&#x2F;output operations.<br>在Rust的标准库中有一个实际的输入&#x2F;输出操作示例。</p>
<p>A buffered reader decorates a vector reader adding buffered behavior.<br>缓冲读取器装饰添加缓冲行为的向量读取器。</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">input</span> = BufReader::<span class="title function_ invoke__">new</span>(Cursor::<span class="title function_ invoke__">new</span>(<span class="string">&quot;Input data&quot;</span>));</span><br><span class="line">input.<span class="title function_ invoke__">read</span>(&amp;<span class="keyword">mut</span> buf).<span class="title function_ invoke__">ok</span>();</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="main-rs"><a href="#main-rs" class="headerlink" title="main.rs"></a><strong>main.rs</strong></h4><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> std::io::&#123;BufReader, Cursor, Read&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">buf</span> = [<span class="number">0u8</span>; <span class="number">10</span>];</span><br><span class="line"></span><br><span class="line">    <span class="comment">// A buffered reader decorates a vector reader which wraps input data.</span></span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">input</span> = BufReader::<span class="title function_ invoke__">new</span>(Cursor::<span class="title function_ invoke__">new</span>(<span class="string">&quot;Input data&quot;</span>));</span><br><span class="line"></span><br><span class="line">    input.<span class="title function_ invoke__">read</span>(&amp;<span class="keyword">mut</span> buf).<span class="title function_ invoke__">ok</span>();</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print!</span>(<span class="string">&quot;Read from a buffered reader: &quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> <span class="variable">byte</span> <span class="keyword">in</span> buf &#123;</span><br><span class="line">        <span class="built_in">print!</span>(<span class="string">&quot;&#123;&#125;&quot;</span>, <span class="type">char</span>::<span class="title function_ invoke__">from</span>(byte));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">println!</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="Output-输出"><a href="#Output-输出" class="headerlink" title="Output 输出"></a>Output 输出</h3><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Read from a buffered reader: Input data</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://tonymistark.github.io/2023/12/07/design-pattern/composite/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Ice">
      <meta itemprop="description" content="安静地坐着学习">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="BLOG">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/12/07/design-pattern/composite/" class="post-title-link" itemprop="url">Composite 部分-整体模式</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2023-12-07 21:52:43" itemprop="dateCreated datePublished" datetime="2023-12-07T21:52:43+08:00">2023-12-07</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2024-01-28 13:29:31" itemprop="dateModified" datetime="2024-01-28T13:29:31+08:00">2024-01-28</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/design-pattern/" itemprop="url" rel="index"><span itemprop="name">design-pattern</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="Symbols count in article">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">Symbols count in article: </span>
              <span>5k</span>
            </span>
            <span class="post-meta-item" title="Reading time">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">Reading time &asymp;</span>
              <span>18 mins.</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="Composite-部分-整体模式"><a href="#Composite-部分-整体模式" class="headerlink" title="Composite 部分-整体模式"></a>Composite 部分-整体模式</h1><p>Also known as: Object Tree<br>也称为：对象树</p>
<h2 id="Intent-意图"><a href="#Intent-意图" class="headerlink" title="Intent 意图"></a>Intent 意图</h2><p><strong>Composite</strong> is a structural design pattern that lets you compose objects into tree structures and then work with these structures as if they were individual objects.<br>复合是一种结构设计模式，可用于将对象组合成树结构，然后像使用单个对象一样处理这些结构。</p>
<div align="center"> <img src="/images/composite-header.png"/></div>

<h2 id="Problem-问题"><a href="#Problem-问题" class="headerlink" title="Problem 问题"></a>Problem 问题</h2><p>Using the Composite pattern makes sense only when the core model of your app can be represented as a tree.<br>只有当应用的核心模型可以表示为树时，使用复合模式才有意义。</p>
<p>For example, imagine that you have two types of objects: <code>Products</code> and <code>Boxes</code>. A <code>Box</code> can contain several <code>Products</code> as well as a number of smaller <code>Boxes</code>. These little <code>Boxes</code> can also hold some <code>Products</code> or even smaller <code>Boxes</code>, and so on.<br>例如，假设您有两种类型的对象： <code>Products</code> 和 <code>Boxes</code>。 一个 <code>Box</code> 可以包含多个以及多个 <code>Products</code> 较小的 <code>Boxes</code>。这些小的也可以容纳一些 <code>Products</code> 甚至更小 <code>Boxes</code> 的 <code>Boxes</code> ，以此类推。</p>
<p>Say you decide to create an ordering system that uses these classes. Orders could contain simple products without any wrapping, as well as boxes stuffed with products…and other boxes. How would you determine the total price of such an order?<br>假设您决定创建一个使用这些类的排序系统。订单可以包含没有任何包装的简单产品，也可以包含装满产品的盒子……和其他盒子。您如何确定此类订单的总价？</p>
<div align="center"> <img src="/images/composite-problem-en.png"/>An order might comprise various products, packaged in boxes, which are packaged in bigger boxes and so on. The whole structure looks like an upside down tree.</br>一个订单可能包括各种产品，包装在盒子里，这些产品包装在更大的盒子里，依此类推。整个结构看起来像一棵倒置的树。</div>

<p>You could try the direct approach: unwrap all the boxes, go over all the products and then calculate the total. That would be doable in the real world; but in a program, it’s not as simple as running a loop. You have to know the classes of <code>Products</code> and <code>Boxes</code> you’re going through, the nesting level of the boxes and other nasty details beforehand. All of this makes the direct approach either too awkward or even impossible.<br>您可以尝试直接方法：打开所有盒子，检查所有产品，然后计算总数。这在现实世界中是可行的;但在程序中，它并不像运行循环那么简单。你必须事先知道 <code>Boxes</code> 你正在经历的 <code>Products</code> 类别、盒子的嵌套级别和其他令人讨厌的细节。所有这些都使得直接方法要么过于尴尬，甚至不可能。</p>
<h2 id="Solution-解决方案"><a href="#Solution-解决方案" class="headerlink" title="Solution 解决方案"></a>Solution 解决方案</h2><p>The Composite pattern suggests that you work with <code>Products</code> and <code>Boxes</code> through a common interface which declares a method for calculating the total price.<br>复合模式建议您使用 <code>Products</code> 并通过 <code>Boxes</code> 一个通用接口进行工作，该接口声明了计算总价的方法。</p>
<p>How would this method work? For a product, it’d simply return the product’s price. For a box, it’d go over each item the box contains, ask its price and then return a total for this box. If one of these items were a smaller box, that box would also start going over its contents and so on, until the prices of all inner components were calculated. A box could even add some extra cost to the final price, such as packaging cost.<br>这种方法如何工作？对于产品，它只会返回产品的价格。对于一个盒子，它会检查盒子里的每件物品，询问它的价格，然后返回这个盒子的总数。如果其中一个物品是一个较小的盒子，那么该盒子也会开始检查其内容，依此类推，直到计算出所有内部组件的价格。一个盒子甚至会给最终价格增加一些额外的成本，比如包装成本。</p>
<div align="center"> <img src="/images/composite-comic-1-en.png"/>The Composite pattern lets you run a behavior recursively over all components of an object tree.</br>Composite 模式允许您以递归方式对对象树的所有组件运行行为。</div>

<p>The greatest benefit of this approach is that you don’t need to care about the concrete classes of objects that compose the tree. You don’t need to know whether an object is a simple product or a sophisticated box. You can treat them all the same via the common interface. When you call a method, the objects themselves pass the request down the tree.<br>这种方法的最大好处是，您不需要关心组成树的具体对象类。您不需要知道一个对象是简单的产品还是复杂的盒子。您可以通过通用界面对它们一视同仁。调用方法时，对象本身会将请求传递到树中。</p>
<h2 id="Real-World-Analogy-真实世界的类比"><a href="#Real-World-Analogy-真实世界的类比" class="headerlink" title="Real-World Analogy 真实世界的类比"></a>Real-World Analogy 真实世界的类比</h2><div align="center"> <img src="/images/composite-live-example.png"/>An example of a military structure.</br>军事结构的一个例子。</div>
Armies of most countries are structured as hierarchies. An army consists of several divisions; a division is a set of brigades, and a brigade consists of platoons, which can be broken down into squads. Finally, a squad is a small group of real soldiers. Orders are given at the top of the hierarchy and passed down onto each level until every soldier knows what needs to be done.
大多数国家的军队都是等级制度。一支军队由几个师组成;一个师是一组旅，一个旅由排组成，排可以分解成小队。最后，小队是一小群真正的士兵。命令在等级制度的顶端下达，并向下传递到每个级别，直到每个士兵都知道需要做什么。

<h2 id="Structure-结构"><a href="#Structure-结构" class="headerlink" title="Structure 结构"></a>Structure 结构</h2><div align="center"> <img src="/images/composite-structure-en.png"/></div>

<ol>
<li><p>The <strong>Component</strong> interface describes operations that are common to both simple and complex elements of the tree.<br><strong>Component</strong> 接口描述树的简单元素和复杂元素通用的操作。</p>
</li>
<li><p>The Leaf is a basic element of a tree that doesn’t have sub-elements.<br>叶子是树的基本元素，没有子元素。</p>
</li>
</ol>
<p>Usually, leaf components end up doing most of the real work, since they don’t have anyone to delegate the work to.<br>通常，叶子组件最终会完成大部分实际工作，因为它们没有人可以将工作委派给它们。</p>
<ol start="3">
<li>The <strong>Container</strong> (aka composite) is an element that has sub-elements: leaves or other containers. A container doesn’t know the concrete classes of its children. It works with all sub-elements only via the component interface.<br>容器（又名复合）是一个具有子元素的元素：树叶或其他容器。容器不知道其子项的具体类。它仅通过组件接口处理所有子元素。</li>
</ol>
<p>Upon receiving a request, a container delegates the work to its sub-elements, processes intermediate results and then returns the final result to the client.<br>收到请求后，容器将工作委托给其子元素，处理中间结果，然后将最终结果返回给客户端。</p>
<ol start="4">
<li>The <strong>Client</strong> works with all elements through the component interface. As a result, the client can work in the same way with both simple or complex elements of the tree.<br>客户端通过组件接口处理所有元素。因此，客户端可以以相同的方式处理树的简单或复杂元素。</li>
</ol>
<h2 id="Pseudocode-伪代码"><a href="#Pseudocode-伪代码" class="headerlink" title="Pseudocode 伪代码"></a>Pseudocode 伪代码</h2><p>In this example, the <strong>Composite</strong> pattern lets you implement stacking of geometric shapes in a graphical editor.<br>在此示例中，复合模式允许您在图形编辑器中实现几何形状的堆叠。</p>
<div align="center"> <img src="/images/composite-example1.png"/>The geometric shapes editor example.</br>几何形状编辑器示例。</div>

<p>The <code>CompoundGraphic</code> class is a container that can comprise any number of sub-shapes, including other compound shapes. A compound shape has the same methods as a simple shape. However, instead of doing something on its own, a compound shape passes the request recursively to all its children and “sums up” the result.<br>该 <code>CompoundGraphic</code> 类是一个容器，可以包含任意数量的子形状，包括其他复合形状。复合形状与简单形状具有相同的方法。但是，复合形状不是自己执行某些操作，而是以递归方式将请求传递给其所有子项，并“汇总”结果。</p>
<p>The client code works with all shapes through the single interface common to all shape classes. Thus, the client doesn’t know whether it’s working with a simple shape or a compound one. The client can work with very complex object structures without being coupled to concrete classes that form that structure.<br>客户端代码通过所有形状类通用的单个接口处理所有形状。因此，客户不知道它是在处理简单形状还是复合形状。客户端可以使用非常复杂的对象结构，而无需与构成该结构的具体类耦合。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// The component interface declares common operations for both</span></span><br><span class="line"><span class="comment">// simple and complex objects of a composition.</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">Graphic</span> is</span><br><span class="line">    method <span class="title function_">move</span><span class="params">(x, y)</span></span><br><span class="line">    method <span class="title function_">draw</span><span class="params">()</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// The leaf class represents end objects of a composition. A</span></span><br><span class="line"><span class="comment">// leaf object can&#x27;t have any sub-objects. Usually, it&#x27;s leaf</span></span><br><span class="line"><span class="comment">// objects that do the actual work, while composite objects only</span></span><br><span class="line"><span class="comment">// delegate to their sub-components.</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Dot</span> <span class="keyword">implements</span> <span class="title class_">Graphic</span> is</span><br><span class="line">    field x, y</span><br><span class="line"></span><br><span class="line">    constructor <span class="title function_">Dot</span><span class="params">(x, y)</span> &#123; ... &#125;</span><br><span class="line"></span><br><span class="line">    method <span class="title function_">move</span><span class="params">(x, y)</span> is</span><br><span class="line">        <span class="built_in">this</span>.x += x, <span class="built_in">this</span>.y += y</span><br><span class="line"></span><br><span class="line">    method <span class="title function_">draw</span><span class="params">()</span> is</span><br><span class="line">        <span class="comment">// Draw a dot at X and Y.</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// All component classes can extend other components.</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Circle</span> <span class="keyword">extends</span> <span class="title class_">Dot</span> is</span><br><span class="line">    field radius</span><br><span class="line"></span><br><span class="line">    constructor <span class="title function_">Circle</span><span class="params">(x, y, radius)</span> &#123; ... &#125;</span><br><span class="line"></span><br><span class="line">    method <span class="title function_">draw</span><span class="params">()</span> is</span><br><span class="line">        <span class="comment">// Draw a circle at X and Y with radius R.</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// The composite class represents complex components that may</span></span><br><span class="line"><span class="comment">// have children. Composite objects usually delegate the actual</span></span><br><span class="line"><span class="comment">// work to their children and then &quot;sum up&quot; the result.</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CompoundGraphic</span> <span class="keyword">implements</span> <span class="title class_">Graphic</span> is</span><br><span class="line">    field children: array of Graphic</span><br><span class="line"></span><br><span class="line">    <span class="comment">// A composite object can add or remove other components</span></span><br><span class="line">    <span class="comment">// (both simple or complex) to or from its child list.</span></span><br><span class="line">    method <span class="title function_">add</span><span class="params">(child: Graphic)</span> is</span><br><span class="line">        <span class="comment">// Add a child to the array of children.</span></span><br><span class="line"></span><br><span class="line">    method <span class="title function_">remove</span><span class="params">(child: Graphic)</span> is</span><br><span class="line">        <span class="comment">// Remove a child from the array of children.</span></span><br><span class="line"></span><br><span class="line">    method <span class="title function_">move</span><span class="params">(x, y)</span> is</span><br><span class="line">        <span class="title function_">foreach</span> <span class="params">(child in children)</span> <span class="keyword">do</span></span><br><span class="line">            child.move(x, y)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// A composite executes its primary logic in a particular</span></span><br><span class="line">    <span class="comment">// way. It traverses recursively through all its children,</span></span><br><span class="line">    <span class="comment">// collecting and summing up their results. Since the</span></span><br><span class="line">    <span class="comment">// composite&#x27;s children pass these calls to their own</span></span><br><span class="line">    <span class="comment">// children and so forth, the whole object tree is traversed</span></span><br><span class="line">    <span class="comment">// as a result.</span></span><br><span class="line">    method <span class="title function_">draw</span><span class="params">()</span> is</span><br><span class="line">        <span class="comment">// 1. For each child component:</span></span><br><span class="line">        <span class="comment">//     - Draw the component.</span></span><br><span class="line">        <span class="comment">//     - Update the bounding rectangle.</span></span><br><span class="line">        <span class="comment">// 2. Draw a dashed rectangle using the bounding</span></span><br><span class="line">        <span class="comment">// coordinates.</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// The client code works with all the components via their base</span></span><br><span class="line"><span class="comment">// interface. This way the client code can support simple leaf</span></span><br><span class="line"><span class="comment">// components as well as complex composites.</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ImageEditor</span> is</span><br><span class="line">    field all: CompoundGraphic</span><br><span class="line"></span><br><span class="line">    method <span class="title function_">load</span><span class="params">()</span> <span class="type">is</span></span><br><span class="line">        <span class="variable">all</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CompoundGraphic</span>()</span><br><span class="line">        all.add(<span class="keyword">new</span> <span class="title class_">Dot</span>(<span class="number">1</span>, <span class="number">2</span>))</span><br><span class="line">        all.add(<span class="keyword">new</span> <span class="title class_">Circle</span>(<span class="number">5</span>, <span class="number">3</span>, <span class="number">10</span>))</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// Combine selected components into one complex composite</span></span><br><span class="line">    <span class="comment">// component.</span></span><br><span class="line">    method <span class="title function_">groupSelected</span><span class="params">(components: array of Graphic)</span> <span class="type">is</span></span><br><span class="line">        <span class="variable">group</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CompoundGraphic</span>()</span><br><span class="line">        foreach (component in components) <span class="keyword">do</span></span><br><span class="line">            group.add(component)</span><br><span class="line">            all.remove(component)</span><br><span class="line">        all.add(group)</span><br><span class="line">        <span class="comment">// All components will be drawn.</span></span><br><span class="line">        all.draw()</span><br></pre></td></tr></table></figure>

<h2 id="Applicability-适用性"><a href="#Applicability-适用性" class="headerlink" title="Applicability 适用性"></a>Applicability 适用性</h2><ul>
<li><p>** Use the Composite pattern when you have to implement a tree-like object structure. 当必须实现树状对象结构时，请使用 Composite 模式。**</p>
</li>
<li><p>The Composite pattern provides you with two basic element types that share a common interface: simple leaves and complex containers. A container can be composed of both leaves and other containers. This lets you construct a nested recursive object structure that resembles a tree.<br>Composite 模式为您提供了两种共享通用接口的基本元素类型：简单叶子和复杂容器。容器可以由叶子和其他容器组成。这使您可以构造类似于树的嵌套递归对象结构。</p>
</li>
<li><p><strong>Use the pattern when you want the client code to treat both simple and complex elements uniformly. 如果希望客户端代码统一处理简单元素和复杂元素，请使用该模式。</strong></p>
</li>
<li><p>All elements defined by the Composite pattern share a common interface. Using this interface, the client doesn’t have to worry about the concrete class of the objects it works with.<br>Composite 模式定义的所有元素共享一个公共接口。使用此接口，客户端不必担心它所处理的对象的具体类。</p>
</li>
</ul>
<h2 id="How-to-Implement-如何实现"><a href="#How-to-Implement-如何实现" class="headerlink" title="How to Implement 如何实现"></a>How to Implement 如何实现</h2><ol>
<li><p>Make sure that the core model of your app can be represented as a tree structure. Try to break it down into simple elements and containers. Remember that containers must be able to contain both simple elements and other containers.<br>确保应用的核心模型可以表示为树结构。尝试将其分解为简单的元素和容器。请记住，容器必须能够同时包含简单元素和其他容器。</p>
</li>
<li><p>Declare the component interface with a list of methods that make sense for both simple and complex components.<br>使用对简单和复杂组件都有意义的方法列表声明组件接口。</p>
</li>
<li><p>Create a leaf class to represent simple elements. A program may have multiple different leaf classes.<br>创建一个叶类来表示简单元素。一个程序可以有多个不同的叶类。</p>
</li>
</ol>
<p>Create a container class to represent complex elements. In this class, provide an array field for storing references to sub-elements. The array must be able to store both leaves and containers, so make sure it’s declared with the component interface type.<br>创建一个容器类来表示复杂元素。在此类中，提供一个数组字段，用于存储对子元素的引用。数组必须能够存储叶子和容器，因此请确保使用组件接口类型声明它。</p>
<ol start="4">
<li><p>While implementing the methods of the component interface, remember that a container is supposed to be delegating most of the work to sub-elements.<br>在实现组件接口的方法时，请记住，容器应该将大部分工作委托给子元素。</p>
</li>
<li><p>Finally, define the methods for adding and removal of child elements in the container.<br>最后，定义在容器中添加和删除子元素的方法。</p>
</li>
</ol>
<p>Keep in mind that these operations can be declared in the component interface. This would violate the Interface Segregation Principle because the methods will be empty in the leaf class. However, the client will be able to treat all the elements equally, even when composing the tree.<br>请记住，这些操作可以在组件接口中声明。这将违反接口隔离原则，因为方法在叶类中为空。但是，客户端将能够平等地对待所有元素，即使在组成树时也是如此。</p>
<h2 id="Pros-and-Cons-优点和缺点"><a href="#Pros-and-Cons-优点和缺点" class="headerlink" title="Pros and Cons 优点和缺点"></a>Pros and Cons 优点和缺点</h2><table>
<thead>
<tr>
<th>Pros 优点</th>
<th>Cons 缺点</th>
</tr>
</thead>
<tbody><tr>
<td>You can work with complex tree structures more conveniently: use polymorphism and recursion to your advantage. 您可以更方便地使用复杂的树结构：使用多态性和递归来发挥自己的优势。</td>
<td>It might be difficult to provide a common interface for classes whose functionality differs too much. In certain scenarios, you’d need to overgeneralize the component interface, making it harder to comprehend.可能很难为功能差异太大的类提供通用接口。在某些情况下，需要过度概括组件接口，使其更难理解。</td>
</tr>
<tr>
<td>Open&#x2F;Closed Principle. You can introduce new element types into the app without breaking the existing code, which now works with the object tree. 开&#x2F;闭原理。您可以在不破坏现有代码的情况下将新的元素类型引入应用程序，这些代码现在适用于对象树。</td>
<td></td>
</tr>
</tbody></table>
<h2 id="Relations-with-Other-Patterns-与其他模式的关系"><a href="#Relations-with-Other-Patterns-与其他模式的关系" class="headerlink" title="Relations with Other Patterns 与其他模式的关系"></a>Relations with Other Patterns 与其他模式的关系</h2><ul>
<li><p>You can use <strong>Builder</strong> when creating complex <strong>Composite</strong> trees because you can program its construction steps to work recursively.<br>在创建复杂的复合树时，可以使用 Builder，因为您可以对其构造步骤进行编程以递归方式工作。</p>
</li>
<li><p>Chain of <strong>Responsibility</strong> is often used in conjunction with <strong>Composite</strong>. In this case, when a leaf component gets a request, it may pass it through the chain of all of the parent components down to the root of the object tree.<br>责任链通常与复合结合使用。在这种情况下，当叶组件收到请求时，它可能会通过所有父组件的链向下传递到对象树的根目录。</p>
</li>
<li><p>You can use <strong>Iterators</strong> to traverse <strong>Composite</strong> trees.<br>可以使用迭代器遍历复合树。</p>
</li>
<li><p>You can use Visitor to execute an operation over an entire <strong>Composite</strong> tree.<br>您可以使用 Visitor 对整个复合树执行操作。</p>
</li>
<li><p>You can implement shared leaf nodes of the <strong>Composite</strong> tree as <strong>Flyweights</strong> to save some RAM.<br>您可以将复合树的共享叶节点实现为轻量级，以节省一些 RAM。</p>
</li>
<li><p><strong>Composite</strong> and <strong>Decorator</strong> have similar structure diagrams since both rely on recursive composition to organize an open-ended number of objects.<br>Composite 和 Decorator 具有相似的结构图，因为两者都依赖于递归组合来组织开放数量的对象。<br>A Decorator is like a Composite but only has one child component. There’s another significant difference: Decorator adds additional responsibilities to the wrapped object, while Composite just “sums up” its children’s results.<br>装饰器类似于 Composite，但只有一个子组件。还有另一个显著的区别：Decorator 为包装的对象添加了额外的职责，而 Composite 只是“汇总”其子对象的结果。<br>However, the patterns can also cooperate: you can use Decorator to extend the behavior of a specific object in the Composite tree.<br>但是，这些模式也可以协同工作：您可以使用 Decorator 来扩展 <strong>Composite</strong> 树中特定对象的行为。</p>
</li>
<li><p>Designs that make heavy use of <strong>Composite</strong> and <strong>Decorator</strong> can often benefit from using <strong>Prototype</strong>. Applying the pattern lets you clone complex structures instead of re-constructing them from scratch.<br>大量使用 <strong>Composite</strong> 和 <strong>Decorator</strong> 的设计通常可以从使用 <strong>Prototype</strong> 中受益。通过应用该模式，您可以克隆复杂的结构，而不是从头开始重新构建它们。</p>
</li>
</ul>
<h2 id="Code-Examples-代码示例"><a href="#Code-Examples-代码示例" class="headerlink" title="Code Examples 代码示例"></a>Code Examples 代码示例</h2><h3 id="Python-Conceptual-Example-概念示例"><a href="#Python-Conceptual-Example-概念示例" class="headerlink" title="Python Conceptual Example 概念示例"></a>Python Conceptual Example 概念示例</h3><p>This example illustrates the structure of the Composite design pattern. It focuses on answering these questions:<br>此示例阐释了 Composite 设计模式的结构。它侧重于回答以下问题：</p>
<ul>
<li>What classes does it consist of?<br>它由哪些类组成？</li>
<li>What roles do these classes play?<br>这些课程扮演什么角色？</li>
<li>In what way the elements of the pattern are related?<br>模式的元素以何种方式相关？</li>
</ul>
<h4 id="main-py"><a href="#main-py" class="headerlink" title="main.py"></a>main.py</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> __future__ <span class="keyword">import</span> annotations</span><br><span class="line"><span class="keyword">from</span> abc <span class="keyword">import</span> ABC, abstractmethod</span><br><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">List</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Component</span>(<span class="title class_ inherited__">ABC</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    The base Component class declares common operations for both simple and</span></span><br><span class="line"><span class="string">    complex objects of a composition.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">    @property</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">parent</span>(<span class="params">self</span>) -&gt; Component:</span><br><span class="line">        <span class="keyword">return</span> self._parent</span><br><span class="line"></span><br><span class="line"><span class="meta">    @parent.setter</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">parent</span>(<span class="params">self, parent: Component</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        Optionally, the base Component can declare an interface for setting and</span></span><br><span class="line"><span class="string">        accessing a parent of the component in a tree structure. It can also</span></span><br><span class="line"><span class="string">        provide some default implementation for these methods.</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">        self._parent = parent</span><br><span class="line"></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    In some cases, it would be beneficial to define the child-management</span></span><br><span class="line"><span class="string">    operations right in the base Component class. This way, you won&#x27;t need to</span></span><br><span class="line"><span class="string">    expose any concrete component classes to the client code, even during the</span></span><br><span class="line"><span class="string">    object tree assembly. The downside is that these methods will be empty for</span></span><br><span class="line"><span class="string">    the leaf-level components.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">add</span>(<span class="params">self, component: Component</span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">remove</span>(<span class="params">self, component: Component</span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">is_composite</span>(<span class="params">self</span>) -&gt; <span class="built_in">bool</span>:</span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        You can provide a method that lets the client code figure out whether a</span></span><br><span class="line"><span class="string">        component can bear children.</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"><span class="meta">    @abstractmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">operation</span>(<span class="params">self</span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        The base Component may implement some default behavior or leave it to</span></span><br><span class="line"><span class="string">        concrete classes (by declaring the method containing the behavior as</span></span><br><span class="line"><span class="string">        &quot;abstract&quot;).</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Leaf</span>(<span class="title class_ inherited__">Component</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    The Leaf class represents the end objects of a composition. A leaf can&#x27;t</span></span><br><span class="line"><span class="string">    have any children.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Usually, it&#x27;s the Leaf objects that do the actual work, whereas Composite</span></span><br><span class="line"><span class="string">    objects only delegate to their sub-components.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">operation</span>(<span class="params">self</span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Leaf&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Composite</span>(<span class="title class_ inherited__">Component</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    The Composite class represents the complex components that may have</span></span><br><span class="line"><span class="string">    children. Usually, the Composite objects delegate the actual work to their</span></span><br><span class="line"><span class="string">    children and then &quot;sum-up&quot; the result.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">        self._children: <span class="type">List</span>[Component] = []</span><br><span class="line"></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    A composite object can add or remove other components (both simple or</span></span><br><span class="line"><span class="string">    complex) to or from its child list.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">add</span>(<span class="params">self, component: Component</span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">        self._children.append(component)</span><br><span class="line">        component.parent = self</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">remove</span>(<span class="params">self, component: Component</span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">        self._children.remove(component)</span><br><span class="line">        component.parent = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">is_composite</span>(<span class="params">self</span>) -&gt; <span class="built_in">bool</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">operation</span>(<span class="params">self</span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        The Composite executes its primary logic in a particular way. It</span></span><br><span class="line"><span class="string">        traverses recursively through all its children, collecting and summing</span></span><br><span class="line"><span class="string">        their results. Since the composite&#x27;s children pass these calls to their</span></span><br><span class="line"><span class="string">        children and so forth, the whole object tree is traversed as a result.</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">        results = []</span><br><span class="line">        <span class="keyword">for</span> child <span class="keyword">in</span> self._children:</span><br><span class="line">            results.append(child.operation())</span><br><span class="line">        <span class="keyword">return</span> <span class="string">f&quot;Branch(<span class="subst">&#123;<span class="string">&#x27;+&#x27;</span>.join(results)&#125;</span>)&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">client_code</span>(<span class="params">component: Component</span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    The client code works with all of the components via the base interface.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;RESULT: <span class="subst">&#123;component.operation()&#125;</span>&quot;</span>, end=<span class="string">&quot;&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">client_code2</span>(<span class="params">component1: Component, component2: Component</span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    Thanks to the fact that the child-management operations are declared in the</span></span><br><span class="line"><span class="string">    base Component class, the client code can work with any component, simple or</span></span><br><span class="line"><span class="string">    complex, without depending on their concrete classes.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> component1.is_composite():</span><br><span class="line">        component1.add(component2)</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;RESULT: <span class="subst">&#123;component1.operation()&#125;</span>&quot;</span>, end=<span class="string">&quot;&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    <span class="comment"># This way the client code can support the simple leaf components...</span></span><br><span class="line">    simple = Leaf()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Client: I&#x27;ve got a simple component:&quot;</span>)</span><br><span class="line">    client_code(simple)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;\n&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># ...as well as the complex composites.</span></span><br><span class="line">    tree = Composite()</span><br><span class="line"></span><br><span class="line">    branch1 = Composite()</span><br><span class="line">    branch1.add(Leaf())</span><br><span class="line">    branch1.add(Leaf())</span><br><span class="line"></span><br><span class="line">    branch2 = Composite()</span><br><span class="line">    branch2.add(Leaf())</span><br><span class="line"></span><br><span class="line">    tree.add(branch1)</span><br><span class="line">    tree.add(branch2)</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Client: Now I&#x27;ve got a composite tree:&quot;</span>)</span><br><span class="line">    client_code(tree)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;\n&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Client: I don&#x27;t need to check the components classes even when managing the tree:&quot;</span>)</span><br><span class="line">    client_code2(tree, simple)</span><br></pre></td></tr></table></figure>

<h4 id="Output-txt-Execution-result"><a href="#Output-txt-Execution-result" class="headerlink" title="Output.txt: Execution result"></a>Output.txt: Execution result</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Client: I&#x27;ve got a simple component:</span><br><span class="line">RESULT: Leaf</span><br><span class="line"></span><br><span class="line">Client: Now I&#x27;ve got a composite tree:</span><br><span class="line">RESULT: Branch(Branch(Leaf+Leaf)+Branch(Leaf))</span><br><span class="line"></span><br><span class="line">Client: I don&#x27;t need to check the components classes even when managing the tree:</span><br><span class="line">RESULT: Branch(Branch(Leaf+Leaf)+Branch(Leaf)+Leaf)</span><br></pre></td></tr></table></figure>

<h3 id="Rust-Files-and-Folders-文件和文件夹"><a href="#Rust-Files-and-Folders-文件和文件夹" class="headerlink" title="Rust: Files and Folders 文件和文件夹"></a>Rust: Files and Folders 文件和文件夹</h3><p>Let’s try to understand the Composite pattern with an example of an operating system’s file system. In the file system, there are two types of objects: files and folders. There are cases when files and folders should be treated to be the same way. This is where the Composite pattern comes in handy.<br>让我们尝试通过操作系统文件系统的示例来理解 Composite 模式。在文件系统中，有两种类型的对象：文件和文件夹。在某些情况下，文件和文件夹应以相同的方式处理。这就是复合模式派上用场的地方。</p>
<p>File and Directory are both of the trait Component with a single search method. For a file, it will just look into the contents of the file; for a folder, it will go through all files of that folder to find that keyword.<br>File 并且 Directory 都 trait Component 使用单一 search 方法。对于文件，它只会查看文件的内容;对于文件夹，它将遍历该文件夹的所有文件以查找该关键字。</p>
<h4 id="fs-mod-rs"><a href="#fs-mod-rs" class="headerlink" title="fs&#x2F;mod.rs"></a>fs&#x2F;mod.rs</h4><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">mod</span> file;</span><br><span class="line"><span class="keyword">mod</span> folder;</span><br><span class="line"></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">use</span> file::File;</span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">use</span> folder::Folder;</span><br><span class="line"></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">trait</span> <span class="title class_">Component</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">search</span>(&amp;<span class="keyword">self</span>, keyword: &amp;<span class="type">str</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="fs-file-rs"><a href="#fs-file-rs" class="headerlink" title="fs&#x2F;file.rs"></a>fs&#x2F;file.rs</h4><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> super::Component;</span><br><span class="line"></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">struct</span> <span class="title class_">File</span> &#123;</span><br><span class="line">    name: &amp;<span class="symbol">&#x27;static</span> <span class="type">str</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">File</span> &#123;</span><br><span class="line">    <span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">new</span>(name: &amp;<span class="symbol">&#x27;static</span> <span class="type">str</span>) <span class="punctuation">-&gt;</span> <span class="keyword">Self</span> &#123;</span><br><span class="line">        <span class="keyword">Self</span> &#123; name &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">Component</span> <span class="keyword">for</span> <span class="title class_">File</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">search</span>(&amp;<span class="keyword">self</span>, keyword: &amp;<span class="type">str</span>) &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;Searching for keyword &#123;&#125; in file &#123;&#125;&quot;</span>, keyword, <span class="keyword">self</span>.name);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="fs-folder-rs"><a href="#fs-folder-rs" class="headerlink" title="fs&#x2F;folder.rs"></a>fs&#x2F;folder.rs</h4><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> super::Component;</span><br><span class="line"></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">struct</span> <span class="title class_">Folder</span> &#123;</span><br><span class="line">    name: &amp;<span class="symbol">&#x27;static</span> <span class="type">str</span>,</span><br><span class="line">    components: <span class="type">Vec</span>&lt;<span class="type">Box</span>&lt;<span class="keyword">dyn</span> Component&gt;&gt;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">Folder</span> &#123;</span><br><span class="line">    <span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">new</span>(name: &amp;<span class="symbol">&#x27;static</span> <span class="type">str</span>) <span class="punctuation">-&gt;</span> <span class="keyword">Self</span> &#123;</span><br><span class="line">        <span class="keyword">Self</span> &#123;</span><br><span class="line">            name,</span><br><span class="line">            components: <span class="built_in">vec!</span>[],</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">add</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>, component: <span class="keyword">impl</span> <span class="title class_">Component</span> + <span class="symbol">&#x27;static</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.components.<span class="title function_ invoke__">push</span>(<span class="type">Box</span>::<span class="title function_ invoke__">new</span>(component));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">Component</span> <span class="keyword">for</span> <span class="title class_">Folder</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">search</span>(&amp;<span class="keyword">self</span>, keyword: &amp;<span class="type">str</span>) &#123;</span><br><span class="line">        <span class="built_in">println!</span>(</span><br><span class="line">            <span class="string">&quot;Searching recursively for keyword &#123;&#125; in folder &#123;&#125;&quot;</span>,</span><br><span class="line">            keyword, <span class="keyword">self</span>.name</span><br><span class="line">        );</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> <span class="variable">component</span> <span class="keyword">in</span> <span class="keyword">self</span>.components.<span class="title function_ invoke__">iter</span>() &#123;</span><br><span class="line">            component.<span class="title function_ invoke__">search</span>(keyword);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="main-rs"><a href="#main-rs" class="headerlink" title="main.rs"></a>main.rs</h4><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">mod</span> fs;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> fs::&#123;Component, File, Folder&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">file1</span> = File::<span class="title function_ invoke__">new</span>(<span class="string">&quot;File 1&quot;</span>);</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">file2</span> = File::<span class="title function_ invoke__">new</span>(<span class="string">&quot;File 2&quot;</span>);</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">file3</span> = File::<span class="title function_ invoke__">new</span>(<span class="string">&quot;File 3&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">folder1</span> = Folder::<span class="title function_ invoke__">new</span>(<span class="string">&quot;Folder 1&quot;</span>);</span><br><span class="line">    folder1.<span class="title function_ invoke__">add</span>(file1);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">folder2</span> = Folder::<span class="title function_ invoke__">new</span>(<span class="string">&quot;Folder 2&quot;</span>);</span><br><span class="line">    folder2.<span class="title function_ invoke__">add</span>(file2);</span><br><span class="line">    folder2.<span class="title function_ invoke__">add</span>(file3);</span><br><span class="line">    folder2.<span class="title function_ invoke__">add</span>(folder1);</span><br><span class="line"></span><br><span class="line">    folder2.<span class="title function_ invoke__">search</span>(<span class="string">&quot;rose&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="Output-输出"><a href="#Output-输出" class="headerlink" title="Output 输出"></a>Output 输出</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Searching recursively for keyword rose in folder Folder 2</span><br><span class="line">Searching for keyword rose in file File 2</span><br><span class="line">Searching for keyword rose in file File 3</span><br><span class="line">Searching recursively for keyword rose in folder Folder 1</span><br><span class="line">Searching for keyword rose in file File 1</span><br><span class="line">------------------------------------</span><br></pre></td></tr></table></figure>



      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://tonymistark.github.io/2023/12/06/design-pattern/bridge/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Ice">
      <meta itemprop="description" content="安静地坐着学习">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="BLOG">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/12/06/design-pattern/bridge/" class="post-title-link" itemprop="url">Bridge</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2023-12-06 21:36:04 / Modified: 22:52:20" itemprop="dateCreated datePublished" datetime="2023-12-06T21:36:04+08:00">2023-12-06</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/design-pattern/" itemprop="url" rel="index"><span itemprop="name">design-pattern</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="Symbols count in article">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">Symbols count in article: </span>
              <span>5.8k</span>
            </span>
            <span class="post-meta-item" title="Reading time">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">Reading time &asymp;</span>
              <span>21 mins.</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="Bridge-桥接模式"><a href="#Bridge-桥接模式" class="headerlink" title="Bridge 桥接模式"></a>Bridge 桥接模式</h1><h2 id="Intent-意图"><a href="#Intent-意图" class="headerlink" title="Intent 意图"></a>Intent 意图</h2><p><strong>Bridge</strong> is a structural design pattern that lets you split a large class or a set of closely related classes into two separate hierarchies—abstraction and implementation—which can be developed independently of each other.<br><strong>Bridge</strong>是一种结构设计模式，它允许您将一个大型类或一组密切相关的类拆分为两个单独的层次结构（抽象和实现），这两个层次结构可以相互独立开发。</p>
<div align="center"> <img src="/images/bridge-header.png"/></div>

<h2 id="Problem-问题"><a href="#Problem-问题" class="headerlink" title="Problem 问题"></a>Problem 问题</h2><p>Abstraction? Implementation? Sound scary? Stay calm and let’s consider a simple example.<br>抽象化？实现？听起来很吓人？保持冷静，让我们考虑一个简单的例子。</p>
<p>Say you have a geometric <code>Shape</code> class with a pair of subclasses: <code>Circle</code> and <code>Square</code>. You want to extend this class hierarchy to incorporate colors, so you plan to create <code>Red</code> and <code>Blue</code> shape subclasses. However, since you already have two subclasses, you’ll need to create four class combinations such as <code>BlueCircle</code> and <code>RedSquare</code>.<br>假设您有一个几何类，其中包含一对子 <code>Shape</code> 类： <code>Circle</code> 和 <code>Square</code> 。您希望扩展此类层次结构以合并颜色，因此您计划创建 <code>Red</code> 和 <code>Blue</code> 调整子类。但是，由于您已经有两个子类，因此需要创建四个类组合，例如 <code>BlueCircle</code> 和 <code>RedSquare</code> 。</p>
<div align="center"> <img src="/images/bridge-problem-en.png"/>Number of class combinations grows in geometric progression.</br>类组合的数量以几何级数增长。</div>
Adding new shape types and colors to the hierarchy will grow it exponentially. For example, to add a triangle shape you’d need to introduce two subclasses, one for each color. And after that, adding a new color would require creating three subclasses, one for each shape type. The further we go, the worse it becomes.
向层次结构添加新的形状类型和颜色将使其呈指数级增长。例如，要添加三角形形状，您需要引入两个子类，每个子类对应一种颜色。之后，添加新颜色将需要创建三个子类，每个子类对应一个形状类型。我们走得越远，情况就越糟。

<h2 id="Solution-解决方案"><a href="#Solution-解决方案" class="headerlink" title="Solution 解决方案"></a>Solution 解决方案</h2><p>This problem occurs because we’re trying to extend the shape classes in two independent dimensions: by form and by color. That’s a very common issue with class inheritance.<br>出现此问题的原因是，我们尝试在两个独立的维度中扩展形状类：按形状和按颜色。这是类继承的一个非常常见的问题。</p>
<p>The Bridge pattern attempts to solve this problem by switching from inheritance to the object composition. What this means is that you extract one of the dimensions into a separate class hierarchy, so that the original classes will reference an object of the new hierarchy, instead of having all of its state and behaviors within one class.<br>Bridge 模式试图通过从继承切换到对象组合来解决此问题。这意味着将其中一个维度提取到单独的类层次结构中，以便原始类将引用新层次结构的对象，而不是将其所有状态和行为都放在一个类中。</p>
<div align="center"> <img src="/images/bridge-solution-en.png"/>You can prevent the explosion of a class hierarchy by transforming it into several related hierarchies.</br>可以通过将类层次结构转换为多个相关的层次结构来防止类层次结构的爆炸式增长。</div>
Following this approach, we can extract the color-related code into its own class with two subclasses: `Red` and `Blue`. The `Shape` class then gets a reference field pointing to one of the color objects. Now the shape can delegate any color-related work to the linked color object. That reference will act as a bridge between the `Shape` and `Color` classes. From now on, adding new colors won’t require changing the shape hierarchy, and vice versa.
按照这种方法，我们可以将与颜色相关的代码提取到它自己的类中，其中包含两个子类： `Red` 和 `Blue` .然后，该 `Shape` 类获取指向其中一个颜色对象的引用字段。现在，形状可以将任何与颜色相关的工作委托给链接的颜色对象。该引用将充当 `Shape` 和 `Color` 类之间的桥梁。从现在开始，添加新颜色将不需要更改形状层次结构，反之亦然。

<h3 id="Abstraction-and-Implementation-抽象和实现"><a href="#Abstraction-and-Implementation-抽象和实现" class="headerlink" title="Abstraction and Implementation 抽象和实现"></a>Abstraction and Implementation 抽象和实现</h3><p>The <a target="_blank" rel="noopener" href="https://refactoring.guru/gof-book" title="“Gang of Four” is a nickname given to the four authors of the original book about design patterns: Design Patterns: Elements of Reusable Object-Oriented Software 设计模式：可重用面向对象软件的元素">GoF book</a>  introduces the terms Abstraction and Implementation as part of the Bridge definition. In my opinion, the terms sound too academic and make the pattern seem more complicated than it really is. Having read the simple example with shapes and colors, let’s decipher the meaning behind the GoF book’s scary words.<br>GoF一书引入了术语“抽象”和“实现”，作为桥接定义的一部分。在我看来，这些术语听起来太学术化了，使模式看起来比实际情况更复杂。在阅读了带有形状和颜色的简单示例之后，让我们破译 GoF 书的可怕单词背后的含义。</p>
<p>Abstraction (also called interface) is a high-level control layer for some entity. This layer isn’t supposed to do any real work on its own. It should delegate the work to the implementation layer (also called platform).<br>抽象（也称为接口）是某些实体的高级控制层。这个层不应该自己做任何真正的工作。它应该将工作委托给实现层（也称为平台）。</p>
<p>Note that we’re not talking about interfaces or abstract classes from your programming language. These aren’t the same things.<br>请注意，我们不是在谈论编程语言中的接口或抽象类。这些不是一回事。</p>
<p>When talking about real applications, the abstraction can be represented by a graphical user interface (GUI), and the implementation could be the underlying operating system code (API) which the GUI layer calls in response to user interactions.<br>在谈论实际应用程序时，抽象可以由图形用户界面 （GUI） 表示，实现可以是 GUI 层为响应用户交互而调用的底层操作系统代码 （API）。</p>
<p>Generally speaking, you can extend such an app in two independent directions:<br>一般来说，您可以在两个独立的方向上扩展此类应用程序：</p>
<ul>
<li>Have several different GUIs (for instance, tailored for regular customers or admins).<br>有几个不同的 GUI（例如，为普通客户或管理员量身定制）。</li>
<li>Support several different APIs (for example, to be able to launch the app under Harmony, Windows, Linux, and macOS).<br>支持多个不同的 API（例如，能够在 Harmony, Windows、Linux 和 macOS 下启动应用程序）。</li>
</ul>
<p>In a worst-case scenario, this app might look like a giant spaghetti bowl, where hundreds of conditionals connect different types of GUI with various APIs all over the code.<br>在最坏的情况下，这个应用程序可能看起来像一个巨大的意大利面碗，其中数百个条件将不同类型的 GUI 与代码中的各种 API 连接起来。</p>
<div align="center"> <img src="/images/bridge-bridge-3-en.png"/>Making even a simple change to a monolithic codebase is pretty hard because you must understand the entire thing very well. Making changes to smaller, well-defined modules is much easier.</br>即使是对单体代码库进行简单的更改也非常困难，因为您必须很好地理解整个事情。对更小、定义明确的模块进行更改要容易得多。</div>
You can bring order to this chaos by extracting the code related to specific interface-platform combinations into separate classes. However, soon you’ll discover that there are lots of these classes. The class hierarchy will grow exponentially because adding a new GUI or supporting a different API would require creating more and more classes.
您可以通过将与特定接口平台组合相关的代码提取到单独的类中来恢复这种混乱。但是，很快您就会发现有很多这样的课程。类层次结构将呈指数级增长，因为添加新的 GUI 或支持不同的 API 需要创建越来越多的类。

<p>Let’s try to solve this issue with the Bridge pattern. It suggests that we divide the classes into two hierarchies:<br>让我们尝试使用 Bridge 模式来解决这个问题。它建议我们将类分为两个层次结构：</p>
<ul>
<li>Abstraction: the GUI layer of the app.<br>抽象：应用的 GUI 层。</li>
<li>Implementation: the operating systems’ APIs.<br>实现：操作系统的 API。<div align="center"> <img src="/images/bridge-bridge-2-en.png"/>One of the ways to structure a cross-platform application.</br>构建跨平台应用程序的方法之一。</div>
The abstraction object controls the appearance of the app, delegating the actual work to the linked implementation object. Different implementations are interchangeable as long as they follow a common interface, enabling the same GUI to work under Harmony, Windows and Linux.
抽象对象控制应用的外观，将实际工作委托给链接的实现对象。不同的实现是可以互换的，只要它们遵循一个通用的接口，使相同的 GUI 能够在Harmony, Windows 和 Linux 下工作。</li>
</ul>
<p>As a result, you can change the GUI classes without touching the API-related classes. Moreover, adding support for another operating system only requires creating a subclass in the implementation hierarchy.<br>因此，您可以在不接触 API 相关类的情况下更改 GUI 类。此外，添加对另一个操作系统的支持只需要在实现层次结构中创建一个子类。</p>
<h2 id="Structure-结构"><a href="#Structure-结构" class="headerlink" title="Structure 结构"></a>Structure 结构</h2><div align="center"> <img src="/images/bridge-structure-en.png"/></div>

<ol>
<li><p>The <strong>Abstraction</strong> provides high-level control logic. It relies on the implementation object to do the actual low-level work.<br>抽象提供高级控制逻辑。它依赖于实现对象来执行实际的低级工作。</p>
</li>
<li><p>The <strong>Implementation</strong> declares the interface that’s common for all concrete implementations. An abstraction can only communicate with an implementation object via methods that are declared here.<br>实现声明了所有具体实现通用的接口。抽象只能通过此处声明的方法与实现对象进行通信。</p>
</li>
<li><p><strong>Concrete Implementations</strong> contain platform-specific code.<br>具体实现包含特定于平台的代码。</p>
</li>
<li><p><strong>Refined Abstractions</strong> provide variants of control logic. Like their parent, they work with different implementations via the general implementation interface.<br>精炼的抽象提供了控制逻辑的变体。与它们的父级一样，它们通过通用实现接口使用不同的实现。</p>
</li>
<li><p>Usually, the <strong>Client</strong> is only interested in working with the abstraction. However, it’s the client’s job to link the abstraction object with one of the implementation objects.<br>通常，客户端只对处理抽象感兴趣。但是，客户端的工作是将抽象对象与其中一个实现对象链接起来。</p>
</li>
</ol>
<h2 id="Pseudocode-伪代码"><a href="#Pseudocode-伪代码" class="headerlink" title="Pseudocode 伪代码"></a>Pseudocode 伪代码</h2><p>This example illustrates how the <strong>Bridge</strong> pattern can help divide the monolithic code of an app that manages devices and their remote controls. The <code>Device</code> classes act as the implementation, whereas the <code>Remote</code>s act as the abstraction.<br>此示例演示了 Bridge 模式如何帮助划分管理设备及其遥控器的应用的整体代码。 <code>Device</code> 类充当实现，而 <code>Remote</code>s 充当抽象。</p>
<div align="center"> <img src="/images/bridge-example-en.png"/>The original class hierarchy is divided into two parts: devices and remote controls.</br>原始的类层次结构分为两部分：设备和遥控器。</div>
The base remote control class declares a reference field that links it with a device object. All remotes work with the devices via the general device interface, which lets the same remote support multiple device types.
基远程控制类声明一个引用字段，该字段将其与设备对象链接。所有遥控器都通过通用设备接口与设备配合使用，这使得同一个遥控器支持多种设备类型。

<p>You can develop the remote control classes independently from the device classes. All that’s needed is to create a new remote subclass. For example, a basic remote control might only have two buttons, but you could extend it with additional features, such as an extra battery or a touchscreen.<br>您可以独立于设备类开发远程控制类。所需要的只是创建一个新的远程子类。例如，一个基本的遥控器可能只有两个按钮，但您可以使用其他功能（例如额外的电池或触摸屏）对其进行扩展。</p>
<p>The client code links the desired type of remote control with a specific device object via the remote’s constructor.<br>客户端代码通过遥控器的构造函数将所需类型的遥控器与特定设备对象链接起来。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// The &quot;abstraction&quot; defines the interface for the &quot;control&quot;</span></span><br><span class="line"><span class="comment">// part of the two class hierarchies. It maintains a reference</span></span><br><span class="line"><span class="comment">// to an object of the &quot;implementation&quot; hierarchy and delegates</span></span><br><span class="line"><span class="comment">// all of the real work to this object.</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">RemoteControl</span> is</span><br><span class="line">    <span class="keyword">protected</span> field device: Device</span><br><span class="line">    constructor <span class="title function_">RemoteControl</span><span class="params">(device: Device)</span> is</span><br><span class="line">        <span class="built_in">this</span>.device = device</span><br><span class="line">    method <span class="title function_">togglePower</span><span class="params">()</span> is</span><br><span class="line">        <span class="title function_">if</span> <span class="params">(device.isEnabled()</span>) then</span><br><span class="line">            device.disable()</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            device.enable()</span><br><span class="line">    method <span class="title function_">volumeDown</span><span class="params">()</span> is</span><br><span class="line">        device.setVolume(device.getVolume() - <span class="number">10</span>)</span><br><span class="line">    method <span class="title function_">volumeUp</span><span class="params">()</span> is</span><br><span class="line">        device.setVolume(device.getVolume() + <span class="number">10</span>)</span><br><span class="line">    method <span class="title function_">channelDown</span><span class="params">()</span> is</span><br><span class="line">        device.setChannel(device.getChannel() - <span class="number">1</span>)</span><br><span class="line">    method <span class="title function_">channelUp</span><span class="params">()</span> is</span><br><span class="line">        device.setChannel(device.getChannel() + <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// You can extend classes from the abstraction hierarchy</span></span><br><span class="line"><span class="comment">// independently from device classes.</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">AdvancedRemoteControl</span> <span class="keyword">extends</span> <span class="title class_">RemoteControl</span> is</span><br><span class="line">    method <span class="title function_">mute</span><span class="params">()</span> is</span><br><span class="line">        device.setVolume(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// The &quot;implementation&quot; interface declares methods common to all</span></span><br><span class="line"><span class="comment">// concrete implementation classes. It doesn&#x27;t have to match the</span></span><br><span class="line"><span class="comment">// abstraction&#x27;s interface. In fact, the two interfaces can be</span></span><br><span class="line"><span class="comment">// entirely different. Typically the implementation interface</span></span><br><span class="line"><span class="comment">// provides only primitive operations, while the abstraction</span></span><br><span class="line"><span class="comment">// defines higher-level operations based on those primitives.</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">Device</span> is</span><br><span class="line">    method <span class="title function_">isEnabled</span><span class="params">()</span></span><br><span class="line">    method <span class="title function_">enable</span><span class="params">()</span></span><br><span class="line">    method <span class="title function_">disable</span><span class="params">()</span></span><br><span class="line">    method <span class="title function_">getVolume</span><span class="params">()</span></span><br><span class="line">    method <span class="title function_">setVolume</span><span class="params">(percent)</span></span><br><span class="line">    method <span class="title function_">getChannel</span><span class="params">()</span></span><br><span class="line">    method <span class="title function_">setChannel</span><span class="params">(channel)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// All devices follow the same interface.</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Tv</span> <span class="keyword">implements</span> <span class="title class_">Device</span> is</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Radio</span> <span class="keyword">implements</span> <span class="title class_">Device</span> is</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// Somewhere in client code.</span></span><br><span class="line">tv = <span class="keyword">new</span> <span class="title class_">Tv</span>()</span><br><span class="line">remote = <span class="keyword">new</span> <span class="title class_">RemoteControl</span>(tv)</span><br><span class="line">remote.togglePower()</span><br><span class="line"></span><br><span class="line">radio = <span class="keyword">new</span> <span class="title class_">Radio</span>()</span><br><span class="line">remote = <span class="keyword">new</span> <span class="title class_">AdvancedRemoteControl</span>(radio)</span><br></pre></td></tr></table></figure>

<h2 id="Applicability-适用性"><a href="#Applicability-适用性" class="headerlink" title="Applicability 适用性"></a>Applicability 适用性</h2><ul>
<li><p><strong>Use the Bridge pattern when you want to divide and organize a monolithic class that has several variants of some functionality (for example, if the class can work with various database servers).如果要划分和组织具有某些功能的多个变体的整体类（例如，如果该类可以与各种数据库服务器一起使用），请使用 Bridge 模式。</strong></p>
</li>
<li><p>The bigger a class becomes, the harder it is to figure out how it works, and the longer it takes to make a change. The changes made to one of the variations of functionality may require making changes across the whole class, which often results in making errors or not addressing some critical side effects.<br>一个班级变得越大，就越难弄清楚它是如何工作的，做出改变所需的时间就越长。对功能变体之一所做的更改可能需要在整个类中进行更改，这通常会导致出错或无法解决一些关键的副作用。</p>
</li>
</ul>
<p>The Bridge pattern lets you split the monolithic class into several class hierarchies. After this, you can change the classes in each hierarchy independently of the classes in the others. This approach simplifies code maintenance and minimizes the risk of breaking existing code.<br>Bridge 模式允许您将整体类拆分为多个类层次结构。在此之后，您可以独立于其他层次结构中的类更改每个层次结构中的类。此方法简化了代码维护，并最大限度地降低了破坏现有代码的风险。</p>
<ul>
<li><p><strong>Use the pattern when you need to extend a class in several orthogonal (independent) dimensions. 当您需要在多个正交（独立）维度中扩展类时，请使用该模式。</strong></p>
</li>
<li><p>The Bridge suggests that you extract a separate class hierarchy for each of the dimensions. The original class delegates the related work to the objects belonging to those hierarchies instead of doing everything on its own.<br>Bridge 建议您为每个维度提取单独的类层次结构。原始类将相关工作委托给属于这些层次结构的对象，而不是自己执行所有操作。</p>
</li>
</ul>
<p> Use the Bridge if you need to be able to switch implementations at runtime.<br>如果您需要能够在运行时切换实现，请使用 Bridge。</p>
<p> Although it’s optional, the Bridge pattern lets you replace the implementation object inside the abstraction. It’s as easy as assigning a new value to a field.<br>尽管它是可选的，但 Bridge 模式允许您替换抽象中的实现对象。这就像为字段分配新值一样简单。</p>
<p>By the way, this last item is the main reason why so many people confuse the Bridge with the Strategy pattern. Remember that a pattern is more than just a certain way to structure your classes. It may also communicate intent and a problem being addressed.<br>顺便说一句，最后一项是这么多人将桥接模式与策略模式混淆的主要原因。请记住，模式不仅仅是构建类的某种方式。它还可以传达意图和正在解决的问题。</p>
<h2 id="How-to-Implement-如何实现"><a href="#How-to-Implement-如何实现" class="headerlink" title="How to Implement 如何实现"></a>How to Implement 如何实现</h2><ol>
<li><p>Identify the orthogonal dimensions in your classes. These independent concepts could be: abstraction&#x2F;platform, domain&#x2F;infrastructure, front-end&#x2F;back-end, or interface&#x2F;implementation.<br>确定类中的正交维度。这些独立的概念可以是：抽象&#x2F;平台、域&#x2F;基础结构、前端&#x2F;后端或接口&#x2F;实现。</p>
</li>
<li><p>See what operations the client needs and define them in the base abstraction class.<br>查看客户端需要哪些操作，并在基抽象类中定义它们。</p>
</li>
<li><p>Determine the operations available on all platforms. Declare the ones that the abstraction needs in the general implementation interface.<br>确定所有平台上可用的操作。在通用实现接口中声明抽象需要的那些。</p>
</li>
<li><p>For all platforms in your domain create concrete implementation classes, but make sure they all follow the implementation interface.<br>对于域中的所有平台，请创建具体的实现类，但请确保它们都遵循实现接口。</p>
</li>
<li><p>Inside the abstraction class, add a reference field for the implementation type. The abstraction delegates most of the work to the implementation object that’s referenced in that field.<br>在抽象类中，为实现类型添加一个引用字段。抽象将大部分工作委托给该字段中引用的实现对象。</p>
</li>
<li><p>If you have several variants of high-level logic, create refined abstractions for each variant by extending the base abstraction class.<br>如果有多个高级逻辑变体，请通过扩展基本抽象类为每个变体创建精细的抽象。</p>
</li>
<li><p>The client code should pass an implementation object to the abstraction’s constructor to associate one with the other. After that, the client can forget about the implementation and work only with the abstraction object.<br>客户端代码应将实现对象传递给抽象的构造函数，以将一个对象与另一个对象相关联。之后，客户端可以忘记实现，只使用抽象对象。</p>
</li>
</ol>
<h2 id="Pros-and-Cons-优点和缺点"><a href="#Pros-and-Cons-优点和缺点" class="headerlink" title="Pros and Cons 优点和缺点"></a>Pros and Cons 优点和缺点</h2><table>
<thead>
<tr>
<th>Pros 优点</th>
<th>Cons 缺点</th>
</tr>
</thead>
<tbody><tr>
<td>You can create platform-independent classes and apps.您可以创建与平台无关的类和应用。</td>
<td>You might make the code more complicated by applying the pattern to a highly cohesive class. 通过将模式应用于高度内聚的类，可以使代码更加复杂。</td>
</tr>
<tr>
<td>The client code works with high-level abstractions. It isn’t exposed to the platform details. 客户端代码使用高级抽象。它不会公开给平台详细信息。</td>
<td></td>
</tr>
<tr>
<td>Open&#x2F;Closed Principle. You can introduce new abstractions and implementations independently from each other. 开&#x2F;闭原理。您可以引入新的抽象和实现，彼此独立。</td>
<td></td>
</tr>
<tr>
<td>Single Responsibility Principle. You can focus on high-level logic in the abstraction and on platform details in the implementation. 单一责任原则。您可以专注于抽象中的高级逻辑和实现中的平台细节。</td>
<td></td>
</tr>
</tbody></table>
<h2 id="Relations-with-Other-Patterns-与其他模式的关系"><a href="#Relations-with-Other-Patterns-与其他模式的关系" class="headerlink" title="Relations with Other Patterns 与其他模式的关系"></a>Relations with Other Patterns 与其他模式的关系</h2><ul>
<li><p><strong>Bridge</strong> is usually designed up-front, letting you develop parts of an application independently of each other. On the other hand, <strong>Adapter</strong> is commonly used with an existing app to make some otherwise-incompatible classes work together nicely.<br><strong>Bridge</strong> 通常是预先设计的，允许您彼此独立地开发应用程序的各个部分。另一方面，<strong>Adapter</strong> 通常与现有应用程序一起使用，以使一些不兼容的类很好地协同工作。</p>
</li>
<li><p><strong>Bridge, State, Strategy</strong> (and to some degree <strong>Adapter</strong>) have very similar structures. Indeed, all of these patterns are based on composition, which is delegating work to other objects. However, they all solve different problems. A pattern isn’t just a recipe for structuring your code in a specific way. It can also communicate to other developers the problem the pattern solves.<br>桥接、状态、策略（在某种程度上还有适配器）具有非常相似的结构。事实上，所有这些模式都是基于构图的，而构图是将工作委托给其他对象。但是，它们都解决了不同的问题。模式不仅仅是以特定方式构建代码的秘诀。它还可以向其他开发人员传达该模式解决的问题。</p>
</li>
<li><p>You can use <strong>Abstract Factory</strong> along with <strong>Bridge</strong>. This pairing is useful when some abstractions defined by <strong>Bridge</strong> can only work with specific implementations. In this case, Abstract Factory can encapsulate these relations and hide the complexity from the client code.</p>
</li>
<li><p>You can combine <strong>Builder</strong> with <strong>Bridge</strong>: the director class plays the role of the abstraction, while different builders act as implementations.<br>您可以将 <strong>Builder</strong> 与 <strong>Bridge</strong> 结合使用：director 类扮演抽象的角色，而不同的构建器充当实现。</p>
</li>
</ul>
<h2 id="Code-Examples-代码示例"><a href="#Code-Examples-代码示例" class="headerlink" title="Code Examples 代码示例"></a>Code Examples 代码示例</h2><h3 id="Python-Conceptual-Example-概念示例"><a href="#Python-Conceptual-Example-概念示例" class="headerlink" title="Python Conceptual Example 概念示例"></a>Python Conceptual Example 概念示例</h3><p>This example illustrates the structure of the Bridge design pattern. It focuses on answering these questions:<br>此示例说明了 Bridge 设计模式的结构。它侧重于回答以下问题：</p>
<ul>
<li>What classes does it consist of?<br>它由哪些类组成？</li>
<li>What roles do these classes play?<br>这些课程扮演什么角色？</li>
<li>In what way the elements of the pattern are related?<br>模式的元素以何种方式相关？</li>
</ul>
<h4 id="main-py"><a href="#main-py" class="headerlink" title="main.py"></a>main.py</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> __future__ <span class="keyword">import</span> annotations</span><br><span class="line"><span class="keyword">from</span> abc <span class="keyword">import</span> ABC, abstractmethod</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Abstraction</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    The Abstraction defines the interface for the &quot;control&quot; part of the two</span></span><br><span class="line"><span class="string">    class hierarchies. It maintains a reference to an object of the</span></span><br><span class="line"><span class="string">    Implementation hierarchy and delegates all of the real work to this object.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, implementation: Implementation</span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">        self.implementation = implementation</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">operation</span>(<span class="params">self</span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">        <span class="keyword">return</span> (<span class="string">f&quot;Abstraction: Base operation with:\n&quot;</span></span><br><span class="line">                <span class="string">f&quot;<span class="subst">&#123;self.implementation.operation_implementation()&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ExtendedAbstraction</span>(<span class="title class_ inherited__">Abstraction</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    You can extend the Abstraction without changing the Implementation classes.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">operation</span>(<span class="params">self</span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">        <span class="keyword">return</span> (<span class="string">f&quot;ExtendedAbstraction: Extended operation with:\n&quot;</span></span><br><span class="line">                <span class="string">f&quot;<span class="subst">&#123;self.implementation.operation_implementation()&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Implementation</span>(<span class="title class_ inherited__">ABC</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    The Implementation defines the interface for all implementation classes. It</span></span><br><span class="line"><span class="string">    doesn&#x27;t have to match the Abstraction&#x27;s interface. In fact, the two</span></span><br><span class="line"><span class="string">    interfaces can be entirely different. Typically the Implementation interface</span></span><br><span class="line"><span class="string">    provides only primitive operations, while the Abstraction defines higher-</span></span><br><span class="line"><span class="string">    level operations based on those primitives.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">    @abstractmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">operation_implementation</span>(<span class="params">self</span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">Each Concrete Implementation corresponds to a specific platform and implements</span></span><br><span class="line"><span class="string">the Implementation interface using that platform&#x27;s API.</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ConcreteImplementationA</span>(<span class="title class_ inherited__">Implementation</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">operation_implementation</span>(<span class="params">self</span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;ConcreteImplementationA: Here&#x27;s the result on the platform A.&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ConcreteImplementationB</span>(<span class="title class_ inherited__">Implementation</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">operation_implementation</span>(<span class="params">self</span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;ConcreteImplementationB: Here&#x27;s the result on the platform B.&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">client_code</span>(<span class="params">abstraction: Abstraction</span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    Except for the initialization phase, where an Abstraction object gets linked</span></span><br><span class="line"><span class="string">    with a specific Implementation object, the client code should only depend on</span></span><br><span class="line"><span class="string">    the Abstraction class. This way the client code can support any abstraction-</span></span><br><span class="line"><span class="string">    implementation combination.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># ...</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(abstraction.operation(), end=<span class="string">&quot;&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># ...</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    The client code should be able to work with any pre-configured abstraction-</span></span><br><span class="line"><span class="string">    implementation combination.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    implementation = ConcreteImplementationA()</span><br><span class="line">    abstraction = Abstraction(implementation)</span><br><span class="line">    client_code(abstraction)</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;\n&quot;</span>)</span><br><span class="line"></span><br><span class="line">    implementation = ConcreteImplementationB()</span><br><span class="line">    abstraction = ExtendedAbstraction(implementation)</span><br><span class="line">    client_code(abstraction)</span><br></pre></td></tr></table></figure>

<h4 id="Output-txt-Execution-result"><a href="#Output-txt-Execution-result" class="headerlink" title="Output.txt: Execution result"></a>Output.txt: Execution result</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Abstraction: Base operation with:</span><br><span class="line">ConcreteImplementationA: Here&#x27;s the result on the platform A.</span><br><span class="line"></span><br><span class="line">ExtendedAbstraction: Extended operation with:</span><br><span class="line">ConcreteImplementationB: Here&#x27;s the result on the platform B.</span><br></pre></td></tr></table></figure>

<h3 id="Rust-Conceptual-Example-概念示例"><a href="#Rust-Conceptual-Example-概念示例" class="headerlink" title="Rust Conceptual Example 概念示例"></a>Rust Conceptual Example 概念示例</h3><h4 id="Devices-and-Remotes-设备和遥控器"><a href="#Devices-and-Remotes-设备和遥控器" class="headerlink" title="Devices and Remotes 设备和遥控器"></a>Devices and Remotes 设备和遥控器</h4><p>This example illustrates how the Bridge pattern can help divide the monolithic code of an app that manages devices and their remote controls. The Device classes act as the implementation, whereas the Remotes act as the abstraction.<br>此示例演示了 Bridge 模式如何帮助划分管理设备及其遥控器的应用的整体代码。Device 类充当实现，而 Remote 充当抽象。</p>
<h4 id="remotes-mod-rs"><a href="#remotes-mod-rs" class="headerlink" title="remotes&#x2F;mod.rs"></a>remotes&#x2F;mod.rs</h4><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">mod</span> advanced;</span><br><span class="line"><span class="keyword">mod</span> basic;</span><br><span class="line"></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">use</span> advanced::AdvancedRemove;</span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">use</span> basic::BasicRemote;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> crate::device::Device;</span><br><span class="line"></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">trait</span> <span class="title class_">HasMutableDevice</span>&lt;D: Device&gt; &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">device</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>) <span class="punctuation">-&gt;</span> &amp;<span class="keyword">mut</span> D;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">trait</span> <span class="title class_">Remote</span>&lt;D: Device&gt;: HasMutableDevice&lt;D&gt; &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">power</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>) &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;Remote: power toggle&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">self</span>.<span class="title function_ invoke__">device</span>().<span class="title function_ invoke__">is_enabled</span>() &#123;</span><br><span class="line">            <span class="keyword">self</span>.<span class="title function_ invoke__">device</span>().<span class="title function_ invoke__">disable</span>();</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">self</span>.<span class="title function_ invoke__">device</span>().<span class="title function_ invoke__">enable</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">volume_down</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>) &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;Remote: volume down&quot;</span>);</span><br><span class="line">        <span class="keyword">let</span> <span class="variable">volume</span> = <span class="keyword">self</span>.<span class="title function_ invoke__">device</span>().<span class="title function_ invoke__">volume</span>();</span><br><span class="line">        <span class="keyword">self</span>.<span class="title function_ invoke__">device</span>().<span class="title function_ invoke__">set_volume</span>(volume - <span class="number">10</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">volume_up</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>) &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;Remote: volume up&quot;</span>);</span><br><span class="line">        <span class="keyword">let</span> <span class="variable">volume</span> = <span class="keyword">self</span>.<span class="title function_ invoke__">device</span>().<span class="title function_ invoke__">volume</span>();</span><br><span class="line">        <span class="keyword">self</span>.<span class="title function_ invoke__">device</span>().<span class="title function_ invoke__">set_volume</span>(volume + <span class="number">10</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">channel_down</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>) &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;Remote: channel down&quot;</span>);</span><br><span class="line">        <span class="keyword">let</span> <span class="variable">channel</span> = <span class="keyword">self</span>.<span class="title function_ invoke__">device</span>().<span class="title function_ invoke__">channel</span>();</span><br><span class="line">        <span class="keyword">self</span>.<span class="title function_ invoke__">device</span>().<span class="title function_ invoke__">set_channel</span>(channel - <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">channel_up</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>) &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;Remote: channel up&quot;</span>);</span><br><span class="line">        <span class="keyword">let</span> <span class="variable">channel</span> = <span class="keyword">self</span>.<span class="title function_ invoke__">device</span>().<span class="title function_ invoke__">channel</span>();</span><br><span class="line">        <span class="keyword">self</span>.<span class="title function_ invoke__">device</span>().<span class="title function_ invoke__">set_channel</span>(channel + <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="remotes-basic-rs"><a href="#remotes-basic-rs" class="headerlink" title="remotes&#x2F;basic.rs"></a>remotes&#x2F;basic.rs</h4><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> crate::device::Device;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> super::&#123;HasMutableDevice, Remote&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">struct</span> <span class="title class_">BasicRemote</span>&lt;D: Device&gt; &#123;</span><br><span class="line">    device: D,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span>&lt;D: Device&gt; BasicRemote&lt;D&gt; &#123;</span><br><span class="line">    <span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">new</span>(device: D) <span class="punctuation">-&gt;</span> <span class="keyword">Self</span> &#123;</span><br><span class="line">        <span class="keyword">Self</span> &#123; device &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span>&lt;D: Device&gt; HasMutableDevice&lt;D&gt; <span class="keyword">for</span> <span class="title class_">BasicRemote</span>&lt;D&gt; &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">device</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>) <span class="punctuation">-&gt;</span> &amp;<span class="keyword">mut</span> D &#123;</span><br><span class="line">        &amp;<span class="keyword">mut</span> <span class="keyword">self</span>.device</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span>&lt;D: Device&gt; Remote&lt;D&gt; <span class="keyword">for</span> <span class="title class_">BasicRemote</span>&lt;D&gt; &#123;&#125;</span><br></pre></td></tr></table></figure>

<h4 id="remotes-advanced-rs"><a href="#remotes-advanced-rs" class="headerlink" title="remotes&#x2F;advanced.rs"></a>remotes&#x2F;advanced.rs</h4><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> crate::device::Device;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> super::&#123;HasMutableDevice, Remote&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">struct</span> <span class="title class_">AdvancedRemote</span>&lt;D: Device&gt; &#123;</span><br><span class="line">    device: D,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span>&lt;D: Device&gt; AdvancedRemote&lt;D&gt; &#123;</span><br><span class="line">    <span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">new</span>(device: D) <span class="punctuation">-&gt;</span> <span class="keyword">Self</span> &#123;</span><br><span class="line">        <span class="keyword">Self</span> &#123; device &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">mute</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>) &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;Remote: mute&quot;</span>);</span><br><span class="line">        <span class="keyword">self</span>.device.<span class="title function_ invoke__">set_volume</span>(<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span>&lt;D: Device&gt; HasMutableDevice&lt;D&gt; <span class="keyword">for</span> <span class="title class_">AdvancedRemote</span>&lt;D&gt; &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">device</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>) <span class="punctuation">-&gt;</span> &amp;<span class="keyword">mut</span> D &#123;</span><br><span class="line">        &amp;<span class="keyword">mut</span> <span class="keyword">self</span>.device</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span>&lt;D: Device&gt; Remote&lt;D&gt; <span class="keyword">for</span> <span class="title class_">AdvancedRemote</span>&lt;D&gt; &#123;&#125;</span><br></pre></td></tr></table></figure>
<h4 id="device-mod-rs"><a href="#device-mod-rs" class="headerlink" title="device&#x2F;mod.rs"></a>device&#x2F;mod.rs</h4><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">mod</span> radio;</span><br><span class="line"><span class="keyword">mod</span> tv;</span><br><span class="line"></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">use</span> radio::Radio;</span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">use</span> tv::Tv;</span><br><span class="line"></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">trait</span> <span class="title class_">Device</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">is_enabled</span>(&amp;<span class="keyword">self</span>) <span class="punctuation">-&gt;</span> <span class="type">bool</span>;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">enable</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>);</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">disable</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>);</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">volume</span>(&amp;<span class="keyword">self</span>) <span class="punctuation">-&gt;</span> <span class="type">u8</span>;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">set_volume</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>, percent: <span class="type">u8</span>);</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">channel</span>(&amp;<span class="keyword">self</span>) <span class="punctuation">-&gt;</span> <span class="type">u16</span>;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">set_channel</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>, channel: <span class="type">u16</span>);</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">print_status</span>(&amp;<span class="keyword">self</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="device-radio-rs"><a href="#device-radio-rs" class="headerlink" title="device&#x2F;radio.rs"></a>device&#x2F;radio.rs</h4><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> super::Device;</span><br><span class="line"></span><br><span class="line"><span class="meta">#[derive(Clone)]</span></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">struct</span> <span class="title class_">Radio</span> &#123;</span><br><span class="line">    on: <span class="type">bool</span>,</span><br><span class="line">    volume: <span class="type">u8</span>,</span><br><span class="line">    channel: <span class="type">u16</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">Default</span> <span class="keyword">for</span> <span class="title class_">Radio</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">default</span>() <span class="punctuation">-&gt;</span> <span class="keyword">Self</span> &#123;</span><br><span class="line">        <span class="keyword">Self</span> &#123;</span><br><span class="line">            on: <span class="literal">false</span>,</span><br><span class="line">            volume: <span class="number">30</span>,</span><br><span class="line">            channel: <span class="number">1</span>,</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">Device</span> <span class="keyword">for</span> <span class="title class_">Radio</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">is_enabled</span>(&amp;<span class="keyword">self</span>) <span class="punctuation">-&gt;</span> <span class="type">bool</span> &#123;</span><br><span class="line">        <span class="keyword">self</span>.on</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">enable</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.on = <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">disable</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.on = <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">volume</span>(&amp;<span class="keyword">self</span>) <span class="punctuation">-&gt;</span> <span class="type">u8</span> &#123;</span><br><span class="line">        <span class="keyword">self</span>.volume</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">set_volume</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>, percent: <span class="type">u8</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.volume = std::cmp::<span class="title function_ invoke__">min</span>(percent, <span class="number">100</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">channel</span>(&amp;<span class="keyword">self</span>) <span class="punctuation">-&gt;</span> <span class="type">u16</span> &#123;</span><br><span class="line">        <span class="keyword">self</span>.channel</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">set_channel</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>, channel: <span class="type">u16</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.channel = channel;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">print_status</span>(&amp;<span class="keyword">self</span>) &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;------------------------------------&quot;</span>);</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;| I&#x27;m radio.&quot;</span>);</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;| I&#x27;m &#123;&#125;&quot;</span>, <span class="keyword">if</span> <span class="keyword">self</span>.on &#123; <span class="string">&quot;enabled&quot;</span> &#125; <span class="keyword">else</span> &#123; <span class="string">&quot;disabled&quot;</span> &#125;);</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;| Current volume is &#123;&#125;%&quot;</span>, <span class="keyword">self</span>.volume);</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;| Current channel is &#123;&#125;&quot;</span>, <span class="keyword">self</span>.channel);</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;------------------------------------\n&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="device-tv-rs"><a href="#device-tv-rs" class="headerlink" title="device&#x2F;tv.rs"></a>device&#x2F;tv.rs</h4><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> super::Device;</span><br><span class="line"></span><br><span class="line"><span class="meta">#[derive(Clone)]</span></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">struct</span> <span class="title class_">Tv</span> &#123;</span><br><span class="line">    on: <span class="type">bool</span>,</span><br><span class="line">    volume: <span class="type">u8</span>,</span><br><span class="line">    channel: <span class="type">u16</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">Default</span> <span class="keyword">for</span> <span class="title class_">Tv</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">default</span>() <span class="punctuation">-&gt;</span> <span class="keyword">Self</span> &#123;</span><br><span class="line">        <span class="keyword">Self</span> &#123;</span><br><span class="line">            on: <span class="literal">false</span>,</span><br><span class="line">            volume: <span class="number">30</span>,</span><br><span class="line">            channel: <span class="number">1</span>,</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">Device</span> <span class="keyword">for</span> <span class="title class_">Tv</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">is_enabled</span>(&amp;<span class="keyword">self</span>) <span class="punctuation">-&gt;</span> <span class="type">bool</span> &#123;</span><br><span class="line">        <span class="keyword">self</span>.on</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">enable</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.on = <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">disable</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.on = <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">volume</span>(&amp;<span class="keyword">self</span>) <span class="punctuation">-&gt;</span> <span class="type">u8</span> &#123;</span><br><span class="line">        <span class="keyword">self</span>.volume</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">set_volume</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>, percent: <span class="type">u8</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.volume = std::cmp::<span class="title function_ invoke__">min</span>(percent, <span class="number">100</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">channel</span>(&amp;<span class="keyword">self</span>) <span class="punctuation">-&gt;</span> <span class="type">u16</span> &#123;</span><br><span class="line">        <span class="keyword">self</span>.channel</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">set_channel</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>, channel: <span class="type">u16</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.channel = channel;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">print_status</span>(&amp;<span class="keyword">self</span>) &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;------------------------------------&quot;</span>);</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;| I&#x27;m TV set.&quot;</span>);</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;| I&#x27;m &#123;&#125;&quot;</span>, <span class="keyword">if</span> <span class="keyword">self</span>.on &#123; <span class="string">&quot;enabled&quot;</span> &#125; <span class="keyword">else</span> &#123; <span class="string">&quot;disabled&quot;</span> &#125;);</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;| Current volume is &#123;&#125;%&quot;</span>, <span class="keyword">self</span>.volume);</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;| Current channel is &#123;&#125;&quot;</span>, <span class="keyword">self</span>.channel);</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;------------------------------------\n&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="main-rs"><a href="#main-rs" class="headerlink" title="main.rs"></a>main.rs</h4><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">mod</span> device;</span><br><span class="line"><span class="keyword">mod</span> remotes;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> device::&#123;Device, Radio, Tv&#125;;</span><br><span class="line"><span class="keyword">use</span> remotes::&#123;AdvancedRemove, BasicRemote, HasMutableDevice, Remote&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="title function_ invoke__">test_device</span>(Tv::<span class="title function_ invoke__">default</span>());</span><br><span class="line">    <span class="title function_ invoke__">test_device</span>(Radio::<span class="title function_ invoke__">default</span>());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">test_device</span>(device: <span class="keyword">impl</span> <span class="title class_">Device</span> + <span class="built_in">Clone</span>) &#123;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;Tests with basic remote.&quot;</span>);</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">basic_remote</span> = BasicRemote::<span class="title function_ invoke__">new</span>(device.<span class="title function_ invoke__">clone</span>());</span><br><span class="line">    basic_remote.<span class="title function_ invoke__">power</span>();</span><br><span class="line">    basic_remote.<span class="title function_ invoke__">device</span>().<span class="title function_ invoke__">print_status</span>();</span><br><span class="line"></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;Tests with advanced remote.&quot;</span>);</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">advanced_remote</span> = AdvancedRemove::<span class="title function_ invoke__">new</span>(device);</span><br><span class="line">    advanced_remote.<span class="title function_ invoke__">power</span>();</span><br><span class="line">    advanced_remote.<span class="title function_ invoke__">mute</span>();</span><br><span class="line">    advanced_remote.<span class="title function_ invoke__">device</span>().<span class="title function_ invoke__">print_status</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="Output-输出"><a href="#Output-输出" class="headerlink" title="Output 输出"></a>Output 输出</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">Tests with basic remote.</span><br><span class="line">Remote: power toggle</span><br><span class="line">------------------------------------</span><br><span class="line">| I&#x27;m TV set.</span><br><span class="line">| I&#x27;m enabled</span><br><span class="line">| Current volume is 30%</span><br><span class="line">| Current channel is 1</span><br><span class="line">------------------------------------</span><br><span class="line"></span><br><span class="line">Tests with advanced remote.</span><br><span class="line">Remote: power toggle</span><br><span class="line">Remote: mute</span><br><span class="line">------------------------------------</span><br><span class="line">| I&#x27;m TV set.</span><br><span class="line">| I&#x27;m enabled</span><br><span class="line">| Current volume is 0%</span><br><span class="line">| Current channel is 1</span><br><span class="line">------------------------------------</span><br><span class="line"></span><br><span class="line">Tests with basic remote.</span><br><span class="line">Remote: power toggle</span><br><span class="line">------------------------------------</span><br><span class="line">| I&#x27;m radio.</span><br><span class="line">| I&#x27;m enabled</span><br><span class="line">| Current volume is 30%</span><br><span class="line">| Current channel is 1</span><br><span class="line">------------------------------------</span><br><span class="line"></span><br><span class="line">Tests with advanced remote.</span><br><span class="line">Remote: power toggle</span><br><span class="line">Remote: mute</span><br><span class="line">------------------------------------</span><br><span class="line">| I&#x27;m radio.</span><br><span class="line">| I&#x27;m enabled</span><br><span class="line">| Current volume is 0%</span><br><span class="line">| Current channel is 1</span><br><span class="line">------------------------------------</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://tonymistark.github.io/2023/12/04/mayday-lip-syncing/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Ice">
      <meta itemprop="description" content="安静地坐着学习">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="BLOG">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/12/04/mayday-lip-syncing/" class="post-title-link" itemprop="url">maydat-lip-syncing</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2023-12-04 18:04:22" itemprop="dateCreated datePublished" datetime="2023-12-04T18:04:22+08:00">2023-12-04</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2023-12-06 22:57:50" itemprop="dateModified" datetime="2023-12-06T22:57:50+08:00">2023-12-06</time>
              </span>

          <br>
            <span class="post-meta-item" title="Symbols count in article">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">Symbols count in article: </span>
              <span>872</span>
            </span>
            <span class="post-meta-item" title="Reading time">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">Reading time &asymp;</span>
              <span>3 mins.</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="今日单词"><a href="#今日单词" class="headerlink" title="今日单词"></a>今日单词</h3><div align="center"> <img src="/images/lip-synches.png"/>今日单词</div>

<h1 id="Mayday-lip-synches-五月天假唱"><a href="#Mayday-lip-synches-五月天假唱" class="headerlink" title="Mayday lip-synches 五月天假唱"></a>Mayday lip-synches 五月天假唱</h1><h1 id="什么才是真正的摇滚精神？"><a href="#什么才是真正的摇滚精神？" class="headerlink" title="什么才是真正的摇滚精神？"></a>什么才是真正的摇滚精神？</h1><p>真正的摇滚精神是一种对自由、反叛和个人表达的热情。它代表着对传统观念的挑战，对权威和束缚的抗拒。摇滚精神鼓励个体追求自己的激情和独立思考，不受限制地表达自己的声音和观点。它强调对社会问题和不公正的关注，并通过音乐和艺术表达对这些问题的批判和反思。摇滚精神是一种生活态度，鼓励人们勇敢地追求自己的梦想，坚持自己的价值观，并与他人分享共同的热情和信念。</p>
<h2 id="一个歌手假唱意味着什么？"><a href="#一个歌手假唱意味着什么？" class="headerlink" title="一个歌手假唱意味着什么？"></a>一个歌手假唱意味着什么？</h2><p>一个歌手假唱意味着他或她在现场演出时并没有真正地唱歌，而是通过播放预先录制的音乐来模拟演唱。这通常被认为是一种不诚实和欺骗观众的行为，因为观众可能会认为他们正在观看一场真正的现场表演，而事实上，演出者并没有真正地展示他们的音乐才华。此外，假唱也可能违反某些演出和音乐产业的道德标准和规定。</p>
<h2 id="一个摇滚歌手假唱符合摇滚精神吗？他的内心能过的安宁吗？"><a href="#一个摇滚歌手假唱符合摇滚精神吗？他的内心能过的安宁吗？" class="headerlink" title="一个摇滚歌手假唱符合摇滚精神吗？他的内心能过的安宁吗？"></a>一个摇滚歌手假唱符合摇滚精神吗？他的内心能过的安宁吗？</h2><p>摇滚精神强调真实、自由和个人表达，因此一个摇滚歌手假唱与摇滚精神并不相符。假唱被认为是一种不诚实的行为，摇滚精神鼓励艺术家真实地展示他们的才华和表达自己的声音。假唱可能会削弱观众对艺术家的信任和尊重，破坏他们与观众之间的联系。</p>
<p>至于内心的安宁，这是一个个体的感受，每个人的体验可能不同。然而，对于许多艺术家来说，真实地表达自己是一种重要的价值观和追求。当一个摇滚歌手选择假唱时，可能会在内心产生不安和冲突，因为他们没有真正地展示自己的音乐才华和个人表达。因此，假唱可能会对他们的内心和艺术追求造成一定程度的困扰。</p>
<h2 id="演唱会假唱对于一个摇滚歌手来说属于轻微错误还是严重错误？"><a href="#演唱会假唱对于一个摇滚歌手来说属于轻微错误还是严重错误？" class="headerlink" title="演唱会假唱对于一个摇滚歌手来说属于轻微错误还是严重错误？"></a>演唱会假唱对于一个摇滚歌手来说属于轻微错误还是严重错误？</h2><p>对于一个摇滚歌手来说，演唱会假唱可以被认为是一个严重错误。摇滚音乐注重现场表演的真实性和能量，观众期望在演唱会上亲眼见证歌手的实力和情感投入。选择假唱可能会被认为是一种欺骗观众的行为，削弱了演唱会的真实性和互动性。这可能会对歌手的声誉和信任度造成负面影响，并引发观众的不满和失望。</p>
<p>然而，每个情况都是独特的，有时候摇滚歌手选择假唱可能是出于保护嗓子健康或其他技术或声音问题的考虑。因此，如何评价这个错误的严重程度可能因情况而异。但总体而言，对于一个摇滚歌手来说，选择假唱在摇滚音乐领域中可能被视为一个严重错误。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://tonymistark.github.io/2023/12/03/design-pattern/adapter/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Ice">
      <meta itemprop="description" content="安静地坐着学习">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="BLOG">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/12/03/design-pattern/adapter/" class="post-title-link" itemprop="url">Adapter</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2023-12-03 16:03:51 / Modified: 18:07:40" itemprop="dateCreated datePublished" datetime="2023-12-03T16:03:51+08:00">2023-12-03</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/design-pattern/" itemprop="url" rel="index"><span itemprop="name">design-pattern</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="Symbols count in article">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">Symbols count in article: </span>
              <span>5k</span>
            </span>
            <span class="post-meta-item" title="Reading time">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">Reading time &asymp;</span>
              <span>18 mins.</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="Adapter-适配器"><a href="#Adapter-适配器" class="headerlink" title="Adapter 适配器"></a>Adapter 适配器</h1><h2 id="Intent-意图"><a href="#Intent-意图" class="headerlink" title="Intent 意图"></a>Intent 意图</h2><p><strong>Adapter</strong> is a structural design pattern that allows objects with incompatible interfaces to collaborate.<br>适配器是一种结构设计模式，它允许具有不兼容接口的对象进行协作。</p>
<div align="center"> <img src="/images/adapter-header.png"/></div>

<h2 id="Problem-问题"><a href="#Problem-问题" class="headerlink" title="Problem 问题"></a>Problem 问题</h2><p>Imagine that you’re creating a stock market monitoring app. The app downloads the stock data from multiple sources in XML format and then displays nice-looking charts and diagrams for the user.<br>想象一下，您正在创建一个股票市场监控应用程序。该应用程序以XML格式从多个来源下载股票数据，然后为用户显示漂亮的图表和图表。</p>
<p>At some point, you decide to improve the app by integrating a smart 3rd-party analytics library. But there’s a catch: the analytics library only works with data in JSON format.<br>在某些时候，您决定通过集成智能第三方分析库来改进应用程序。但有一个问题：分析库仅适用于 JSON 格式的数据。</p>
<div align="center"> <img src="/images/adapter-problem-en.png"/>You can’t use the analytics library “as is” because it expects the data in a format that’s incompatible with your app.</br>您不能“按原样”使用分析库，因为它需要的数据格式与您的应用不兼容。</div>
You could change the library to work with XML. However, this might break some existing code that relies on the library. And worse, you might not have access to the library’s source code in the first place, making this approach impossible.
您可以更改库以使用 XML。但是，这可能会破坏一些依赖于该库的现有代码。更糟糕的是，您可能一开始就无法访问库的源代码，从而无法使用此方法。

<h2 id="Solution-解决方案"><a href="#Solution-解决方案" class="headerlink" title="Solution 解决方案"></a>Solution 解决方案</h2><p>You can create an adapter. This is a special object that converts the interface of one object so that another object can understand it.<br>您可以创建适配器。这是一个特殊的对象，它转换一个对象的接口，以便另一个对象可以理解它。</p>
<p>An adapter wraps one of the objects to hide the complexity of conversion happening behind the scenes. The wrapped object isn’t even aware of the adapter. For example, you can wrap an object that operates in meters and kilometers with an adapter that converts all of the data to imperial units such as feet and miles.<br>适配器包装其中一个对象，以隐藏在后台发生的转换的复杂性。包装的对象甚至不知道适配器。例如，您可以使用适配器包装以米和公里为单位运行的对象，该适配器将所有数据转换为英制单位（如英尺和英里）。</p>
<p>Adapters can not only convert data into various formats but can also help objects with different interfaces collaborate. Here’s how it works:<br>适配器不仅可以将数据转换为各种格式，还可以帮助具有不同接口的对象进行协作。其工作原理如下：</p>
<ol>
<li>The adapter gets an interface, compatible with one of the existing objects.<br>适配器获取一个接口，该接口与现有对象之一兼容。</li>
<li>Using this interface, the existing object can safely call the adapter’s methods.<br>使用此接口，现有对象可以安全地调用适配器的方法。</li>
<li>Upon receiving a call, the adapter passes the request to the second object, but in a format and order that the second object expects.<br>收到调用后，适配器将请求传递给第二个对象，但采用第二个对象期望的格式和顺序。</li>
</ol>
<p>Sometimes it’s even possible to create a two-way adapter that can convert the calls in both directions.<br>有时甚至可以创建一个双向适配器，可以在两个方向上转换呼叫。</p>
<div align="center"> <img src="/images/adapter-solution.png"/></div>
Let’s get back to our stock market app. To solve the dilemma of incompatible formats, you can create XML-to-JSON adapters for every class of the analytics library that your code works with directly. Then you adjust your code to communicate with the library only via these adapters. When an adapter receives a call, it translates the incoming XML data into a JSON structure and passes the call to the appropriate methods of a wrapped analytics object.

<p>让我们回到我们的股票市场应用程序。为了解决格式不兼容的难题，您可以为代码直接使用的分析库的每个类创建 XML 到 JSON 适配器。然后，将代码调整为仅通过这些适配器与库通信。当适配器收到调用时，它会将传入的 XML 数据转换为 JSON 结构，并将调用传递给包装的分析对象的相应方法。</p>
<h2 id="Real-World-Analogy-真实世界的类比"><a href="#Real-World-Analogy-真实世界的类比" class="headerlink" title="Real-World Analogy 真实世界的类比"></a>Real-World Analogy 真实世界的类比</h2><div align="center"> <img src="/images/adapter-comic-1.png"/>A suitcase before and after a trip abroad.</br>出国旅行前后的行李箱。</div>
When you travel from the US to Europe for the first time, you may get a surprise when trying to charge your laptop. The power plug and sockets standards are different in different countries. That’s why your US plug won’t fit a German socket. The problem can be solved by using a power plug adapter that has the American-style socket and the European-style plug.
当您第一次从美国到欧洲旅行时，当您尝试为笔记本电脑充电时，您可能会感到惊讶。不同国家的电源插头和插座标准不同。这就是为什么您的美国插头不适合德国插座的原因。这个问题可以通过使用具有美式插座和欧式插头的电源插头适配器来解决。

<h2 id="Structure-结构"><a href="#Structure-结构" class="headerlink" title="Structure 结构"></a>Structure 结构</h2><h3 id="Object-adapter-对象适配器"><a href="#Object-adapter-对象适配器" class="headerlink" title="Object adapter 对象适配器"></a>Object adapter 对象适配器</h3><p>This implementation uses the object composition principle: the adapter implements the interface of one object and wraps the other one. It can be implemented in all popular programming languages.<br>此实现使用对象组合原则：适配器实现一个对象的接口并包装另一个对象。它可以用所有流行的编程语言实现。</p>
<div align="center"> <img src="/images/adapter-structure-object-adapter.png"/></div>

<ol>
<li><p>The Client is a class that contains the existing business logic of the program.<br>Client 是一个包含程序现有业务逻辑的类。</p>
</li>
<li><p>The Client Interface describes a protocol that other classes must follow to be able to collaborate with the client code.<br>客户端接口描述了其他类必须遵循的协议，以便能够与客户端代码进行协作。</p>
</li>
<li><p>The Service is some useful class (usually 3rd-party or legacy). The client can’t use this class directly because it has an incompatible interface.<br>服务是一些有用的类（通常是第三方或旧版）。客户端不能直接使用此类，因为它具有不兼容的接口。</p>
</li>
<li><p>The <strong>Adapter</strong> is a class that’s able to work with both the client and the service: it implements the client interface, while wrapping the service object. The adapter receives calls from the client via the client interface and translates them into calls to the wrapped service object in a format it can understand.<br>Adapter 是一个能够同时使用客户端和服务的类：它实现客户端接口，同时包装服务对象。适配器通过客户端接口接收来自客户端的调用，并以它可以理解的格式将其转换为对包装的服务对象的调用。</p>
</li>
<li><p>The client code doesn’t get coupled to the concrete adapter class as long as it works with the adapter via the client interface. Thanks to this, you can introduce new types of adapters into the program without breaking the existing client code. This can be useful when the interface of the service class gets changed or replaced: you can just create a new adapter class without changing the client code.<br>只要客户端代码通过客户端接口与适配器一起使用，它就不会耦合到具体的适配器类。因此，您可以在不破坏现有客户端代码的情况下将新类型的适配器引入程序。当服务类的接口被更改或替换时，这可能很有用：您可以只创建一个新的适配器类，而无需更改客户端代码。</p>
</li>
</ol>
<h3 id="Class-adapter-类适配器"><a href="#Class-adapter-类适配器" class="headerlink" title="Class adapter 类适配器"></a>Class adapter 类适配器</h3><p>This implementation uses inheritance: the adapter inherits interfaces from both objects at the same time. Note that this approach can only be implemented in programming languages that support multiple inheritance, such as C++.<br>此实现使用继承：适配器同时从两个对象继承接口。请注意，此方法只能在支持多重继承的编程语言（如 C++）中实现。</p>
<div align="center"> <img src="/images/adapter-structure-class-adapter.png"/></div>

<ol>
<li>The Class Adapter doesn’t need to wrap any objects because it inherits behaviors from both the client and the service. The adaptation happens within the overridden methods. The resulting adapter can be used in place of an existing client class.<br>类适配器不需要包装任何对象，因为它从客户端和服务继承行为。适应发生在被覆盖的方法中。生成的适配器可用于代替现有的客户端类。</li>
</ol>
<h2 id="Pseudocode-伪代码"><a href="#Pseudocode-伪代码" class="headerlink" title="Pseudocode 伪代码"></a>Pseudocode 伪代码</h2><p>This example of the <strong>Adapter</strong> pattern is based on the classic conflict between square pegs and round holes.<br>此适配器模式示例基于方形钉子和圆孔之间的经典冲突。</p>
<div align="center"> <img src="/images/adapter-example.png"/>Adapting square pegs to round holes.</br>使方钉适应圆孔。</div>
The Adapter pretends to be a round peg, with a radius equal to a half of the square’s diameter (in other words, the radius of the smallest circle that can accommodate the square peg).
适配器假装是一个圆钉，其半径等于正方形直径的一半（换句话说，可以容纳方形钉的最小圆的半径）。

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Say you have two classes with compatible interfaces:</span></span><br><span class="line"><span class="comment">// RoundHole and RoundPeg.</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">RoundHole</span> is</span><br><span class="line">    constructor <span class="title function_">RoundHole</span><span class="params">(radius)</span> &#123; ... &#125;</span><br><span class="line"></span><br><span class="line">    method <span class="title function_">getRadius</span><span class="params">()</span> is</span><br><span class="line">        <span class="comment">// Return the radius of the hole.</span></span><br><span class="line"></span><br><span class="line">    method <span class="title function_">fits</span><span class="params">(peg: RoundPeg)</span> is</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.getRadius() &gt;= peg.getRadius()</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">RoundPeg</span> is</span><br><span class="line">    constructor <span class="title function_">RoundPeg</span><span class="params">(radius)</span> &#123; ... &#125;</span><br><span class="line"></span><br><span class="line">    method <span class="title function_">getRadius</span><span class="params">()</span> is</span><br><span class="line">        <span class="comment">// Return the radius of the peg.</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// But there&#x27;s an incompatible class: SquarePeg.</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SquarePeg</span> is</span><br><span class="line">    constructor <span class="title function_">SquarePeg</span><span class="params">(width)</span> &#123; ... &#125;</span><br><span class="line"></span><br><span class="line">    method <span class="title function_">getWidth</span><span class="params">()</span> is</span><br><span class="line">        <span class="comment">// Return the square peg width.</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// An adapter class lets you fit square pegs into round holes.</span></span><br><span class="line"><span class="comment">// It extends the RoundPeg class to let the adapter objects act</span></span><br><span class="line"><span class="comment">// as round pegs.</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SquarePegAdapter</span> <span class="keyword">extends</span> <span class="title class_">RoundPeg</span> is</span><br><span class="line">    <span class="comment">// In reality, the adapter contains an instance of the</span></span><br><span class="line">    <span class="comment">// SquarePeg class.</span></span><br><span class="line">    <span class="keyword">private</span> field peg: SquarePeg</span><br><span class="line"></span><br><span class="line">    constructor <span class="title function_">SquarePegAdapter</span><span class="params">(peg: SquarePeg)</span> is</span><br><span class="line">        <span class="built_in">this</span>.peg = peg</span><br><span class="line"></span><br><span class="line">    method <span class="title function_">getRadius</span><span class="params">()</span> is</span><br><span class="line">        <span class="comment">// The adapter pretends that it&#x27;s a round peg with a</span></span><br><span class="line">        <span class="comment">// radius that could fit the square peg that the adapter</span></span><br><span class="line">        <span class="comment">// actually wraps.</span></span><br><span class="line">        <span class="keyword">return</span> peg.getWidth() * Math.sqrt(<span class="number">2</span>) / <span class="number">2</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// Somewhere in client code.</span></span><br><span class="line">hole = <span class="keyword">new</span> <span class="title class_">RoundHole</span>(<span class="number">5</span>)</span><br><span class="line">rpeg = <span class="keyword">new</span> <span class="title class_">RoundPeg</span>(<span class="number">5</span>)</span><br><span class="line">hole.fits(rpeg) <span class="comment">// true</span></span><br><span class="line"></span><br><span class="line">small_sqpeg = <span class="keyword">new</span> <span class="title class_">SquarePeg</span>(<span class="number">5</span>)</span><br><span class="line">large_sqpeg = <span class="keyword">new</span> <span class="title class_">SquarePeg</span>(<span class="number">10</span>)</span><br><span class="line">hole.fits(small_sqpeg) <span class="comment">// this won&#x27;t compile (incompatible types)</span></span><br><span class="line"></span><br><span class="line">small_sqpeg_adapter = <span class="keyword">new</span> <span class="title class_">SquarePegAdapter</span>(small_sqpeg)</span><br><span class="line">large_sqpeg_adapter = <span class="keyword">new</span> <span class="title class_">SquarePegAdapter</span>(large_sqpeg)</span><br><span class="line">hole.fits(small_sqpeg_adapter) <span class="comment">// true</span></span><br><span class="line">hole.fits(large_sqpeg_adapter) <span class="comment">// false</span></span><br></pre></td></tr></table></figure>

<h2 id="Applicability-适用性"><a href="#Applicability-适用性" class="headerlink" title="Applicability 适用性"></a>Applicability 适用性</h2><ul>
<li><p><strong>Use the Adapter class when you want to use some existing class, but its interface isn’t compatible with the rest of your code.<br>如果要使用某些现有类，但其接口与代码的其余部分不兼容，请使用 Adapter 类。</strong></p>
</li>
<li><p>The Adapter pattern lets you create a middle-layer class that serves as a translator between your code and a legacy class, a 3rd-party class or any other class with a weird interface.<br>适配器模式允许您创建一个中间层类，该类充当代码与旧类、第三方类或任何其他具有奇怪接口的类之间的转换器。</p>
</li>
<li><p><strong>Use the pattern when you want to reuse several existing subclasses that lack some common functionality that can’t be added to the superclass.<br>如果要重用多个现有的子类，这些子类缺少一些无法添加到超类的通用功能，请使用该模式。</strong></p>
</li>
<li><p>You could extend each subclass and put the missing functionality into new child classes. However, you’ll need to duplicate the code across all of these new classes, which smells really bad.<br>您可以扩展每个子类，并将缺少的功能放入新的子类中。但是，您需要在所有这些新类中复制代码，这闻起来非常难闻。</p>
</li>
</ul>
<p>The much more elegant solution would be to put the missing functionality into an adapter class. Then you would wrap objects with missing features inside the adapter, gaining needed features dynamically. For this to work, the target classes must have a common interface, and the adapter’s field should follow that interface. This approach looks very similar to the Decorator pattern.<br>更优雅的解决方案是将缺少的功能放入适配器类中。然后，将缺少特征的对象包装在适配器内，动态获得所需的特征。为此，目标类必须具有通用接口，并且适配器的字段应遵循该接口。此方法看起来与 Decorator 模式非常相似。</p>
<h2 id="How-to-Implement-如何实现"><a href="#How-to-Implement-如何实现" class="headerlink" title="How to Implement 如何实现"></a>How to Implement 如何实现</h2><ol>
<li><p>Make sure that you have at least two classes with incompatible interfaces:确保至少有两个接口不兼容的类：</p>
<ul>
<li>A useful service class, which you can’t change (often 3rd-party, legacy or with lots of existing dependencies).<br>一个有用的服务类，您无法更改（通常是第三方、旧版或具有大量现有依赖项）。</li>
<li>One or several client classes that would benefit from using the service class.<br>一个或多个客户端类，这些类将从使用服务类中受益。</li>
</ul>
</li>
<li><p>Declare the client interface and describe how clients communicate with the service.<br>声明客户端接口并描述客户端如何与服务通信。</p>
</li>
<li><p>Create the adapter class and make it follow the client interface. Leave all the methods empty for now.<br>创建适配器类，并使其遵循客户端接口。暂时将所有方法留空。</p>
</li>
<li><p>Add a field to the adapter class to store a reference to the service object. The common practice is to initialize this field via the constructor, but sometimes it’s more convenient to pass it to the adapter when calling its methods.<br>向适配器类添加一个字段，以存储对服务对象的引用。通常的做法是通过构造函数初始化此字段，但有时在调用适配器的方法时将其传递给适配器会更方便。</p>
</li>
<li><p>One by one, implement all methods of the client interface in the adapter class. The adapter should delegate most of the real work to the service object, handling only the interface or data format conversion.<br>在适配器类中逐个实现客户端接口的所有方法。适配器应将大部分实际工作委托给服务对象，仅处理接口或数据格式转换。</p>
</li>
<li><p>Clients should use the adapter via the client interface. This will let you change or extend the adapters without affecting the client code.<br>客户端应通过客户端接口使用适配器。这将允许您更改或扩展适配器，而不会影响客户端代码。</p>
</li>
</ol>
<h2 id="Pros-and-Cons-优点和缺点"><a href="#Pros-and-Cons-优点和缺点" class="headerlink" title="Pros and Cons 优点和缺点"></a>Pros and Cons 优点和缺点</h2><table>
<thead>
<tr>
<th>Pros 优点</th>
<th>Cons 缺点</th>
</tr>
</thead>
<tbody><tr>
<td>Single Responsibility Principle. You can separate the interface or data conversion code from the primary business logic of the program. 单一责任原则。您可以将接口或数据转换代码与程序的主要业务逻辑分开。</td>
<td>The overall complexity of the code increases because you need to introduce a set of new interfaces and classes. Sometimes it’s simpler just to change the service class so that it matches the rest of your code. 代码的整体复杂性增加，因为您需要引入一组新的接口和类。有时，只需更改服务类以使其与代码的其余部分匹配即可更简单。</td>
</tr>
<tr>
<td>Open&#x2F;Closed Principle. You can introduce new types of adapters into the program without breaking the existing client code, as long as they work with the adapters through the client interface. 开&#x2F;闭原理。您可以在不破坏现有客户端代码的情况下将新类型的适配器引入程序，只要它们通过客户端接口与适配器一起使用即可。</td>
<td></td>
</tr>
</tbody></table>
<h2 id="Relations-with-Other-Patterns-与其他模式的关系"><a href="#Relations-with-Other-Patterns-与其他模式的关系" class="headerlink" title="Relations with Other Patterns 与其他模式的关系"></a>Relations with Other Patterns 与其他模式的关系</h2><ul>
<li><p>Bridge is usually designed up-front, letting you develop parts of an application independently of each other. On the other hand, Adapter is commonly used with an existing app to make some otherwise-incompatible classes work together nicely.<br>Bridge 通常是预先设计的，允许您彼此独立地开发应用程序的各个部分。另一方面，Adapter 通常与现有应用程序一起使用，以使一些不兼容的类很好地协同工作。</p>
</li>
<li><p>Adapter provides a completely different interface for accessing an existing object. On the other hand, with the Decorator pattern the interface either stays the same or gets extended. In addition, Decorator supports recursive composition, which isn’t possible when you use Adapter.<br>适配器提供了一个完全不同的接口来访问现有对象。另一方面，使用 Decorator 模式，界面要么保持不变，要么得到扩展。此外，Decorator 支持递归组合，这在使用 Adapter 时是不可能的。</p>
</li>
<li><p>With Adapter you access an existing object via different interface. With Proxy, the interface stays the same. With Decorator you access the object via an enhanced interface.<br>使用 Adapter，您可以通过不同的接口访问现有对象。使用 Proxy，界面保持不变。使用 Decorator，您可以通过增强的界面访问对象。</p>
</li>
<li><p>Facade defines a new interface for existing objects, whereas Adapter tries to make the existing interface usable. Adapter usually wraps just one object, while Facade works with an entire subsystem of objects.<br>Facade 为现有对象定义了一个新的接口，而 Adapter 则试图使现有接口可用。Adapter 通常只包装一个对象，而 Facade 则处理对象的整个子系统。</p>
</li>
<li><p>Bridge, State, Strategy (and to some degree Adapter) have very similar structures. Indeed, all of these patterns are based on composition, which is delegating work to other objects. However, they all solve different problems. A pattern isn’t just a recipe for structuring your code in a specific way. It can also communicate to other developers the problem the pattern solves.<br>桥接、状态、策略（在某种程度上还有适配器）具有非常相似的结构。事实上，所有这些模式都是基于构图的，而构图是将工作委托给其他对象。但是，它们都解决了不同的问题。模式不仅仅是以特定方式构建代码的秘诀。它还可以向其他开发人员传达该模式解决的问题。</p>
</li>
</ul>
<h2 id="Code-Examples-代码示例"><a href="#Code-Examples-代码示例" class="headerlink" title="Code Examples 代码示例"></a>Code Examples 代码示例</h2><h3 id="Python-Conceptual-Example-via-inheritance-概念示例（通过继承）"><a href="#Python-Conceptual-Example-via-inheritance-概念示例（通过继承）" class="headerlink" title="Python: Conceptual Example (via inheritance) 概念示例（通过继承）"></a>Python: Conceptual Example (via inheritance) 概念示例（通过继承）</h3><p>This example illustrates the structure of the Adapter design pattern. It focuses on answering these questions:<br>此示例阐释了适配器设计模式的结构。它侧重于回答以下问题：</p>
<ul>
<li>What classes does it consist of?<br>它由哪些类组成？</li>
<li>What roles do these classes play?<br>这些课程扮演什么角色？</li>
<li>In what way the elements of the pattern are related?<br>模式的元素以何种方式相关？</li>
</ul>
<h3 id="main-py：概念示例"><a href="#main-py：概念示例" class="headerlink" title="main.py：概念示例"></a>main.py：概念示例</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Target</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    The Target defines the domain-specific interface used by the client code.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">request</span>(<span class="params">self</span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Target: The default target&#x27;s behavior.&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Adaptee</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    The Adaptee contains some useful behavior, but its interface is incompatible</span></span><br><span class="line"><span class="string">    with the existing client code. The Adaptee needs some adaptation before the</span></span><br><span class="line"><span class="string">    client code can use it.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">specific_request</span>(<span class="params">self</span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;.eetpadA eht fo roivaheb laicepS&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Adapter</span>(Target, Adaptee):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    The Adapter makes the Adaptee&#x27;s interface compatible with the Target&#x27;s</span></span><br><span class="line"><span class="string">    interface via multiple inheritance.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">request</span>(<span class="params">self</span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">f&quot;Adapter: (TRANSLATED) <span class="subst">&#123;self.specific_request()[::-<span class="number">1</span>]&#125;</span>&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">client_code</span>(<span class="params">target: <span class="string">&quot;Target&quot;</span></span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    The client code supports all classes that follow the Target interface.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(target.request(), end=<span class="string">&quot;&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Client: I can work just fine with the Target objects:&quot;</span>)</span><br><span class="line">    target = Target()</span><br><span class="line">    client_code(target)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;\n&quot;</span>)</span><br><span class="line"></span><br><span class="line">    adaptee = Adaptee()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Client: The Adaptee class has a weird interface. &quot;</span></span><br><span class="line">          <span class="string">&quot;See, I don&#x27;t understand it:&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;Adaptee: <span class="subst">&#123;adaptee.specific_request()&#125;</span>&quot;</span>, end=<span class="string">&quot;\n\n&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Client: But I can work with it via the Adapter:&quot;</span>)</span><br><span class="line">    adapter = Adapter()</span><br><span class="line">    client_code(adapter)</span><br></pre></td></tr></table></figure>
<h3 id="Output-txt-Execution-result"><a href="#Output-txt-Execution-result" class="headerlink" title="Output.txt: Execution result"></a>Output.txt: Execution result</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Client: I can work just fine with the Target objects:</span><br><span class="line">Target: The default target&#x27;s behavior.</span><br><span class="line"></span><br><span class="line">Client: The Adaptee class has a weird interface. See, I don&#x27;t understand it:</span><br><span class="line">Adaptee: .eetpadA eht fo roivaheb laicepS</span><br><span class="line"></span><br><span class="line">Client: But I can work with it via the Adapter:</span><br><span class="line">Adapter: (TRANSLATED) Special behavior of the Adaptee.</span><br></pre></td></tr></table></figure>

<h3 id="Python-Conceptual-Example-via-object-composition-概念示例（通过对象组合）"><a href="#Python-Conceptual-Example-via-object-composition-概念示例（通过对象组合）" class="headerlink" title="Python: Conceptual Example (via object composition) 概念示例（通过对象组合）"></a>Python: Conceptual Example (via object composition) 概念示例（通过对象组合）</h3><p>This example illustrates the structure of the Adapter design pattern. It focuses on answering these questions:<br>此示例阐释了适配器设计模式的结构。它侧重于回答以下问题：</p>
<ul>
<li>What classes does it consist of?<br>它由哪些类组成？</li>
<li>What roles do these classes play?<br>这些课程扮演什么角色？</li>
<li>In what way the elements of the pattern are related?<br>模式的元素以何种方式相关？</li>
</ul>
<h3 id="main-py：概念示例-1"><a href="#main-py：概念示例-1" class="headerlink" title="main.py：概念示例"></a>main.py：概念示例</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Target</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    The Target defines the domain-specific interface used by the client code.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">request</span>(<span class="params">self</span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Target: The default target&#x27;s behavior.&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Adaptee</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    The Adaptee contains some useful behavior, but its interface is incompatible</span></span><br><span class="line"><span class="string">    with the existing client code. The Adaptee needs some adaptation before the</span></span><br><span class="line"><span class="string">    client code can use it.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">specific_request</span>(<span class="params">self</span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;.eetpadA eht fo roivaheb laicepS&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Adapter</span>(<span class="title class_ inherited__">Target</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    The Adapter makes the Adaptee&#x27;s interface compatible with the Target&#x27;s</span></span><br><span class="line"><span class="string">    interface via composition.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, adaptee: Adaptee</span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">        self.adaptee = adaptee</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">request</span>(<span class="params">self</span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">f&quot;Adapter: (TRANSLATED) <span class="subst">&#123;self.adaptee.specific_request()[::-<span class="number">1</span>]&#125;</span>&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">client_code</span>(<span class="params">target: Target</span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    The client code supports all classes that follow the Target interface.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(target.request(), end=<span class="string">&quot;&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Client: I can work just fine with the Target objects:&quot;</span>)</span><br><span class="line">    target = Target()</span><br><span class="line">    client_code(target)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;\n&quot;</span>)</span><br><span class="line"></span><br><span class="line">    adaptee = Adaptee()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Client: The Adaptee class has a weird interface. &quot;</span></span><br><span class="line">          <span class="string">&quot;See, I don&#x27;t understand it:&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;Adaptee: <span class="subst">&#123;adaptee.specific_request()&#125;</span>&quot;</span>, end=<span class="string">&quot;\n\n&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Client: But I can work with it via the Adapter:&quot;</span>)</span><br><span class="line">    adapter = Adapter(adaptee)</span><br><span class="line">    client_code(adapter)</span><br></pre></td></tr></table></figure>
<h3 id="Output-txt-Execution-result-1"><a href="#Output-txt-Execution-result-1" class="headerlink" title="Output.txt: Execution result"></a>Output.txt: Execution result</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Client: I can work just fine with the Target objects:</span><br><span class="line">Target: The default target&#x27;s behavior.</span><br><span class="line"></span><br><span class="line">Client: The Adaptee class has a weird interface. See, I don&#x27;t understand it:</span><br><span class="line">Adaptee: .eetpadA eht fo roivaheb laicepS</span><br><span class="line"></span><br><span class="line">Client: But I can work with it via the Adapter:</span><br><span class="line">Adapter: (TRANSLATED) Special behavior of the Adaptee.</span><br></pre></td></tr></table></figure>

<h3 id="Adapter-in-Rust-Rust-中的适配器"><a href="#Adapter-in-Rust-Rust-中的适配器" class="headerlink" title="Adapter in Rust Rust 中的适配器"></a>Adapter in Rust Rust 中的适配器</h3><p>In this example, the <code>trait SpecificTarget</code> is incompatible with a <code>call</code> function which accepts <code>trait Target</code> only.<br>在此示例中，与 <code>trait SpecificTarget</code> 仅接受 <code>call</code> <code>trait Target</code> 的函数不兼容。</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">call</span>(target: <span class="keyword">impl</span> <span class="title class_">Target</span>);</span><br></pre></td></tr></table></figure>
<p>The adapter helps to pass the incompatible interface to the <code>call</code> function.<br>适配器有助于将不兼容的接口传递给 <code>call</code> 函数。</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="variable">target</span> = TargetAdapter::<span class="title function_ invoke__">new</span>(specific_target);</span><br><span class="line"><span class="title function_ invoke__">call</span>(target);</span><br></pre></td></tr></table></figure>

<h4 id="adapter-rs"><a href="#adapter-rs" class="headerlink" title="adapter.rs"></a>adapter.rs</h4><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> crate::&#123;adaptee::SpecificTarget, Target&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// Converts adaptee&#x27;s specific interface to a compatible `Target` output.</span></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">struct</span> <span class="title class_">TargetAdapter</span> &#123;</span><br><span class="line">    adaptee: SpecificTarget,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">TargetAdapter</span> &#123;</span><br><span class="line">    <span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">new</span>(adaptee: SpecificTarget) <span class="punctuation">-&gt;</span> <span class="keyword">Self</span> &#123;</span><br><span class="line">        <span class="keyword">Self</span> &#123; adaptee &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">Target</span> <span class="keyword">for</span> <span class="title class_">TargetAdapter</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">request</span>(&amp;<span class="keyword">self</span>) <span class="punctuation">-&gt;</span> <span class="type">String</span> &#123;</span><br><span class="line">        <span class="comment">// Here&#x27;s the &quot;adaptation&quot; of a specific output to a compatible output.</span></span><br><span class="line">        <span class="keyword">self</span>.adaptee.<span class="title function_ invoke__">specific_request</span>().<span class="title function_ invoke__">chars</span>().<span class="title function_ invoke__">rev</span>().<span class="title function_ invoke__">collect</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="adaptee-rs"><a href="#adaptee-rs" class="headerlink" title="adaptee.rs"></a>adaptee.rs</h4><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">pub</span> <span class="keyword">struct</span> <span class="title class_">SpecificTarget</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">SpecificTarget</span> &#123;</span><br><span class="line">    <span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">specific_request</span>(&amp;<span class="keyword">self</span>) <span class="punctuation">-&gt;</span> <span class="type">String</span> &#123;</span><br><span class="line">        <span class="string">&quot;.tseuqer cificepS&quot;</span>.<span class="title function_ invoke__">into</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="target-rs"><a href="#target-rs" class="headerlink" title="target.rs"></a>target.rs</h4><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">pub</span> <span class="keyword">trait</span> <span class="title class_">Target</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">request</span>(&amp;<span class="keyword">self</span>) <span class="punctuation">-&gt;</span> <span class="type">String</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">struct</span> <span class="title class_">OrdinaryTarget</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">Target</span> <span class="keyword">for</span> <span class="title class_">OrdinaryTarget</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">request</span>(&amp;<span class="keyword">self</span>) <span class="punctuation">-&gt;</span> <span class="type">String</span> &#123;</span><br><span class="line">        <span class="string">&quot;Ordinary request.&quot;</span>.<span class="title function_ invoke__">into</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="main-rs"><a href="#main-rs" class="headerlink" title="main.rs"></a>main.rs</h4><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">mod</span> adaptee;</span><br><span class="line"><span class="keyword">mod</span> adapter;</span><br><span class="line"><span class="keyword">mod</span> target;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> adaptee::SpecificTarget;</span><br><span class="line"><span class="keyword">use</span> adapter::TargetAdapter;</span><br><span class="line"><span class="keyword">use</span> target::&#123;OrdinaryTarget, Target&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// Calls any object of a `Target` trait.</span></span><br><span class="line"><span class="comment">///</span></span><br><span class="line"><span class="comment">/// To understand the Adapter pattern better, imagine that this is</span></span><br><span class="line"><span class="comment">/// a client code, which can operate over a specific interface only</span></span><br><span class="line"><span class="comment">/// (`Target` trait only). It means that an incompatible interface cannot be</span></span><br><span class="line"><span class="comment">/// passed here without an adapter.</span></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">call</span>(target: <span class="keyword">impl</span> <span class="title class_">Target</span>) &#123;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&#x27;&#123;&#125;&#x27;&quot;</span>, target.<span class="title function_ invoke__">request</span>());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">target</span> = OrdinaryTarget;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print!</span>(<span class="string">&quot;A compatible target can be directly called: &quot;</span>);</span><br><span class="line">    <span class="title function_ invoke__">call</span>(target);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">adaptee</span> = SpecificTarget;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">println!</span>(</span><br><span class="line">        <span class="string">&quot;Adaptee is incompatible with client: &#x27;&#123;&#125;&#x27;&quot;</span>,</span><br><span class="line">        adaptee.<span class="title function_ invoke__">specific_request</span>()</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">adapter</span> = TargetAdapter::<span class="title function_ invoke__">new</span>(adaptee);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print!</span>(<span class="string">&quot;But with adapter client can call its method: &quot;</span>);</span><br><span class="line">    <span class="title function_ invoke__">call</span>(adapter);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Output-输出"><a href="#Output-输出" class="headerlink" title="Output 输出"></a>Output 输出</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">A compatible target can be directly called: &#x27;Ordinary request.&#x27;</span><br><span class="line">Adaptee is incompatible with client: &#x27;.tseuqer cificepS&#x27;</span><br><span class="line">But with adapter client can call its method: &#x27;Specific request.&#x27;</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/8/">8</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Ice</p>
  <div class="site-description" itemprop="description">安静地坐着学习</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">76</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">7</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">9</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/TonyMistark" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;TonyMistark" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://gitee.com/Micestark" title="Gitee → https:&#x2F;&#x2F;gitee.com&#x2F;Micestark" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>Gitee</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:tony_mistark@163.com" title="E-Mail → mailto:tony_mistark@163.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://twitter.com/Tony_Mistark" title="Twitter → https:&#x2F;&#x2F;twitter.com&#x2F;Tony_Mistark" rel="noopener" target="_blank"><i class="fab fa-twitter fa-fw"></i>Twitter</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2024</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Ice</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-area"></i>
    </span>
    <span title="Symbols count total">126k</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="Reading time total">7:38</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a>
  </div>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="Total Visitors">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="Total Views">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/medium-zoom@1/dist/medium-zoom.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  


</body>
</html>
