<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"tonymistark.github.io","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":true,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":true,"preload":true},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="Singleton 单例模式Intent 意图Singleton is a creational design pattern that lets you ensure that a class has only one instance, while providing a global access point to this instance.Singleton 是一种创建性设计模式，它允许">
<meta property="og:type" content="article">
<meta property="og:title" content="Singleton">
<meta property="og:url" content="https://tonymistark.github.io/2023/11/23/design-pattern/singleton/index.html">
<meta property="og:site_name" content="BLOG">
<meta property="og:description" content="Singleton 单例模式Intent 意图Singleton is a creational design pattern that lets you ensure that a class has only one instance, while providing a global access point to this instance.Singleton 是一种创建性设计模式，它允许">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://tonymistark.github.io/images/singleton-header.png">
<meta property="og:image" content="https://tonymistark.github.io/images/singleton-comic-1-en.png">
<meta property="og:image" content="https://tonymistark.github.io/images/singleton-structure-en.png">
<meta property="article:published_time" content="2023-11-23T13:08:58.000Z">
<meta property="article:modified_time" content="2023-11-23T14:35:50.091Z">
<meta property="article:author" content="Ice">
<meta property="article:tag" content="Design Pattern">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://tonymistark.github.io/images/singleton-header.png">

<link rel="canonical" href="https://tonymistark.github.io/2023/11/23/design-pattern/singleton/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'en'
  };
</script>

  <title>Singleton | BLOG</title>
  
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-W6L4L92Z6Z"></script>
    <script>
      if (CONFIG.hostname === location.hostname) {
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-W6L4L92Z6Z');
      }
    </script>


  <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?99c70b2174a7fbe4af476f28bafb19a3";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>




  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

<link rel="alternate" href="/./atom.xml" title="BLOG" type="application/atom+xml">
<link rel="alternate" href="/./rss2.xml" title="BLOG" type="application/rss+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">BLOG</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">用心记录思想</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
        <li class="menu-item menu-item-sitemap">

    <a href="/sitemap.xml" rel="section"><i class="fa fa-sitemap fa-fw"></i>Sitemap</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://tonymistark.github.io/2023/11/23/design-pattern/singleton/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Ice">
      <meta itemprop="description" content="安静地坐着学习">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="BLOG">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Singleton
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2023-11-23 21:08:58 / Modified: 22:35:50" itemprop="dateCreated datePublished" datetime="2023-11-23T21:08:58+08:00">2023-11-23</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/design-pattern/" itemprop="url" rel="index"><span itemprop="name">design-pattern</span></a>
                </span>
            </span>

          
            <span class="post-meta-item" title="Views" id="busuanzi_container_page_pv" style="display: none;">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">Views: </span>
              <span id="busuanzi_value_page_pv"></span>
            </span><br>
            <span class="post-meta-item" title="Symbols count in article">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">Symbols count in article: </span>
              <span>4.6k</span>
            </span>
            <span class="post-meta-item" title="Reading time">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">Reading time &asymp;</span>
              <span>17 mins.</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h1 id="Singleton-单例模式"><a href="#Singleton-单例模式" class="headerlink" title="Singleton 单例模式"></a>Singleton 单例模式</h1><h2 id="Intent-意图"><a href="#Intent-意图" class="headerlink" title="Intent 意图"></a>Intent 意图</h2><p><strong>Singleton</strong> is a creational design pattern that lets you ensure that a class has only one instance, while providing a global access point to this instance.<br>Singleton 是一种创建性设计模式，它允许您确保一个类只有一个实例，同时提供此实例的全局访问点。</p>
<div align="center"> <img src="/images/singleton-header.png"/></div>

<h2 id="Problem-问题"><a href="#Problem-问题" class="headerlink" title="Problem 问题"></a>Problem 问题</h2><p>The Singleton pattern solves two problems at the same time, violating the Single Responsibility Principle:<br>Singleton 模式同时解决了两个问题，违反了单一责任原则：</p>
<ol>
<li><strong>Ensure that a class has just a single instance</strong>. Why would anyone want to control how many instances a class has? The most common reason for this is to control access to some shared resource—for example, a database or a file.<br>确保一个类只有一个实例。为什么有人想要控制一个类有多少个实例？最常见的原因是控制对某些共享资源（例如数据库或文件）的访问。</li>
</ol>
<p>Here’s how it works: imagine that you created an object, but after a while decided to create a new one. Instead of receiving a fresh object, you’ll get the one you already created.<br>它是这样工作的：假设你创建了一个对象，但过了一段时间决定创建一个新对象。您将获得已创建的对象，而不是接收新对象。</p>
<p>Note that this behavior is impossible to implement with a regular constructor since a constructor call must always return a new object by design.<br>请注意，此行为无法使用常规构造函数实现，因为构造函数调用必须始终返回新对象。</p>
<div align="center"> <img src="/images/singleton-comic-1-en.png"/>Clients may not even realize that they’re working with the same object all the time.</br>客户甚至可能没有意识到他们一直在使用同一个对象。</div>

<ol start="2">
<li><strong>Provide a global access point to that instance</strong>.Remember those global variables that you (all right, me) used to store some essential objects? While they’re very handy, they’re also very unsafe since any code can potentially overwrite the contents of those variables and crash the app.<br>为该实例提供全局访问点。还记得你（好吧，我）用来存储一些基本对象的那些全局变量吗？虽然它们非常方便，但它们也非常不安全，因为任何代码都可能覆盖这些变量的内容并使应用程序崩溃。<br>Just like a global variable, the Singleton pattern lets you access some object from anywhere in the program. However, it also protects that instance from being overwritten by other code.<br>就像全局变量一样，Singleton 模式允许您从程序中的任何位置访问某些对象。但是，它还可以保护该实例不被其他代码覆盖。<br>There’s another side to this problem: you don’t want the code that solves problem #1 to be scattered all over your program. It’s much better to have it within one class, especially if the rest of your code already depends on it.<br>这个问题还有另一面：你不希望解决问题 #1 的代码分散在你的程序中。最好将它放在一个类中，特别是如果您的其余代码已经依赖于它。</li>
</ol>
<p>Nowadays, the Singleton pattern has become so popular that people may call something a singleton even if it solves just one of the listed problems.<br>如今，单例模式已经变得如此流行，以至于人们可能会称某物为单例，即使它只解决了列出的问题之一。</p>
<h2 id="Solution-解决方案"><a href="#Solution-解决方案" class="headerlink" title="Solution 解决方案"></a>Solution 解决方案</h2><p>All implementations of the Singleton have these two steps in common:<br>Singleton 的所有实现都具有以下两个共同步骤：</p>
<ul>
<li>Make the default constructor private, to prevent other objects from using the new operator with the Singleton class.<br>将默认构造函数设为私有，以防止其他对象将运 new 算符与 Singleton 类一起使用。</li>
<li>Create a static creation method that acts as a constructor. Under the hood, this method calls the private constructor to create an object and saves it in a static field. All following calls to this method return the cached object.<br>创建一个充当构造函数的静态创建方法。在后台，此方法调用私有构造函数来创建对象并将其保存在静态字段中。对此方法的所有后续调用都将返回缓存的对象。</li>
</ul>
<p>If your code has access to the Singleton class, then it’s able to call the Singleton’s static method. So whenever that method is called, the same object is always returned.<br>如果您的代码有权访问 Singleton 类，则它能够调用 Singleton 的静态方法。因此，每当调用该方法时，始终返回相同的对象。</p>
<h2 id="Real-World-Analogy-真实世界的类比"><a href="#Real-World-Analogy-真实世界的类比" class="headerlink" title="Real-World Analogy 真实世界的类比"></a>Real-World Analogy 真实世界的类比</h2><p>The government is an excellent example of the Singleton pattern. A country can have only one official government. Regardless of the personal identities of the individuals who form governments, the title, “The Government of X”, is a global point of access that identifies the group of people in charge.<br>政府是辛格尔顿模式的一个很好的例子。一个国家只能有一个官方政府。无论组成政府的个人的个人身份如何，“X政府”这个头衔都是一个全球访问点，用于识别负责人群体。</p>
<h2 id="Structure-结构"><a href="#Structure-结构" class="headerlink" title="Structure 结构"></a>Structure 结构</h2><div align="center"> <img src="/images/singleton-structure-en.png"/></div>
The **Singleton** class declares the static method getInstance that returns the same instance of its own class.
**Singleton** 类声明返回其自身类的相同实例的静态方法 getInstance 。

<p>The Singleton’s constructor should be hidden from the client code. Calling the getInstance method should be the only way of getting the Singleton object.<br>Singleton 的构造函数应在客户端代码中隐藏。调用该 getInstance 方法应该是获取 Singleton 对象的唯一方法。</p>
<h2 id="Pseudocode-伪代码"><a href="#Pseudocode-伪代码" class="headerlink" title="Pseudocode 伪代码"></a>Pseudocode 伪代码</h2><p>In this example, the database connection class acts as a <strong>Singleton</strong>. This class doesn’t have a public constructor, so the only way to get its object is to call the <code>getInstance</code> method. This method caches the first created object and returns it in all subsequent calls.<br>在此示例中，数据库连接类充当 Singleton。此类没有公共构造函数，因此获取其对象的唯一方法是调用该 <code>getInstance</code> 方法。此方法缓存第一个创建的对象，并在所有后续调用中返回该对象。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// The Database class defines the `getInstance` method that lets</span></span><br><span class="line"><span class="comment">// clients access the same instance of a database connection</span></span><br><span class="line"><span class="comment">// throughout the program.</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Database</span> is</span><br><span class="line">    <span class="comment">// The field for storing the singleton instance should be</span></span><br><span class="line">    <span class="comment">// declared static.</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> field instance: Database</span><br><span class="line"></span><br><span class="line">    <span class="comment">// The singleton&#x27;s constructor should always be private to</span></span><br><span class="line">    <span class="comment">// prevent direct construction calls with the `new`</span></span><br><span class="line">    <span class="comment">// operator.</span></span><br><span class="line">    <span class="keyword">private</span> constructor <span class="title function_">Database</span><span class="params">()</span> is</span><br><span class="line">        <span class="comment">// Some initialization code, such as the actual</span></span><br><span class="line">        <span class="comment">// connection to a database server.</span></span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// The static method that controls access to the singleton</span></span><br><span class="line">    <span class="comment">// instance.</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> method <span class="title function_">getInstance</span><span class="params">()</span> is</span><br><span class="line">        <span class="title function_">if</span> <span class="params">(Database.instance == <span class="literal">null</span>)</span> then</span><br><span class="line">            <span class="title function_">acquireThreadLock</span><span class="params">()</span> and then</span><br><span class="line">                <span class="comment">// Ensure that the instance hasn&#x27;t yet been</span></span><br><span class="line">                <span class="comment">// initialized by another thread while this one</span></span><br><span class="line">                <span class="comment">// has been waiting for the lock&#x27;s release.</span></span><br><span class="line">                <span class="keyword">if</span> (Database.instance == <span class="literal">null</span>) then</span><br><span class="line">                    Database.instance = <span class="keyword">new</span> <span class="title class_">Database</span>()</span><br><span class="line">        <span class="keyword">return</span> Database.instance</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Finally, any singleton should define some business logic</span></span><br><span class="line">    <span class="comment">// which can be executed on its instance.</span></span><br><span class="line">    <span class="keyword">public</span> method <span class="title function_">query</span><span class="params">(sql)</span> is</span><br><span class="line">        <span class="comment">// For instance, all database queries of an app go</span></span><br><span class="line">        <span class="comment">// through this method. Therefore, you can place</span></span><br><span class="line">        <span class="comment">// throttling or caching logic here.</span></span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Application</span> is</span><br><span class="line">    method <span class="title function_">main</span><span class="params">()</span> is</span><br><span class="line">        <span class="type">Database</span> <span class="variable">foo</span> <span class="operator">=</span> Database.getInstance()</span><br><span class="line">        foo.query(<span class="string">&quot;SELECT ...&quot;</span>)</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">        <span class="type">Database</span> <span class="variable">bar</span> <span class="operator">=</span> Database.getInstance()</span><br><span class="line">        bar.query(<span class="string">&quot;SELECT ...&quot;</span>)</span><br><span class="line">        <span class="comment">// The variable `bar` will contain the same object as</span></span><br><span class="line">        <span class="comment">// the variable `foo`.</span></span><br></pre></td></tr></table></figure>
<h2 id="Applicability-适用性"><a href="#Applicability-适用性" class="headerlink" title="Applicability 适用性"></a>Applicability 适用性</h2><ul>
<li><p><strong>Use the Singleton pattern when a class in your program should have just a single instance available to all clients; for example, a single database object shared by different parts of the program.当程序中的类应该只有一个实例可供所有客户端使用时，请使用单例模式;例如，由程序的不同部分共享的单个数据库对象。</strong></p>
</li>
<li><p>The Singleton pattern disables all other means of creating objects of a class except for the special creation method. This method either creates a new object or returns an existing one if it has already been created.<br>Singleton 模式禁用除特殊创建方法之外的所有其他创建类对象的方法。此方法要么创建一个新对象，要么返回一个现有对象（如果已创建）。</p>
</li>
<li><p><strong>Use the Singleton pattern when you need stricter control over global variables.当您需要对全局变量进行更严格的控制时，请使用单例模式。</strong></p>
</li>
<li><p>Unlike global variables, the Singleton pattern guarantees that there’s just one instance of a class. Nothing, except for the Singleton class itself, can replace the cached instance.<br>与全局变量不同，单例模式保证一个类只有一个实例。除了 Singleton 类本身之外，没有任何内容可以替换缓存的实例。</p>
</li>
</ul>
<p>Note that you can always adjust this limitation and allow creating any number of Singleton instances. The only piece of code that needs changing is the body of the <code>getInstance</code> method.<br>请注意，您始终可以调整此限制，并允许创建任意数量的单例实例。唯一需要更改的代码段是 <code>getInstance</code> 方法的主体。</p>
<h2 id="How-to-Implement-如何实现"><a href="#How-to-Implement-如何实现" class="headerlink" title="How to Implement 如何实现"></a>How to Implement 如何实现</h2><ol>
<li><p>Add a private static field to the class for storing the singleton instance.<br>在类中添加一个私有静态字段，用于存储单例实例。</p>
</li>
<li><p>Declare a public static creation method for getting the singleton instance.<br>声明用于获取单例实例的公共静态创建方法。</p>
</li>
<li><p>Implement “lazy initialization” inside the static method. It should create a new object on its first call and put it into the static field. The method should always return that instance on all subsequent calls.<br>在静态方法中实现“延迟初始化”。它应该在第一次调用时创建一个新对象，并将其放入静态字段中。该方法应始终在所有后续调用中返回该实例。</p>
</li>
<li><p>Make the constructor of the class private. The static method of the class will still be able to call the constructor, but not the other objects.<br>将类的构造函数设为私有。类的静态方法仍然能够调用构造函数，但不能调用其他对象。</p>
</li>
<li><p>Go over the client code and replace all direct calls to the singleton’s constructor with calls to its static creation method.<br>遍历客户端代码，并将对单例构造函数的所有直接调用替换为对其静态创建方法的调用。</p>
</li>
</ol>
<h2 id="Pros-and-Cons-优点和缺点"><a href="#Pros-and-Cons-优点和缺点" class="headerlink" title="Pros and Cons 优点和缺点"></a>Pros and Cons 优点和缺点</h2><table>
<thead>
<tr>
<th>Pros 优点</th>
<th>Cons 缺点</th>
</tr>
</thead>
<tbody><tr>
<td>You can be sure that a class has only a single instance.可以确定一个类只有一个实例。</td>
<td>Violates the Single Responsibility Principle. The pattern solves two problems at the time.违反了单一责任原则。该模式解决了当时的两个问题。</td>
</tr>
<tr>
<td>You gain a global access point to that instance.您将获得该实例的全局访问点。</td>
<td>The Singleton pattern can mask bad design, for instance, when the components of the program know too much about each other.单例模式可以掩盖糟糕的设计，例如，当程序的组件彼此了解太多时。</td>
</tr>
<tr>
<td>The singleton object is initialized only when it’s requested for the first time.仅当首次请求单一实例对象时，才会对其进行初始化。</td>
<td>The pattern requires special treatment in a multithreaded environment so that multiple threads won’t create a singleton object several times.</td>
</tr>
<tr>
<td>该模式需要在多线程环境中进行特殊处理，以便多个线程不会多次创建单一实例对象。</td>
<td></td>
</tr>
<tr>
<td></td>
<td>It may be difficult to unit test the client code of the Singleton because many test frameworks rely on inheritance when producing mock objects. Since the constructor of the singleton class is private and overriding static methods is impossible in most languages, you will need to think of a creative way to mock the singleton. Or just don’t write the tests. Or don’t use the Singleton pattern.对 Singleton 的客户端代码进行单元测试可能很困难，因为许多测试框架在生成模拟对象时依赖于继承。由于单例类的构造函数是私有的，并且在大多数语言中不可能重写静态方法，因此您需要想出一种创造性的方法来模拟单例。或者干脆不写测试。或者不要使用单一实例模式。</td>
</tr>
</tbody></table>
<h2 id="Relations-with-Other-Patterns-与其他模式的关系"><a href="#Relations-with-Other-Patterns-与其他模式的关系" class="headerlink" title="Relations with Other Patterns 与其他模式的关系"></a>Relations with Other Patterns 与其他模式的关系</h2><ul>
<li><p>A <strong>Facade</strong> class can often be transformed into a <strong>Singleton</strong> since a single facade object is sufficient in most cases.<br>Facade 类通常可以转换为 Singleton，因为在大多数情况下，单个 Facade 对象就足够了。</p>
</li>
<li><p><strong>Flyweight</strong> would resemble <strong>Singleton</strong> if you somehow managed to reduce all shared states of the objects to just one flyweight object. But there are two fundamental differences between these patterns:<br>如果你以某种方式设法将对象的所有共享状态减少到一个蝇量级对象，那么 Flyweight 将类似于 Singleton。但这些模式之间有两个根本区别：</p>
<ol>
<li>There should be only one Singleton instance, whereas a Flyweight class can have multiple instances with different intrinsic states.<br>应该只有一个 Singleton 实例，而 Flyweight 类可以有多个具有不同内部状态的实例。</li>
<li>The Singleton object can be mutable. Flyweight objects are immutable.<br>Singleton 对象可以是可变的。轻量级对象是不可变的。</li>
</ol>
</li>
<li><p>Abstract Factories, Builders and Prototypes can all be implemented as Singletons.<br>抽象工厂、构建器和原型都可以作为单例实现。</p>
</li>
</ul>
<h2 id="Code-Examples-代码示例"><a href="#Code-Examples-代码示例" class="headerlink" title="Code Examples 代码示例"></a>Code Examples 代码示例</h2><h3 id="Python-Navie-Singleton-简单版"><a href="#Python-Navie-Singleton-简单版" class="headerlink" title="Python: Navie Singleton 简单版"></a>Python: Navie Singleton 简单版</h3><p>It’s pretty easy to implement a sloppy Singleton. You just need to hide the constructor and implement a static creation method.<br>实现一个草率的 Singleton 非常容易。你只需要隐藏构造函数并实现一个静态创建方法。</p>
<p>The same class behaves incorrectly in a multithreaded environment. Multiple threads can call the creation method simultaneously and get several instances of Singleton class.<br>同一类在多线程环境中的行为不正确。多个线程可以同时调用创建方法，并获取 Singleton 类的多个实例。</p>
<h4 id="main-py-Conceptual-example"><a href="#main-py-Conceptual-example" class="headerlink" title="main.py: Conceptual example"></a>main.py: Conceptual example</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">SingletonMeta</span>(<span class="title class_ inherited__">type</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    The Singleton class can be implemented in different ways in Python. Some</span></span><br><span class="line"><span class="string">    possible methods include: base class, decorator, metaclass. We will use the</span></span><br><span class="line"><span class="string">    metaclass because it is best suited for this purpose.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    _instances = &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__call__</span>(<span class="params">cls, *args, **kwargs</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        Possible changes to the value of the `__init__` argument do not affect</span></span><br><span class="line"><span class="string">        the returned instance.</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">if</span> cls <span class="keyword">not</span> <span class="keyword">in</span> cls._instances:</span><br><span class="line">            instance = <span class="built_in">super</span>().__call__(*args, **kwargs)</span><br><span class="line">            cls._instances[cls] = instance</span><br><span class="line">        <span class="keyword">return</span> cls._instances[cls]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Singleton</span>(metaclass=SingletonMeta):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">some_business_logic</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        Finally, any singleton should define some business logic, which can be</span></span><br><span class="line"><span class="string">        executed on its instance.</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># ...</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    <span class="comment"># The client code.</span></span><br><span class="line"></span><br><span class="line">    s1 = Singleton()</span><br><span class="line">    s2 = Singleton()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">id</span>(s1) == <span class="built_in">id</span>(s2):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Singleton works, both variables contain the same instance.&quot;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Singleton failed, variables contain different instances.&quot;</span>)</span><br></pre></td></tr></table></figure>
<h4 id="Output-txt-Execution-result"><a href="#Output-txt-Execution-result" class="headerlink" title="Output.txt: Execution result"></a>Output.txt: Execution result</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Singleton works, both variables contain the same instance.</span><br></pre></td></tr></table></figure>

<h3 id="Python-Thread-safe-Singleton-线程安全单例"><a href="#Python-Thread-safe-Singleton-线程安全单例" class="headerlink" title="Python: Thread-safe Singleton 线程安全单例"></a>Python: Thread-safe Singleton 线程安全单例</h3><p>To fix the problem, you have to synchronize threads during the first creation of the Singleton object.<br>若要解决此问题，必须在首次创建 Singleton 对象期间同步线程。</p>
<h4 id="main-py-Conceptual-example-1"><a href="#main-py-Conceptual-example-1" class="headerlink" title="main.py: Conceptual example"></a>main.py: Conceptual example</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> threading <span class="keyword">import</span> Lock, Thread</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SingletonMeta</span>(<span class="title class_ inherited__">type</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    This is a thread-safe implementation of Singleton.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    _instances = &#123;&#125;</span><br><span class="line"></span><br><span class="line">    _lock: Lock = Lock()</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    We now have a lock object that will be used to synchronize threads during</span></span><br><span class="line"><span class="string">    first access to the Singleton.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__call__</span>(<span class="params">cls, *args, **kwargs</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        Possible changes to the value of the `__init__` argument do not affect</span></span><br><span class="line"><span class="string">        the returned instance.</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="comment"># Now, imagine that the program has just been launched. Since there&#x27;s no</span></span><br><span class="line">        <span class="comment"># Singleton instance yet, multiple threads can simultaneously pass the</span></span><br><span class="line">        <span class="comment"># previous conditional and reach this point almost at the same time. The</span></span><br><span class="line">        <span class="comment"># first of them will acquire lock and will proceed further, while the</span></span><br><span class="line">        <span class="comment"># rest will wait here.</span></span><br><span class="line">        <span class="keyword">with</span> cls._lock:</span><br><span class="line">            <span class="comment"># The first thread to acquire the lock, reaches this conditional,</span></span><br><span class="line">            <span class="comment"># goes inside and creates the Singleton instance. Once it leaves the</span></span><br><span class="line">            <span class="comment"># lock block, a thread that might have been waiting for the lock</span></span><br><span class="line">            <span class="comment"># release may then enter this section. But since the Singleton field</span></span><br><span class="line">            <span class="comment"># is already initialized, the thread won&#x27;t create a new object.</span></span><br><span class="line">            <span class="keyword">if</span> cls <span class="keyword">not</span> <span class="keyword">in</span> cls._instances:</span><br><span class="line">                instance = <span class="built_in">super</span>().__call__(*args, **kwargs)</span><br><span class="line">                cls._instances[cls] = instance</span><br><span class="line">        <span class="keyword">return</span> cls._instances[cls]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Singleton</span>(metaclass=SingletonMeta):</span><br><span class="line">    value: <span class="built_in">str</span> = <span class="literal">None</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    We&#x27;ll use this property to prove that our Singleton really works.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, value: <span class="built_in">str</span></span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">        self.value = value</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">some_business_logic</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        Finally, any singleton should define some business logic, which can be</span></span><br><span class="line"><span class="string">        executed on its instance.</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">test_singleton</span>(<span class="params">value: <span class="built_in">str</span></span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">    singleton = Singleton(value)</span><br><span class="line">    <span class="built_in">print</span>(singleton.value)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    <span class="comment"># The client code.</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;If you see the same value, then singleton was reused (yay!)\n&quot;</span></span><br><span class="line">          <span class="string">&quot;If you see different values, &quot;</span></span><br><span class="line">          <span class="string">&quot;then 2 singletons were created (booo!!)\n\n&quot;</span></span><br><span class="line">          <span class="string">&quot;RESULT:\n&quot;</span>)</span><br><span class="line"></span><br><span class="line">    process1 = Thread(target=test_singleton, args=(<span class="string">&quot;FOO&quot;</span>,))</span><br><span class="line">    process2 = Thread(target=test_singleton, args=(<span class="string">&quot;BAR&quot;</span>,))</span><br><span class="line">    process1.start()</span><br><span class="line">    process2.start()</span><br></pre></td></tr></table></figure>
<h4 id="Output-txt-Execution-result-1"><a href="#Output-txt-Execution-result-1" class="headerlink" title="Output.txt: Execution result"></a>Output.txt: Execution result</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">If you see the same value, then singleton was reused (yay!)</span><br><span class="line">If you see different values, then 2 singletons were created (booo!!)</span><br><span class="line"></span><br><span class="line">RESULT:</span><br><span class="line"></span><br><span class="line">FOO</span><br><span class="line">FOO</span><br></pre></td></tr></table></figure>

<h3 id="Rust-specifics"><a href="#Rust-specifics" class="headerlink" title="Rust specifics"></a>Rust specifics</h3><p>By definition, Singleton is a global mutable object. In Rust this is a <code>static mut</code> item. Thus, to avoid all sorts of concurrency issues, the function or block that is either reading or writing to a mutable static variable should be marked as an <code>unsafe</code> block.<br>根据定义，Singleton 是一个全局可变对象。在 Rust 中， static mut 这是一个项目。因此，为了避免各种并发问题，应将读取或写入可变静态变量的函数或块标记为 <code>unsafe</code> 块。</p>
<p>For this reason, the Singleton pattern can be percieved as unsafe. However, the pattern is still widely used in practice. A good read-world example of Singleton is a <code>log</code> crate that introduces <code>log!</code>, <code>debug!</code> and other logging macros, which you can use throughout your code after setting up a concrete logger instance, such as <code>env_logger</code>. As we can see, <code>env_logger</code> uses log::set_boxed_logger under the hood, which has an <code>unsafe</code> block to set up a global logger object.<br>因此，Singleton 模式可能被认为是不安全的。然而，该模式在实践中仍然被广泛使用。Singleton 的一个很好的读取世界示例是一个 log crate，它引入了 log! 和其他 debug! 日志记录宏，在设置具体的记录器实例（如 <code>env_logger</code>）后，您可以在整个代码中使用这些宏。正如我们所看到的， <code>env_logger</code> 在后台使用 log：：set_boxed_logger，它有一个 unsafe 用于设置全局记录器对象的块。</p>
<ul>
<li><p>In order to provide safe and usable access to a singleton object, introduce an API hiding unsafe blocks under the hood.<br>为了提供对单例对象的安全且可用的访问，请在后台引入一个隐藏 <code>unsafe</code> 块的 API。</p>
</li>
<li><p>See the thread about a mutable Singleton on Stackoverflow for more information.<br>有关更多信息，请参阅 Stackoverflow 上有关可变 Singleton 的线程。</p>
</li>
</ul>
<p>Starting with Rust 1.63, <code>Mutex::new</code> is <code>const</code>, you can use global static Mutex locks without needing lazy initialization. See the Singleton using <code>Mutex</code> example below.<br>从 Rust 1.63 开始，您可以使用全局静态 Mutex 锁， <code>Mutex::new</code> <code>const</code> 而无需延迟初始化。请参阅下面的使用互斥锁的单例示例。</p>
<h4 id="Safe-Singleton-安全单例"><a href="#Safe-Singleton-安全单例" class="headerlink" title="Safe Singleton 安全单例"></a>Safe Singleton 安全单例</h4><p>A pure safe way to implement Singleton in Rust is using no global variables at all and passing everything around through function arguments. The oldest living variable is an object created at the start of the <code>main()</code>.<br>在 Rust 中实现 Singleton 的一个纯粹安全的方法是完全不使用全局变量，并通过函数参数传递所有内容。最早的活变量是在 的开头创建的对象 <code>main()</code> 。</p>
<h4 id="safe-rs"><a href="#safe-rs" class="headerlink" title="safe.rs"></a>safe.rs</h4><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//! A pure safe way to implement Singleton in Rust is using no static variables</span></span><br><span class="line"><span class="comment">//! and passing everything around through function arguments.</span></span><br><span class="line"><span class="comment">//! The oldest living variable is an object created at the start of the `main()`.</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">change</span>(global_state: &amp;<span class="keyword">mut</span> <span class="type">u32</span>) &#123;</span><br><span class="line">    *global_state += <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">global_state</span> = <span class="number">0u32</span>;</span><br><span class="line"></span><br><span class="line">    <span class="title function_ invoke__">change</span>(&amp;<span class="keyword">mut</span> global_state);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;Final state: &#123;&#125;&quot;</span>, global_state);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="Output"><a href="#Output" class="headerlink" title="Output"></a>Output</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Final state: 1</span><br></pre></td></tr></table></figure>

<h4 id="Lazy-Singleton-惰性单例模式"><a href="#Lazy-Singleton-惰性单例模式" class="headerlink" title="Lazy Singleton 惰性单例模式"></a>Lazy Singleton 惰性单例模式</h4><p>This is a singleton implementation via <code>lazy_static!</code>, which allows declaring a static variable with lazy initialization at first access. It is actually implemented via <code>unsafe</code> with <code>static mut</code> manipulation, however, it keeps your code clear of <code>unsafe</code> blocks.<br>这是一个单例实现，它 lazy_static! 允许在首次访问时使用延迟初始化声明静态变量。它实际上 <code>unsafe</code> 是通过 <code>static mut</code> 操作实现的，但是，它使您的代码没有 <code>unsafe</code> 块。</p>
<h4 id="lazy-rs"><a href="#lazy-rs" class="headerlink" title="lazy.rs"></a>lazy.rs</h4><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//! Taken from: https://stackoverflow.com/questions/27791532/how-do-i-create-a-global-mutable-singleton</span></span><br><span class="line"><span class="comment">//!</span></span><br><span class="line"><span class="comment">//! Rust doesn&#x27;t really allow a singleton pattern without `unsafe` because it</span></span><br><span class="line"><span class="comment">//! doesn&#x27;t have a safe mutable global state.</span></span><br><span class="line"><span class="comment">//!</span></span><br><span class="line"><span class="comment">//! `lazy-static` allows declaring a static variable with lazy initialization</span></span><br><span class="line"><span class="comment">//! at first access. It is actually implemented via `unsafe` with `static mut`</span></span><br><span class="line"><span class="comment">//! manipulation, however, it keeps your code clear of `unsafe` blocks.</span></span><br><span class="line"><span class="comment">//!</span></span><br><span class="line"><span class="comment">//! `Mutex` provides safe access to a single object.</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> lazy_static::lazy_static;</span><br><span class="line"><span class="keyword">use</span> std::sync::Mutex;</span><br><span class="line"></span><br><span class="line">lazy_static! &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">ref</span> ARRAY: Mutex&lt;<span class="type">Vec</span>&lt;<span class="type">u8</span>&gt;&gt; = Mutex::<span class="title function_ invoke__">new</span>(<span class="built_in">vec!</span>[]);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">do_a_call</span>() &#123;</span><br><span class="line">    ARRAY.<span class="title function_ invoke__">lock</span>().<span class="title function_ invoke__">unwrap</span>().<span class="title function_ invoke__">push</span>(<span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="title function_ invoke__">do_a_call</span>();</span><br><span class="line">    <span class="title function_ invoke__">do_a_call</span>();</span><br><span class="line">    <span class="title function_ invoke__">do_a_call</span>();</span><br><span class="line"></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;Called &#123;&#125;&quot;</span>, ARRAY.<span class="title function_ invoke__">lock</span>().<span class="title function_ invoke__">unwrap</span>().<span class="title function_ invoke__">len</span>());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="Output-1"><a href="#Output-1" class="headerlink" title="Output"></a>Output</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Called 3</span><br></pre></td></tr></table></figure>

<h4 id="Singleton-using-Mutex-使用互斥锁的单例"><a href="#Singleton-using-Mutex-使用互斥锁的单例" class="headerlink" title="Singleton using Mutex 使用互斥锁的单例"></a>Singleton using Mutex 使用互斥锁的单例</h4><p>Starting with <code>Rust 1.63</code>, it can be easier to work with global mutable singletons, although it’s still preferable to avoid global variables in mostcases.<br>从 开始 <code>Rust 1.63</code> ，使用全局可变单例会更容易，尽管在大多数情况下仍然最好避免全局变量。</p>
<p>Now that <code>Mutex::new</code> is <code>const</code>, you can use global static <code>Mutex</code> locks without needing lazy initialization.<br>现在 <code>Mutex::new</code> ，您可以使用全局静态 <code>Mutex </code>锁 <code>const</code> ，而无需延迟初始化。</p>
<h4 id="mutex-rs"><a href="#mutex-rs" class="headerlink" title="mutex.rs"></a>mutex.rs</h4><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//! ructc 1.63</span></span><br><span class="line"><span class="comment">//! https://stackoverflow.com/questions/27791532/how-do-i-create-a-global-mutable-singleton</span></span><br><span class="line"><span class="comment">//!</span></span><br><span class="line"><span class="comment">//! Starting with Rust 1.63, it can be easier to work with global mutable</span></span><br><span class="line"><span class="comment">//! singletons, although it&#x27;s still preferable to avoid global variables in most</span></span><br><span class="line"><span class="comment">//! cases.</span></span><br><span class="line"><span class="comment">//!</span></span><br><span class="line"><span class="comment">//! Now that `Mutex::new` is `const`, you can use global static `Mutex` locks</span></span><br><span class="line"><span class="comment">//! without needing lazy initialization.</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> std::sync::Mutex;</span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> ARRAY: Mutex&lt;<span class="type">Vec</span>&lt;<span class="type">i32</span>&gt;&gt; = Mutex::<span class="title function_ invoke__">new</span>(<span class="type">Vec</span>::<span class="title function_ invoke__">new</span>());</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">do_a_call</span>() &#123;</span><br><span class="line">    ARRAY.<span class="title function_ invoke__">lock</span>().<span class="title function_ invoke__">unwrap</span>().<span class="title function_ invoke__">push</span>(<span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="title function_ invoke__">do_a_call</span>();</span><br><span class="line">    <span class="title function_ invoke__">do_a_call</span>();</span><br><span class="line">    <span class="title function_ invoke__">do_a_call</span>();</span><br><span class="line"></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;Called &#123;&#125; times&quot;</span>, ARRAY.<span class="title function_ invoke__">lock</span>().<span class="title function_ invoke__">unwrap</span>().<span class="title function_ invoke__">len</span>());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="Output-2"><a href="#Output-2" class="headerlink" title="Output"></a>Output</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Called 3 times</span><br></pre></td></tr></table></figure>

    </div>

    
    
    
        <div class="reward-container">
  <div>宇宙山河浪漫，赞赏动力无限</div>
  <button onclick="var qr = document.getElementById('qr'); qr.style.display = (qr.style.display === 'none') ? 'block' : 'none';">
    Donate
  </button>
  <div id="qr" style="display: none;">
      
      <div style="display: inline-block;">
        <img src="/images/wechatpay.png" alt="Ice WeChat Pay">
        <p>WeChat Pay</p>
      </div>
      
      <div style="display: inline-block;">
        <img src="/images/alipay.png" alt="Ice Alipay">
        <p>Alipay</p>
      </div>

  </div>
</div>

        

  <div class="followme">
    <p>Welcome to my other publishing channels</p>

    <div class="social-list">

        <div class="social-item">
          <a target="_blank" class="social-link" href="/images/wechat_channel.png">
            <span class="icon">
              <i class="fab fa-weixin"></i>
            </span>

            <span class="label">WeChat</span>
          </a>
        </div>

        <div class="social-item">
          <a target="_blank" class="social-link" href="/atom.xml">
            <span class="icon">
              <i class="fa fa-rss"></i>
            </span>

            <span class="label">RSS</span>
          </a>
        </div>
    </div>
  </div>


      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/Design-Pattern/" rel="tag"># Design Pattern</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2023/11/22/design-pattern/prototype/" rel="prev" title="Prototype">
      <i class="fa fa-chevron-left"></i> Prototype
    </a></div>
      <div class="post-nav-item">
    <a href="/2023/11/24/sam_altman/growth-and-government/" rel="next" title="Growth and Government">
      Growth and Government <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          
    <div class="comments" id="gitalk-container"></div>

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#Singleton-%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F"><span class="nav-number">1.</span> <span class="nav-text">Singleton 单例模式</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Intent-%E6%84%8F%E5%9B%BE"><span class="nav-number">1.1.</span> <span class="nav-text">Intent 意图</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Problem-%E9%97%AE%E9%A2%98"><span class="nav-number">1.2.</span> <span class="nav-text">Problem 问题</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Solution-%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88"><span class="nav-number">1.3.</span> <span class="nav-text">Solution 解决方案</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Real-World-Analogy-%E7%9C%9F%E5%AE%9E%E4%B8%96%E7%95%8C%E7%9A%84%E7%B1%BB%E6%AF%94"><span class="nav-number">1.4.</span> <span class="nav-text">Real-World Analogy 真实世界的类比</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Structure-%E7%BB%93%E6%9E%84"><span class="nav-number">1.5.</span> <span class="nav-text">Structure 结构</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Pseudocode-%E4%BC%AA%E4%BB%A3%E7%A0%81"><span class="nav-number">1.6.</span> <span class="nav-text">Pseudocode 伪代码</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Applicability-%E9%80%82%E7%94%A8%E6%80%A7"><span class="nav-number">1.7.</span> <span class="nav-text">Applicability 适用性</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#How-to-Implement-%E5%A6%82%E4%BD%95%E5%AE%9E%E7%8E%B0"><span class="nav-number">1.8.</span> <span class="nav-text">How to Implement 如何实现</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Pros-and-Cons-%E4%BC%98%E7%82%B9%E5%92%8C%E7%BC%BA%E7%82%B9"><span class="nav-number">1.9.</span> <span class="nav-text">Pros and Cons 优点和缺点</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Relations-with-Other-Patterns-%E4%B8%8E%E5%85%B6%E4%BB%96%E6%A8%A1%E5%BC%8F%E7%9A%84%E5%85%B3%E7%B3%BB"><span class="nav-number">1.10.</span> <span class="nav-text">Relations with Other Patterns 与其他模式的关系</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Code-Examples-%E4%BB%A3%E7%A0%81%E7%A4%BA%E4%BE%8B"><span class="nav-number">1.11.</span> <span class="nav-text">Code Examples 代码示例</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Python-Navie-Singleton-%E7%AE%80%E5%8D%95%E7%89%88"><span class="nav-number">1.11.1.</span> <span class="nav-text">Python: Navie Singleton 简单版</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#main-py-Conceptual-example"><span class="nav-number">1.11.1.1.</span> <span class="nav-text">main.py: Conceptual example</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Output-txt-Execution-result"><span class="nav-number">1.11.1.2.</span> <span class="nav-text">Output.txt: Execution result</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Python-Thread-safe-Singleton-%E7%BA%BF%E7%A8%8B%E5%AE%89%E5%85%A8%E5%8D%95%E4%BE%8B"><span class="nav-number">1.11.2.</span> <span class="nav-text">Python: Thread-safe Singleton 线程安全单例</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#main-py-Conceptual-example-1"><span class="nav-number">1.11.2.1.</span> <span class="nav-text">main.py: Conceptual example</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Output-txt-Execution-result-1"><span class="nav-number">1.11.2.2.</span> <span class="nav-text">Output.txt: Execution result</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Rust-specifics"><span class="nav-number">1.11.3.</span> <span class="nav-text">Rust specifics</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Safe-Singleton-%E5%AE%89%E5%85%A8%E5%8D%95%E4%BE%8B"><span class="nav-number">1.11.3.1.</span> <span class="nav-text">Safe Singleton 安全单例</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#safe-rs"><span class="nav-number">1.11.3.2.</span> <span class="nav-text">safe.rs</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Output"><span class="nav-number">1.11.3.3.</span> <span class="nav-text">Output</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Lazy-Singleton-%E6%83%B0%E6%80%A7%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F"><span class="nav-number">1.11.3.4.</span> <span class="nav-text">Lazy Singleton 惰性单例模式</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#lazy-rs"><span class="nav-number">1.11.3.5.</span> <span class="nav-text">lazy.rs</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Output-1"><span class="nav-number">1.11.3.6.</span> <span class="nav-text">Output</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Singleton-using-Mutex-%E4%BD%BF%E7%94%A8%E4%BA%92%E6%96%A5%E9%94%81%E7%9A%84%E5%8D%95%E4%BE%8B"><span class="nav-number">1.11.3.7.</span> <span class="nav-text">Singleton using Mutex 使用互斥锁的单例</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#mutex-rs"><span class="nav-number">1.11.3.8.</span> <span class="nav-text">mutex.rs</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Output-2"><span class="nav-number">1.11.3.9.</span> <span class="nav-text">Output</span></a></li></ol></li></ol></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Ice</p>
  <div class="site-description" itemprop="description">安静地坐着学习</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">67</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">7</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">9</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/TonyMistark" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;TonyMistark" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://gitee.com/Micestark" title="Gitee → https:&#x2F;&#x2F;gitee.com&#x2F;Micestark" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>Gitee</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:tony_mistark@163.com" title="E-Mail → mailto:tony_mistark@163.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://twitter.com/Tony_Mistark" title="Twitter → https:&#x2F;&#x2F;twitter.com&#x2F;Tony_Mistark" rel="noopener" target="_blank"><i class="fab fa-twitter fa-fw"></i>Twitter</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Ice</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-area"></i>
    </span>
    <span title="Symbols count total">92k</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="Reading time total">5:33</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a>
  </div>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="Total Visitors">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="Total Views">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/medium-zoom@1/dist/medium-zoom.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.css">

<script>
NexT.utils.loadComments(document.querySelector('#gitalk-container'), () => {
  NexT.utils.getScript('//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js', () => {
    var gitalk = new Gitalk({
      clientID    : '298b6503f44953bd4193',
      clientSecret: '6756a6cfc10d74976c79256c96ae1c441f3116ac',
      repo        : 'tonymistark.github.io',
      owner       : 'TonyMistark',
      admin       : ['TonyMistark'],
      id          : '875df349c06770a3ec16b9710c97c227',
        language: 'zh-CN',
      distractionFreeMode: true
    });
    gitalk.render('gitalk-container');
  }, window.Gitalk);
});
</script>

</body>
</html>
